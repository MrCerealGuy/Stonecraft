/* WARNING: This file was automatically generated by lua2c. */

#ifdef __cplusplus
extern "C" {
#endif
#include <lua.h>
#include <lauxlib.h>
#include <lualib.h>
#ifdef __cplusplus
}
#endif
#include <stdio.h>
#include <stdlib.h>


#include <string.h>


#include <assert.h>

/* function(pos) */
static int lcf1 (lua_State * L) {
  enum { lc_nformalargs = 1 };
  lua_settop(L,1);
  
  /* local meta = minetest.env:get_meta(pos) */
  lua_getfield(L,LUA_ENVIRONINDEX,"minetest");
  lua_pushliteral(L,"env");
  lua_gettable(L,-2);
  lua_remove(L,-2);
  lua_pushliteral(L,"get_meta");
  lua_gettable(L,-2);
  lua_insert(L,-2);
  lua_pushvalue(L,1);
  lua_call(L,2,1);
  assert(lua_gettop(L) == 2);
  
  /* meta:set_string("formspec",
   * 				"size[8,8]"..
   * 				"list[current_name;main;0,0;8,3;]"..
   * 				"list[current_player;main;0,4;8,4;]") */
  lua_pushvalue(L,2);
  lua_pushliteral(L,"set_string");
  lua_gettable(L,-2);
  lua_insert(L,-2);
  lua_pushliteral(L,"formspec");
  lua_pushliteral(L,"size[8,8]");
  lua_pushliteral(L,"list[current_name;main;0,0;8,3;]");
  lua_pushliteral(L,"list[current_player;main;0,4;8,4;]");
  lua_concat(L,2);
  lua_concat(L,2);
  lua_call(L,3,0);
  assert(lua_gettop(L) == 2);
  
  /* meta:set_string("infotext", "Box") */
  lua_pushvalue(L,2);
  lua_pushliteral(L,"set_string");
  lua_gettable(L,-2);
  lua_insert(L,-2);
  lua_pushliteral(L,"infotext");
  lua_pushliteral(L,"Box");
  lua_call(L,3,0);
  assert(lua_gettop(L) == 2);
  
  /* local inv = meta:get_inventory() */
  lua_pushvalue(L,2);
  lua_pushliteral(L,"get_inventory");
  lua_gettable(L,-2);
  lua_insert(L,-2);
  lua_call(L,1,1);
  assert(lua_gettop(L) == 3);
  
  /* inv:set_size("main", 16) */
  lua_pushvalue(L,3);
  lua_pushliteral(L,"set_size");
  lua_gettable(L,-2);
  lua_insert(L,-2);
  lua_pushliteral(L,"main");
  lua_pushnumber(L,16);
  lua_call(L,3,0);
  assert(lua_gettop(L) == 3);
  return 0;
}


/* function(pos,player) */
static int lcf3 (lua_State * L) {
  enum { lc_nformalargs = 2 };
  lua_settop(L,2);
  
  /* local meta = minetest.env:get_meta(pos) */
  lua_getfield(L,LUA_ENVIRONINDEX,"minetest");
  lua_pushliteral(L,"env");
  lua_gettable(L,-2);
  lua_remove(L,-2);
  lua_pushliteral(L,"get_meta");
  lua_gettable(L,-2);
  lua_insert(L,-2);
  lua_pushvalue(L,1);
  lua_call(L,2,1);
  assert(lua_gettop(L) == 3);
  
  /* local inv = meta:get_inventory() */
  lua_pushvalue(L,3);
  lua_pushliteral(L,"get_inventory");
  lua_gettable(L,-2);
  lua_insert(L,-2);
  lua_call(L,1,1);
  assert(lua_gettop(L) == 4);
  
  /* return inv:is_empty("main") */
  const int lc2 = lua_gettop(L);
  lua_pushvalue(L,4);
  lua_pushliteral(L,"is_empty");
  lua_gettable(L,-2);
  lua_insert(L,-2);
  lua_pushliteral(L,"main");
  lua_call(L,2,LUA_MULTRET);
  return (lua_gettop(L) - lc2);
  assert(lua_gettop(L) == 4);
}


/* function(pos, from_list, from_index, to_list, to_index, count, player) */
static int lcf4 (lua_State * L) {
  enum { lc_nformalargs = 7 };
  lua_settop(L,7);
  
  /* minetest.log("action", player:get_player_name()..
   * 				" moves stuff in box at "..minetest.pos_to_string(pos)) */
  lua_getfield(L,LUA_ENVIRONINDEX,"minetest");
  lua_pushliteral(L,"log");
  lua_gettable(L,-2);
  lua_remove(L,-2);
  lua_pushliteral(L,"action");
  lua_pushvalue(L,7);
  lua_pushliteral(L,"get_player_name");
  lua_gettable(L,-2);
  lua_insert(L,-2);
  lua_call(L,1,1);
  lua_pushliteral(L," moves stuff in box at ");
  lua_getfield(L,LUA_ENVIRONINDEX,"minetest");
  lua_pushliteral(L,"pos_to_string");
  lua_gettable(L,-2);
  lua_remove(L,-2);
  lua_pushvalue(L,1);
  lua_call(L,1,1);
  lua_concat(L,2);
  lua_concat(L,2);
  lua_call(L,2,0);
  assert(lua_gettop(L) == 7);
  return 0;
}


/* function(pos, listname, index, stack, player) */
static int lcf5 (lua_State * L) {
  enum { lc_nformalargs = 5 };
  lua_settop(L,5);
  
  /* minetest.log("action", player:get_player_name()..
   * 				" moves stuff to box at "..minetest.pos_to_string(pos)) */
  lua_getfield(L,LUA_ENVIRONINDEX,"minetest");
  lua_pushliteral(L,"log");
  lua_gettable(L,-2);
  lua_remove(L,-2);
  lua_pushliteral(L,"action");
  lua_pushvalue(L,5);
  lua_pushliteral(L,"get_player_name");
  lua_gettable(L,-2);
  lua_insert(L,-2);
  lua_call(L,1,1);
  lua_pushliteral(L," moves stuff to box at ");
  lua_getfield(L,LUA_ENVIRONINDEX,"minetest");
  lua_pushliteral(L,"pos_to_string");
  lua_gettable(L,-2);
  lua_remove(L,-2);
  lua_pushvalue(L,1);
  lua_call(L,1,1);
  lua_concat(L,2);
  lua_concat(L,2);
  lua_call(L,2,0);
  assert(lua_gettop(L) == 5);
  return 0;
}


/* function(pos, listname, index, stack, player) */
static int lcf6 (lua_State * L) {
  enum { lc_nformalargs = 5 };
  lua_settop(L,5);
  
  /* minetest.log("action", player:get_player_name()..
   * 				" takes stuff from box at "..minetest.pos_to_string(pos)) */
  lua_getfield(L,LUA_ENVIRONINDEX,"minetest");
  lua_pushliteral(L,"log");
  lua_gettable(L,-2);
  lua_remove(L,-2);
  lua_pushliteral(L,"action");
  lua_pushvalue(L,5);
  lua_pushliteral(L,"get_player_name");
  lua_gettable(L,-2);
  lua_insert(L,-2);
  lua_call(L,1,1);
  lua_pushliteral(L," takes stuff from box at ");
  lua_getfield(L,LUA_ENVIRONINDEX,"minetest");
  lua_pushliteral(L,"pos_to_string");
  lua_gettable(L,-2);
  lua_remove(L,-2);
  lua_pushvalue(L,1);
  lua_call(L,1,1);
  lua_concat(L,2);
  lua_concat(L,2);
  lua_call(L,2,0);
  assert(lua_gettop(L) == 5);
  return 0;
}


/* function(pos) */
static int lcf7 (lua_State * L) {
  enum { lc_nformalargs = 1 };
  lua_settop(L,1);
  
  /* local meta = minetest.env:get_meta(pos) */
  lua_getfield(L,LUA_ENVIRONINDEX,"minetest");
  lua_pushliteral(L,"env");
  lua_gettable(L,-2);
  lua_remove(L,-2);
  lua_pushliteral(L,"get_meta");
  lua_gettable(L,-2);
  lua_insert(L,-2);
  lua_pushvalue(L,1);
  lua_call(L,2,1);
  assert(lua_gettop(L) == 2);
  
  /* meta:set_string("formspec",
   * 				"size[8,10]"..
   *         "list[context;up;0,0;8,3;]"..
   *         "list[context;down;0,3;8,3;]"..
   * 				"list[current_player;main;0,6;8,4;]") */
  lua_pushvalue(L,2);
  lua_pushliteral(L,"set_string");
  lua_gettable(L,-2);
  lua_insert(L,-2);
  lua_pushliteral(L,"formspec");
  lua_pushliteral(L,"size[8,10]");
  lua_pushliteral(L,"list[context;up;0,0;8,3;]");
  lua_pushliteral(L,"list[context;down;0,3;8,3;]");
  lua_pushliteral(L,"list[current_player;main;0,6;8,4;]");
  lua_concat(L,2);
  lua_concat(L,2);
  lua_concat(L,2);
  lua_call(L,3,0);
  assert(lua_gettop(L) == 2);
  
  /* meta:set_string("infotext", "Wooden Shelves") */
  lua_pushvalue(L,2);
  lua_pushliteral(L,"set_string");
  lua_gettable(L,-2);
  lua_insert(L,-2);
  lua_pushliteral(L,"infotext");
  lua_pushliteral(L,"Wooden Shelves");
  lua_call(L,3,0);
  assert(lua_gettop(L) == 2);
  
  /* local inv = meta:get_inventory() */
  lua_pushvalue(L,2);
  lua_pushliteral(L,"get_inventory");
  lua_gettable(L,-2);
  lua_insert(L,-2);
  lua_call(L,1,1);
  assert(lua_gettop(L) == 3);
  
  /* inv:set_size("up", 16) */
  lua_pushvalue(L,3);
  lua_pushliteral(L,"set_size");
  lua_gettable(L,-2);
  lua_insert(L,-2);
  lua_pushliteral(L,"up");
  lua_pushnumber(L,16);
  lua_call(L,3,0);
  assert(lua_gettop(L) == 3);
  
  /* inv:set_size("down", 16) */
  lua_pushvalue(L,3);
  lua_pushliteral(L,"set_size");
  lua_gettable(L,-2);
  lua_insert(L,-2);
  lua_pushliteral(L,"down");
  lua_pushnumber(L,16);
  lua_call(L,3,0);
  assert(lua_gettop(L) == 3);
  return 0;
}


/* function(pos,player) */
static int lcf8 (lua_State * L) {
  enum { lc_nformalargs = 2 };
  lua_settop(L,2);
  
  /* local meta = minetest.env:get_meta(pos) */
  lua_getfield(L,LUA_ENVIRONINDEX,"minetest");
  lua_pushliteral(L,"env");
  lua_gettable(L,-2);
  lua_remove(L,-2);
  lua_pushliteral(L,"get_meta");
  lua_gettable(L,-2);
  lua_insert(L,-2);
  lua_pushvalue(L,1);
  lua_call(L,2,1);
  assert(lua_gettop(L) == 3);
  
  /* local inv = meta:get_inventory() */
  lua_pushvalue(L,3);
  lua_pushliteral(L,"get_inventory");
  lua_gettable(L,-2);
  lua_insert(L,-2);
  lua_call(L,1,1);
  assert(lua_gettop(L) == 4);
  
  /* return inv:is_empty("shape") and inv:is_empty("out") and inv:is_empty("water") */
  lua_pushvalue(L,4);
  lua_pushliteral(L,"is_empty");
  lua_gettable(L,-2);
  lua_insert(L,-2);
  lua_pushliteral(L,"shape");
  lua_call(L,2,1);
  if (lua_toboolean(L,-1)) {
    lua_pop(L,1);
    lua_pushvalue(L,4);
    lua_pushliteral(L,"is_empty");
    lua_gettable(L,-2);
    lua_insert(L,-2);
    lua_pushliteral(L,"out");
    lua_call(L,2,1);
  }
  if (lua_toboolean(L,-1)) {
    lua_pop(L,1);
    lua_pushvalue(L,4);
    lua_pushliteral(L,"is_empty");
    lua_gettable(L,-2);
    lua_insert(L,-2);
    lua_pushliteral(L,"water");
    lua_call(L,2,1);
  }
  return 1;
  assert(lua_gettop(L) == 4);
}


/* function(pos, from_list, from_index, to_list, to_index, count, player) */
static int lcf9 (lua_State * L) {
  enum { lc_nformalargs = 7 };
  lua_settop(L,7);
  
  /* minetest.log("action", player:get_player_name()..
   * 				" moves stuff in shelves at "..minetest.pos_to_string(pos)) */
  lua_getfield(L,LUA_ENVIRONINDEX,"minetest");
  lua_pushliteral(L,"log");
  lua_gettable(L,-2);
  lua_remove(L,-2);
  lua_pushliteral(L,"action");
  lua_pushvalue(L,7);
  lua_pushliteral(L,"get_player_name");
  lua_gettable(L,-2);
  lua_insert(L,-2);
  lua_call(L,1,1);
  lua_pushliteral(L," moves stuff in shelves at ");
  lua_getfield(L,LUA_ENVIRONINDEX,"minetest");
  lua_pushliteral(L,"pos_to_string");
  lua_gettable(L,-2);
  lua_remove(L,-2);
  lua_pushvalue(L,1);
  lua_call(L,1,1);
  lua_concat(L,2);
  lua_concat(L,2);
  lua_call(L,2,0);
  assert(lua_gettop(L) == 7);
  return 0;
}


/* function(pos, listname, index, stack, player) */
static int lcf10 (lua_State * L) {
  enum { lc_nformalargs = 5 };
  lua_settop(L,5);
  
  /* minetest.log("action", player:get_player_name()..
   * 				" moves stuff to shelves at "..minetest.pos_to_string(pos)) */
  lua_getfield(L,LUA_ENVIRONINDEX,"minetest");
  lua_pushliteral(L,"log");
  lua_gettable(L,-2);
  lua_remove(L,-2);
  lua_pushliteral(L,"action");
  lua_pushvalue(L,5);
  lua_pushliteral(L,"get_player_name");
  lua_gettable(L,-2);
  lua_insert(L,-2);
  lua_call(L,1,1);
  lua_pushliteral(L," moves stuff to shelves at ");
  lua_getfield(L,LUA_ENVIRONINDEX,"minetest");
  lua_pushliteral(L,"pos_to_string");
  lua_gettable(L,-2);
  lua_remove(L,-2);
  lua_pushvalue(L,1);
  lua_call(L,1,1);
  lua_concat(L,2);
  lua_concat(L,2);
  lua_call(L,2,0);
  assert(lua_gettop(L) == 5);
  return 0;
}


/* function(pos, listname, index, stack, player) */
static int lcf11 (lua_State * L) {
  enum { lc_nformalargs = 5 };
  lua_settop(L,5);
  
  /* minetest.log("action", player:get_player_name()..
   * 				" takes stuff from shelves at "..minetest.pos_to_string(pos)) */
  lua_getfield(L,LUA_ENVIRONINDEX,"minetest");
  lua_pushliteral(L,"log");
  lua_gettable(L,-2);
  lua_remove(L,-2);
  lua_pushliteral(L,"action");
  lua_pushvalue(L,5);
  lua_pushliteral(L,"get_player_name");
  lua_gettable(L,-2);
  lua_insert(L,-2);
  lua_call(L,1,1);
  lua_pushliteral(L," takes stuff from shelves at ");
  lua_getfield(L,LUA_ENVIRONINDEX,"minetest");
  lua_pushliteral(L,"pos_to_string");
  lua_gettable(L,-2);
  lua_remove(L,-2);
  lua_pushvalue(L,1);
  lua_call(L,1,1);
  lua_concat(L,2);
  lua_concat(L,2);
  lua_call(L,2,0);
  assert(lua_gettop(L) == 5);
  return 0;
}


/* __sub metamethod handler.
 * warning: assumes indices in range LUA_REGISTRYINDEX < x < 0 are relative. */
static void lc_sub(lua_State * L, int idxa, int idxb) {
  if (lua_isnumber(L,idxa) && lua_isnumber(L,idxb)) {
    lua_pushnumber(L,lua_tonumber(L,idxa) - lua_tonumber(L,idxb));
  }
  else {
    if (luaL_getmetafield(L,idxa,"__sub")||luaL_getmetafield(L,idxb,"__sub")) {
      lua_pushvalue(L,idxa < 0 && idxa > LUA_REGISTRYINDEX ? idxa-1 : idxa);
      lua_pushvalue(L,idxb < 0 && idxb > LUA_REGISTRYINDEX ? idxb-2 : idxb);
      lua_call(L,2,1);
    }
    else {
      luaL_error(L, "attempt to perform arithmetic");
    }
  }
}


/* name: (main)
 * function(...) */
static int lcf_main (lua_State * L) {
  enum { lc_nformalargs = 0 };
  #ifndef NDEBUG
  const int lc_nactualargs = lua_gettop(L);
  #endif
  #ifndef NDEBUG
  const int lc_nextra = (lc_nactualargs - lc_nformalargs);
  #endif
  
  /* minetest.register_node("darkage:chain", {
   * 	description = "Chain",
   * 	drawtype = "signlike",
   * 	tiles = {"darkage_chain.png"},
   * 	inventory_image = "darkage_chain.png",
   * 	wield_image = "darkage_chain.png",
   * 	paramtype = "light",
   * 	paramtype2 = "wallmounted",
   * 	is_ground_content = true,
   * 	walkable = false,
   * 	climbable = true,
   * 	selection_box = {
   * 		type = "wallmounted",
   * 		--wall_top = = <default>
   * 		--wall_bottom = = <default>
   * 		--wall_side = = <default>
   * 	},
   * 	groups = {snappy=1,cracky=2,oddly_breakable_by_hand=2},
   * 	legacy_wallmounted = true
   * }) */
  lua_getfield(L,LUA_ENVIRONINDEX,"minetest");
  lua_pushliteral(L,"register_node");
  lua_gettable(L,-2);
  lua_remove(L,-2);
  lua_pushliteral(L,"darkage:chain");
  lua_createtable(L,0,13);
  lua_pushliteral(L,"description");
  lua_pushliteral(L,"Chain");
  lua_rawset(L,-3);
  lua_pushliteral(L,"drawtype");
  lua_pushliteral(L,"signlike");
  lua_rawset(L,-3);
  lua_pushliteral(L,"tiles");
  lua_createtable(L,1,0);
  lua_pushliteral(L,"darkage_chain.png");
  lua_rawseti(L,-2,1);
  lua_rawset(L,-3);
  lua_pushliteral(L,"inventory_image");
  lua_pushliteral(L,"darkage_chain.png");
  lua_rawset(L,-3);
  lua_pushliteral(L,"wield_image");
  lua_pushliteral(L,"darkage_chain.png");
  lua_rawset(L,-3);
  lua_pushliteral(L,"paramtype");
  lua_pushliteral(L,"light");
  lua_rawset(L,-3);
  lua_pushliteral(L,"paramtype2");
  lua_pushliteral(L,"wallmounted");
  lua_rawset(L,-3);
  lua_pushliteral(L,"is_ground_content");
  lua_pushboolean(L,1);
  lua_rawset(L,-3);
  lua_pushliteral(L,"walkable");
  lua_pushboolean(L,0);
  lua_rawset(L,-3);
  lua_pushliteral(L,"climbable");
  lua_pushboolean(L,1);
  lua_rawset(L,-3);
  lua_pushliteral(L,"selection_box");
  lua_createtable(L,0,1);
  lua_pushliteral(L,"type");
  lua_pushliteral(L,"wallmounted");
  lua_rawset(L,-3);
  lua_rawset(L,-3);
  lua_pushliteral(L,"groups");
  lua_createtable(L,0,3);
  lua_pushliteral(L,"snappy");
  lua_pushnumber(L,1);
  lua_rawset(L,-3);
  lua_pushliteral(L,"cracky");
  lua_pushnumber(L,2);
  lua_rawset(L,-3);
  lua_pushliteral(L,"oddly_breakable_by_hand");
  lua_pushnumber(L,2);
  lua_rawset(L,-3);
  lua_rawset(L,-3);
  lua_pushliteral(L,"legacy_wallmounted");
  lua_pushboolean(L,1);
  lua_rawset(L,-3);
  lua_call(L,2,0);
  assert(lua_gettop(L) - lc_nextra == 0);
  
  /* minetest.register_node('darkage:box', {
   * 	description = "Box",
   * 	tiles = { 'darkage_box_top.png','darkage_box_top.png','darkage_box.png'},
   * 	sunlight_propagates = false,
   * 	paramtype = "light",
   * 	paramtype2 = "facedir",
   * 	walkable = true,
   * 	groups = { snappy = 3 },
   * 	sounds = default.node_sound_leaves_defaults(),
   * 	on_construct = function(pos)
   * 		local meta = minetest.env:get_meta(pos)
   * 		meta:set_string("formspec",
   * 				"size[8,8]"..
   * 				"list[current_name;main;0,0;8,3;]"..
   * 				"list[current_player;main;0,4;8,4;]")
   * 		meta:set_string("infotext", "Box")
   * 		local inv = meta:get_inventory()
   * 		inv:set_size("main", 16)
   * 	end,
   * 	can_dig = function(pos,player)
   * 		local meta = minetest.env:get_meta(pos);
   * 		local inv = meta:get_inventory()
   * 		return inv:is_empty("main")
   * 	end,
   * 	on_metadata_inventory_move = function(pos, from_list, from_index, to_list, to_index, count, player)
   * 		minetest.log("action", player:get_player_name()..
   * 				" moves stuff in box at "..minetest.pos_to_string(pos))
   * 	end,
   *     on_metadata_inventory_put = function(pos, listname, index, stack, player)
   * 		minetest.log("action", player:get_player_name()..
   * 				" moves stuff to box at "..minetest.pos_to_string(pos))
   * 	end,
   *     on_metadata_inventory_take = function(pos, listname, index, stack, player)
   * 		minetest.log("action", player:get_player_name()..
   * 				" takes stuff from box at "..minetest.pos_to_string(pos))
   * 	end,
   * }) */
  lua_getfield(L,LUA_ENVIRONINDEX,"minetest");
  lua_pushliteral(L,"register_node");
  lua_gettable(L,-2);
  lua_remove(L,-2);
  lua_pushliteral(L,"darkage:box");
  lua_createtable(L,0,13);
  lua_pushliteral(L,"description");
  lua_pushliteral(L,"Box");
  lua_rawset(L,-3);
  lua_pushliteral(L,"tiles");
  lua_createtable(L,3,0);
  lua_pushliteral(L,"darkage_box_top.png");
  lua_rawseti(L,-2,1);
  lua_pushliteral(L,"darkage_box_top.png");
  lua_rawseti(L,-2,2);
  lua_pushliteral(L,"darkage_box.png");
  lua_rawseti(L,-2,3);
  lua_rawset(L,-3);
  lua_pushliteral(L,"sunlight_propagates");
  lua_pushboolean(L,0);
  lua_rawset(L,-3);
  lua_pushliteral(L,"paramtype");
  lua_pushliteral(L,"light");
  lua_rawset(L,-3);
  lua_pushliteral(L,"paramtype2");
  lua_pushliteral(L,"facedir");
  lua_rawset(L,-3);
  lua_pushliteral(L,"walkable");
  lua_pushboolean(L,1);
  lua_rawset(L,-3);
  lua_pushliteral(L,"groups");
  lua_createtable(L,0,1);
  lua_pushliteral(L,"snappy");
  lua_pushnumber(L,3);
  lua_rawset(L,-3);
  lua_rawset(L,-3);
  lua_pushliteral(L,"sounds");
  lua_getfield(L,LUA_ENVIRONINDEX,"default");
  lua_pushliteral(L,"node_sound_leaves_defaults");
  lua_gettable(L,-2);
  lua_remove(L,-2);
  lua_call(L,0,1);
  lua_rawset(L,-3);
  lua_pushliteral(L,"on_construct");
  lua_pushcfunction(L,lcf1);
  lua_rawset(L,-3);
  lua_pushliteral(L,"can_dig");
  lua_pushcfunction(L,lcf3);
  lua_rawset(L,-3);
  lua_pushliteral(L,"on_metadata_inventory_move");
  lua_pushcfunction(L,lcf4);
  lua_rawset(L,-3);
  lua_pushliteral(L,"on_metadata_inventory_put");
  lua_pushcfunction(L,lcf5);
  lua_rawset(L,-3);
  lua_pushliteral(L,"on_metadata_inventory_take");
  lua_pushcfunction(L,lcf6);
  lua_rawset(L,-3);
  lua_call(L,2,0);
  assert(lua_gettop(L) - lc_nextra == 0);
  
  /* minetest.register_node('darkage:wood_shelves', {
   * 	description = "Wooden Shelves",
   * 	tiles = { 'darkage_shelves.png','darkage_shelves.png','darkage_shelves.png',
   *             'darkage_shelves.png','darkage_shelves.png','darkage_shelves_front.png'},
   * 	sunlight_propagates = false,
   * 	paramtype = "light",
   * 	paramtype2 = "facedir",
   * 	walkable = true,
   * 	groups = { snappy = 3 },
   * 	sounds = default.node_sound_leaves_defaults(),
   * 	on_construct = function(pos)
   * 		local meta = minetest.env:get_meta(pos)
   * 		meta:set_string("formspec",
   * 				"size[8,10]"..
   *         "list[context;up;0,0;8,3;]"..
   *         "list[context;down;0,3;8,3;]"..
   * 				"list[current_player;main;0,6;8,4;]")
   * 		meta:set_string("infotext", "Wooden Shelves")
   * 		local inv = meta:get_inventory()
   * 		inv:set_size("up", 16)
   * 		inv:set_size("down", 16)
   * 	end,
   * 	can_dig = function(pos,player)
   * 		local meta = minetest.env:get_meta(pos);
   * 		local inv = meta:get_inventory()
   * 		return inv:is_empty("shape") and inv:is_empty("out") and inv:is_empty("water")
   * 	end,
   * 	on_metadata_inventory_move = function(pos, from_list, from_index, to_list, to_index, count, player)
   * 		minetest.log("action", player:get_player_name()..
   * 				" moves stuff in shelves at "..minetest.pos_to_string(pos))
   * 	end,
   *     on_metadata_inventory_put = function(pos, listname, index, stack, player)
   * 		minetest.log("action", player:get_player_name()..
   * 				" moves stuff to shelves at "..minetest.pos_to_string(pos))
   * 	end,
   *     on_metadata_inventory_take = function(pos, listname, index, stack, player)
   * 		minetest.log("action", player:get_player_name()..
   * 				" takes stuff from shelves at "..minetest.pos_to_string(pos))
   * 	end,
   * }) */
  lua_getfield(L,LUA_ENVIRONINDEX,"minetest");
  lua_pushliteral(L,"register_node");
  lua_gettable(L,-2);
  lua_remove(L,-2);
  lua_pushliteral(L,"darkage:wood_shelves");
  lua_createtable(L,0,13);
  lua_pushliteral(L,"description");
  lua_pushliteral(L,"Wooden Shelves");
  lua_rawset(L,-3);
  lua_pushliteral(L,"tiles");
  lua_createtable(L,6,0);
  lua_pushliteral(L,"darkage_shelves.png");
  lua_rawseti(L,-2,1);
  lua_pushliteral(L,"darkage_shelves.png");
  lua_rawseti(L,-2,2);
  lua_pushliteral(L,"darkage_shelves.png");
  lua_rawseti(L,-2,3);
  lua_pushliteral(L,"darkage_shelves.png");
  lua_rawseti(L,-2,4);
  lua_pushliteral(L,"darkage_shelves.png");
  lua_rawseti(L,-2,5);
  lua_pushliteral(L,"darkage_shelves_front.png");
  lua_rawseti(L,-2,6);
  lua_rawset(L,-3);
  lua_pushliteral(L,"sunlight_propagates");
  lua_pushboolean(L,0);
  lua_rawset(L,-3);
  lua_pushliteral(L,"paramtype");
  lua_pushliteral(L,"light");
  lua_rawset(L,-3);
  lua_pushliteral(L,"paramtype2");
  lua_pushliteral(L,"facedir");
  lua_rawset(L,-3);
  lua_pushliteral(L,"walkable");
  lua_pushboolean(L,1);
  lua_rawset(L,-3);
  lua_pushliteral(L,"groups");
  lua_createtable(L,0,1);
  lua_pushliteral(L,"snappy");
  lua_pushnumber(L,3);
  lua_rawset(L,-3);
  lua_rawset(L,-3);
  lua_pushliteral(L,"sounds");
  lua_getfield(L,LUA_ENVIRONINDEX,"default");
  lua_pushliteral(L,"node_sound_leaves_defaults");
  lua_gettable(L,-2);
  lua_remove(L,-2);
  lua_call(L,0,1);
  lua_rawset(L,-3);
  lua_pushliteral(L,"on_construct");
  lua_pushcfunction(L,lcf7);
  lua_rawset(L,-3);
  lua_pushliteral(L,"can_dig");
  lua_pushcfunction(L,lcf8);
  lua_rawset(L,-3);
  lua_pushliteral(L,"on_metadata_inventory_move");
  lua_pushcfunction(L,lcf9);
  lua_rawset(L,-3);
  lua_pushliteral(L,"on_metadata_inventory_put");
  lua_pushcfunction(L,lcf10);
  lua_rawset(L,-3);
  lua_pushliteral(L,"on_metadata_inventory_take");
  lua_pushcfunction(L,lcf11);
  lua_rawset(L,-3);
  lua_call(L,2,0);
  assert(lua_gettop(L) - lc_nextra == 0);
  
  /* --minetest.register_node("darkage:rosace", {
   * --	description = "Rose Window",
   * --	tiles = {"darkage_rosace.png"},
   * --	is_ground_content = true,
   * --	groups = {cracky=3},
   * --	sounds = default.node_sound_stone_defaults()
   * --})
   * minetest.register_node("darkage:iron_bars", {
   * 	description = "Iron Bars",
   *   drawtype = "glasslike",
   * 	tiles = {"darkage_iron_bars.png"},
   *   inventory_image = "darkage_iron_bars.png",
   * 	wield_image = "darkage_iron_bars.png",
   * 	is_ground_content = true,
   * 	paramtype = "light",
   * 	sunlight_propagates = true,
   * 	groups = {cracky=3},
   * 	sounds = default.node_sound_stone_defaults()
   * }) */
  lua_getfield(L,LUA_ENVIRONINDEX,"minetest");
  lua_pushliteral(L,"register_node");
  lua_gettable(L,-2);
  lua_remove(L,-2);
  lua_pushliteral(L,"darkage:iron_bars");
  lua_createtable(L,0,10);
  lua_pushliteral(L,"description");
  lua_pushliteral(L,"Iron Bars");
  lua_rawset(L,-3);
  lua_pushliteral(L,"drawtype");
  lua_pushliteral(L,"glasslike");
  lua_rawset(L,-3);
  lua_pushliteral(L,"tiles");
  lua_createtable(L,1,0);
  lua_pushliteral(L,"darkage_iron_bars.png");
  lua_rawseti(L,-2,1);
  lua_rawset(L,-3);
  lua_pushliteral(L,"inventory_image");
  lua_pushliteral(L,"darkage_iron_bars.png");
  lua_rawset(L,-3);
  lua_pushliteral(L,"wield_image");
  lua_pushliteral(L,"darkage_iron_bars.png");
  lua_rawset(L,-3);
  lua_pushliteral(L,"is_ground_content");
  lua_pushboolean(L,1);
  lua_rawset(L,-3);
  lua_pushliteral(L,"paramtype");
  lua_pushliteral(L,"light");
  lua_rawset(L,-3);
  lua_pushliteral(L,"sunlight_propagates");
  lua_pushboolean(L,1);
  lua_rawset(L,-3);
  lua_pushliteral(L,"groups");
  lua_createtable(L,0,1);
  lua_pushliteral(L,"cracky");
  lua_pushnumber(L,3);
  lua_rawset(L,-3);
  lua_rawset(L,-3);
  lua_pushliteral(L,"sounds");
  lua_getfield(L,LUA_ENVIRONINDEX,"default");
  lua_pushliteral(L,"node_sound_stone_defaults");
  lua_gettable(L,-2);
  lua_remove(L,-2);
  lua_call(L,0,1);
  lua_rawset(L,-3);
  lua_call(L,2,0);
  assert(lua_gettop(L) - lc_nextra == 0);
  
  /* minetest.register_node("darkage:lamp", {
   * 	description = "Lamp",
   * 	tiles = {
   * 		"darkage_lamp.png"
   * 	},
   * 	paramtype = "light",
   * 	sunlight_propagates = true,
   * 	light_source = LIGHT_MAX-1,
   * 	groups = {snappy=2,cracky=3,oddly_breakable_by_hand=3,flammable=1},
   * 	sounds = default.node_sound_glass_defaults(),
   * }) */
  lua_getfield(L,LUA_ENVIRONINDEX,"minetest");
  lua_pushliteral(L,"register_node");
  lua_gettable(L,-2);
  lua_remove(L,-2);
  lua_pushliteral(L,"darkage:lamp");
  lua_createtable(L,0,7);
  lua_pushliteral(L,"description");
  lua_pushliteral(L,"Lamp");
  lua_rawset(L,-3);
  lua_pushliteral(L,"tiles");
  lua_createtable(L,1,0);
  lua_pushliteral(L,"darkage_lamp.png");
  lua_rawseti(L,-2,1);
  lua_rawset(L,-3);
  lua_pushliteral(L,"paramtype");
  lua_pushliteral(L,"light");
  lua_rawset(L,-3);
  lua_pushliteral(L,"sunlight_propagates");
  lua_pushboolean(L,1);
  lua_rawset(L,-3);
  lua_pushliteral(L,"light_source");
  lua_getfield(L,LUA_ENVIRONINDEX,"LIGHT_MAX");
  lua_pushnumber(L,1);
  lc_sub(L,-2,-1);
  lua_remove(L,-2);
  lua_remove(L,-2);
  lua_rawset(L,-3);
  lua_pushliteral(L,"groups");
  lua_createtable(L,0,4);
  lua_pushliteral(L,"snappy");
  lua_pushnumber(L,2);
  lua_rawset(L,-3);
  lua_pushliteral(L,"cracky");
  lua_pushnumber(L,3);
  lua_rawset(L,-3);
  lua_pushliteral(L,"oddly_breakable_by_hand");
  lua_pushnumber(L,3);
  lua_rawset(L,-3);
  lua_pushliteral(L,"flammable");
  lua_pushnumber(L,1);
  lua_rawset(L,-3);
  lua_rawset(L,-3);
  lua_pushliteral(L,"sounds");
  lua_getfield(L,LUA_ENVIRONINDEX,"default");
  lua_pushliteral(L,"node_sound_glass_defaults");
  lua_gettable(L,-2);
  lua_remove(L,-2);
  lua_call(L,0,1);
  lua_rawset(L,-3);
  lua_call(L,2,0);
  assert(lua_gettop(L) - lc_nextra == 0);
  
  /* minetest.register_node("darkage:iron_grille", {
   * 	description = "Iron Grille",
   *   drawtype = "glasslike",
   * 	tiles = {"darkage_iron_grille.png"},
   *   inventory_image = "darkage_iron_grille.png",
   * 	wield_image = "darkage_iron_grille.png",
   * 	is_ground_content = true,
   * 	paramtype = "light",
   * 	sunlight_propagates = true,
   * 	groups = {cracky=3},
   * 	sounds = default.node_sound_stone_defaults()
   * }) */
  lua_getfield(L,LUA_ENVIRONINDEX,"minetest");
  lua_pushliteral(L,"register_node");
  lua_gettable(L,-2);
  lua_remove(L,-2);
  lua_pushliteral(L,"darkage:iron_grille");
  lua_createtable(L,0,10);
  lua_pushliteral(L,"description");
  lua_pushliteral(L,"Iron Grille");
  lua_rawset(L,-3);
  lua_pushliteral(L,"drawtype");
  lua_pushliteral(L,"glasslike");
  lua_rawset(L,-3);
  lua_pushliteral(L,"tiles");
  lua_createtable(L,1,0);
  lua_pushliteral(L,"darkage_iron_grille.png");
  lua_rawseti(L,-2,1);
  lua_rawset(L,-3);
  lua_pushliteral(L,"inventory_image");
  lua_pushliteral(L,"darkage_iron_grille.png");
  lua_rawset(L,-3);
  lua_pushliteral(L,"wield_image");
  lua_pushliteral(L,"darkage_iron_grille.png");
  lua_rawset(L,-3);
  lua_pushliteral(L,"is_ground_content");
  lua_pushboolean(L,1);
  lua_rawset(L,-3);
  lua_pushliteral(L,"paramtype");
  lua_pushliteral(L,"light");
  lua_rawset(L,-3);
  lua_pushliteral(L,"sunlight_propagates");
  lua_pushboolean(L,1);
  lua_rawset(L,-3);
  lua_pushliteral(L,"groups");
  lua_createtable(L,0,1);
  lua_pushliteral(L,"cracky");
  lua_pushnumber(L,3);
  lua_rawset(L,-3);
  lua_rawset(L,-3);
  lua_pushliteral(L,"sounds");
  lua_getfield(L,LUA_ENVIRONINDEX,"default");
  lua_pushliteral(L,"node_sound_stone_defaults");
  lua_gettable(L,-2);
  lua_remove(L,-2);
  lua_call(L,0,1);
  lua_rawset(L,-3);
  lua_call(L,2,0);
  assert(lua_gettop(L) - lc_nextra == 0);
  
  /* minetest.register_node("darkage:wood_bars", {
   * 	description = "Wooden Bars",
   *   drawtype = "glasslike",
   * 	tiles = {"darkage_wood_bars.png"},
   *   inventory_image = "darkage_wood_bars.png",
   * 	wield_image = "darkage_wood_bars.png",
   * 	is_ground_content = true,
   * 	paramtype = "light",
   * 	sunlight_propagates = true,
   * 	groups = {snappy=1,choppy=2},
   * 	sounds = default.node_sound_stone_defaults()
   * }) */
  lua_getfield(L,LUA_ENVIRONINDEX,"minetest");
  lua_pushliteral(L,"register_node");
  lua_gettable(L,-2);
  lua_remove(L,-2);
  lua_pushliteral(L,"darkage:wood_bars");
  lua_createtable(L,0,10);
  lua_pushliteral(L,"description");
  lua_pushliteral(L,"Wooden Bars");
  lua_rawset(L,-3);
  lua_pushliteral(L,"drawtype");
  lua_pushliteral(L,"glasslike");
  lua_rawset(L,-3);
  lua_pushliteral(L,"tiles");
  lua_createtable(L,1,0);
  lua_pushliteral(L,"darkage_wood_bars.png");
  lua_rawseti(L,-2,1);
  lua_rawset(L,-3);
  lua_pushliteral(L,"inventory_image");
  lua_pushliteral(L,"darkage_wood_bars.png");
  lua_rawset(L,-3);
  lua_pushliteral(L,"wield_image");
  lua_pushliteral(L,"darkage_wood_bars.png");
  lua_rawset(L,-3);
  lua_pushliteral(L,"is_ground_content");
  lua_pushboolean(L,1);
  lua_rawset(L,-3);
  lua_pushliteral(L,"paramtype");
  lua_pushliteral(L,"light");
  lua_rawset(L,-3);
  lua_pushliteral(L,"sunlight_propagates");
  lua_pushboolean(L,1);
  lua_rawset(L,-3);
  lua_pushliteral(L,"groups");
  lua_createtable(L,0,2);
  lua_pushliteral(L,"snappy");
  lua_pushnumber(L,1);
  lua_rawset(L,-3);
  lua_pushliteral(L,"choppy");
  lua_pushnumber(L,2);
  lua_rawset(L,-3);
  lua_rawset(L,-3);
  lua_pushliteral(L,"sounds");
  lua_getfield(L,LUA_ENVIRONINDEX,"default");
  lua_pushliteral(L,"node_sound_stone_defaults");
  lua_gettable(L,-2);
  lua_remove(L,-2);
  lua_call(L,0,1);
  lua_rawset(L,-3);
  lua_call(L,2,0);
  assert(lua_gettop(L) - lc_nextra == 0);
  
  /* minetest.register_node("darkage:wood_grille", {
   * 	description = "Wooden Grille",
   *   drawtype = "glasslike",
   * 	tiles = {"darkage_wood_grille.png"},
   *   inventory_image = "darkage_wood_grille.png",
   * 	wield_image = "darkage_wood_grille.png",
   * 	is_ground_content = true,
   * 	paramtype = "light",
   * 	sunlight_propagates = true,
   * 	groups = {snappy=1,choppy=2},
   * 	sounds = default.node_sound_stone_defaults()
   * }) */
  lua_getfield(L,LUA_ENVIRONINDEX,"minetest");
  lua_pushliteral(L,"register_node");
  lua_gettable(L,-2);
  lua_remove(L,-2);
  lua_pushliteral(L,"darkage:wood_grille");
  lua_createtable(L,0,10);
  lua_pushliteral(L,"description");
  lua_pushliteral(L,"Wooden Grille");
  lua_rawset(L,-3);
  lua_pushliteral(L,"drawtype");
  lua_pushliteral(L,"glasslike");
  lua_rawset(L,-3);
  lua_pushliteral(L,"tiles");
  lua_createtable(L,1,0);
  lua_pushliteral(L,"darkage_wood_grille.png");
  lua_rawseti(L,-2,1);
  lua_rawset(L,-3);
  lua_pushliteral(L,"inventory_image");
  lua_pushliteral(L,"darkage_wood_grille.png");
  lua_rawset(L,-3);
  lua_pushliteral(L,"wield_image");
  lua_pushliteral(L,"darkage_wood_grille.png");
  lua_rawset(L,-3);
  lua_pushliteral(L,"is_ground_content");
  lua_pushboolean(L,1);
  lua_rawset(L,-3);
  lua_pushliteral(L,"paramtype");
  lua_pushliteral(L,"light");
  lua_rawset(L,-3);
  lua_pushliteral(L,"sunlight_propagates");
  lua_pushboolean(L,1);
  lua_rawset(L,-3);
  lua_pushliteral(L,"groups");
  lua_createtable(L,0,2);
  lua_pushliteral(L,"snappy");
  lua_pushnumber(L,1);
  lua_rawset(L,-3);
  lua_pushliteral(L,"choppy");
  lua_pushnumber(L,2);
  lua_rawset(L,-3);
  lua_rawset(L,-3);
  lua_pushliteral(L,"sounds");
  lua_getfield(L,LUA_ENVIRONINDEX,"default");
  lua_pushliteral(L,"node_sound_stone_defaults");
  lua_gettable(L,-2);
  lua_remove(L,-2);
  lua_call(L,0,1);
  lua_rawset(L,-3);
  lua_call(L,2,0);
  assert(lua_gettop(L) - lc_nextra == 0);
  
  /* minetest.register_node("darkage:wood_frame", {
   * 	description = "Wooden Frame",
   *   drawtype = "glasslike",
   * 	tiles = {"darkage_wood_frame.png"},
   *   inventory_image = "darkage_wood_frame.png",
   * 	wield_image = "darkage_wood_frame.png",
   * 	is_ground_content = true,
   * 	paramtype = "light",
   * 	sunlight_propagates = true,
   * 	groups = {snappy=1,choppy=2},
   * 	sounds = default.node_sound_stone_defaults()
   * }) */
  lua_getfield(L,LUA_ENVIRONINDEX,"minetest");
  lua_pushliteral(L,"register_node");
  lua_gettable(L,-2);
  lua_remove(L,-2);
  lua_pushliteral(L,"darkage:wood_frame");
  lua_createtable(L,0,10);
  lua_pushliteral(L,"description");
  lua_pushliteral(L,"Wooden Frame");
  lua_rawset(L,-3);
  lua_pushliteral(L,"drawtype");
  lua_pushliteral(L,"glasslike");
  lua_rawset(L,-3);
  lua_pushliteral(L,"tiles");
  lua_createtable(L,1,0);
  lua_pushliteral(L,"darkage_wood_frame.png");
  lua_rawseti(L,-2,1);
  lua_rawset(L,-3);
  lua_pushliteral(L,"inventory_image");
  lua_pushliteral(L,"darkage_wood_frame.png");
  lua_rawset(L,-3);
  lua_pushliteral(L,"wield_image");
  lua_pushliteral(L,"darkage_wood_frame.png");
  lua_rawset(L,-3);
  lua_pushliteral(L,"is_ground_content");
  lua_pushboolean(L,1);
  lua_rawset(L,-3);
  lua_pushliteral(L,"paramtype");
  lua_pushliteral(L,"light");
  lua_rawset(L,-3);
  lua_pushliteral(L,"sunlight_propagates");
  lua_pushboolean(L,1);
  lua_rawset(L,-3);
  lua_pushliteral(L,"groups");
  lua_createtable(L,0,2);
  lua_pushliteral(L,"snappy");
  lua_pushnumber(L,1);
  lua_rawset(L,-3);
  lua_pushliteral(L,"choppy");
  lua_pushnumber(L,2);
  lua_rawset(L,-3);
  lua_rawset(L,-3);
  lua_pushliteral(L,"sounds");
  lua_getfield(L,LUA_ENVIRONINDEX,"default");
  lua_pushliteral(L,"node_sound_stone_defaults");
  lua_gettable(L,-2);
  lua_remove(L,-2);
  lua_call(L,0,1);
  lua_rawset(L,-3);
  lua_call(L,2,0);
  assert(lua_gettop(L) - lc_nextra == 0);
  
  /* ---------------
   * -- Crafts Item
   * ---------------
   * ----------
   * -- Crafts 
   * ----------
   * minetest.register_craft({
   * 	output = 'darkage:box',
   * 	recipe = {
   *     {'default:wood','','default:wood'},
   *     {'','',''},
   * 		{'default:wood','','default:wood'},
   * 	}
   * }) */
  lua_getfield(L,LUA_ENVIRONINDEX,"minetest");
  lua_pushliteral(L,"register_craft");
  lua_gettable(L,-2);
  lua_remove(L,-2);
  lua_createtable(L,0,2);
  lua_pushliteral(L,"output");
  lua_pushliteral(L,"darkage:box");
  lua_rawset(L,-3);
  lua_pushliteral(L,"recipe");
  lua_createtable(L,3,0);
  lua_createtable(L,3,0);
  lua_pushliteral(L,"default:wood");
  lua_rawseti(L,-2,1);
  lua_pushliteral(L,"");
  lua_rawseti(L,-2,2);
  lua_pushliteral(L,"default:wood");
  lua_rawseti(L,-2,3);
  lua_rawseti(L,-2,1);
  lua_createtable(L,3,0);
  lua_pushliteral(L,"");
  lua_rawseti(L,-2,1);
  lua_pushliteral(L,"");
  lua_rawseti(L,-2,2);
  lua_pushliteral(L,"");
  lua_rawseti(L,-2,3);
  lua_rawseti(L,-2,2);
  lua_createtable(L,3,0);
  lua_pushliteral(L,"default:wood");
  lua_rawseti(L,-2,1);
  lua_pushliteral(L,"");
  lua_rawseti(L,-2,2);
  lua_pushliteral(L,"default:wood");
  lua_rawseti(L,-2,3);
  lua_rawseti(L,-2,3);
  lua_rawset(L,-3);
  lua_call(L,1,0);
  assert(lua_gettop(L) - lc_nextra == 0);
  
  /* minetest.register_craft({
   * 	output = 'darkage:chain 2',
   * 	recipe = {
   *     {'default:steel_ingot'},
   *     {'default:steel_ingot'},
   *     {'default:steel_ingot'},
   * 	}
   * }) */
  lua_getfield(L,LUA_ENVIRONINDEX,"minetest");
  lua_pushliteral(L,"register_craft");
  lua_gettable(L,-2);
  lua_remove(L,-2);
  lua_createtable(L,0,2);
  lua_pushliteral(L,"output");
  lua_pushliteral(L,"darkage:chain 2");
  lua_rawset(L,-3);
  lua_pushliteral(L,"recipe");
  lua_createtable(L,3,0);
  lua_createtable(L,1,0);
  lua_pushliteral(L,"default:steel_ingot");
  lua_rawseti(L,-2,1);
  lua_rawseti(L,-2,1);
  lua_createtable(L,1,0);
  lua_pushliteral(L,"default:steel_ingot");
  lua_rawseti(L,-2,1);
  lua_rawseti(L,-2,2);
  lua_createtable(L,1,0);
  lua_pushliteral(L,"default:steel_ingot");
  lua_rawseti(L,-2,1);
  lua_rawseti(L,-2,3);
  lua_rawset(L,-3);
  lua_call(L,1,0);
  assert(lua_gettop(L) - lc_nextra == 0);
  
  /* minetest.register_craft({
   * 	output = 'darkage:iron_bars 2',
   * 	recipe = {
   *     {'default:steel_ingot','','default:steel_ingot'},
   *     {'default:steel_ingot','','default:steel_ingot'},
   *     {'default:steel_ingot','','default:steel_ingot'},
   * 	}
   * }) */
  lua_getfield(L,LUA_ENVIRONINDEX,"minetest");
  lua_pushliteral(L,"register_craft");
  lua_gettable(L,-2);
  lua_remove(L,-2);
  lua_createtable(L,0,2);
  lua_pushliteral(L,"output");
  lua_pushliteral(L,"darkage:iron_bars 2");
  lua_rawset(L,-3);
  lua_pushliteral(L,"recipe");
  lua_createtable(L,3,0);
  lua_createtable(L,3,0);
  lua_pushliteral(L,"default:steel_ingot");
  lua_rawseti(L,-2,1);
  lua_pushliteral(L,"");
  lua_rawseti(L,-2,2);
  lua_pushliteral(L,"default:steel_ingot");
  lua_rawseti(L,-2,3);
  lua_rawseti(L,-2,1);
  lua_createtable(L,3,0);
  lua_pushliteral(L,"default:steel_ingot");
  lua_rawseti(L,-2,1);
  lua_pushliteral(L,"");
  lua_rawseti(L,-2,2);
  lua_pushliteral(L,"default:steel_ingot");
  lua_rawseti(L,-2,3);
  lua_rawseti(L,-2,2);
  lua_createtable(L,3,0);
  lua_pushliteral(L,"default:steel_ingot");
  lua_rawseti(L,-2,1);
  lua_pushliteral(L,"");
  lua_rawseti(L,-2,2);
  lua_pushliteral(L,"default:steel_ingot");
  lua_rawseti(L,-2,3);
  lua_rawseti(L,-2,3);
  lua_rawset(L,-3);
  lua_call(L,1,0);
  assert(lua_gettop(L) - lc_nextra == 0);
  
  /* minetest.register_craft({
   * 	output = 'darkage:iron_grille 3',
   * 	recipe = {
   *     {'','darkage:iron_bars',''},
   *     {'darkage:iron_bars','','darkage:iron_bars'},
   *     {'','darkage:iron_bars',''},
   * 	}
   * }) */
  lua_getfield(L,LUA_ENVIRONINDEX,"minetest");
  lua_pushliteral(L,"register_craft");
  lua_gettable(L,-2);
  lua_remove(L,-2);
  lua_createtable(L,0,2);
  lua_pushliteral(L,"output");
  lua_pushliteral(L,"darkage:iron_grille 3");
  lua_rawset(L,-3);
  lua_pushliteral(L,"recipe");
  lua_createtable(L,3,0);
  lua_createtable(L,3,0);
  lua_pushliteral(L,"");
  lua_rawseti(L,-2,1);
  lua_pushliteral(L,"darkage:iron_bars");
  lua_rawseti(L,-2,2);
  lua_pushliteral(L,"");
  lua_rawseti(L,-2,3);
  lua_rawseti(L,-2,1);
  lua_createtable(L,3,0);
  lua_pushliteral(L,"darkage:iron_bars");
  lua_rawseti(L,-2,1);
  lua_pushliteral(L,"");
  lua_rawseti(L,-2,2);
  lua_pushliteral(L,"darkage:iron_bars");
  lua_rawseti(L,-2,3);
  lua_rawseti(L,-2,2);
  lua_createtable(L,3,0);
  lua_pushliteral(L,"");
  lua_rawseti(L,-2,1);
  lua_pushliteral(L,"darkage:iron_bars");
  lua_rawseti(L,-2,2);
  lua_pushliteral(L,"");
  lua_rawseti(L,-2,3);
  lua_rawseti(L,-2,3);
  lua_rawset(L,-3);
  lua_call(L,1,0);
  assert(lua_gettop(L) - lc_nextra == 0);
  
  /* minetest.register_craft({
   * 	output = 'darkage:lamp',
   * 	recipe = {
   *     {'default:stick','','default:stick'},
   *     {'','default:torch',''},
   *     {'default:stick','','default:stick'},
   * 	}
   * }) */
  lua_getfield(L,LUA_ENVIRONINDEX,"minetest");
  lua_pushliteral(L,"register_craft");
  lua_gettable(L,-2);
  lua_remove(L,-2);
  lua_createtable(L,0,2);
  lua_pushliteral(L,"output");
  lua_pushliteral(L,"darkage:lamp");
  lua_rawset(L,-3);
  lua_pushliteral(L,"recipe");
  lua_createtable(L,3,0);
  lua_createtable(L,3,0);
  lua_pushliteral(L,"default:stick");
  lua_rawseti(L,-2,1);
  lua_pushliteral(L,"");
  lua_rawseti(L,-2,2);
  lua_pushliteral(L,"default:stick");
  lua_rawseti(L,-2,3);
  lua_rawseti(L,-2,1);
  lua_createtable(L,3,0);
  lua_pushliteral(L,"");
  lua_rawseti(L,-2,1);
  lua_pushliteral(L,"default:torch");
  lua_rawseti(L,-2,2);
  lua_pushliteral(L,"");
  lua_rawseti(L,-2,3);
  lua_rawseti(L,-2,2);
  lua_createtable(L,3,0);
  lua_pushliteral(L,"default:stick");
  lua_rawseti(L,-2,1);
  lua_pushliteral(L,"");
  lua_rawseti(L,-2,2);
  lua_pushliteral(L,"default:stick");
  lua_rawseti(L,-2,3);
  lua_rawseti(L,-2,3);
  lua_rawset(L,-3);
  lua_call(L,1,0);
  assert(lua_gettop(L) - lc_nextra == 0);
  
  /* minetest.register_craft({
   * 	output = 'darkage:wood_bars 2',
   * 	recipe = {
   *     {'default:stick','','default:stick'},
   *     {'default:stick','','default:stick'},
   *     {'default:stick','','default:stick'},
   * 	}
   * }) */
  lua_getfield(L,LUA_ENVIRONINDEX,"minetest");
  lua_pushliteral(L,"register_craft");
  lua_gettable(L,-2);
  lua_remove(L,-2);
  lua_createtable(L,0,2);
  lua_pushliteral(L,"output");
  lua_pushliteral(L,"darkage:wood_bars 2");
  lua_rawset(L,-3);
  lua_pushliteral(L,"recipe");
  lua_createtable(L,3,0);
  lua_createtable(L,3,0);
  lua_pushliteral(L,"default:stick");
  lua_rawseti(L,-2,1);
  lua_pushliteral(L,"");
  lua_rawseti(L,-2,2);
  lua_pushliteral(L,"default:stick");
  lua_rawseti(L,-2,3);
  lua_rawseti(L,-2,1);
  lua_createtable(L,3,0);
  lua_pushliteral(L,"default:stick");
  lua_rawseti(L,-2,1);
  lua_pushliteral(L,"");
  lua_rawseti(L,-2,2);
  lua_pushliteral(L,"default:stick");
  lua_rawseti(L,-2,3);
  lua_rawseti(L,-2,2);
  lua_createtable(L,3,0);
  lua_pushliteral(L,"default:stick");
  lua_rawseti(L,-2,1);
  lua_pushliteral(L,"");
  lua_rawseti(L,-2,2);
  lua_pushliteral(L,"default:stick");
  lua_rawseti(L,-2,3);
  lua_rawseti(L,-2,3);
  lua_rawset(L,-3);
  lua_call(L,1,0);
  assert(lua_gettop(L) - lc_nextra == 0);
  
  /* minetest.register_craft({
   * 	output = 'darkage:wood_grille 3',
   * 	recipe = {
   *     {'','darkage:wood_bars',''},
   *     {'darkage:wood_bars','','darkage:wood_bars'},
   *     {'','darkage:wood_bars',''},
   * 	}
   * }) */
  lua_getfield(L,LUA_ENVIRONINDEX,"minetest");
  lua_pushliteral(L,"register_craft");
  lua_gettable(L,-2);
  lua_remove(L,-2);
  lua_createtable(L,0,2);
  lua_pushliteral(L,"output");
  lua_pushliteral(L,"darkage:wood_grille 3");
  lua_rawset(L,-3);
  lua_pushliteral(L,"recipe");
  lua_createtable(L,3,0);
  lua_createtable(L,3,0);
  lua_pushliteral(L,"");
  lua_rawseti(L,-2,1);
  lua_pushliteral(L,"darkage:wood_bars");
  lua_rawseti(L,-2,2);
  lua_pushliteral(L,"");
  lua_rawseti(L,-2,3);
  lua_rawseti(L,-2,1);
  lua_createtable(L,3,0);
  lua_pushliteral(L,"darkage:wood_bars");
  lua_rawseti(L,-2,1);
  lua_pushliteral(L,"");
  lua_rawseti(L,-2,2);
  lua_pushliteral(L,"darkage:wood_bars");
  lua_rawseti(L,-2,3);
  lua_rawseti(L,-2,2);
  lua_createtable(L,3,0);
  lua_pushliteral(L,"");
  lua_rawseti(L,-2,1);
  lua_pushliteral(L,"darkage:wood_bars");
  lua_rawseti(L,-2,2);
  lua_pushliteral(L,"");
  lua_rawseti(L,-2,3);
  lua_rawseti(L,-2,3);
  lua_rawset(L,-3);
  lua_call(L,1,0);
  assert(lua_gettop(L) - lc_nextra == 0);
  
  /* minetest.register_craft({
   * 	output = 'darkage:wood_shelves',
   * 	recipe = {
   *     {'darkage:box'},
   *     {'darkage:box'},
   * 	}
   * }) */
  lua_getfield(L,LUA_ENVIRONINDEX,"minetest");
  lua_pushliteral(L,"register_craft");
  lua_gettable(L,-2);
  lua_remove(L,-2);
  lua_createtable(L,0,2);
  lua_pushliteral(L,"output");
  lua_pushliteral(L,"darkage:wood_shelves");
  lua_rawset(L,-3);
  lua_pushliteral(L,"recipe");
  lua_createtable(L,2,0);
  lua_createtable(L,1,0);
  lua_pushliteral(L,"darkage:box");
  lua_rawseti(L,-2,1);
  lua_rawseti(L,-2,1);
  lua_createtable(L,1,0);
  lua_pushliteral(L,"darkage:box");
  lua_rawseti(L,-2,1);
  lua_rawseti(L,-2,2);
  lua_rawset(L,-3);
  lua_call(L,1,0);
  assert(lua_gettop(L) - lc_nextra == 0);
  
  /* minetest.register_craft({
   * 	output = 'darkage:wood_frame',
   * 	recipe = {
   *     {'default:stick','','default:stick'},
   *     {'','default:glass',''},
   *     {'default:stick','','default:stick'},
   * 	}
   * }) */
  lua_getfield(L,LUA_ENVIRONINDEX,"minetest");
  lua_pushliteral(L,"register_craft");
  lua_gettable(L,-2);
  lua_remove(L,-2);
  lua_createtable(L,0,2);
  lua_pushliteral(L,"output");
  lua_pushliteral(L,"darkage:wood_frame");
  lua_rawset(L,-3);
  lua_pushliteral(L,"recipe");
  lua_createtable(L,3,0);
  lua_createtable(L,3,0);
  lua_pushliteral(L,"default:stick");
  lua_rawseti(L,-2,1);
  lua_pushliteral(L,"");
  lua_rawseti(L,-2,2);
  lua_pushliteral(L,"default:stick");
  lua_rawseti(L,-2,3);
  lua_rawseti(L,-2,1);
  lua_createtable(L,3,0);
  lua_pushliteral(L,"");
  lua_rawseti(L,-2,1);
  lua_pushliteral(L,"default:glass");
  lua_rawseti(L,-2,2);
  lua_pushliteral(L,"");
  lua_rawseti(L,-2,3);
  lua_rawseti(L,-2,2);
  lua_createtable(L,3,0);
  lua_pushliteral(L,"default:stick");
  lua_rawseti(L,-2,1);
  lua_pushliteral(L,"");
  lua_rawseti(L,-2,2);
  lua_pushliteral(L,"default:stick");
  lua_rawseti(L,-2,3);
  lua_rawseti(L,-2,3);
  lua_rawset(L,-3);
  lua_call(L,1,0);
  assert(lua_gettop(L) - lc_nextra == 0);
  
  /* -- Cookings
   * minetest.register_craft({
   * 	type = "cooking",
   * 	output = "default:glass",
   * 	recipe = "darkage:wood_frame",
   * }) */
  lua_getfield(L,LUA_ENVIRONINDEX,"minetest");
  lua_pushliteral(L,"register_craft");
  lua_gettable(L,-2);
  lua_remove(L,-2);
  lua_createtable(L,0,3);
  lua_pushliteral(L,"type");
  lua_pushliteral(L,"cooking");
  lua_rawset(L,-3);
  lua_pushliteral(L,"output");
  lua_pushliteral(L,"default:glass");
  lua_rawset(L,-3);
  lua_pushliteral(L,"recipe");
  lua_pushliteral(L,"darkage:wood_frame");
  lua_rawset(L,-3);
  lua_call(L,1,0);
  assert(lua_gettop(L) - lc_nextra == 0);
  return 0;
}


/* from lua.c */
static int traceback (lua_State *L) {
  if (!lua_isstring(L, 1))  /* 'message' not a string? */
    return 1;  /* keep it intact */
  lua_getfield(L, LUA_GLOBALSINDEX, "debug");
  if (!lua_istable(L, -1)) {
    lua_pop(L, 1);
    return 1;
  }
  lua_getfield(L, -1, "traceback");
  if (!lua_isfunction(L, -1)) {
    lua_pop(L, 2);
    return 1;
  }
  lua_pushvalue(L, 1);  /* pass error message */
  lua_pushinteger(L, 2);  /* skip this function and traceback */
  lua_call(L, 2, 1);  /* call debug.traceback */
  return 1;
}


static void lc_l_message (const char *pname, const char *msg) {
  if (pname) fprintf(stderr, "%s: ", pname);
  fprintf(stderr, "%s\n", msg);
  fflush(stderr);
}

static int lc_report (lua_State *L, int status) {
  if (status && !lua_isnil(L, -1)) {
    const char *msg = lua_tostring(L, -1);
    if (msg == NULL) msg = "(error object is not a string)";
    /*FIX-IMROVE:progname*/
    lc_l_message("lua", msg);
    lua_pop(L, 1);
  }
  return status;
}

static int lc_docall (lua_State *L, int narg, int clear) {
  int status;
  int base = lua_gettop(L) - narg;  /* function index */
  lua_pushcfunction(L, traceback);  /* push traceback function */
  lua_insert(L, base);  /* put it under chunk and args */
  /*FIX? signal(SIGINT, laction); */
  status = lua_pcall(L, narg, (clear ? 0 : LUA_MULTRET), base);
  /*FIX? signal(SIGINT, SIG_DFL); */
  lua_remove(L, base);  /* remove traceback function */
  /* force a complete garbage collection in case of errors */
  if (status != 0) lua_gc(L, LUA_GCCOLLECT, 0);
  return status;
}

static int lc_dofile (lua_State *L, const char *name) {
  int status = luaL_loadfile(L, name) || lc_docall(L, 0, 1);
  return lc_report(L, status);
}

static int lc_dostring (lua_State *L, const char *s, const char *name) {
  int status = luaL_loadbuffer(L, s, strlen(s), name) || lc_docall(L, 0, 1);
  return lc_report(L, status);
}

static int lc_handle_luainit (lua_State *L) {
  const char *init = getenv(LUA_INIT);
  if (init == NULL) return 0;  /* status OK */
  else if (init[0] == '@')
    return lc_dofile(L, init+1);
  else
    return lc_dostring(L, init, "=" LUA_INIT);
}


typedef struct {
  int c;
  const char ** v;
} lc_args_t;


/* create global arg table */
static void lc_createarg(lua_State * L, const lc_args_t * const args) {
  int i;
  lua_newtable(L);
  for (i=0; i < args->c; i++) {
    lua_pushstring(L, args->v[i]);
    lua_rawseti(L, -2, i);
  }
  lua_setglobal(L, "arg");
}


int lc_pmain_mod_darkage_furniture(lua_State * L) {
  luaL_openlibs(L);

  lua_pushcfunction(L, traceback);

  const int status1 = lc_handle_luainit(L);
  if (status1 != 0) return 0;

  /* note: IMPROVE: closure not always needed here */
  lua_newtable(L); /* closure table */
  lua_pushcclosure(L, lcf_main, 1);

  int status2 = lua_pcall(L, 0, 0, -2);
  if (status2 != 0) {
	const char * msg = lua_tostring(L,-1);
	if (msg == NULL) msg = "(error object is not a string)";
	fputs(msg, stderr);
  }
  return 0;
}


