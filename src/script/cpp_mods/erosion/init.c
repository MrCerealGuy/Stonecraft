/* WARNING: This file was automatically generated by lua2c. */

#ifdef __cplusplus
extern "C" {
#endif
#include <lua.h>
#include <lauxlib.h>
#include <lualib.h>
#ifdef __cplusplus
}
#endif
#include <stdio.h>
#include <stdlib.h>


#include <string.h>


#include <assert.h>

#include "cpp_mods/erosion/init.h"

/* pushes new closure table onto the stack, using closure table at
 * given index as its parent */
static void lc_newclosuretable(lua_State * L, int idx) {

  lua_newtable(L);
  lua_pushvalue(L,idx);
  lua_rawseti(L,-2,0);


}

/* gets upvalue with ID varid by consulting upvalue table at index
 * tidx for the upvalue table at given nesting level. */
static void lc_getupvalue(lua_State * L, int tidx, int level, int varid) {
  if (level == 0) {
    lua_rawgeti(L,tidx,varid);
  }
  else {
    lua_pushvalue(L,tidx);
    while (--level >= 0) {
      lua_rawgeti(L,tidx,0); /* 0 links to parent table */
      lua_remove(L,-2);
      tidx = -1;
    }
    lua_rawgeti(L,-1,varid);
    lua_remove(L,-2);
  }
}


/* __add metamethod handler.
 * warning: assumes indices in range LUA_REGISTRYINDEX < x < 0 are relative. */
static void lc_add(lua_State * L, int idxa, int idxb) {
  if (lua_isnumber(L,idxa) && lua_isnumber(L,idxb)) {
    lua_pushnumber(L,lua_tonumber(L,idxa) + lua_tonumber(L,idxb));
  }
  else {
    if (luaL_getmetafield(L,idxa,"__add")||luaL_getmetafield(L,idxb,"__add")) {
      lua_pushvalue(L,idxa < 0 && idxa > LUA_REGISTRYINDEX ? idxa-1 : idxa);
      lua_pushvalue(L,idxb < 0 && idxb > LUA_REGISTRYINDEX ? idxb-2 : idxb);
      lua_call(L,2,1);
    }
    else {
      luaL_error(L, "attempt to perform arithmetic");
    }
  }
}


/* name: table.val_to_str
 * function( v) */
static int lcf1_table_val_to_str (lua_State * L) {
  enum { lc_nformalargs = 1 };
  lua_settop(L,1);
  
  /* if "string" == type( v ) then */
  enum { lc13 = 1 };
  lua_pushliteral(L,"string");
  lua_getfield(L,LUA_ENVIRONINDEX,"type");
  lua_pushvalue(L,1);
  lua_call(L,1,1);
  const int lc14 = lua_equal(L,-2,-1);
  lua_pop(L,2);
  lua_pushboolean(L,lc14);
  const int lc15 = lua_toboolean(L,-1);
  lua_pop(L,1);
  if (lc15) {
    
    /* v = string.gsub( v, "\n", "\\n" ) */
    lua_getfield(L,LUA_ENVIRONINDEX,"string");
    lua_pushliteral(L,"gsub");
    lua_gettable(L,-2);
    lua_remove(L,-2);
    lua_pushvalue(L,1);
    lua_pushliteral(L,"\n");
    lua_pushliteral(L,"\\n");
    lua_call(L,3,1);
    lua_replace(L,1);
    assert(lua_gettop(L) == 1);
    
    /* if string.match( string.gsub(v,"[^'\"]",""), '^"+$' ) then */
    enum { lc16 = 1 };
    lua_getfield(L,LUA_ENVIRONINDEX,"string");
    lua_pushliteral(L,"match");
    lua_gettable(L,-2);
    lua_remove(L,-2);
    lua_getfield(L,LUA_ENVIRONINDEX,"string");
    lua_pushliteral(L,"gsub");
    lua_gettable(L,-2);
    lua_remove(L,-2);
    lua_pushvalue(L,1);
    lua_pushliteral(L,"[^'\"]");
    lua_pushliteral(L,"");
    lua_call(L,3,1);
    lua_pushliteral(L,"^\"+$");
    lua_call(L,2,1);
    const int lc17 = lua_toboolean(L,-1);
    lua_pop(L,1);
    if (lc17) {
      
      /* return "'" .. v .. "'" */
      lua_pushliteral(L,"'");
      lua_pushvalue(L,1);
      lua_pushliteral(L,"'");
      lua_concat(L,2);
      lua_concat(L,2);
      return 1;
      assert(lua_gettop(L) == 1);
    }
    lua_settop(L,lc16);
    assert(lua_gettop(L) == 1);
    
    /* return '"' .. string.gsub(v,'"', '\\"' ) .. '"' */
    lua_pushliteral(L,"\"");
    lua_getfield(L,LUA_ENVIRONINDEX,"string");
    lua_pushliteral(L,"gsub");
    lua_gettable(L,-2);
    lua_remove(L,-2);
    lua_pushvalue(L,1);
    lua_pushliteral(L,"\"");
    lua_pushliteral(L,"\\\"");
    lua_call(L,3,1);
    lua_pushliteral(L,"\"");
    lua_concat(L,2);
    lua_concat(L,2);
    return 1;
    assert(lua_gettop(L) == 1);
  }
  else {
    
    /* else
     * return "table" == type( v ) and table.tostring( v ) or
     *       tostring( v ) */
    lua_pushliteral(L,"table");
    lua_getfield(L,LUA_ENVIRONINDEX,"type");
    lua_pushvalue(L,1);
    lua_call(L,1,1);
    const int lc18 = lua_equal(L,-2,-1);
    lua_pop(L,2);
    lua_pushboolean(L,lc18);
    if (lua_toboolean(L,-1)) {
      lua_pop(L,1);
      lua_getfield(L,LUA_ENVIRONINDEX,"table");
      lua_pushliteral(L,"tostring");
      lua_gettable(L,-2);
      lua_remove(L,-2);
      lua_pushvalue(L,1);
      lua_call(L,1,1);
    }
    if (!(lua_toboolean(L,-1))) {
      lua_pop(L,1);
      lua_getfield(L,LUA_ENVIRONINDEX,"tostring");
      lua_pushvalue(L,1);
      lua_call(L,1,1);
    }
    return 1;
    assert(lua_gettop(L) == 1);
  }
  lua_settop(L,lc13);
  assert(lua_gettop(L) == 1);
  return 0;
}


/* name: table.key_to_str
 * function( k) */
static int lcf1_table_key_to_str (lua_State * L) {
  enum { lc_nformalargs = 1 };
  lua_settop(L,1);
  
  /* if "string" == type( k ) and string.match( k, "^[_%a][_%a%d]*$" ) then */
  enum { lc19 = 1 };
  lua_pushliteral(L,"string");
  lua_getfield(L,LUA_ENVIRONINDEX,"type");
  lua_pushvalue(L,1);
  lua_call(L,1,1);
  const int lc20 = lua_equal(L,-2,-1);
  lua_pop(L,2);
  lua_pushboolean(L,lc20);
  if (lua_toboolean(L,-1)) {
    lua_pop(L,1);
    lua_getfield(L,LUA_ENVIRONINDEX,"string");
    lua_pushliteral(L,"match");
    lua_gettable(L,-2);
    lua_remove(L,-2);
    lua_pushvalue(L,1);
    lua_pushliteral(L,"^[_%a][_%a%d]*$");
    lua_call(L,2,1);
  }
  const int lc21 = lua_toboolean(L,-1);
  lua_pop(L,1);
  if (lc21) {
    
    /* return k */
    lua_pushvalue(L,1);
    return 1;
    assert(lua_gettop(L) == 1);
  }
  else {
    
    /* else
     * return "[" .. table.val_to_str( k ) .. "]" */
    lua_pushliteral(L,"[");
    lua_getfield(L,LUA_ENVIRONINDEX,"table");
    lua_pushliteral(L,"val_to_str");
    lua_gettable(L,-2);
    lua_remove(L,-2);
    lua_pushvalue(L,1);
    lua_call(L,1,1);
    lua_pushliteral(L,"]");
    lua_concat(L,2);
    lua_concat(L,2);
    return 1;
    assert(lua_gettop(L) == 1);
  }
  lua_settop(L,lc19);
  assert(lua_gettop(L) == 1);
  return 0;
}


/* name: table.tostring
 * function( tbl) */
static int lcf1_table_tostring (lua_State * L) {
  enum { lc_nformalargs = 1 };
  lua_settop(L,1);
  
  /* local result, done = {}, {} */
  lua_newtable(L);
  lua_newtable(L);
  assert(lua_gettop(L) == 3);
  
  /* for k, v in ipairs( tbl ) do
   * internal: local f, s, var = explist */
  enum { lc22 = 3 };
  lua_getfield(L,LUA_ENVIRONINDEX,"ipairs");
  lua_pushvalue(L,1);
  lua_call(L,1,3);
  while (1) {
    
    /* internal: local var_1, ..., var_n = f(s, var)
     *           if var_1 == nil then break end
     *           var = var_1 */
    lua_pushvalue(L,-3);
    lua_pushvalue(L,-3);
    lua_pushvalue(L,-3);
    lua_call(L,2,2);
    if (lua_isnil(L,-2)) {
      break;
    }
    lua_pushvalue(L,-2);
    lua_replace(L,-4);
    
    /* internal: local k with idx 7
     * internal: local v with idx 8 */
    
    
    /* table.insert( result, table.val_to_str( v ) ) */
    lua_getfield(L,LUA_ENVIRONINDEX,"table");
    lua_pushliteral(L,"insert");
    lua_gettable(L,-2);
    lua_remove(L,-2);
    const int lc23 = lua_gettop(L);
    lua_pushvalue(L,2);
    lua_getfield(L,LUA_ENVIRONINDEX,"table");
    lua_pushliteral(L,"val_to_str");
    lua_gettable(L,-2);
    lua_remove(L,-2);
    lua_pushvalue(L,8);
    lua_call(L,1,LUA_MULTRET);
    lua_call(L,(lua_gettop(L) - lc23),0);
    assert(lua_gettop(L) == 8);
    
    /* done[ k ] = true */
    lua_pushboolean(L,1);
    lua_pushvalue(L,7);
    lua_insert(L,-2);
    lua_settable(L,3);
    assert(lua_gettop(L) == 8);
    
    /* internal: stack cleanup on scope exit */
    lua_pop(L,2);
  }
  lua_settop(L,lc22);
  assert(lua_gettop(L) == 3);
  
  /* for k, v in pairs( tbl ) do
   * internal: local f, s, var = explist */
  enum { lc24 = 3 };
  lua_getfield(L,LUA_ENVIRONINDEX,"pairs");
  lua_pushvalue(L,1);
  lua_call(L,1,3);
  while (1) {
    
    /* internal: local var_1, ..., var_n = f(s, var)
     *           if var_1 == nil then break end
     *           var = var_1 */
    lua_pushvalue(L,-3);
    lua_pushvalue(L,-3);
    lua_pushvalue(L,-3);
    lua_call(L,2,2);
    if (lua_isnil(L,-2)) {
      break;
    }
    lua_pushvalue(L,-2);
    lua_replace(L,-4);
    
    /* internal: local k with idx 7
     * internal: local v with idx 8 */
    
    
    /* if not done[ k ] then */
    enum { lc25 = 8 };
    lua_pushvalue(L,7);
    lua_gettable(L,3);
    lua_pushboolean(L,!(lua_toboolean(L,-1)));
    lua_remove(L,-2);
    const int lc26 = lua_toboolean(L,-1);
    lua_pop(L,1);
    if (lc26) {
      
      /* table.insert( result,
       *         table.key_to_str( k ) .. "=" .. table.val_to_str( v ) ) */
      lua_getfield(L,LUA_ENVIRONINDEX,"table");
      lua_pushliteral(L,"insert");
      lua_gettable(L,-2);
      lua_remove(L,-2);
      lua_pushvalue(L,2);
      lua_getfield(L,LUA_ENVIRONINDEX,"table");
      lua_pushliteral(L,"key_to_str");
      lua_gettable(L,-2);
      lua_remove(L,-2);
      lua_pushvalue(L,7);
      lua_call(L,1,1);
      lua_pushliteral(L,"=");
      lua_getfield(L,LUA_ENVIRONINDEX,"table");
      lua_pushliteral(L,"val_to_str");
      lua_gettable(L,-2);
      lua_remove(L,-2);
      lua_pushvalue(L,8);
      lua_call(L,1,1);
      lua_concat(L,2);
      lua_concat(L,2);
      lua_call(L,2,0);
      assert(lua_gettop(L) == 8);
    }
    lua_settop(L,lc25);
    assert(lua_gettop(L) == 8);
    
    /* internal: stack cleanup on scope exit */
    lua_pop(L,2);
  }
  lua_settop(L,lc24);
  assert(lua_gettop(L) == 3);
  
  /* return "{" .. table.concat( result, "," ) .. "}" */
  lua_pushliteral(L,"{");
  lua_getfield(L,LUA_ENVIRONINDEX,"table");
  lua_pushliteral(L,"concat");
  lua_gettable(L,-2);
  lua_remove(L,-2);
  lua_pushvalue(L,2);
  lua_pushliteral(L,",");
  lua_call(L,2,1);
  lua_pushliteral(L,"}");
  lua_concat(L,2);
  lua_concat(L,2);
  return 1;
  assert(lua_gettop(L) == 3);
}


/* __sub metamethod handler.
 * warning: assumes indices in range LUA_REGISTRYINDEX < x < 0 are relative. */
static void lc_sub(lua_State * L, int idxa, int idxb) {
  if (lua_isnumber(L,idxa) && lua_isnumber(L,idxb)) {
    lua_pushnumber(L,lua_tonumber(L,idxa) - lua_tonumber(L,idxb));
  }
  else {
    if (luaL_getmetafield(L,idxa,"__sub")||luaL_getmetafield(L,idxb,"__sub")) {
      lua_pushvalue(L,idxa < 0 && idxa > LUA_REGISTRYINDEX ? idxa-1 : idxa);
      lua_pushvalue(L,idxb < 0 && idxb > LUA_REGISTRYINDEX ? idxb-2 : idxb);
      lua_call(L,2,1);
    }
    else {
      luaL_error(L, "attempt to perform arithmetic");
    }
  }
}


/* __mul metamethod handler.
 * warning: assumes indices in range LUA_REGISTRYINDEX < x < 0 are relative. */
static void lc_mul(lua_State * L, int idxa, int idxb) {
  if (lua_isnumber(L,idxa) && lua_isnumber(L,idxb)) {
    lua_pushnumber(L,lua_tonumber(L,idxa) * lua_tonumber(L,idxb));
  }
  else {
    if (luaL_getmetafield(L,idxa,"__mul")||luaL_getmetafield(L,idxb,"__mul")) {
      lua_pushvalue(L,idxa < 0 && idxa > LUA_REGISTRYINDEX ? idxa-1 : idxa);
      lua_pushvalue(L,idxb < 0 && idxb > LUA_REGISTRYINDEX ? idxb-2 : idxb);
      lua_call(L,2,1);
    }
    else {
      luaL_error(L, "attempt to perform arithmetic");
    }
  }
}


/* name: get_adjacent_nodes
 * function(p,nlst) */
static int lcf1_get_adjacent_nodes (lua_State * L) {
  enum { lc_nformalargs = 2 };
  lua_settop(L,2);
  
  /* local xsr,nvt = minetest.find_nodes_in_area({x=p.x-1,y=p.y,z=p.z-1},{x=p.x+1,y=p.y,z=p.z+1},nlst),{} */
  lua_getfield(L,LUA_ENVIRONINDEX,"minetest");
  lua_pushliteral(L,"find_nodes_in_area");
  lua_gettable(L,-2);
  lua_remove(L,-2);
  lua_createtable(L,0,3);
  lua_pushliteral(L,"x");
  lua_pushliteral(L,"x");
  lua_gettable(L,1);
  lua_pushnumber(L,1);
  lc_sub(L,-2,-1);
  lua_remove(L,-2);
  lua_remove(L,-2);
  lua_rawset(L,-3);
  lua_pushliteral(L,"y");
  lua_pushliteral(L,"y");
  lua_gettable(L,1);
  lua_rawset(L,-3);
  lua_pushliteral(L,"z");
  lua_pushliteral(L,"z");
  lua_gettable(L,1);
  lua_pushnumber(L,1);
  lc_sub(L,-2,-1);
  lua_remove(L,-2);
  lua_remove(L,-2);
  lua_rawset(L,-3);
  lua_createtable(L,0,3);
  lua_pushliteral(L,"x");
  lua_pushliteral(L,"x");
  lua_gettable(L,1);
  lua_pushnumber(L,1);
  lc_add(L,-2,-1);
  lua_remove(L,-2);
  lua_remove(L,-2);
  lua_rawset(L,-3);
  lua_pushliteral(L,"y");
  lua_pushliteral(L,"y");
  lua_gettable(L,1);
  lua_rawset(L,-3);
  lua_pushliteral(L,"z");
  lua_pushliteral(L,"z");
  lua_gettable(L,1);
  lua_pushnumber(L,1);
  lc_add(L,-2,-1);
  lua_remove(L,-2);
  lua_remove(L,-2);
  lua_rawset(L,-3);
  lua_pushvalue(L,2);
  lua_call(L,3,1);
  lua_newtable(L);
  assert(lua_gettop(L) == 4);
  
  /* for i=1,#xsr do */
  lua_pushnumber(L,1);
  const double lc40 = lua_objlen(L,3);
  lua_pushnumber(L,lc40);
  if (!((lua_isnumber(L,-2) && lua_isnumber(L,-1)))) {
    luaL_error(L,"'for' limit must be a number");
  }
  double lc37_var = lua_tonumber(L,-2);
  const double lc38_limit = lua_tonumber(L,-1);
  const double lc39_step = 1;
  lua_pop(L,2);
  enum { lc41 = 4 };
  while ((((lc39_step > 0) && (lc37_var <= lc38_limit)) || ((lc39_step <= 0) && (lc37_var >= lc38_limit)))) {
    
    /* internal: local i at index 5 */
    lua_pushnumber(L,lc37_var);
    
    /* nvt[xsr[i].x] = nvt[xsr[i].x] or {} */
    lua_pushvalue(L,5);
    lua_gettable(L,3);
    lua_pushliteral(L,"x");
    lua_gettable(L,-2);
    lua_remove(L,-2);
    lua_gettable(L,4);
    if (!(lua_toboolean(L,-1))) {
      lua_pop(L,1);
      lua_newtable(L);
    }
    lua_pushvalue(L,5);
    lua_gettable(L,3);
    lua_pushliteral(L,"x");
    lua_gettable(L,-2);
    lua_remove(L,-2);
    lua_insert(L,-2);
    lua_settable(L,4);
    assert(lua_gettop(L) == 5);
    
    /* nvt[xsr[i].x][xsr[i].z] = i */
    lua_pushvalue(L,5);
    lua_pushvalue(L,5);
    lua_gettable(L,3);
    lua_pushliteral(L,"x");
    lua_gettable(L,-2);
    lua_remove(L,-2);
    lua_gettable(L,4);
    lua_insert(L,-2);
    lua_pushvalue(L,5);
    lua_gettable(L,3);
    lua_pushliteral(L,"z");
    lua_gettable(L,-2);
    lua_remove(L,-2);
    lua_insert(L,-2);
    lua_settable(L,-3);
    lua_pop(L,1);
    assert(lua_gettop(L) == 5);
    
    /* internal: stack cleanup on scope exit */
    lua_pop(L,1);
    lc37_var += lc39_step;
  }
  lua_settop(L,lc41);
  assert(lua_gettop(L) == 4);
  
  /* return xsr,nvt */
  lua_pushvalue(L,3);
  lua_pushvalue(L,4);
  return 2;
  assert(lua_gettop(L) == 4);
}


/* name: orient_pile
 * function(k,m,p) */
static int lcf1_orient_pile (lua_State * L) {
  lua_checkstack(L,25);
  enum { lc_nformalargs = 3 };
  lua_settop(L,3);
  
  /* local _,t0 = get_adjacent_nodes(p,{"air"}) */
  lc_getupvalue(L,lua_upvalueindex(1),1,10);
  lua_pushvalue(L,3);
  lua_createtable(L,1,0);
  lua_pushliteral(L,"air");
  lua_rawseti(L,-2,1);
  lua_call(L,2,2);
  assert(lua_gettop(L) == 5);
  
  /* local a,t1 = get_adjacent_nodes(p,snt1) */
  lc_getupvalue(L,lua_upvalueindex(1),1,10);
  lua_pushvalue(L,3);
  lc_getupvalue(L,lua_upvalueindex(1),3,8);
  lua_call(L,2,2);
  assert(lua_gettop(L) == 7);
  
  /* local _,t2 = get_adjacent_nodes(p,snt2) */
  lc_getupvalue(L,lua_upvalueindex(1),1,10);
  lua_pushvalue(L,3);
  lc_getupvalue(L,lua_upvalueindex(1),3,7);
  lua_call(L,2,2);
  assert(lua_gettop(L) == 9);
  
  /* local x1,z1,x2,z2,d,nm =
   * 	t0[p.x-1] and t0[p.x-1][p.z] and 0 or t1[p.x-1] and t1[p.x-1][p.z] and 1 or t2[p.x-1] and t2[p.x-1][p.z] and 2 or 3,
   * 	t0[p.x] and t0[p.x][p.z-1] and 0 or t1[p.x] and t1[p.x][p.z-1] and 1 or t2[p.x] and t2[p.x][p.z-1] and 2 or 3,
   * 	t0[p.x+1] and t0[p.x+1][p.z] and 0 or t1[p.x+1] and t1[p.x+1][p.z] and 1 or t2[p.x+1] and t2[p.x+1][p.z] and 2 or 3,
   * 	t0[p.x] and t0[p.x][p.z+1] and 0 or t1[p.x] and t1[p.x][p.z+1] and 1 or t2[p.x] and t2[p.x][p.z+1] and 2 or 3 */
  lua_pushliteral(L,"x");
  lua_gettable(L,3);
  lua_pushnumber(L,1);
  lc_sub(L,-2,-1);
  lua_remove(L,-2);
  lua_remove(L,-2);
  lua_gettable(L,5);
  if (lua_toboolean(L,-1)) {
    lua_pop(L,1);
    lua_pushliteral(L,"x");
    lua_gettable(L,3);
    lua_pushnumber(L,1);
    lc_sub(L,-2,-1);
    lua_remove(L,-2);
    lua_remove(L,-2);
    lua_gettable(L,5);
    lua_pushliteral(L,"z");
    lua_gettable(L,3);
    lua_gettable(L,-2);
    lua_remove(L,-2);
  }
  if (lua_toboolean(L,-1)) {
    lua_pop(L,1);
    lua_pushnumber(L,0);
  }
  if (!(lua_toboolean(L,-1))) {
    lua_pop(L,1);
    lua_pushliteral(L,"x");
    lua_gettable(L,3);
    lua_pushnumber(L,1);
    lc_sub(L,-2,-1);
    lua_remove(L,-2);
    lua_remove(L,-2);
    lua_gettable(L,7);
    if (lua_toboolean(L,-1)) {
      lua_pop(L,1);
      lua_pushliteral(L,"x");
      lua_gettable(L,3);
      lua_pushnumber(L,1);
      lc_sub(L,-2,-1);
      lua_remove(L,-2);
      lua_remove(L,-2);
      lua_gettable(L,7);
      lua_pushliteral(L,"z");
      lua_gettable(L,3);
      lua_gettable(L,-2);
      lua_remove(L,-2);
    }
    if (lua_toboolean(L,-1)) {
      lua_pop(L,1);
      lua_pushnumber(L,1);
    }
  }
  if (!(lua_toboolean(L,-1))) {
    lua_pop(L,1);
    lua_pushliteral(L,"x");
    lua_gettable(L,3);
    lua_pushnumber(L,1);
    lc_sub(L,-2,-1);
    lua_remove(L,-2);
    lua_remove(L,-2);
    lua_gettable(L,9);
    if (lua_toboolean(L,-1)) {
      lua_pop(L,1);
      lua_pushliteral(L,"x");
      lua_gettable(L,3);
      lua_pushnumber(L,1);
      lc_sub(L,-2,-1);
      lua_remove(L,-2);
      lua_remove(L,-2);
      lua_gettable(L,9);
      lua_pushliteral(L,"z");
      lua_gettable(L,3);
      lua_gettable(L,-2);
      lua_remove(L,-2);
    }
    if (lua_toboolean(L,-1)) {
      lua_pop(L,1);
      lua_pushnumber(L,2);
    }
  }
  if (!(lua_toboolean(L,-1))) {
    lua_pop(L,1);
    lua_pushnumber(L,3);
  }
  lua_pushliteral(L,"x");
  lua_gettable(L,3);
  lua_gettable(L,5);
  if (lua_toboolean(L,-1)) {
    lua_pop(L,1);
    lua_pushliteral(L,"x");
    lua_gettable(L,3);
    lua_gettable(L,5);
    lua_pushliteral(L,"z");
    lua_gettable(L,3);
    lua_pushnumber(L,1);
    lc_sub(L,-2,-1);
    lua_remove(L,-2);
    lua_remove(L,-2);
    lua_gettable(L,-2);
    lua_remove(L,-2);
  }
  if (lua_toboolean(L,-1)) {
    lua_pop(L,1);
    lua_pushnumber(L,0);
  }
  if (!(lua_toboolean(L,-1))) {
    lua_pop(L,1);
    lua_pushliteral(L,"x");
    lua_gettable(L,3);
    lua_gettable(L,7);
    if (lua_toboolean(L,-1)) {
      lua_pop(L,1);
      lua_pushliteral(L,"x");
      lua_gettable(L,3);
      lua_gettable(L,7);
      lua_pushliteral(L,"z");
      lua_gettable(L,3);
      lua_pushnumber(L,1);
      lc_sub(L,-2,-1);
      lua_remove(L,-2);
      lua_remove(L,-2);
      lua_gettable(L,-2);
      lua_remove(L,-2);
    }
    if (lua_toboolean(L,-1)) {
      lua_pop(L,1);
      lua_pushnumber(L,1);
    }
  }
  if (!(lua_toboolean(L,-1))) {
    lua_pop(L,1);
    lua_pushliteral(L,"x");
    lua_gettable(L,3);
    lua_gettable(L,9);
    if (lua_toboolean(L,-1)) {
      lua_pop(L,1);
      lua_pushliteral(L,"x");
      lua_gettable(L,3);
      lua_gettable(L,9);
      lua_pushliteral(L,"z");
      lua_gettable(L,3);
      lua_pushnumber(L,1);
      lc_sub(L,-2,-1);
      lua_remove(L,-2);
      lua_remove(L,-2);
      lua_gettable(L,-2);
      lua_remove(L,-2);
    }
    if (lua_toboolean(L,-1)) {
      lua_pop(L,1);
      lua_pushnumber(L,2);
    }
  }
  if (!(lua_toboolean(L,-1))) {
    lua_pop(L,1);
    lua_pushnumber(L,3);
  }
  lua_pushliteral(L,"x");
  lua_gettable(L,3);
  lua_pushnumber(L,1);
  lc_add(L,-2,-1);
  lua_remove(L,-2);
  lua_remove(L,-2);
  lua_gettable(L,5);
  if (lua_toboolean(L,-1)) {
    lua_pop(L,1);
    lua_pushliteral(L,"x");
    lua_gettable(L,3);
    lua_pushnumber(L,1);
    lc_add(L,-2,-1);
    lua_remove(L,-2);
    lua_remove(L,-2);
    lua_gettable(L,5);
    lua_pushliteral(L,"z");
    lua_gettable(L,3);
    lua_gettable(L,-2);
    lua_remove(L,-2);
  }
  if (lua_toboolean(L,-1)) {
    lua_pop(L,1);
    lua_pushnumber(L,0);
  }
  if (!(lua_toboolean(L,-1))) {
    lua_pop(L,1);
    lua_pushliteral(L,"x");
    lua_gettable(L,3);
    lua_pushnumber(L,1);
    lc_add(L,-2,-1);
    lua_remove(L,-2);
    lua_remove(L,-2);
    lua_gettable(L,7);
    if (lua_toboolean(L,-1)) {
      lua_pop(L,1);
      lua_pushliteral(L,"x");
      lua_gettable(L,3);
      lua_pushnumber(L,1);
      lc_add(L,-2,-1);
      lua_remove(L,-2);
      lua_remove(L,-2);
      lua_gettable(L,7);
      lua_pushliteral(L,"z");
      lua_gettable(L,3);
      lua_gettable(L,-2);
      lua_remove(L,-2);
    }
    if (lua_toboolean(L,-1)) {
      lua_pop(L,1);
      lua_pushnumber(L,1);
    }
  }
  if (!(lua_toboolean(L,-1))) {
    lua_pop(L,1);
    lua_pushliteral(L,"x");
    lua_gettable(L,3);
    lua_pushnumber(L,1);
    lc_add(L,-2,-1);
    lua_remove(L,-2);
    lua_remove(L,-2);
    lua_gettable(L,9);
    if (lua_toboolean(L,-1)) {
      lua_pop(L,1);
      lua_pushliteral(L,"x");
      lua_gettable(L,3);
      lua_pushnumber(L,1);
      lc_add(L,-2,-1);
      lua_remove(L,-2);
      lua_remove(L,-2);
      lua_gettable(L,9);
      lua_pushliteral(L,"z");
      lua_gettable(L,3);
      lua_gettable(L,-2);
      lua_remove(L,-2);
    }
    if (lua_toboolean(L,-1)) {
      lua_pop(L,1);
      lua_pushnumber(L,2);
    }
  }
  if (!(lua_toboolean(L,-1))) {
    lua_pop(L,1);
    lua_pushnumber(L,3);
  }
  lua_pushliteral(L,"x");
  lua_gettable(L,3);
  lua_gettable(L,5);
  if (lua_toboolean(L,-1)) {
    lua_pop(L,1);
    lua_pushliteral(L,"x");
    lua_gettable(L,3);
    lua_gettable(L,5);
    lua_pushliteral(L,"z");
    lua_gettable(L,3);
    lua_pushnumber(L,1);
    lc_add(L,-2,-1);
    lua_remove(L,-2);
    lua_remove(L,-2);
    lua_gettable(L,-2);
    lua_remove(L,-2);
  }
  if (lua_toboolean(L,-1)) {
    lua_pop(L,1);
    lua_pushnumber(L,0);
  }
  if (!(lua_toboolean(L,-1))) {
    lua_pop(L,1);
    lua_pushliteral(L,"x");
    lua_gettable(L,3);
    lua_gettable(L,7);
    if (lua_toboolean(L,-1)) {
      lua_pop(L,1);
      lua_pushliteral(L,"x");
      lua_gettable(L,3);
      lua_gettable(L,7);
      lua_pushliteral(L,"z");
      lua_gettable(L,3);
      lua_pushnumber(L,1);
      lc_add(L,-2,-1);
      lua_remove(L,-2);
      lua_remove(L,-2);
      lua_gettable(L,-2);
      lua_remove(L,-2);
    }
    if (lua_toboolean(L,-1)) {
      lua_pop(L,1);
      lua_pushnumber(L,1);
    }
  }
  if (!(lua_toboolean(L,-1))) {
    lua_pop(L,1);
    lua_pushliteral(L,"x");
    lua_gettable(L,3);
    lua_gettable(L,9);
    if (lua_toboolean(L,-1)) {
      lua_pop(L,1);
      lua_pushliteral(L,"x");
      lua_gettable(L,3);
      lua_gettable(L,9);
      lua_pushliteral(L,"z");
      lua_gettable(L,3);
      lua_pushnumber(L,1);
      lc_add(L,-2,-1);
      lua_remove(L,-2);
      lua_remove(L,-2);
      lua_gettable(L,-2);
      lua_remove(L,-2);
    }
    if (lua_toboolean(L,-1)) {
      lua_pop(L,1);
      lua_pushnumber(L,2);
    }
  }
  if (!(lua_toboolean(L,-1))) {
    lua_pop(L,1);
    lua_pushnumber(L,3);
  }
  lua_settop(L,(lua_gettop(L) + 2));
  assert(lua_gettop(L) == 15);
  
  /* d = m>3 and 0
   * 	or z2 > z1 and x1 == x2 and 0
   * 	or x2 > x1 and z1 == z2 and 1
   * 	or z1 > z2 and x1 == x2 and 2
   * 	or x1 > x2 and z1 == z2 and 3
   * 	or z2 > z1 and x1 > x2 and 4
   * 	or x2 > x1 and z2 > z1 and 5
   * 	or z1 > z2 and x2 > x1 and 6
   * 	or x1 > x2 and z1 > z2 and 7 or 4 */
  lua_pushnumber(L,3);
  const int lc43 = lua_lessthan(L,-1,2);
  lua_pop(L,1);
  lua_pushboolean(L,lc43);
  if (lua_toboolean(L,-1)) {
    lua_pop(L,1);
    lua_pushnumber(L,0);
  }
  if (!(lua_toboolean(L,-1))) {
    lua_pop(L,1);
    const int lc44 = lua_lessthan(L,11,13);
    lua_pushboolean(L,lc44);
    if (lua_toboolean(L,-1)) {
      lua_pop(L,1);
      lua_pushvalue(L,10);
      lua_pushvalue(L,12);
      const int lc45 = lua_equal(L,-2,-1);
      lua_pop(L,2);
      lua_pushboolean(L,lc45);
    }
    if (lua_toboolean(L,-1)) {
      lua_pop(L,1);
      lua_pushnumber(L,0);
    }
  }
  if (!(lua_toboolean(L,-1))) {
    lua_pop(L,1);
    const int lc46 = lua_lessthan(L,10,12);
    lua_pushboolean(L,lc46);
    if (lua_toboolean(L,-1)) {
      lua_pop(L,1);
      lua_pushvalue(L,11);
      lua_pushvalue(L,13);
      const int lc47 = lua_equal(L,-2,-1);
      lua_pop(L,2);
      lua_pushboolean(L,lc47);
    }
    if (lua_toboolean(L,-1)) {
      lua_pop(L,1);
      lua_pushnumber(L,1);
    }
  }
  if (!(lua_toboolean(L,-1))) {
    lua_pop(L,1);
    const int lc48 = lua_lessthan(L,13,11);
    lua_pushboolean(L,lc48);
    if (lua_toboolean(L,-1)) {
      lua_pop(L,1);
      lua_pushvalue(L,10);
      lua_pushvalue(L,12);
      const int lc49 = lua_equal(L,-2,-1);
      lua_pop(L,2);
      lua_pushboolean(L,lc49);
    }
    if (lua_toboolean(L,-1)) {
      lua_pop(L,1);
      lua_pushnumber(L,2);
    }
  }
  if (!(lua_toboolean(L,-1))) {
    lua_pop(L,1);
    const int lc50 = lua_lessthan(L,12,10);
    lua_pushboolean(L,lc50);
    if (lua_toboolean(L,-1)) {
      lua_pop(L,1);
      lua_pushvalue(L,11);
      lua_pushvalue(L,13);
      const int lc51 = lua_equal(L,-2,-1);
      lua_pop(L,2);
      lua_pushboolean(L,lc51);
    }
    if (lua_toboolean(L,-1)) {
      lua_pop(L,1);
      lua_pushnumber(L,3);
    }
  }
  if (!(lua_toboolean(L,-1))) {
    lua_pop(L,1);
    const int lc52 = lua_lessthan(L,11,13);
    lua_pushboolean(L,lc52);
    if (lua_toboolean(L,-1)) {
      lua_pop(L,1);
      const int lc53 = lua_lessthan(L,12,10);
      lua_pushboolean(L,lc53);
    }
    if (lua_toboolean(L,-1)) {
      lua_pop(L,1);
      lua_pushnumber(L,4);
    }
  }
  if (!(lua_toboolean(L,-1))) {
    lua_pop(L,1);
    const int lc54 = lua_lessthan(L,10,12);
    lua_pushboolean(L,lc54);
    if (lua_toboolean(L,-1)) {
      lua_pop(L,1);
      const int lc55 = lua_lessthan(L,11,13);
      lua_pushboolean(L,lc55);
    }
    if (lua_toboolean(L,-1)) {
      lua_pop(L,1);
      lua_pushnumber(L,5);
    }
  }
  if (!(lua_toboolean(L,-1))) {
    lua_pop(L,1);
    const int lc56 = lua_lessthan(L,13,11);
    lua_pushboolean(L,lc56);
    if (lua_toboolean(L,-1)) {
      lua_pop(L,1);
      const int lc57 = lua_lessthan(L,10,12);
      lua_pushboolean(L,lc57);
    }
    if (lua_toboolean(L,-1)) {
      lua_pop(L,1);
      lua_pushnumber(L,6);
    }
  }
  if (!(lua_toboolean(L,-1))) {
    lua_pop(L,1);
    const int lc58 = lua_lessthan(L,12,10);
    lua_pushboolean(L,lc58);
    if (lua_toboolean(L,-1)) {
      lua_pop(L,1);
      const int lc59 = lua_lessthan(L,13,11);
      lua_pushboolean(L,lc59);
    }
    if (lua_toboolean(L,-1)) {
      lua_pop(L,1);
      lua_pushnumber(L,7);
    }
  }
  if (!(lua_toboolean(L,-1))) {
    lua_pop(L,1);
    lua_pushnumber(L,4);
  }
  lua_replace(L,14);
  assert(lua_gettop(L) == 15);
  
  /* nm = m<4 and "erosion:slope_"..k..bstbl[d<4 and 1 or 2][m] or "default:"..k */
  lua_pushnumber(L,4);
  const int lc60 = lua_lessthan(L,2,-1);
  lua_pop(L,1);
  lua_pushboolean(L,lc60);
  if (lua_toboolean(L,-1)) {
    lua_pop(L,1);
    lua_pushliteral(L,"erosion:slope_");
    lua_pushvalue(L,1);
    lc_getupvalue(L,lua_upvalueindex(1),2,9);
    lua_pushnumber(L,4);
    const int lc61 = lua_lessthan(L,14,-1);
    lua_pop(L,1);
    lua_pushboolean(L,lc61);
    if (lua_toboolean(L,-1)) {
      lua_pop(L,1);
      lua_pushnumber(L,1);
    }
    if (!(lua_toboolean(L,-1))) {
      lua_pop(L,1);
      lua_pushnumber(L,2);
    }
    lua_gettable(L,-2);
    lua_remove(L,-2);
    lua_pushvalue(L,2);
    lua_gettable(L,-2);
    lua_remove(L,-2);
    lua_concat(L,2);
    lua_concat(L,2);
  }
  if (!(lua_toboolean(L,-1))) {
    lua_pop(L,1);
    lua_pushliteral(L,"default:");
    lua_pushvalue(L,1);
    lua_concat(L,2);
  }
  lua_replace(L,15);
  assert(lua_gettop(L) == 15);
  
  /* minetest.swap_node(p,{name=nm,param2=d<4 and d or d-4}) */
  lua_getfield(L,LUA_ENVIRONINDEX,"minetest");
  lua_pushliteral(L,"swap_node");
  lua_gettable(L,-2);
  lua_remove(L,-2);
  lua_pushvalue(L,3);
  lua_createtable(L,0,2);
  lua_pushliteral(L,"name");
  lua_pushvalue(L,15);
  lua_rawset(L,-3);
  lua_pushliteral(L,"param2");
  lua_pushnumber(L,4);
  const int lc62 = lua_lessthan(L,14,-1);
  lua_pop(L,1);
  lua_pushboolean(L,lc62);
  if (lua_toboolean(L,-1)) {
    lua_pop(L,1);
    lua_pushvalue(L,14);
  }
  if (!(lua_toboolean(L,-1))) {
    lua_pop(L,1);
    lua_pushnumber(L,4);
    lc_sub(L,14,-1);
    lua_remove(L,-2);
  }
  lua_rawset(L,-3);
  lua_call(L,2,0);
  assert(lua_gettop(L) == 15);
  
  /* return a */
  lua_pushvalue(L,6);
  return 1;
  assert(lua_gettop(L) == 15);
}


/* name: pile_up
 * function(k,m,p) */
static int lcf1_pile_up (lua_State * L) {
  enum { lc_nformalargs = 3 };
  lua_settop(L,3);
  
  /* p.y = p.y-1 */
  lua_pushliteral(L,"y");
  lua_gettable(L,3);
  lua_pushnumber(L,1);
  lc_sub(L,-2,-1);
  lua_remove(L,-2);
  lua_remove(L,-2);
  lua_pushliteral(L,"y");
  lua_insert(L,-2);
  lua_settable(L,3);
  assert(lua_gettop(L) == 3);
  
  /* local un,p1,n = minetest.get_node(p),"erosion:slope_" */
  lua_getfield(L,LUA_ENVIRONINDEX,"minetest");
  lua_pushliteral(L,"get_node");
  lua_gettable(L,-2);
  lua_remove(L,-2);
  lua_pushvalue(L,3);
  lua_call(L,1,1);
  lua_pushliteral(L,"erosion:slope_");
  lua_settop(L,(lua_gettop(L) + 1));
  assert(lua_gettop(L) == 6);
  
  /* local a */
  lua_settop(L,(lua_gettop(L) + 1));
  assert(lua_gettop(L) == 7);
  
  /* if erosion_materials[eroding_lut[un.name]] then */
  enum { lc64 = 7 };
  lc_getupvalue(L,lua_upvalueindex(1),5,5);
  lc_getupvalue(L,lua_upvalueindex(1),7,3);
  lua_pushliteral(L,"name");
  lua_gettable(L,4);
  lua_gettable(L,-2);
  lua_remove(L,-2);
  lua_gettable(L,-2);
  lua_remove(L,-2);
  const int lc65 = lua_toboolean(L,-1);
  lua_pop(L,1);
  if (lc65) {
    
    /* erosionCL(p,un) */
    lua_getfield(L,LUA_ENVIRONINDEX,"erosionCL");
    lua_pushvalue(L,3);
    lua_pushvalue(L,4);
    lua_call(L,2,0);
    assert(lua_gettop(L) == 7);
    
    /* un = minetest.get_node(p) */
    lua_getfield(L,LUA_ENVIRONINDEX,"minetest");
    lua_pushliteral(L,"get_node");
    lua_gettable(L,-2);
    lua_remove(L,-2);
    lua_pushvalue(L,3);
    lua_call(L,1,1);
    lua_replace(L,4);
    assert(lua_gettop(L) == 7);
  }
  lua_settop(L,lc64);
  assert(lua_gettop(L) == 7);
  
  /* if un.name == "air" or un.name == "default:water_source" then */
  enum { lc66 = 7 };
  lua_pushliteral(L,"name");
  lua_gettable(L,4);
  lua_pushliteral(L,"air");
  const int lc67 = lua_equal(L,-2,-1);
  lua_pop(L,2);
  lua_pushboolean(L,lc67);
  if (!(lua_toboolean(L,-1))) {
    lua_pop(L,1);
    lua_pushliteral(L,"name");
    lua_gettable(L,4);
    lua_pushliteral(L,"default:water_source");
    const int lc68 = lua_equal(L,-2,-1);
    lua_pop(L,2);
    lua_pushboolean(L,lc68);
  }
  const int lc69 = lua_toboolean(L,-1);
  lua_pop(L,1);
  if (lc69) {
  }
  else {
    
    /* elseif eroded_lut[un.name] then */
    enum { lc70 = 7 };
    lc_getupvalue(L,lua_upvalueindex(1),7,2);
    lua_pushliteral(L,"name");
    lua_gettable(L,4);
    lua_gettable(L,-2);
    lua_remove(L,-2);
    const int lc71 = lua_toboolean(L,-1);
    lua_pop(L,1);
    if (lc71) {
      
      /* orient_pile(k,m+slopes[eroded_lut[un.name][2]],p) */
      lc_getupvalue(L,lua_upvalueindex(1),1,11);
      lua_pushvalue(L,1);
      lc_getupvalue(L,lua_upvalueindex(1),4,6);
      lc_getupvalue(L,lua_upvalueindex(1),7,2);
      lua_pushliteral(L,"name");
      lua_gettable(L,4);
      lua_gettable(L,-2);
      lua_remove(L,-2);
      lua_pushnumber(L,2);
      lua_gettable(L,-2);
      lua_remove(L,-2);
      lua_gettable(L,-2);
      lua_remove(L,-2);
      lc_add(L,2,-1);
      lua_remove(L,-2);
      lua_pushvalue(L,3);
      lua_call(L,3,0);
      assert(lua_gettop(L) == 7);
      
      /* p.y = p.y+1 */
      lua_pushliteral(L,"y");
      lua_gettable(L,3);
      lua_pushnumber(L,1);
      lc_add(L,-2,-1);
      lua_remove(L,-2);
      lua_remove(L,-2);
      lua_pushliteral(L,"y");
      lua_insert(L,-2);
      lua_settable(L,3);
      assert(lua_gettop(L) == 7);
      
      /* minetest.set_node(p,{name="air"}) */
      lua_getfield(L,LUA_ENVIRONINDEX,"minetest");
      lua_pushliteral(L,"set_node");
      lua_gettable(L,-2);
      lua_remove(L,-2);
      lua_pushvalue(L,3);
      lua_createtable(L,0,1);
      lua_pushliteral(L,"name");
      lua_pushliteral(L,"air");
      lua_rawset(L,-3);
      lua_call(L,2,0);
      assert(lua_gettop(L) == 7);
    }
    else {
      
      /* else
       * p.y = p.y+1 */
      lua_pushliteral(L,"y");
      lua_gettable(L,3);
      lua_pushnumber(L,1);
      lc_add(L,-2,-1);
      lua_remove(L,-2);
      lua_remove(L,-2);
      lua_pushliteral(L,"y");
      lua_insert(L,-2);
      lua_settable(L,3);
      assert(lua_gettop(L) == 7);
      
      /* a = orient_pile(k,m,p) */
      lc_getupvalue(L,lua_upvalueindex(1),1,11);
      lua_pushvalue(L,1);
      lua_pushvalue(L,2);
      lua_pushvalue(L,3);
      lua_call(L,3,1);
      lua_replace(L,7);
      assert(lua_gettop(L) == 7);
      
      /* for i=1,#a do */
      lua_pushnumber(L,1);
      const double lc75 = lua_objlen(L,7);
      lua_pushnumber(L,lc75);
      if (!((lua_isnumber(L,-2) && lua_isnumber(L,-1)))) {
        luaL_error(L,"'for' limit must be a number");
      }
      double lc72_var = lua_tonumber(L,-2);
      const double lc73_limit = lua_tonumber(L,-1);
      const double lc74_step = 1;
      lua_pop(L,2);
      enum { lc76 = 7 };
      while ((((lc74_step > 0) && (lc72_var <= lc73_limit)) || ((lc74_step <= 0) && (lc72_var >= lc73_limit)))) {
        
        /* internal: local i at index 8 */
        lua_pushnumber(L,lc72_var);
        
        /* local nn = minetest.get_node(a[i]) */
        lua_getfield(L,LUA_ENVIRONINDEX,"minetest");
        lua_pushliteral(L,"get_node");
        lua_gettable(L,-2);
        lua_remove(L,-2);
        lua_pushvalue(L,8);
        lua_gettable(L,7);
        lua_call(L,1,1);
        assert(lua_gettop(L) == 9);
        
        /* orient_pile(eroded_lut[nn.name][1],slopes[eroded_lut[nn.name][2]],a[i]) */
        lc_getupvalue(L,lua_upvalueindex(1),1,11);
        lc_getupvalue(L,lua_upvalueindex(1),7,2);
        lua_pushliteral(L,"name");
        lua_gettable(L,9);
        lua_gettable(L,-2);
        lua_remove(L,-2);
        lua_pushnumber(L,1);
        lua_gettable(L,-2);
        lua_remove(L,-2);
        lc_getupvalue(L,lua_upvalueindex(1),4,6);
        lc_getupvalue(L,lua_upvalueindex(1),7,2);
        lua_pushliteral(L,"name");
        lua_gettable(L,9);
        lua_gettable(L,-2);
        lua_remove(L,-2);
        lua_pushnumber(L,2);
        lua_gettable(L,-2);
        lua_remove(L,-2);
        lua_gettable(L,-2);
        lua_remove(L,-2);
        lua_pushvalue(L,8);
        lua_gettable(L,7);
        lua_call(L,3,0);
        assert(lua_gettop(L) == 9);
        
        /* internal: stack cleanup on scope exit */
        lua_pop(L,2);
        lc72_var += lc74_step;
      }
      lua_settop(L,lc76);
      assert(lua_gettop(L) == 7);
    }
    lua_settop(L,lc70);
  }
  lua_settop(L,lc66);
  assert(lua_gettop(L) == 7);
  return 0;
}


/* name: slide_off
 * function(p,nd) */
static int lcf1_slide_off (lua_State * L) {
  enum { lc_nformalargs = 2 };
  lua_settop(L,2);
  
  /* if eroded_lut[nd.name] then */
  enum { lc77 = 2 };
  lc_getupvalue(L,lua_upvalueindex(1),7,2);
  lua_pushliteral(L,"name");
  lua_gettable(L,2);
  lua_gettable(L,-2);
  lua_remove(L,-2);
  const int lc78 = lua_toboolean(L,-1);
  lua_pop(L,1);
  if (lc78) {
    
    /* p.y = p.y-1 */
    lua_pushliteral(L,"y");
    lua_gettable(L,1);
    lua_pushnumber(L,1);
    lc_sub(L,-2,-1);
    lua_remove(L,-2);
    lua_remove(L,-2);
    lua_pushliteral(L,"y");
    lua_insert(L,-2);
    lua_settable(L,1);
    assert(lua_gettop(L) == 2);
    
    /* local un = minetest.get_node(p).name */
    lua_getfield(L,LUA_ENVIRONINDEX,"minetest");
    lua_pushliteral(L,"get_node");
    lua_gettable(L,-2);
    lua_remove(L,-2);
    lua_pushvalue(L,1);
    lua_call(L,1,1);
    lua_pushliteral(L,"name");
    lua_gettable(L,-2);
    lua_remove(L,-2);
    assert(lua_gettop(L) == 3);
    
    /* if eroded_lut[un] then */
    enum { lc79 = 3 };
    lc_getupvalue(L,lua_upvalueindex(1),7,2);
    lua_pushvalue(L,3);
    lua_gettable(L,-2);
    lua_remove(L,-2);
    const int lc80 = lua_toboolean(L,-1);
    lua_pop(L,1);
    if (lc80) {
      
      /* p.y = p.y+1 */
      lua_pushliteral(L,"y");
      lua_gettable(L,1);
      lua_pushnumber(L,1);
      lc_add(L,-2,-1);
      lua_remove(L,-2);
      lua_remove(L,-2);
      lua_pushliteral(L,"y");
      lua_insert(L,-2);
      lua_settable(L,1);
      assert(lua_gettop(L) == 3);
      
      /* pile_up(eroded_lut[nd.name][1],slopes[eroded_lut[nd.name][2]],p) */
      lc_getupvalue(L,lua_upvalueindex(1),0,12);
      lc_getupvalue(L,lua_upvalueindex(1),7,2);
      lua_pushliteral(L,"name");
      lua_gettable(L,2);
      lua_gettable(L,-2);
      lua_remove(L,-2);
      lua_pushnumber(L,1);
      lua_gettable(L,-2);
      lua_remove(L,-2);
      lc_getupvalue(L,lua_upvalueindex(1),4,6);
      lc_getupvalue(L,lua_upvalueindex(1),7,2);
      lua_pushliteral(L,"name");
      lua_gettable(L,2);
      lua_gettable(L,-2);
      lua_remove(L,-2);
      lua_pushnumber(L,2);
      lua_gettable(L,-2);
      lua_remove(L,-2);
      lua_gettable(L,-2);
      lua_remove(L,-2);
      lua_pushvalue(L,1);
      lua_call(L,3,0);
      assert(lua_gettop(L) == 3);
    }
    else {
      
      /* elseif string.sub(un,1,17) == "moreblocks:slope_" then */
      enum { lc81 = 3 };
      lua_getfield(L,LUA_ENVIRONINDEX,"string");
      lua_pushliteral(L,"sub");
      lua_gettable(L,-2);
      lua_remove(L,-2);
      lua_pushvalue(L,3);
      lua_pushnumber(L,1);
      lua_pushnumber(L,17);
      lua_call(L,3,1);
      lua_pushliteral(L,"moreblocks:slope_");
      const int lc82 = lua_equal(L,-2,-1);
      lua_pop(L,2);
      lua_pushboolean(L,lc82);
      const int lc83 = lua_toboolean(L,-1);
      lua_pop(L,1);
      if (lc83) {
        
        /* local o = get_adjacent_nodes(p,{"air"}) */
        lc_getupvalue(L,lua_upvalueindex(1),2,10);
        lua_pushvalue(L,1);
        lua_createtable(L,1,0);
        lua_pushliteral(L,"air");
        lua_rawseti(L,-2,1);
        lua_call(L,2,1);
        assert(lua_gettop(L) == 4);
        
        /* if o[1] then */
        enum { lc84 = 4 };
        lua_pushnumber(L,1);
        lua_gettable(L,4);
        const int lc85 = lua_toboolean(L,-1);
        lua_pop(L,1);
        if (lc85) {
          
          /* p.y = p.y+1 */
          lua_pushliteral(L,"y");
          lua_gettable(L,1);
          lua_pushnumber(L,1);
          lc_add(L,-2,-1);
          lua_remove(L,-2);
          lua_remove(L,-2);
          lua_pushliteral(L,"y");
          lua_insert(L,-2);
          lua_settable(L,1);
          assert(lua_gettop(L) == 4);
          
          /* local n = slopes[eroded_lut[nd.name][2]] */
          lc_getupvalue(L,lua_upvalueindex(1),4,6);
          lc_getupvalue(L,lua_upvalueindex(1),7,2);
          lua_pushliteral(L,"name");
          lua_gettable(L,2);
          lua_gettable(L,-2);
          lua_remove(L,-2);
          lua_pushnumber(L,2);
          lua_gettable(L,-2);
          lua_remove(L,-2);
          lua_gettable(L,-2);
          lua_remove(L,-2);
          assert(lua_gettop(L) == 5);
          
          /* for i=1,#o>n and n or #o do */
          lua_pushnumber(L,1);
          const double lc89 = lua_objlen(L,4);
          lua_pushnumber(L,lc89);
          const int lc90 = lua_lessthan(L,5,-1);
          lua_pop(L,1);
          lua_pushboolean(L,lc90);
          if (lua_toboolean(L,-1)) {
            lua_pop(L,1);
            lua_pushvalue(L,5);
          }
          if (!(lua_toboolean(L,-1))) {
            lua_pop(L,1);
            const double lc91 = lua_objlen(L,4);
            lua_pushnumber(L,lc91);
          }
          if (!((lua_isnumber(L,-2) && lua_isnumber(L,-1)))) {
            luaL_error(L,"'for' limit must be a number");
          }
          double lc86_var = lua_tonumber(L,-2);
          const double lc87_limit = lua_tonumber(L,-1);
          const double lc88_step = 1;
          lua_pop(L,2);
          enum { lc92 = 5 };
          while ((((lc88_step > 0) && (lc86_var <= lc87_limit)) || ((lc88_step <= 0) && (lc86_var >= lc87_limit)))) {
            
            /* internal: local i at index 6 */
            lua_pushnumber(L,lc86_var);
            
            /* minetest.place_node(o[1],{name="erosion:fall_"..eroding_nodes[eroded_lut[nd.name][1]][2]}) */
            lua_getfield(L,LUA_ENVIRONINDEX,"minetest");
            lua_pushliteral(L,"place_node");
            lua_gettable(L,-2);
            lua_remove(L,-2);
            lua_pushnumber(L,1);
            lua_gettable(L,4);
            lua_createtable(L,0,1);
            lua_pushliteral(L,"name");
            lua_pushliteral(L,"erosion:fall_");
            lc_getupvalue(L,lua_upvalueindex(1),7,1);
            lc_getupvalue(L,lua_upvalueindex(1),7,2);
            lua_pushliteral(L,"name");
            lua_gettable(L,2);
            lua_gettable(L,-2);
            lua_remove(L,-2);
            lua_pushnumber(L,1);
            lua_gettable(L,-2);
            lua_remove(L,-2);
            lua_gettable(L,-2);
            lua_remove(L,-2);
            lua_pushnumber(L,2);
            lua_gettable(L,-2);
            lua_remove(L,-2);
            lua_concat(L,2);
            lua_rawset(L,-3);
            lua_call(L,2,0);
            assert(lua_gettop(L) == 6);
            
            /* internal: stack cleanup on scope exit */
            lua_pop(L,1);
            lc86_var += lc88_step;
          }
          lua_settop(L,lc92);
          assert(lua_gettop(L) == 5);
          
          /* minetest.set_node(p,{name="air"}) */
          lua_getfield(L,LUA_ENVIRONINDEX,"minetest");
          lua_pushliteral(L,"set_node");
          lua_gettable(L,-2);
          lua_remove(L,-2);
          lua_pushvalue(L,1);
          lua_createtable(L,0,1);
          lua_pushliteral(L,"name");
          lua_pushliteral(L,"air");
          lua_rawset(L,-3);
          lua_call(L,2,0);
          assert(lua_gettop(L) == 5);
        }
        lua_settop(L,lc84);
        assert(lua_gettop(L) == 4);
      }
      lua_settop(L,lc81);
    }
    lua_settop(L,lc79);
    assert(lua_gettop(L) == 3);
  }
  lua_settop(L,lc77);
  assert(lua_gettop(L) == 2);
  return 0;
}


/* function(pos) */
static int lcf99 (lua_State * L) {
  enum { lc_nformalargs = 1 };
  lua_settop(L,1);
  
  /* pile_up(k,1,pos) */
  lc_getupvalue(L,lua_upvalueindex(1),1,12);
  lc_getupvalue(L,lua_upvalueindex(1),0,13);
  lua_pushnumber(L,1);
  lua_pushvalue(L,1);
  lua_call(L,3,0);
  assert(lua_gettop(L) == 1);
  return 0;
}


/* function(pos) */
static int lcf109 (lua_State * L) {
  enum { lc_nformalargs = 1 };
  lua_settop(L,1);
  
  /* pile_up(k,d,pos) */
  lc_getupvalue(L,lua_upvalueindex(1),2,12);
  lc_getupvalue(L,lua_upvalueindex(1),1,13);
  lc_getupvalue(L,lua_upvalueindex(1),0,14);
  lua_pushvalue(L,1);
  lua_call(L,3,0);
  assert(lua_gettop(L) == 1);
  return 0;
}


/* __div metamethod handler.
 * warning: assumes indices in range LUA_REGISTRYINDEX < x < 0 are relative. */
static void lc_div(lua_State * L, int idxa, int idxb) {
  if (lua_isnumber(L,idxa) && lua_isnumber(L,idxb)) {
    lua_pushnumber(L,lua_tonumber(L,idxa) / lua_tonumber(L,idxb));
  }
  else {
    if (luaL_getmetafield(L,idxa,"__div")||luaL_getmetafield(L,idxb,"__div")) {
      lua_pushvalue(L,idxa < 0 && idxa > LUA_REGISTRYINDEX ? idxa-1 : idxa);
      lua_pushvalue(L,idxb < 0 && idxb > LUA_REGISTRYINDEX ? idxb-2 : idxb);
      lua_call(L,2,1);
    }
    else {
      luaL_error(L, "attempt to perform arithmetic");
    }
  }
}


/* name: erosionCL
 * function(p,node) */
static int lcf1_erosionCL (lua_State * L) {
  enum { lc_nformalargs = 2 };
  lua_settop(L,2);
  
  /* if not eroding_lut[node.name] then */
  enum { lc110 = 2 };
  lc_getupvalue(L,lua_upvalueindex(1),7,3);
  lua_pushliteral(L,"name");
  lua_gettable(L,2);
  lua_gettable(L,-2);
  lua_remove(L,-2);
  lua_pushboolean(L,!(lua_toboolean(L,-1)));
  lua_remove(L,-2);
  const int lc111 = lua_toboolean(L,-1);
  lua_pop(L,1);
  if (lc111) {
    
    /* return */
    return 0;
    assert(lua_gettop(L) == 2);
  }
  lua_settop(L,lc110);
  assert(lua_gettop(L) == 2);
  
  /* local rmnn,flmt = eroding_nodes[eroding_lut[node.name]][1].."slope_"..eroding_lut[node.name],
   * 		"erosion:fall_"..eroding_nodes[eroding_lut[node.name]][2] */
  lc_getupvalue(L,lua_upvalueindex(1),7,1);
  lc_getupvalue(L,lua_upvalueindex(1),7,3);
  lua_pushliteral(L,"name");
  lua_gettable(L,2);
  lua_gettable(L,-2);
  lua_remove(L,-2);
  lua_gettable(L,-2);
  lua_remove(L,-2);
  lua_pushnumber(L,1);
  lua_gettable(L,-2);
  lua_remove(L,-2);
  lua_pushliteral(L,"slope_");
  lc_getupvalue(L,lua_upvalueindex(1),7,3);
  lua_pushliteral(L,"name");
  lua_gettable(L,2);
  lua_gettable(L,-2);
  lua_remove(L,-2);
  lua_concat(L,2);
  lua_concat(L,2);
  lua_pushliteral(L,"erosion:fall_");
  lc_getupvalue(L,lua_upvalueindex(1),7,1);
  lc_getupvalue(L,lua_upvalueindex(1),7,3);
  lua_pushliteral(L,"name");
  lua_gettable(L,2);
  lua_gettable(L,-2);
  lua_remove(L,-2);
  lua_gettable(L,-2);
  lua_remove(L,-2);
  lua_pushnumber(L,2);
  lua_gettable(L,-2);
  lua_remove(L,-2);
  lua_concat(L,2);
  assert(lua_gettop(L) == 4);
  
  /* local xpsr,nvtbl = get_adjacent_nodes(p,{"air"}) */
  lc_getupvalue(L,lua_upvalueindex(1),2,10);
  lua_pushvalue(L,1);
  lua_createtable(L,1,0);
  lua_pushliteral(L,"air");
  lua_rawseti(L,-2,1);
  lua_call(L,2,2);
  assert(lua_gettop(L) == 6);
  
  /* if xpsr[1] then */
  enum { lc112 = 6 };
  lua_pushnumber(L,1);
  lua_gettable(L,5);
  const int lc113 = lua_toboolean(L,-1);
  lua_pop(L,1);
  if (lc113) {
    
    /* local xr,zr = 0,0 */
    lua_pushnumber(L,0);
    lua_pushnumber(L,0);
    assert(lua_gettop(L) == 8);
    
    /* if nvtbl[p.x] and nvtbl[p.x][p.z-1] then */
    enum { lc114 = 8 };
    lua_pushliteral(L,"x");
    lua_gettable(L,1);
    lua_gettable(L,6);
    if (lua_toboolean(L,-1)) {
      lua_pop(L,1);
      lua_pushliteral(L,"x");
      lua_gettable(L,1);
      lua_gettable(L,6);
      lua_pushliteral(L,"z");
      lua_gettable(L,1);
      lua_pushnumber(L,1);
      lc_sub(L,-2,-1);
      lua_remove(L,-2);
      lua_remove(L,-2);
      lua_gettable(L,-2);
      lua_remove(L,-2);
    }
    const int lc115 = lua_toboolean(L,-1);
    lua_pop(L,1);
    if (lc115) {
      
      /* xr = 5 */
      lua_pushnumber(L,5);
      lua_replace(L,7);
      assert(lua_gettop(L) == 8);
      
      /* minetest.place_node({x=p.x,y=p.y,z=p.z-1},{name=flmt}) */
      lua_getfield(L,LUA_ENVIRONINDEX,"minetest");
      lua_pushliteral(L,"place_node");
      lua_gettable(L,-2);
      lua_remove(L,-2);
      lua_createtable(L,0,3);
      lua_pushliteral(L,"x");
      lua_pushliteral(L,"x");
      lua_gettable(L,1);
      lua_rawset(L,-3);
      lua_pushliteral(L,"y");
      lua_pushliteral(L,"y");
      lua_gettable(L,1);
      lua_rawset(L,-3);
      lua_pushliteral(L,"z");
      lua_pushliteral(L,"z");
      lua_gettable(L,1);
      lua_pushnumber(L,1);
      lc_sub(L,-2,-1);
      lua_remove(L,-2);
      lua_remove(L,-2);
      lua_rawset(L,-3);
      lua_createtable(L,0,1);
      lua_pushliteral(L,"name");
      lua_pushvalue(L,4);
      lua_rawset(L,-3);
      lua_call(L,2,0);
      assert(lua_gettop(L) == 8);
    }
    else {
      
      /* elseif nvtbl[p.x] and nvtbl[p.x][p.z+1] then */
      enum { lc116 = 8 };
      lua_pushliteral(L,"x");
      lua_gettable(L,1);
      lua_gettable(L,6);
      if (lua_toboolean(L,-1)) {
        lua_pop(L,1);
        lua_pushliteral(L,"x");
        lua_gettable(L,1);
        lua_gettable(L,6);
        lua_pushliteral(L,"z");
        lua_gettable(L,1);
        lua_pushnumber(L,1);
        lc_add(L,-2,-1);
        lua_remove(L,-2);
        lua_remove(L,-2);
        lua_gettable(L,-2);
        lua_remove(L,-2);
      }
      const int lc117 = lua_toboolean(L,-1);
      lua_pop(L,1);
      if (lc117) {
        
        /* xr = 3 */
        lua_pushnumber(L,3);
        lua_replace(L,7);
        assert(lua_gettop(L) == 8);
        
        /* minetest.place_node({x=p.x,y=p.y,z=p.z+1},{name=flmt}) */
        lua_getfield(L,LUA_ENVIRONINDEX,"minetest");
        lua_pushliteral(L,"place_node");
        lua_gettable(L,-2);
        lua_remove(L,-2);
        lua_createtable(L,0,3);
        lua_pushliteral(L,"x");
        lua_pushliteral(L,"x");
        lua_gettable(L,1);
        lua_rawset(L,-3);
        lua_pushliteral(L,"y");
        lua_pushliteral(L,"y");
        lua_gettable(L,1);
        lua_rawset(L,-3);
        lua_pushliteral(L,"z");
        lua_pushliteral(L,"z");
        lua_gettable(L,1);
        lua_pushnumber(L,1);
        lc_add(L,-2,-1);
        lua_remove(L,-2);
        lua_remove(L,-2);
        lua_rawset(L,-3);
        lua_createtable(L,0,1);
        lua_pushliteral(L,"name");
        lua_pushvalue(L,4);
        lua_rawset(L,-3);
        lua_call(L,2,0);
        assert(lua_gettop(L) == 8);
      }
      lua_settop(L,lc116);
    }
    lua_settop(L,lc114);
    assert(lua_gettop(L) == 8);
    
    /* if nvtbl[p.x-1] and nvtbl[p.x-1][p.z] then */
    enum { lc118 = 8 };
    lua_pushliteral(L,"x");
    lua_gettable(L,1);
    lua_pushnumber(L,1);
    lc_sub(L,-2,-1);
    lua_remove(L,-2);
    lua_remove(L,-2);
    lua_gettable(L,6);
    if (lua_toboolean(L,-1)) {
      lua_pop(L,1);
      lua_pushliteral(L,"x");
      lua_gettable(L,1);
      lua_pushnumber(L,1);
      lc_sub(L,-2,-1);
      lua_remove(L,-2);
      lua_remove(L,-2);
      lua_gettable(L,6);
      lua_pushliteral(L,"z");
      lua_gettable(L,1);
      lua_gettable(L,-2);
      lua_remove(L,-2);
    }
    const int lc119 = lua_toboolean(L,-1);
    lua_pop(L,1);
    if (lc119) {
      
      /* zr = 6 */
      lua_pushnumber(L,6);
      lua_replace(L,8);
      assert(lua_gettop(L) == 8);
      
      /* minetest.place_node({x=p.x-1,y=p.y,z=p.z},{name=flmt}) */
      lua_getfield(L,LUA_ENVIRONINDEX,"minetest");
      lua_pushliteral(L,"place_node");
      lua_gettable(L,-2);
      lua_remove(L,-2);
      lua_createtable(L,0,3);
      lua_pushliteral(L,"x");
      lua_pushliteral(L,"x");
      lua_gettable(L,1);
      lua_pushnumber(L,1);
      lc_sub(L,-2,-1);
      lua_remove(L,-2);
      lua_remove(L,-2);
      lua_rawset(L,-3);
      lua_pushliteral(L,"y");
      lua_pushliteral(L,"y");
      lua_gettable(L,1);
      lua_rawset(L,-3);
      lua_pushliteral(L,"z");
      lua_pushliteral(L,"z");
      lua_gettable(L,1);
      lua_rawset(L,-3);
      lua_createtable(L,0,1);
      lua_pushliteral(L,"name");
      lua_pushvalue(L,4);
      lua_rawset(L,-3);
      lua_call(L,2,0);
      assert(lua_gettop(L) == 8);
    }
    else {
      
      /* elseif nvtbl[p.x+1] and nvtbl[p.x+1][p.z] then */
      enum { lc120 = 8 };
      lua_pushliteral(L,"x");
      lua_gettable(L,1);
      lua_pushnumber(L,1);
      lc_add(L,-2,-1);
      lua_remove(L,-2);
      lua_remove(L,-2);
      lua_gettable(L,6);
      if (lua_toboolean(L,-1)) {
        lua_pop(L,1);
        lua_pushliteral(L,"x");
        lua_gettable(L,1);
        lua_pushnumber(L,1);
        lc_add(L,-2,-1);
        lua_remove(L,-2);
        lua_remove(L,-2);
        lua_gettable(L,6);
        lua_pushliteral(L,"z");
        lua_gettable(L,1);
        lua_gettable(L,-2);
        lua_remove(L,-2);
      }
      const int lc121 = lua_toboolean(L,-1);
      lua_pop(L,1);
      if (lc121) {
        
        /* zr = 4 */
        lua_pushnumber(L,4);
        lua_replace(L,8);
        assert(lua_gettop(L) == 8);
        
        /* minetest.place_node({x=p.x+1,y=p.y,z=p.z},{name=flmt}) */
        lua_getfield(L,LUA_ENVIRONINDEX,"minetest");
        lua_pushliteral(L,"place_node");
        lua_gettable(L,-2);
        lua_remove(L,-2);
        lua_createtable(L,0,3);
        lua_pushliteral(L,"x");
        lua_pushliteral(L,"x");
        lua_gettable(L,1);
        lua_pushnumber(L,1);
        lc_add(L,-2,-1);
        lua_remove(L,-2);
        lua_remove(L,-2);
        lua_rawset(L,-3);
        lua_pushliteral(L,"y");
        lua_pushliteral(L,"y");
        lua_gettable(L,1);
        lua_rawset(L,-3);
        lua_pushliteral(L,"z");
        lua_pushliteral(L,"z");
        lua_gettable(L,1);
        lua_rawset(L,-3);
        lua_createtable(L,0,1);
        lua_pushliteral(L,"name");
        lua_pushvalue(L,4);
        lua_rawset(L,-3);
        lua_call(L,2,0);
        assert(lua_gettop(L) == 8);
      }
      lua_settop(L,lc120);
    }
    lua_settop(L,lc118);
    assert(lua_gettop(L) == 8);
    
    /* if xr+zr < 1 then */
    enum { lc122 = 8 };
    lc_add(L,7,8);
    lua_pushnumber(L,1);
    const int lc123 = lua_lessthan(L,-2,-1);
    lua_pop(L,2);
    lua_pushboolean(L,lc123);
    const int lc124 = lua_toboolean(L,-1);
    lua_pop(L,1);
    if (lc124) {
      
      /* xr,zr = p.x-xpsr[1].x,p.z-xpsr[1].z+15 */
      lua_pushliteral(L,"x");
      lua_gettable(L,1);
      lua_pushnumber(L,1);
      lua_gettable(L,5);
      lua_pushliteral(L,"x");
      lua_gettable(L,-2);
      lua_remove(L,-2);
      lc_sub(L,-2,-1);
      lua_remove(L,-2);
      lua_remove(L,-2);
      lua_pushliteral(L,"z");
      lua_gettable(L,1);
      lua_pushnumber(L,1);
      lua_gettable(L,5);
      lua_pushliteral(L,"z");
      lua_gettable(L,-2);
      lua_remove(L,-2);
      lc_sub(L,-2,-1);
      lua_remove(L,-2);
      lua_remove(L,-2);
      lua_pushnumber(L,15);
      lc_add(L,-2,-1);
      lua_remove(L,-2);
      lua_remove(L,-2);
      lua_replace(L,8);
      lua_replace(L,7);
      assert(lua_gettop(L) == 8);
      
      /* minetest.place_node(xpsr[1],{name=flmt}) */
      lua_getfield(L,LUA_ENVIRONINDEX,"minetest");
      lua_pushliteral(L,"place_node");
      lua_gettable(L,-2);
      lua_remove(L,-2);
      lua_pushnumber(L,1);
      lua_gettable(L,5);
      lua_createtable(L,0,1);
      lua_pushliteral(L,"name");
      lua_pushvalue(L,4);
      lua_rawset(L,-3);
      lua_call(L,2,0);
      assert(lua_gettop(L) == 8);
    }
    lua_settop(L,lc122);
    assert(lua_gettop(L) == 8);
    
    /* if xr+zr < 7 then */
    enum { lc125 = 8 };
    lc_add(L,7,8);
    lua_pushnumber(L,7);
    const int lc126 = lua_lessthan(L,-2,-1);
    lua_pop(L,2);
    lua_pushboolean(L,lc126);
    const int lc127 = lua_toboolean(L,-1);
    lua_pop(L,1);
    if (lc127) {
      
      /* minetest.swap_node(p,{name=rmnn.."_half_raised",param2=math.mod(xr+zr-1,4)}) */
      lua_getfield(L,LUA_ENVIRONINDEX,"minetest");
      lua_pushliteral(L,"swap_node");
      lua_gettable(L,-2);
      lua_remove(L,-2);
      lua_pushvalue(L,1);
      lua_createtable(L,0,2);
      lua_pushliteral(L,"name");
      lua_pushvalue(L,3);
      lua_pushliteral(L,"_half_raised");
      lua_concat(L,2);
      lua_rawset(L,-3);
      lua_pushliteral(L,"param2");
      lua_getfield(L,LUA_ENVIRONINDEX,"math");
      lua_pushliteral(L,"mod");
      lua_gettable(L,-2);
      lua_remove(L,-2);
      lc_add(L,7,8);
      lua_pushnumber(L,1);
      lc_sub(L,-2,-1);
      lua_remove(L,-2);
      lua_remove(L,-2);
      lua_pushnumber(L,4);
      lua_call(L,2,1);
      lua_rawset(L,-3);
      lua_call(L,2,0);
      assert(lua_gettop(L) == 8);
    }
    else {
      
      /* elseif xr+zr < 13 then */
      enum { lc128 = 8 };
      lc_add(L,7,8);
      lua_pushnumber(L,13);
      const int lc129 = lua_lessthan(L,-2,-1);
      lua_pop(L,2);
      lua_pushboolean(L,lc129);
      const int lc130 = lua_toboolean(L,-1);
      lua_pop(L,1);
      if (lc130) {
        
        /* minetest.swap_node(p,{name=rmnn.."_cut",param2=math.mod(xr>4 and zr/2-2 or 5-zr/2,4)}) */
        lua_getfield(L,LUA_ENVIRONINDEX,"minetest");
        lua_pushliteral(L,"swap_node");
        lua_gettable(L,-2);
        lua_remove(L,-2);
        lua_pushvalue(L,1);
        lua_createtable(L,0,2);
        lua_pushliteral(L,"name");
        lua_pushvalue(L,3);
        lua_pushliteral(L,"_cut");
        lua_concat(L,2);
        lua_rawset(L,-3);
        lua_pushliteral(L,"param2");
        lua_getfield(L,LUA_ENVIRONINDEX,"math");
        lua_pushliteral(L,"mod");
        lua_gettable(L,-2);
        lua_remove(L,-2);
        lua_pushnumber(L,4);
        const int lc131 = lua_lessthan(L,-1,7);
        lua_pop(L,1);
        lua_pushboolean(L,lc131);
        if (lua_toboolean(L,-1)) {
          lua_pop(L,1);
          lua_pushnumber(L,2);
          lc_div(L,8,-1);
          lua_remove(L,-2);
          lua_pushnumber(L,2);
          lc_sub(L,-2,-1);
          lua_remove(L,-2);
          lua_remove(L,-2);
        }
        if (!(lua_toboolean(L,-1))) {
          lua_pop(L,1);
          lua_pushnumber(L,5);
          lua_pushnumber(L,2);
          lc_div(L,8,-1);
          lua_remove(L,-2);
          lc_sub(L,-2,-1);
          lua_remove(L,-2);
          lua_remove(L,-2);
        }
        lua_pushnumber(L,4);
        lua_call(L,2,1);
        lua_rawset(L,-3);
        lua_call(L,2,0);
        assert(lua_gettop(L) == 8);
      }
      else {
        
        /* else
         * minetest.swap_node(p,{name=rmnn.."_inner_cut_half_raised",param2=math.mod(xr>0 and 9-zr/2 or zr/2,4)}) */
        lua_getfield(L,LUA_ENVIRONINDEX,"minetest");
        lua_pushliteral(L,"swap_node");
        lua_gettable(L,-2);
        lua_remove(L,-2);
        lua_pushvalue(L,1);
        lua_createtable(L,0,2);
        lua_pushliteral(L,"name");
        lua_pushvalue(L,3);
        lua_pushliteral(L,"_inner_cut_half_raised");
        lua_concat(L,2);
        lua_rawset(L,-3);
        lua_pushliteral(L,"param2");
        lua_getfield(L,LUA_ENVIRONINDEX,"math");
        lua_pushliteral(L,"mod");
        lua_gettable(L,-2);
        lua_remove(L,-2);
        lua_pushnumber(L,0);
        const int lc132 = lua_lessthan(L,-1,7);
        lua_pop(L,1);
        lua_pushboolean(L,lc132);
        if (lua_toboolean(L,-1)) {
          lua_pop(L,1);
          lua_pushnumber(L,9);
          lua_pushnumber(L,2);
          lc_div(L,8,-1);
          lua_remove(L,-2);
          lc_sub(L,-2,-1);
          lua_remove(L,-2);
          lua_remove(L,-2);
        }
        if (!(lua_toboolean(L,-1))) {
          lua_pop(L,1);
          lua_pushnumber(L,2);
          lc_div(L,8,-1);
          lua_remove(L,-2);
        }
        lua_pushnumber(L,4);
        lua_call(L,2,1);
        lua_rawset(L,-3);
        lua_call(L,2,0);
        assert(lua_gettop(L) == 8);
      }
      lua_settop(L,lc128);
    }
    lua_settop(L,lc125);
    assert(lua_gettop(L) == 8);
  }
  lua_settop(L,lc112);
  assert(lua_gettop(L) == 6);
  return 0;
}


/* name: place_slope
 * function(vpos,m) */
static int lcf1_place_slope (lua_State * L) {
  enum { lc_nformalargs = 2 };
  lua_settop(L,2);
  
  /* if data == nil or prm2 == nil then */
  enum { lc145 = 2 };
  lua_getfield(L,LUA_ENVIRONINDEX,"data");
  lua_pushnil(L);
  const int lc146 = lua_equal(L,-2,-1);
  lua_pop(L,2);
  lua_pushboolean(L,lc146);
  if (!(lua_toboolean(L,-1))) {
    lua_pop(L,1);
    lua_getfield(L,LUA_ENVIRONINDEX,"prm2");
    lua_pushnil(L);
    const int lc147 = lua_equal(L,-2,-1);
    lua_pop(L,2);
    lua_pushboolean(L,lc147);
  }
  const int lc148 = lua_toboolean(L,-1);
  lua_pop(L,1);
  if (lc148) {
    
    /* return */
    return 0;
    assert(lua_gettop(L) == 2);
  }
  lua_settop(L,lc145);
  assert(lua_gettop(L) == 2);
  
  /* box.w = data[vpos+cube3[-1][0][0]] == dpstn[m] */
  lua_getfield(L,LUA_ENVIRONINDEX,"data");
  lc_getupvalue(L,lua_upvalueindex(1),1,16);
  lua_pushnumber(L,-1);
  lua_gettable(L,-2);
  lua_remove(L,-2);
  lua_pushnumber(L,0);
  lua_gettable(L,-2);
  lua_remove(L,-2);
  lua_pushnumber(L,0);
  lua_gettable(L,-2);
  lua_remove(L,-2);
  lc_add(L,1,-1);
  lua_remove(L,-2);
  lua_gettable(L,-2);
  lua_remove(L,-2);
  lc_getupvalue(L,lua_upvalueindex(1),1,17);
  lua_pushvalue(L,2);
  lua_gettable(L,-2);
  lua_remove(L,-2);
  const int lc149 = lua_equal(L,-2,-1);
  lua_pop(L,2);
  lua_pushboolean(L,lc149);
  lc_getupvalue(L,lua_upvalueindex(1),1,15);
  lua_insert(L,-2);
  lua_pushliteral(L,"w");
  lua_insert(L,-2);
  lua_settable(L,-3);
  lua_pop(L,1);
  assert(lua_gettop(L) == 2);
  
  /* box.e = data[vpos+cube3[1][0][0]] == dpstn[m] */
  lua_getfield(L,LUA_ENVIRONINDEX,"data");
  lc_getupvalue(L,lua_upvalueindex(1),1,16);
  lua_pushnumber(L,1);
  lua_gettable(L,-2);
  lua_remove(L,-2);
  lua_pushnumber(L,0);
  lua_gettable(L,-2);
  lua_remove(L,-2);
  lua_pushnumber(L,0);
  lua_gettable(L,-2);
  lua_remove(L,-2);
  lc_add(L,1,-1);
  lua_remove(L,-2);
  lua_gettable(L,-2);
  lua_remove(L,-2);
  lc_getupvalue(L,lua_upvalueindex(1),1,17);
  lua_pushvalue(L,2);
  lua_gettable(L,-2);
  lua_remove(L,-2);
  const int lc150 = lua_equal(L,-2,-1);
  lua_pop(L,2);
  lua_pushboolean(L,lc150);
  lc_getupvalue(L,lua_upvalueindex(1),1,15);
  lua_insert(L,-2);
  lua_pushliteral(L,"e");
  lua_insert(L,-2);
  lua_settable(L,-3);
  lua_pop(L,1);
  assert(lua_gettop(L) == 2);
  
  /* box.d = data[vpos+cube3[0][-1][0]] == dpstn[m] */
  lua_getfield(L,LUA_ENVIRONINDEX,"data");
  lc_getupvalue(L,lua_upvalueindex(1),1,16);
  lua_pushnumber(L,0);
  lua_gettable(L,-2);
  lua_remove(L,-2);
  lua_pushnumber(L,-1);
  lua_gettable(L,-2);
  lua_remove(L,-2);
  lua_pushnumber(L,0);
  lua_gettable(L,-2);
  lua_remove(L,-2);
  lc_add(L,1,-1);
  lua_remove(L,-2);
  lua_gettable(L,-2);
  lua_remove(L,-2);
  lc_getupvalue(L,lua_upvalueindex(1),1,17);
  lua_pushvalue(L,2);
  lua_gettable(L,-2);
  lua_remove(L,-2);
  const int lc151 = lua_equal(L,-2,-1);
  lua_pop(L,2);
  lua_pushboolean(L,lc151);
  lc_getupvalue(L,lua_upvalueindex(1),1,15);
  lua_insert(L,-2);
  lua_pushliteral(L,"d");
  lua_insert(L,-2);
  lua_settable(L,-3);
  lua_pop(L,1);
  assert(lua_gettop(L) == 2);
  
  /* box.u = data[vpos+cube3[0][1][0]] == dpstn[m] */
  lua_getfield(L,LUA_ENVIRONINDEX,"data");
  lc_getupvalue(L,lua_upvalueindex(1),1,16);
  lua_pushnumber(L,0);
  lua_gettable(L,-2);
  lua_remove(L,-2);
  lua_pushnumber(L,1);
  lua_gettable(L,-2);
  lua_remove(L,-2);
  lua_pushnumber(L,0);
  lua_gettable(L,-2);
  lua_remove(L,-2);
  lc_add(L,1,-1);
  lua_remove(L,-2);
  lua_gettable(L,-2);
  lua_remove(L,-2);
  lc_getupvalue(L,lua_upvalueindex(1),1,17);
  lua_pushvalue(L,2);
  lua_gettable(L,-2);
  lua_remove(L,-2);
  const int lc152 = lua_equal(L,-2,-1);
  lua_pop(L,2);
  lua_pushboolean(L,lc152);
  lc_getupvalue(L,lua_upvalueindex(1),1,15);
  lua_insert(L,-2);
  lua_pushliteral(L,"u");
  lua_insert(L,-2);
  lua_settable(L,-3);
  lua_pop(L,1);
  assert(lua_gettop(L) == 2);
  
  /* box.s = data[vpos+cube3[0][0][-1]] == dpstn[m] */
  lua_getfield(L,LUA_ENVIRONINDEX,"data");
  lc_getupvalue(L,lua_upvalueindex(1),1,16);
  lua_pushnumber(L,0);
  lua_gettable(L,-2);
  lua_remove(L,-2);
  lua_pushnumber(L,0);
  lua_gettable(L,-2);
  lua_remove(L,-2);
  lua_pushnumber(L,-1);
  lua_gettable(L,-2);
  lua_remove(L,-2);
  lc_add(L,1,-1);
  lua_remove(L,-2);
  lua_gettable(L,-2);
  lua_remove(L,-2);
  lc_getupvalue(L,lua_upvalueindex(1),1,17);
  lua_pushvalue(L,2);
  lua_gettable(L,-2);
  lua_remove(L,-2);
  const int lc153 = lua_equal(L,-2,-1);
  lua_pop(L,2);
  lua_pushboolean(L,lc153);
  lc_getupvalue(L,lua_upvalueindex(1),1,15);
  lua_insert(L,-2);
  lua_pushliteral(L,"s");
  lua_insert(L,-2);
  lua_settable(L,-3);
  lua_pop(L,1);
  assert(lua_gettop(L) == 2);
  
  /* box.n = data[vpos+cube3[0][0][1]] == dpstn[m] */
  lua_getfield(L,LUA_ENVIRONINDEX,"data");
  lc_getupvalue(L,lua_upvalueindex(1),1,16);
  lua_pushnumber(L,0);
  lua_gettable(L,-2);
  lua_remove(L,-2);
  lua_pushnumber(L,0);
  lua_gettable(L,-2);
  lua_remove(L,-2);
  lua_pushnumber(L,1);
  lua_gettable(L,-2);
  lua_remove(L,-2);
  lc_add(L,1,-1);
  lua_remove(L,-2);
  lua_gettable(L,-2);
  lua_remove(L,-2);
  lc_getupvalue(L,lua_upvalueindex(1),1,17);
  lua_pushvalue(L,2);
  lua_gettable(L,-2);
  lua_remove(L,-2);
  const int lc154 = lua_equal(L,-2,-1);
  lua_pop(L,2);
  lua_pushboolean(L,lc154);
  lc_getupvalue(L,lua_upvalueindex(1),1,15);
  lua_insert(L,-2);
  lua_pushliteral(L,"n");
  lua_insert(L,-2);
  lua_settable(L,-3);
  lua_pop(L,1);
  assert(lua_gettop(L) == 2);
  
  /* if box.w or	box.e or box.d or box.u or box.s or box.n then */
  enum { lc155 = 2 };
  lc_getupvalue(L,lua_upvalueindex(1),1,15);
  lua_pushliteral(L,"w");
  lua_gettable(L,-2);
  lua_remove(L,-2);
  if (!(lua_toboolean(L,-1))) {
    lua_pop(L,1);
    lc_getupvalue(L,lua_upvalueindex(1),1,15);
    lua_pushliteral(L,"e");
    lua_gettable(L,-2);
    lua_remove(L,-2);
  }
  if (!(lua_toboolean(L,-1))) {
    lua_pop(L,1);
    lc_getupvalue(L,lua_upvalueindex(1),1,15);
    lua_pushliteral(L,"d");
    lua_gettable(L,-2);
    lua_remove(L,-2);
  }
  if (!(lua_toboolean(L,-1))) {
    lua_pop(L,1);
    lc_getupvalue(L,lua_upvalueindex(1),1,15);
    lua_pushliteral(L,"u");
    lua_gettable(L,-2);
    lua_remove(L,-2);
  }
  if (!(lua_toboolean(L,-1))) {
    lua_pop(L,1);
    lc_getupvalue(L,lua_upvalueindex(1),1,15);
    lua_pushliteral(L,"s");
    lua_gettable(L,-2);
    lua_remove(L,-2);
  }
  if (!(lua_toboolean(L,-1))) {
    lua_pop(L,1);
    lc_getupvalue(L,lua_upvalueindex(1),1,15);
    lua_pushliteral(L,"n");
    lua_gettable(L,-2);
    lua_remove(L,-2);
  }
  const int lc156 = lua_toboolean(L,-1);
  lua_pop(L,1);
  if (lc156) {
    
    /* box.t = (box.w and 1 or 0)+(box.e and 1 or 0)+(box.d and 1 or 0)+(box.u and 1 or 0)+(box.s and 1 or 0)+(box.n and 1 or 0) */
    lc_getupvalue(L,lua_upvalueindex(1),1,15);
    lua_pushliteral(L,"w");
    lua_gettable(L,-2);
    lua_remove(L,-2);
    if (lua_toboolean(L,-1)) {
      lua_pop(L,1);
      lua_pushnumber(L,1);
    }
    if (!(lua_toboolean(L,-1))) {
      lua_pop(L,1);
      lua_pushnumber(L,0);
    }
    lc_getupvalue(L,lua_upvalueindex(1),1,15);
    lua_pushliteral(L,"e");
    lua_gettable(L,-2);
    lua_remove(L,-2);
    if (lua_toboolean(L,-1)) {
      lua_pop(L,1);
      lua_pushnumber(L,1);
    }
    if (!(lua_toboolean(L,-1))) {
      lua_pop(L,1);
      lua_pushnumber(L,0);
    }
    lc_add(L,-2,-1);
    lua_remove(L,-2);
    lua_remove(L,-2);
    lc_getupvalue(L,lua_upvalueindex(1),1,15);
    lua_pushliteral(L,"d");
    lua_gettable(L,-2);
    lua_remove(L,-2);
    if (lua_toboolean(L,-1)) {
      lua_pop(L,1);
      lua_pushnumber(L,1);
    }
    if (!(lua_toboolean(L,-1))) {
      lua_pop(L,1);
      lua_pushnumber(L,0);
    }
    lc_add(L,-2,-1);
    lua_remove(L,-2);
    lua_remove(L,-2);
    lc_getupvalue(L,lua_upvalueindex(1),1,15);
    lua_pushliteral(L,"u");
    lua_gettable(L,-2);
    lua_remove(L,-2);
    if (lua_toboolean(L,-1)) {
      lua_pop(L,1);
      lua_pushnumber(L,1);
    }
    if (!(lua_toboolean(L,-1))) {
      lua_pop(L,1);
      lua_pushnumber(L,0);
    }
    lc_add(L,-2,-1);
    lua_remove(L,-2);
    lua_remove(L,-2);
    lc_getupvalue(L,lua_upvalueindex(1),1,15);
    lua_pushliteral(L,"s");
    lua_gettable(L,-2);
    lua_remove(L,-2);
    if (lua_toboolean(L,-1)) {
      lua_pop(L,1);
      lua_pushnumber(L,1);
    }
    if (!(lua_toboolean(L,-1))) {
      lua_pop(L,1);
      lua_pushnumber(L,0);
    }
    lc_add(L,-2,-1);
    lua_remove(L,-2);
    lua_remove(L,-2);
    lc_getupvalue(L,lua_upvalueindex(1),1,15);
    lua_pushliteral(L,"n");
    lua_gettable(L,-2);
    lua_remove(L,-2);
    if (lua_toboolean(L,-1)) {
      lua_pop(L,1);
      lua_pushnumber(L,1);
    }
    if (!(lua_toboolean(L,-1))) {
      lua_pop(L,1);
      lua_pushnumber(L,0);
    }
    lc_add(L,-2,-1);
    lua_remove(L,-2);
    lua_remove(L,-2);
    lc_getupvalue(L,lua_upvalueindex(1),1,15);
    lua_insert(L,-2);
    lua_pushliteral(L,"t");
    lua_insert(L,-2);
    lua_settable(L,-3);
    lua_pop(L,1);
    assert(lua_gettop(L) == 2);
    
    /* if box.t == 2 then */
    enum { lc157 = 2 };
    lc_getupvalue(L,lua_upvalueindex(1),1,15);
    lua_pushliteral(L,"t");
    lua_gettable(L,-2);
    lua_remove(L,-2);
    lua_pushnumber(L,2);
    const int lc158 = lua_equal(L,-2,-1);
    lua_pop(L,2);
    lua_pushboolean(L,lc158);
    const int lc159 = lua_toboolean(L,-1);
    lua_pop(L,1);
    if (lc159) {
      
      /* box.f = box.d and box.n and 10
       * 			or box.d and box.e and 1
       * 			or box.d and box.s and 2
       * 			or box.d and box.w and 13
       * 			or box.u and box.n and 20
       * 			or box.u and box.w and 21
       * 			or box.u and box.s and 6
       * 			or box.u and box.e and 17
       * 			or box.e and box.s and 18
       * 			or box.w and box.s and 7
       * 			or box.e and box.n and 9
       * 			or box.w and box.n and 12 */
      lc_getupvalue(L,lua_upvalueindex(1),1,15);
      lua_pushliteral(L,"d");
      lua_gettable(L,-2);
      lua_remove(L,-2);
      if (lua_toboolean(L,-1)) {
        lua_pop(L,1);
        lc_getupvalue(L,lua_upvalueindex(1),1,15);
        lua_pushliteral(L,"n");
        lua_gettable(L,-2);
        lua_remove(L,-2);
      }
      if (lua_toboolean(L,-1)) {
        lua_pop(L,1);
        lua_pushnumber(L,10);
      }
      if (!(lua_toboolean(L,-1))) {
        lua_pop(L,1);
        lc_getupvalue(L,lua_upvalueindex(1),1,15);
        lua_pushliteral(L,"d");
        lua_gettable(L,-2);
        lua_remove(L,-2);
        if (lua_toboolean(L,-1)) {
          lua_pop(L,1);
          lc_getupvalue(L,lua_upvalueindex(1),1,15);
          lua_pushliteral(L,"e");
          lua_gettable(L,-2);
          lua_remove(L,-2);
        }
        if (lua_toboolean(L,-1)) {
          lua_pop(L,1);
          lua_pushnumber(L,1);
        }
      }
      if (!(lua_toboolean(L,-1))) {
        lua_pop(L,1);
        lc_getupvalue(L,lua_upvalueindex(1),1,15);
        lua_pushliteral(L,"d");
        lua_gettable(L,-2);
        lua_remove(L,-2);
        if (lua_toboolean(L,-1)) {
          lua_pop(L,1);
          lc_getupvalue(L,lua_upvalueindex(1),1,15);
          lua_pushliteral(L,"s");
          lua_gettable(L,-2);
          lua_remove(L,-2);
        }
        if (lua_toboolean(L,-1)) {
          lua_pop(L,1);
          lua_pushnumber(L,2);
        }
      }
      if (!(lua_toboolean(L,-1))) {
        lua_pop(L,1);
        lc_getupvalue(L,lua_upvalueindex(1),1,15);
        lua_pushliteral(L,"d");
        lua_gettable(L,-2);
        lua_remove(L,-2);
        if (lua_toboolean(L,-1)) {
          lua_pop(L,1);
          lc_getupvalue(L,lua_upvalueindex(1),1,15);
          lua_pushliteral(L,"w");
          lua_gettable(L,-2);
          lua_remove(L,-2);
        }
        if (lua_toboolean(L,-1)) {
          lua_pop(L,1);
          lua_pushnumber(L,13);
        }
      }
      if (!(lua_toboolean(L,-1))) {
        lua_pop(L,1);
        lc_getupvalue(L,lua_upvalueindex(1),1,15);
        lua_pushliteral(L,"u");
        lua_gettable(L,-2);
        lua_remove(L,-2);
        if (lua_toboolean(L,-1)) {
          lua_pop(L,1);
          lc_getupvalue(L,lua_upvalueindex(1),1,15);
          lua_pushliteral(L,"n");
          lua_gettable(L,-2);
          lua_remove(L,-2);
        }
        if (lua_toboolean(L,-1)) {
          lua_pop(L,1);
          lua_pushnumber(L,20);
        }
      }
      if (!(lua_toboolean(L,-1))) {
        lua_pop(L,1);
        lc_getupvalue(L,lua_upvalueindex(1),1,15);
        lua_pushliteral(L,"u");
        lua_gettable(L,-2);
        lua_remove(L,-2);
        if (lua_toboolean(L,-1)) {
          lua_pop(L,1);
          lc_getupvalue(L,lua_upvalueindex(1),1,15);
          lua_pushliteral(L,"w");
          lua_gettable(L,-2);
          lua_remove(L,-2);
        }
        if (lua_toboolean(L,-1)) {
          lua_pop(L,1);
          lua_pushnumber(L,21);
        }
      }
      if (!(lua_toboolean(L,-1))) {
        lua_pop(L,1);
        lc_getupvalue(L,lua_upvalueindex(1),1,15);
        lua_pushliteral(L,"u");
        lua_gettable(L,-2);
        lua_remove(L,-2);
        if (lua_toboolean(L,-1)) {
          lua_pop(L,1);
          lc_getupvalue(L,lua_upvalueindex(1),1,15);
          lua_pushliteral(L,"s");
          lua_gettable(L,-2);
          lua_remove(L,-2);
        }
        if (lua_toboolean(L,-1)) {
          lua_pop(L,1);
          lua_pushnumber(L,6);
        }
      }
      if (!(lua_toboolean(L,-1))) {
        lua_pop(L,1);
        lc_getupvalue(L,lua_upvalueindex(1),1,15);
        lua_pushliteral(L,"u");
        lua_gettable(L,-2);
        lua_remove(L,-2);
        if (lua_toboolean(L,-1)) {
          lua_pop(L,1);
          lc_getupvalue(L,lua_upvalueindex(1),1,15);
          lua_pushliteral(L,"e");
          lua_gettable(L,-2);
          lua_remove(L,-2);
        }
        if (lua_toboolean(L,-1)) {
          lua_pop(L,1);
          lua_pushnumber(L,17);
        }
      }
      if (!(lua_toboolean(L,-1))) {
        lua_pop(L,1);
        lc_getupvalue(L,lua_upvalueindex(1),1,15);
        lua_pushliteral(L,"e");
        lua_gettable(L,-2);
        lua_remove(L,-2);
        if (lua_toboolean(L,-1)) {
          lua_pop(L,1);
          lc_getupvalue(L,lua_upvalueindex(1),1,15);
          lua_pushliteral(L,"s");
          lua_gettable(L,-2);
          lua_remove(L,-2);
        }
        if (lua_toboolean(L,-1)) {
          lua_pop(L,1);
          lua_pushnumber(L,18);
        }
      }
      if (!(lua_toboolean(L,-1))) {
        lua_pop(L,1);
        lc_getupvalue(L,lua_upvalueindex(1),1,15);
        lua_pushliteral(L,"w");
        lua_gettable(L,-2);
        lua_remove(L,-2);
        if (lua_toboolean(L,-1)) {
          lua_pop(L,1);
          lc_getupvalue(L,lua_upvalueindex(1),1,15);
          lua_pushliteral(L,"s");
          lua_gettable(L,-2);
          lua_remove(L,-2);
        }
        if (lua_toboolean(L,-1)) {
          lua_pop(L,1);
          lua_pushnumber(L,7);
        }
      }
      if (!(lua_toboolean(L,-1))) {
        lua_pop(L,1);
        lc_getupvalue(L,lua_upvalueindex(1),1,15);
        lua_pushliteral(L,"e");
        lua_gettable(L,-2);
        lua_remove(L,-2);
        if (lua_toboolean(L,-1)) {
          lua_pop(L,1);
          lc_getupvalue(L,lua_upvalueindex(1),1,15);
          lua_pushliteral(L,"n");
          lua_gettable(L,-2);
          lua_remove(L,-2);
        }
        if (lua_toboolean(L,-1)) {
          lua_pop(L,1);
          lua_pushnumber(L,9);
        }
      }
      if (!(lua_toboolean(L,-1))) {
        lua_pop(L,1);
        lc_getupvalue(L,lua_upvalueindex(1),1,15);
        lua_pushliteral(L,"w");
        lua_gettable(L,-2);
        lua_remove(L,-2);
        if (lua_toboolean(L,-1)) {
          lua_pop(L,1);
          lc_getupvalue(L,lua_upvalueindex(1),1,15);
          lua_pushliteral(L,"n");
          lua_gettable(L,-2);
          lua_remove(L,-2);
        }
        if (lua_toboolean(L,-1)) {
          lua_pop(L,1);
          lua_pushnumber(L,12);
        }
      }
      lc_getupvalue(L,lua_upvalueindex(1),1,15);
      lua_insert(L,-2);
      lua_pushliteral(L,"f");
      lua_insert(L,-2);
      lua_settable(L,-3);
      lua_pop(L,1);
      assert(lua_gettop(L) == 2);
      
      /* if box.f then */
      enum { lc160 = 2 };
      lc_getupvalue(L,lua_upvalueindex(1),1,15);
      lua_pushliteral(L,"f");
      lua_gettable(L,-2);
      lua_remove(L,-2);
      const int lc161 = lua_toboolean(L,-1);
      lua_pop(L,1);
      if (lc161) {
        
        /* data[vpos],prm2[vpos] = dpstn["slp_"..m],box.f */
        lc_getupvalue(L,lua_upvalueindex(1),1,17);
        lua_pushliteral(L,"slp_");
        lua_pushvalue(L,2);
        lua_concat(L,2);
        lua_gettable(L,-2);
        lua_remove(L,-2);
        lc_getupvalue(L,lua_upvalueindex(1),1,15);
        lua_pushliteral(L,"f");
        lua_gettable(L,-2);
        lua_remove(L,-2);
        lua_getfield(L,LUA_ENVIRONINDEX,"prm2");
        lua_insert(L,-2);
        lua_pushvalue(L,1);
        lua_insert(L,-2);
        lua_settable(L,-3);
        lua_pop(L,1);
        lua_getfield(L,LUA_ENVIRONINDEX,"data");
        lua_insert(L,-2);
        lua_pushvalue(L,1);
        lua_insert(L,-2);
        lua_settable(L,-3);
        lua_pop(L,1);
        assert(lua_gettop(L) == 2);
        
        /* if not box.e and data[vpos+cube3[-1][0][0]] == dpstn.air
         * 				and data[vpos+cube3[-1][box.u and 1 or box.d and -1 or 0][box.n and 1 or box.s and -1 or 0]] == dpstn[m]
         * 				and math.mod(vpos,cube3[0][0][1])~=1 then */
        enum { lc162 = 2 };
        lc_getupvalue(L,lua_upvalueindex(1),1,15);
        lua_pushliteral(L,"e");
        lua_gettable(L,-2);
        lua_remove(L,-2);
        lua_pushboolean(L,!(lua_toboolean(L,-1)));
        lua_remove(L,-2);
        if (lua_toboolean(L,-1)) {
          lua_pop(L,1);
          lua_getfield(L,LUA_ENVIRONINDEX,"data");
          lc_getupvalue(L,lua_upvalueindex(1),1,16);
          lua_pushnumber(L,-1);
          lua_gettable(L,-2);
          lua_remove(L,-2);
          lua_pushnumber(L,0);
          lua_gettable(L,-2);
          lua_remove(L,-2);
          lua_pushnumber(L,0);
          lua_gettable(L,-2);
          lua_remove(L,-2);
          lc_add(L,1,-1);
          lua_remove(L,-2);
          lua_gettable(L,-2);
          lua_remove(L,-2);
          lc_getupvalue(L,lua_upvalueindex(1),1,17);
          lua_pushliteral(L,"air");
          lua_gettable(L,-2);
          lua_remove(L,-2);
          const int lc163 = lua_equal(L,-2,-1);
          lua_pop(L,2);
          lua_pushboolean(L,lc163);
        }
        if (lua_toboolean(L,-1)) {
          lua_pop(L,1);
          lua_getfield(L,LUA_ENVIRONINDEX,"data");
          lc_getupvalue(L,lua_upvalueindex(1),1,16);
          lua_pushnumber(L,-1);
          lua_gettable(L,-2);
          lua_remove(L,-2);
          lc_getupvalue(L,lua_upvalueindex(1),1,15);
          lua_pushliteral(L,"u");
          lua_gettable(L,-2);
          lua_remove(L,-2);
          if (lua_toboolean(L,-1)) {
            lua_pop(L,1);
            lua_pushnumber(L,1);
          }
          if (!(lua_toboolean(L,-1))) {
            lua_pop(L,1);
            lc_getupvalue(L,lua_upvalueindex(1),1,15);
            lua_pushliteral(L,"d");
            lua_gettable(L,-2);
            lua_remove(L,-2);
            if (lua_toboolean(L,-1)) {
              lua_pop(L,1);
              lua_pushnumber(L,-1);
            }
          }
          if (!(lua_toboolean(L,-1))) {
            lua_pop(L,1);
            lua_pushnumber(L,0);
          }
          lua_gettable(L,-2);
          lua_remove(L,-2);
          lc_getupvalue(L,lua_upvalueindex(1),1,15);
          lua_pushliteral(L,"n");
          lua_gettable(L,-2);
          lua_remove(L,-2);
          if (lua_toboolean(L,-1)) {
            lua_pop(L,1);
            lua_pushnumber(L,1);
          }
          if (!(lua_toboolean(L,-1))) {
            lua_pop(L,1);
            lc_getupvalue(L,lua_upvalueindex(1),1,15);
            lua_pushliteral(L,"s");
            lua_gettable(L,-2);
            lua_remove(L,-2);
            if (lua_toboolean(L,-1)) {
              lua_pop(L,1);
              lua_pushnumber(L,-1);
            }
          }
          if (!(lua_toboolean(L,-1))) {
            lua_pop(L,1);
            lua_pushnumber(L,0);
          }
          lua_gettable(L,-2);
          lua_remove(L,-2);
          lc_add(L,1,-1);
          lua_remove(L,-2);
          lua_gettable(L,-2);
          lua_remove(L,-2);
          lc_getupvalue(L,lua_upvalueindex(1),1,17);
          lua_pushvalue(L,2);
          lua_gettable(L,-2);
          lua_remove(L,-2);
          const int lc164 = lua_equal(L,-2,-1);
          lua_pop(L,2);
          lua_pushboolean(L,lc164);
        }
        if (lua_toboolean(L,-1)) {
          lua_pop(L,1);
          lua_getfield(L,LUA_ENVIRONINDEX,"math");
          lua_pushliteral(L,"mod");
          lua_gettable(L,-2);
          lua_remove(L,-2);
          lua_pushvalue(L,1);
          lc_getupvalue(L,lua_upvalueindex(1),1,16);
          lua_pushnumber(L,0);
          lua_gettable(L,-2);
          lua_remove(L,-2);
          lua_pushnumber(L,0);
          lua_gettable(L,-2);
          lua_remove(L,-2);
          lua_pushnumber(L,1);
          lua_gettable(L,-2);
          lua_remove(L,-2);
          lua_call(L,2,1);
          lua_pushnumber(L,1);
          const int lc165 = lua_equal(L,-2,-1);
          lua_pop(L,2);
          lua_pushboolean(L,lc165);
          lua_pushboolean(L,!(lua_toboolean(L,-1)));
          lua_remove(L,-2);
        }
        const int lc166 = lua_toboolean(L,-1);
        lua_pop(L,1);
        if (lc166) {
          
          /* data[vpos+cube3[-1][0][0]],prm2[vpos+cube3[-1][0][0]] = dpstn["slp_"..m.."_outer_cut"],box.f */
          lc_getupvalue(L,lua_upvalueindex(1),1,17);
          lua_pushliteral(L,"slp_");
          lua_pushvalue(L,2);
          lua_pushliteral(L,"_outer_cut");
          lua_concat(L,2);
          lua_concat(L,2);
          lua_gettable(L,-2);
          lua_remove(L,-2);
          lc_getupvalue(L,lua_upvalueindex(1),1,15);
          lua_pushliteral(L,"f");
          lua_gettable(L,-2);
          lua_remove(L,-2);
          lua_getfield(L,LUA_ENVIRONINDEX,"prm2");
          lua_insert(L,-2);
          lc_getupvalue(L,lua_upvalueindex(1),1,16);
          lua_pushnumber(L,-1);
          lua_gettable(L,-2);
          lua_remove(L,-2);
          lua_pushnumber(L,0);
          lua_gettable(L,-2);
          lua_remove(L,-2);
          lua_pushnumber(L,0);
          lua_gettable(L,-2);
          lua_remove(L,-2);
          lc_add(L,1,-1);
          lua_remove(L,-2);
          lua_insert(L,-2);
          lua_settable(L,-3);
          lua_pop(L,1);
          lua_getfield(L,LUA_ENVIRONINDEX,"data");
          lua_insert(L,-2);
          lc_getupvalue(L,lua_upvalueindex(1),1,16);
          lua_pushnumber(L,-1);
          lua_gettable(L,-2);
          lua_remove(L,-2);
          lua_pushnumber(L,0);
          lua_gettable(L,-2);
          lua_remove(L,-2);
          lua_pushnumber(L,0);
          lua_gettable(L,-2);
          lua_remove(L,-2);
          lc_add(L,1,-1);
          lua_remove(L,-2);
          lua_insert(L,-2);
          lua_settable(L,-3);
          lua_pop(L,1);
          assert(lua_gettop(L) == 2);
        }
        lua_settop(L,lc162);
        assert(lua_gettop(L) == 2);
        
        /* if not box.u and data[vpos+cube3[0][-1][0]] == dpstn.air
         * 				and data[vpos+cube3[box.e and 1 or box.w and -1 or 0][-1][box.n and 1 or box.s and -1 or 0]] == dpstn[m]
         * 				and vpos>cube3[0][1][0] then */
        enum { lc167 = 2 };
        lc_getupvalue(L,lua_upvalueindex(1),1,15);
        lua_pushliteral(L,"u");
        lua_gettable(L,-2);
        lua_remove(L,-2);
        lua_pushboolean(L,!(lua_toboolean(L,-1)));
        lua_remove(L,-2);
        if (lua_toboolean(L,-1)) {
          lua_pop(L,1);
          lua_getfield(L,LUA_ENVIRONINDEX,"data");
          lc_getupvalue(L,lua_upvalueindex(1),1,16);
          lua_pushnumber(L,0);
          lua_gettable(L,-2);
          lua_remove(L,-2);
          lua_pushnumber(L,-1);
          lua_gettable(L,-2);
          lua_remove(L,-2);
          lua_pushnumber(L,0);
          lua_gettable(L,-2);
          lua_remove(L,-2);
          lc_add(L,1,-1);
          lua_remove(L,-2);
          lua_gettable(L,-2);
          lua_remove(L,-2);
          lc_getupvalue(L,lua_upvalueindex(1),1,17);
          lua_pushliteral(L,"air");
          lua_gettable(L,-2);
          lua_remove(L,-2);
          const int lc168 = lua_equal(L,-2,-1);
          lua_pop(L,2);
          lua_pushboolean(L,lc168);
        }
        if (lua_toboolean(L,-1)) {
          lua_pop(L,1);
          lua_getfield(L,LUA_ENVIRONINDEX,"data");
          lc_getupvalue(L,lua_upvalueindex(1),1,16);
          lc_getupvalue(L,lua_upvalueindex(1),1,15);
          lua_pushliteral(L,"e");
          lua_gettable(L,-2);
          lua_remove(L,-2);
          if (lua_toboolean(L,-1)) {
            lua_pop(L,1);
            lua_pushnumber(L,1);
          }
          if (!(lua_toboolean(L,-1))) {
            lua_pop(L,1);
            lc_getupvalue(L,lua_upvalueindex(1),1,15);
            lua_pushliteral(L,"w");
            lua_gettable(L,-2);
            lua_remove(L,-2);
            if (lua_toboolean(L,-1)) {
              lua_pop(L,1);
              lua_pushnumber(L,-1);
            }
          }
          if (!(lua_toboolean(L,-1))) {
            lua_pop(L,1);
            lua_pushnumber(L,0);
          }
          lua_gettable(L,-2);
          lua_remove(L,-2);
          lua_pushnumber(L,-1);
          lua_gettable(L,-2);
          lua_remove(L,-2);
          lc_getupvalue(L,lua_upvalueindex(1),1,15);
          lua_pushliteral(L,"n");
          lua_gettable(L,-2);
          lua_remove(L,-2);
          if (lua_toboolean(L,-1)) {
            lua_pop(L,1);
            lua_pushnumber(L,1);
          }
          if (!(lua_toboolean(L,-1))) {
            lua_pop(L,1);
            lc_getupvalue(L,lua_upvalueindex(1),1,15);
            lua_pushliteral(L,"s");
            lua_gettable(L,-2);
            lua_remove(L,-2);
            if (lua_toboolean(L,-1)) {
              lua_pop(L,1);
              lua_pushnumber(L,-1);
            }
          }
          if (!(lua_toboolean(L,-1))) {
            lua_pop(L,1);
            lua_pushnumber(L,0);
          }
          lua_gettable(L,-2);
          lua_remove(L,-2);
          lc_add(L,1,-1);
          lua_remove(L,-2);
          lua_gettable(L,-2);
          lua_remove(L,-2);
          lc_getupvalue(L,lua_upvalueindex(1),1,17);
          lua_pushvalue(L,2);
          lua_gettable(L,-2);
          lua_remove(L,-2);
          const int lc169 = lua_equal(L,-2,-1);
          lua_pop(L,2);
          lua_pushboolean(L,lc169);
        }
        if (lua_toboolean(L,-1)) {
          lua_pop(L,1);
          lc_getupvalue(L,lua_upvalueindex(1),1,16);
          lua_pushnumber(L,0);
          lua_gettable(L,-2);
          lua_remove(L,-2);
          lua_pushnumber(L,1);
          lua_gettable(L,-2);
          lua_remove(L,-2);
          lua_pushnumber(L,0);
          lua_gettable(L,-2);
          lua_remove(L,-2);
          const int lc170 = lua_lessthan(L,-1,1);
          lua_pop(L,1);
          lua_pushboolean(L,lc170);
        }
        const int lc171 = lua_toboolean(L,-1);
        lua_pop(L,1);
        if (lc171) {
          
          /* data[vpos+cube3[0][-1][0]],prm2[vpos+cube3[0][-1][0]] = dpstn["slp_"..m.."_outer_cut"],box.f */
          lc_getupvalue(L,lua_upvalueindex(1),1,17);
          lua_pushliteral(L,"slp_");
          lua_pushvalue(L,2);
          lua_pushliteral(L,"_outer_cut");
          lua_concat(L,2);
          lua_concat(L,2);
          lua_gettable(L,-2);
          lua_remove(L,-2);
          lc_getupvalue(L,lua_upvalueindex(1),1,15);
          lua_pushliteral(L,"f");
          lua_gettable(L,-2);
          lua_remove(L,-2);
          lua_getfield(L,LUA_ENVIRONINDEX,"prm2");
          lua_insert(L,-2);
          lc_getupvalue(L,lua_upvalueindex(1),1,16);
          lua_pushnumber(L,0);
          lua_gettable(L,-2);
          lua_remove(L,-2);
          lua_pushnumber(L,-1);
          lua_gettable(L,-2);
          lua_remove(L,-2);
          lua_pushnumber(L,0);
          lua_gettable(L,-2);
          lua_remove(L,-2);
          lc_add(L,1,-1);
          lua_remove(L,-2);
          lua_insert(L,-2);
          lua_settable(L,-3);
          lua_pop(L,1);
          lua_getfield(L,LUA_ENVIRONINDEX,"data");
          lua_insert(L,-2);
          lc_getupvalue(L,lua_upvalueindex(1),1,16);
          lua_pushnumber(L,0);
          lua_gettable(L,-2);
          lua_remove(L,-2);
          lua_pushnumber(L,-1);
          lua_gettable(L,-2);
          lua_remove(L,-2);
          lua_pushnumber(L,0);
          lua_gettable(L,-2);
          lua_remove(L,-2);
          lc_add(L,1,-1);
          lua_remove(L,-2);
          lua_insert(L,-2);
          lua_settable(L,-3);
          lua_pop(L,1);
          assert(lua_gettop(L) == 2);
        }
        lua_settop(L,lc167);
        assert(lua_gettop(L) == 2);
        
        /* if not box.n and data[vpos+cube3[0][0][-1]] == dpstn.air
         * 				and data[vpos+cube3[box.e and 1 or box.w and -1 or 0][box.u and 1 or box.d and -1 or 0][-1]] == dpstn[m]
         * 				and math.mod(vpos,cube3[0][1][0])~=cube3[0][0][1] then */
        enum { lc172 = 2 };
        lc_getupvalue(L,lua_upvalueindex(1),1,15);
        lua_pushliteral(L,"n");
        lua_gettable(L,-2);
        lua_remove(L,-2);
        lua_pushboolean(L,!(lua_toboolean(L,-1)));
        lua_remove(L,-2);
        if (lua_toboolean(L,-1)) {
          lua_pop(L,1);
          lua_getfield(L,LUA_ENVIRONINDEX,"data");
          lc_getupvalue(L,lua_upvalueindex(1),1,16);
          lua_pushnumber(L,0);
          lua_gettable(L,-2);
          lua_remove(L,-2);
          lua_pushnumber(L,0);
          lua_gettable(L,-2);
          lua_remove(L,-2);
          lua_pushnumber(L,-1);
          lua_gettable(L,-2);
          lua_remove(L,-2);
          lc_add(L,1,-1);
          lua_remove(L,-2);
          lua_gettable(L,-2);
          lua_remove(L,-2);
          lc_getupvalue(L,lua_upvalueindex(1),1,17);
          lua_pushliteral(L,"air");
          lua_gettable(L,-2);
          lua_remove(L,-2);
          const int lc173 = lua_equal(L,-2,-1);
          lua_pop(L,2);
          lua_pushboolean(L,lc173);
        }
        if (lua_toboolean(L,-1)) {
          lua_pop(L,1);
          lua_getfield(L,LUA_ENVIRONINDEX,"data");
          lc_getupvalue(L,lua_upvalueindex(1),1,16);
          lc_getupvalue(L,lua_upvalueindex(1),1,15);
          lua_pushliteral(L,"e");
          lua_gettable(L,-2);
          lua_remove(L,-2);
          if (lua_toboolean(L,-1)) {
            lua_pop(L,1);
            lua_pushnumber(L,1);
          }
          if (!(lua_toboolean(L,-1))) {
            lua_pop(L,1);
            lc_getupvalue(L,lua_upvalueindex(1),1,15);
            lua_pushliteral(L,"w");
            lua_gettable(L,-2);
            lua_remove(L,-2);
            if (lua_toboolean(L,-1)) {
              lua_pop(L,1);
              lua_pushnumber(L,-1);
            }
          }
          if (!(lua_toboolean(L,-1))) {
            lua_pop(L,1);
            lua_pushnumber(L,0);
          }
          lua_gettable(L,-2);
          lua_remove(L,-2);
          lc_getupvalue(L,lua_upvalueindex(1),1,15);
          lua_pushliteral(L,"u");
          lua_gettable(L,-2);
          lua_remove(L,-2);
          if (lua_toboolean(L,-1)) {
            lua_pop(L,1);
            lua_pushnumber(L,1);
          }
          if (!(lua_toboolean(L,-1))) {
            lua_pop(L,1);
            lc_getupvalue(L,lua_upvalueindex(1),1,15);
            lua_pushliteral(L,"d");
            lua_gettable(L,-2);
            lua_remove(L,-2);
            if (lua_toboolean(L,-1)) {
              lua_pop(L,1);
              lua_pushnumber(L,-1);
            }
          }
          if (!(lua_toboolean(L,-1))) {
            lua_pop(L,1);
            lua_pushnumber(L,0);
          }
          lua_gettable(L,-2);
          lua_remove(L,-2);
          lua_pushnumber(L,-1);
          lua_gettable(L,-2);
          lua_remove(L,-2);
          lc_add(L,1,-1);
          lua_remove(L,-2);
          lua_gettable(L,-2);
          lua_remove(L,-2);
          lc_getupvalue(L,lua_upvalueindex(1),1,17);
          lua_pushvalue(L,2);
          lua_gettable(L,-2);
          lua_remove(L,-2);
          const int lc174 = lua_equal(L,-2,-1);
          lua_pop(L,2);
          lua_pushboolean(L,lc174);
        }
        if (lua_toboolean(L,-1)) {
          lua_pop(L,1);
          lua_getfield(L,LUA_ENVIRONINDEX,"math");
          lua_pushliteral(L,"mod");
          lua_gettable(L,-2);
          lua_remove(L,-2);
          lua_pushvalue(L,1);
          lc_getupvalue(L,lua_upvalueindex(1),1,16);
          lua_pushnumber(L,0);
          lua_gettable(L,-2);
          lua_remove(L,-2);
          lua_pushnumber(L,1);
          lua_gettable(L,-2);
          lua_remove(L,-2);
          lua_pushnumber(L,0);
          lua_gettable(L,-2);
          lua_remove(L,-2);
          lua_call(L,2,1);
          lc_getupvalue(L,lua_upvalueindex(1),1,16);
          lua_pushnumber(L,0);
          lua_gettable(L,-2);
          lua_remove(L,-2);
          lua_pushnumber(L,0);
          lua_gettable(L,-2);
          lua_remove(L,-2);
          lua_pushnumber(L,1);
          lua_gettable(L,-2);
          lua_remove(L,-2);
          const int lc175 = lua_equal(L,-2,-1);
          lua_pop(L,2);
          lua_pushboolean(L,lc175);
          lua_pushboolean(L,!(lua_toboolean(L,-1)));
          lua_remove(L,-2);
        }
        const int lc176 = lua_toboolean(L,-1);
        lua_pop(L,1);
        if (lc176) {
          
          /* data[vpos+cube3[0][0][-1]],prm2[vpos+cube3[0][0][-1]] = dpstn["slp_"..m.."_outer_cut"],box.f */
          lc_getupvalue(L,lua_upvalueindex(1),1,17);
          lua_pushliteral(L,"slp_");
          lua_pushvalue(L,2);
          lua_pushliteral(L,"_outer_cut");
          lua_concat(L,2);
          lua_concat(L,2);
          lua_gettable(L,-2);
          lua_remove(L,-2);
          lc_getupvalue(L,lua_upvalueindex(1),1,15);
          lua_pushliteral(L,"f");
          lua_gettable(L,-2);
          lua_remove(L,-2);
          lua_getfield(L,LUA_ENVIRONINDEX,"prm2");
          lua_insert(L,-2);
          lc_getupvalue(L,lua_upvalueindex(1),1,16);
          lua_pushnumber(L,0);
          lua_gettable(L,-2);
          lua_remove(L,-2);
          lua_pushnumber(L,0);
          lua_gettable(L,-2);
          lua_remove(L,-2);
          lua_pushnumber(L,-1);
          lua_gettable(L,-2);
          lua_remove(L,-2);
          lc_add(L,1,-1);
          lua_remove(L,-2);
          lua_insert(L,-2);
          lua_settable(L,-3);
          lua_pop(L,1);
          lua_getfield(L,LUA_ENVIRONINDEX,"data");
          lua_insert(L,-2);
          lc_getupvalue(L,lua_upvalueindex(1),1,16);
          lua_pushnumber(L,0);
          lua_gettable(L,-2);
          lua_remove(L,-2);
          lua_pushnumber(L,0);
          lua_gettable(L,-2);
          lua_remove(L,-2);
          lua_pushnumber(L,-1);
          lua_gettable(L,-2);
          lua_remove(L,-2);
          lc_add(L,1,-1);
          lua_remove(L,-2);
          lua_insert(L,-2);
          lua_settable(L,-3);
          lua_pop(L,1);
          assert(lua_gettop(L) == 2);
        }
        lua_settop(L,lc172);
        assert(lua_gettop(L) == 2);
      }
      lua_settop(L,lc160);
      assert(lua_gettop(L) == 2);
    }
    else {
      
      /* elseif box.t == 3 then */
      enum { lc177 = 2 };
      lc_getupvalue(L,lua_upvalueindex(1),1,15);
      lua_pushliteral(L,"t");
      lua_gettable(L,-2);
      lua_remove(L,-2);
      lua_pushnumber(L,3);
      const int lc178 = lua_equal(L,-2,-1);
      lua_pop(L,2);
      lua_pushboolean(L,lc178);
      const int lc179 = lua_toboolean(L,-1);
      lua_pop(L,1);
      if (lc179) {
        
        /* box.f = box.d and box.n and box.w and 0
         * 			or box.d and box.e and box.n and 1
         * 			or box.d and box.s and box.e and 2
         * 			or box.d and box.w and box.s and 3
         * 			or box.u and box.n and box.e and 20
         * 			or box.u and box.w and box.n and 21
         * 			or box.u and box.s and box.w and 22
         * 			or box.u and box.e and box.s and 23 */
        lc_getupvalue(L,lua_upvalueindex(1),1,15);
        lua_pushliteral(L,"d");
        lua_gettable(L,-2);
        lua_remove(L,-2);
        if (lua_toboolean(L,-1)) {
          lua_pop(L,1);
          lc_getupvalue(L,lua_upvalueindex(1),1,15);
          lua_pushliteral(L,"n");
          lua_gettable(L,-2);
          lua_remove(L,-2);
        }
        if (lua_toboolean(L,-1)) {
          lua_pop(L,1);
          lc_getupvalue(L,lua_upvalueindex(1),1,15);
          lua_pushliteral(L,"w");
          lua_gettable(L,-2);
          lua_remove(L,-2);
        }
        if (lua_toboolean(L,-1)) {
          lua_pop(L,1);
          lua_pushnumber(L,0);
        }
        if (!(lua_toboolean(L,-1))) {
          lua_pop(L,1);
          lc_getupvalue(L,lua_upvalueindex(1),1,15);
          lua_pushliteral(L,"d");
          lua_gettable(L,-2);
          lua_remove(L,-2);
          if (lua_toboolean(L,-1)) {
            lua_pop(L,1);
            lc_getupvalue(L,lua_upvalueindex(1),1,15);
            lua_pushliteral(L,"e");
            lua_gettable(L,-2);
            lua_remove(L,-2);
          }
          if (lua_toboolean(L,-1)) {
            lua_pop(L,1);
            lc_getupvalue(L,lua_upvalueindex(1),1,15);
            lua_pushliteral(L,"n");
            lua_gettable(L,-2);
            lua_remove(L,-2);
          }
          if (lua_toboolean(L,-1)) {
            lua_pop(L,1);
            lua_pushnumber(L,1);
          }
        }
        if (!(lua_toboolean(L,-1))) {
          lua_pop(L,1);
          lc_getupvalue(L,lua_upvalueindex(1),1,15);
          lua_pushliteral(L,"d");
          lua_gettable(L,-2);
          lua_remove(L,-2);
          if (lua_toboolean(L,-1)) {
            lua_pop(L,1);
            lc_getupvalue(L,lua_upvalueindex(1),1,15);
            lua_pushliteral(L,"s");
            lua_gettable(L,-2);
            lua_remove(L,-2);
          }
          if (lua_toboolean(L,-1)) {
            lua_pop(L,1);
            lc_getupvalue(L,lua_upvalueindex(1),1,15);
            lua_pushliteral(L,"e");
            lua_gettable(L,-2);
            lua_remove(L,-2);
          }
          if (lua_toboolean(L,-1)) {
            lua_pop(L,1);
            lua_pushnumber(L,2);
          }
        }
        if (!(lua_toboolean(L,-1))) {
          lua_pop(L,1);
          lc_getupvalue(L,lua_upvalueindex(1),1,15);
          lua_pushliteral(L,"d");
          lua_gettable(L,-2);
          lua_remove(L,-2);
          if (lua_toboolean(L,-1)) {
            lua_pop(L,1);
            lc_getupvalue(L,lua_upvalueindex(1),1,15);
            lua_pushliteral(L,"w");
            lua_gettable(L,-2);
            lua_remove(L,-2);
          }
          if (lua_toboolean(L,-1)) {
            lua_pop(L,1);
            lc_getupvalue(L,lua_upvalueindex(1),1,15);
            lua_pushliteral(L,"s");
            lua_gettable(L,-2);
            lua_remove(L,-2);
          }
          if (lua_toboolean(L,-1)) {
            lua_pop(L,1);
            lua_pushnumber(L,3);
          }
        }
        if (!(lua_toboolean(L,-1))) {
          lua_pop(L,1);
          lc_getupvalue(L,lua_upvalueindex(1),1,15);
          lua_pushliteral(L,"u");
          lua_gettable(L,-2);
          lua_remove(L,-2);
          if (lua_toboolean(L,-1)) {
            lua_pop(L,1);
            lc_getupvalue(L,lua_upvalueindex(1),1,15);
            lua_pushliteral(L,"n");
            lua_gettable(L,-2);
            lua_remove(L,-2);
          }
          if (lua_toboolean(L,-1)) {
            lua_pop(L,1);
            lc_getupvalue(L,lua_upvalueindex(1),1,15);
            lua_pushliteral(L,"e");
            lua_gettable(L,-2);
            lua_remove(L,-2);
          }
          if (lua_toboolean(L,-1)) {
            lua_pop(L,1);
            lua_pushnumber(L,20);
          }
        }
        if (!(lua_toboolean(L,-1))) {
          lua_pop(L,1);
          lc_getupvalue(L,lua_upvalueindex(1),1,15);
          lua_pushliteral(L,"u");
          lua_gettable(L,-2);
          lua_remove(L,-2);
          if (lua_toboolean(L,-1)) {
            lua_pop(L,1);
            lc_getupvalue(L,lua_upvalueindex(1),1,15);
            lua_pushliteral(L,"w");
            lua_gettable(L,-2);
            lua_remove(L,-2);
          }
          if (lua_toboolean(L,-1)) {
            lua_pop(L,1);
            lc_getupvalue(L,lua_upvalueindex(1),1,15);
            lua_pushliteral(L,"n");
            lua_gettable(L,-2);
            lua_remove(L,-2);
          }
          if (lua_toboolean(L,-1)) {
            lua_pop(L,1);
            lua_pushnumber(L,21);
          }
        }
        if (!(lua_toboolean(L,-1))) {
          lua_pop(L,1);
          lc_getupvalue(L,lua_upvalueindex(1),1,15);
          lua_pushliteral(L,"u");
          lua_gettable(L,-2);
          lua_remove(L,-2);
          if (lua_toboolean(L,-1)) {
            lua_pop(L,1);
            lc_getupvalue(L,lua_upvalueindex(1),1,15);
            lua_pushliteral(L,"s");
            lua_gettable(L,-2);
            lua_remove(L,-2);
          }
          if (lua_toboolean(L,-1)) {
            lua_pop(L,1);
            lc_getupvalue(L,lua_upvalueindex(1),1,15);
            lua_pushliteral(L,"w");
            lua_gettable(L,-2);
            lua_remove(L,-2);
          }
          if (lua_toboolean(L,-1)) {
            lua_pop(L,1);
            lua_pushnumber(L,22);
          }
        }
        if (!(lua_toboolean(L,-1))) {
          lua_pop(L,1);
          lc_getupvalue(L,lua_upvalueindex(1),1,15);
          lua_pushliteral(L,"u");
          lua_gettable(L,-2);
          lua_remove(L,-2);
          if (lua_toboolean(L,-1)) {
            lua_pop(L,1);
            lc_getupvalue(L,lua_upvalueindex(1),1,15);
            lua_pushliteral(L,"e");
            lua_gettable(L,-2);
            lua_remove(L,-2);
          }
          if (lua_toboolean(L,-1)) {
            lua_pop(L,1);
            lc_getupvalue(L,lua_upvalueindex(1),1,15);
            lua_pushliteral(L,"s");
            lua_gettable(L,-2);
            lua_remove(L,-2);
          }
          if (lua_toboolean(L,-1)) {
            lua_pop(L,1);
            lua_pushnumber(L,23);
          }
        }
        lc_getupvalue(L,lua_upvalueindex(1),1,15);
        lua_insert(L,-2);
        lua_pushliteral(L,"f");
        lua_insert(L,-2);
        lua_settable(L,-3);
        lua_pop(L,1);
        assert(lua_gettop(L) == 2);
        
        /* if box.f then */
        enum { lc180 = 2 };
        lc_getupvalue(L,lua_upvalueindex(1),1,15);
        lua_pushliteral(L,"f");
        lua_gettable(L,-2);
        lua_remove(L,-2);
        const int lc181 = lua_toboolean(L,-1);
        lua_pop(L,1);
        if (lc181) {
          
          /* data[vpos],prm2[vpos] = dpstn["slp_"..m.."_inner_cut"],box.f */
          lc_getupvalue(L,lua_upvalueindex(1),1,17);
          lua_pushliteral(L,"slp_");
          lua_pushvalue(L,2);
          lua_pushliteral(L,"_inner_cut");
          lua_concat(L,2);
          lua_concat(L,2);
          lua_gettable(L,-2);
          lua_remove(L,-2);
          lc_getupvalue(L,lua_upvalueindex(1),1,15);
          lua_pushliteral(L,"f");
          lua_gettable(L,-2);
          lua_remove(L,-2);
          lua_getfield(L,LUA_ENVIRONINDEX,"prm2");
          lua_insert(L,-2);
          lua_pushvalue(L,1);
          lua_insert(L,-2);
          lua_settable(L,-3);
          lua_pop(L,1);
          lua_getfield(L,LUA_ENVIRONINDEX,"data");
          lua_insert(L,-2);
          lua_pushvalue(L,1);
          lua_insert(L,-2);
          lua_settable(L,-3);
          lua_pop(L,1);
          assert(lua_gettop(L) == 2);
          
          /* if box.e and data[vpos+cube3[-1][0][0]] == dpstn.air
           * 				and data[vpos+cube3[-1][box.u and 1 or box.d and -1 or 0][box.n and 1 or box.s and -1 or 0]] == dpstn[m]
           * 				and math.mod(vpos,cube3[0][0][1])~=1 then */
          enum { lc182 = 2 };
          lc_getupvalue(L,lua_upvalueindex(1),1,15);
          lua_pushliteral(L,"e");
          lua_gettable(L,-2);
          lua_remove(L,-2);
          if (lua_toboolean(L,-1)) {
            lua_pop(L,1);
            lua_getfield(L,LUA_ENVIRONINDEX,"data");
            lc_getupvalue(L,lua_upvalueindex(1),1,16);
            lua_pushnumber(L,-1);
            lua_gettable(L,-2);
            lua_remove(L,-2);
            lua_pushnumber(L,0);
            lua_gettable(L,-2);
            lua_remove(L,-2);
            lua_pushnumber(L,0);
            lua_gettable(L,-2);
            lua_remove(L,-2);
            lc_add(L,1,-1);
            lua_remove(L,-2);
            lua_gettable(L,-2);
            lua_remove(L,-2);
            lc_getupvalue(L,lua_upvalueindex(1),1,17);
            lua_pushliteral(L,"air");
            lua_gettable(L,-2);
            lua_remove(L,-2);
            const int lc183 = lua_equal(L,-2,-1);
            lua_pop(L,2);
            lua_pushboolean(L,lc183);
          }
          if (lua_toboolean(L,-1)) {
            lua_pop(L,1);
            lua_getfield(L,LUA_ENVIRONINDEX,"data");
            lc_getupvalue(L,lua_upvalueindex(1),1,16);
            lua_pushnumber(L,-1);
            lua_gettable(L,-2);
            lua_remove(L,-2);
            lc_getupvalue(L,lua_upvalueindex(1),1,15);
            lua_pushliteral(L,"u");
            lua_gettable(L,-2);
            lua_remove(L,-2);
            if (lua_toboolean(L,-1)) {
              lua_pop(L,1);
              lua_pushnumber(L,1);
            }
            if (!(lua_toboolean(L,-1))) {
              lua_pop(L,1);
              lc_getupvalue(L,lua_upvalueindex(1),1,15);
              lua_pushliteral(L,"d");
              lua_gettable(L,-2);
              lua_remove(L,-2);
              if (lua_toboolean(L,-1)) {
                lua_pop(L,1);
                lua_pushnumber(L,-1);
              }
            }
            if (!(lua_toboolean(L,-1))) {
              lua_pop(L,1);
              lua_pushnumber(L,0);
            }
            lua_gettable(L,-2);
            lua_remove(L,-2);
            lc_getupvalue(L,lua_upvalueindex(1),1,15);
            lua_pushliteral(L,"n");
            lua_gettable(L,-2);
            lua_remove(L,-2);
            if (lua_toboolean(L,-1)) {
              lua_pop(L,1);
              lua_pushnumber(L,1);
            }
            if (!(lua_toboolean(L,-1))) {
              lua_pop(L,1);
              lc_getupvalue(L,lua_upvalueindex(1),1,15);
              lua_pushliteral(L,"s");
              lua_gettable(L,-2);
              lua_remove(L,-2);
              if (lua_toboolean(L,-1)) {
                lua_pop(L,1);
                lua_pushnumber(L,-1);
              }
            }
            if (!(lua_toboolean(L,-1))) {
              lua_pop(L,1);
              lua_pushnumber(L,0);
            }
            lua_gettable(L,-2);
            lua_remove(L,-2);
            lc_add(L,1,-1);
            lua_remove(L,-2);
            lua_gettable(L,-2);
            lua_remove(L,-2);
            lc_getupvalue(L,lua_upvalueindex(1),1,17);
            lua_pushvalue(L,2);
            lua_gettable(L,-2);
            lua_remove(L,-2);
            const int lc184 = lua_equal(L,-2,-1);
            lua_pop(L,2);
            lua_pushboolean(L,lc184);
          }
          if (lua_toboolean(L,-1)) {
            lua_pop(L,1);
            lua_getfield(L,LUA_ENVIRONINDEX,"math");
            lua_pushliteral(L,"mod");
            lua_gettable(L,-2);
            lua_remove(L,-2);
            lua_pushvalue(L,1);
            lc_getupvalue(L,lua_upvalueindex(1),1,16);
            lua_pushnumber(L,0);
            lua_gettable(L,-2);
            lua_remove(L,-2);
            lua_pushnumber(L,0);
            lua_gettable(L,-2);
            lua_remove(L,-2);
            lua_pushnumber(L,1);
            lua_gettable(L,-2);
            lua_remove(L,-2);
            lua_call(L,2,1);
            lua_pushnumber(L,1);
            const int lc185 = lua_equal(L,-2,-1);
            lua_pop(L,2);
            lua_pushboolean(L,lc185);
            lua_pushboolean(L,!(lua_toboolean(L,-1)));
            lua_remove(L,-2);
          }
          const int lc186 = lua_toboolean(L,-1);
          lua_pop(L,1);
          if (lc186) {
            
            /* data[vpos+cube3[-1][0][0]],prm2[vpos+cube3[-1][0][0]] = dpstn["slp_"..m.."_outer_cut"],box.f */
            lc_getupvalue(L,lua_upvalueindex(1),1,17);
            lua_pushliteral(L,"slp_");
            lua_pushvalue(L,2);
            lua_pushliteral(L,"_outer_cut");
            lua_concat(L,2);
            lua_concat(L,2);
            lua_gettable(L,-2);
            lua_remove(L,-2);
            lc_getupvalue(L,lua_upvalueindex(1),1,15);
            lua_pushliteral(L,"f");
            lua_gettable(L,-2);
            lua_remove(L,-2);
            lua_getfield(L,LUA_ENVIRONINDEX,"prm2");
            lua_insert(L,-2);
            lc_getupvalue(L,lua_upvalueindex(1),1,16);
            lua_pushnumber(L,-1);
            lua_gettable(L,-2);
            lua_remove(L,-2);
            lua_pushnumber(L,0);
            lua_gettable(L,-2);
            lua_remove(L,-2);
            lua_pushnumber(L,0);
            lua_gettable(L,-2);
            lua_remove(L,-2);
            lc_add(L,1,-1);
            lua_remove(L,-2);
            lua_insert(L,-2);
            lua_settable(L,-3);
            lua_pop(L,1);
            lua_getfield(L,LUA_ENVIRONINDEX,"data");
            lua_insert(L,-2);
            lc_getupvalue(L,lua_upvalueindex(1),1,16);
            lua_pushnumber(L,-1);
            lua_gettable(L,-2);
            lua_remove(L,-2);
            lua_pushnumber(L,0);
            lua_gettable(L,-2);
            lua_remove(L,-2);
            lua_pushnumber(L,0);
            lua_gettable(L,-2);
            lua_remove(L,-2);
            lc_add(L,1,-1);
            lua_remove(L,-2);
            lua_insert(L,-2);
            lua_settable(L,-3);
            lua_pop(L,1);
            assert(lua_gettop(L) == 2);
          }
          lua_settop(L,lc182);
          assert(lua_gettop(L) == 2);
          
          /* if box.u and data[vpos+cube3[0][-1][0]] == dpstn.air and vpos>cube3[0][1][0] then */
          enum { lc187 = 2 };
          lc_getupvalue(L,lua_upvalueindex(1),1,15);
          lua_pushliteral(L,"u");
          lua_gettable(L,-2);
          lua_remove(L,-2);
          if (lua_toboolean(L,-1)) {
            lua_pop(L,1);
            lua_getfield(L,LUA_ENVIRONINDEX,"data");
            lc_getupvalue(L,lua_upvalueindex(1),1,16);
            lua_pushnumber(L,0);
            lua_gettable(L,-2);
            lua_remove(L,-2);
            lua_pushnumber(L,-1);
            lua_gettable(L,-2);
            lua_remove(L,-2);
            lua_pushnumber(L,0);
            lua_gettable(L,-2);
            lua_remove(L,-2);
            lc_add(L,1,-1);
            lua_remove(L,-2);
            lua_gettable(L,-2);
            lua_remove(L,-2);
            lc_getupvalue(L,lua_upvalueindex(1),1,17);
            lua_pushliteral(L,"air");
            lua_gettable(L,-2);
            lua_remove(L,-2);
            const int lc188 = lua_equal(L,-2,-1);
            lua_pop(L,2);
            lua_pushboolean(L,lc188);
          }
          if (lua_toboolean(L,-1)) {
            lua_pop(L,1);
            lc_getupvalue(L,lua_upvalueindex(1),1,16);
            lua_pushnumber(L,0);
            lua_gettable(L,-2);
            lua_remove(L,-2);
            lua_pushnumber(L,1);
            lua_gettable(L,-2);
            lua_remove(L,-2);
            lua_pushnumber(L,0);
            lua_gettable(L,-2);
            lua_remove(L,-2);
            const int lc189 = lua_lessthan(L,-1,1);
            lua_pop(L,1);
            lua_pushboolean(L,lc189);
          }
          const int lc190 = lua_toboolean(L,-1);
          lua_pop(L,1);
          if (lc190) {
            
            /* data[vpos+cube3[0][-1][0]],prm2[vpos+cube3[0][-1][0]] = dpstn["slp_"..m.."_outer_cut"],box.f */
            lc_getupvalue(L,lua_upvalueindex(1),1,17);
            lua_pushliteral(L,"slp_");
            lua_pushvalue(L,2);
            lua_pushliteral(L,"_outer_cut");
            lua_concat(L,2);
            lua_concat(L,2);
            lua_gettable(L,-2);
            lua_remove(L,-2);
            lc_getupvalue(L,lua_upvalueindex(1),1,15);
            lua_pushliteral(L,"f");
            lua_gettable(L,-2);
            lua_remove(L,-2);
            lua_getfield(L,LUA_ENVIRONINDEX,"prm2");
            lua_insert(L,-2);
            lc_getupvalue(L,lua_upvalueindex(1),1,16);
            lua_pushnumber(L,0);
            lua_gettable(L,-2);
            lua_remove(L,-2);
            lua_pushnumber(L,-1);
            lua_gettable(L,-2);
            lua_remove(L,-2);
            lua_pushnumber(L,0);
            lua_gettable(L,-2);
            lua_remove(L,-2);
            lc_add(L,1,-1);
            lua_remove(L,-2);
            lua_insert(L,-2);
            lua_settable(L,-3);
            lua_pop(L,1);
            lua_getfield(L,LUA_ENVIRONINDEX,"data");
            lua_insert(L,-2);
            lc_getupvalue(L,lua_upvalueindex(1),1,16);
            lua_pushnumber(L,0);
            lua_gettable(L,-2);
            lua_remove(L,-2);
            lua_pushnumber(L,-1);
            lua_gettable(L,-2);
            lua_remove(L,-2);
            lua_pushnumber(L,0);
            lua_gettable(L,-2);
            lua_remove(L,-2);
            lc_add(L,1,-1);
            lua_remove(L,-2);
            lua_insert(L,-2);
            lua_settable(L,-3);
            lua_pop(L,1);
            assert(lua_gettop(L) == 2);
          }
          lua_settop(L,lc187);
          assert(lua_gettop(L) == 2);
          
          /* if box.n and data[vpos+cube3[0][0][-1]] == dpstn.air
           * 				and data[vpos+cube3[box.e and 1 or box.w and -1 or 0][box.u and 1 or box.d and -1 or 0][-1]] == dpstn[m]
           * 				and math.mod(vpos,cube3[0][1][0])~=cube3[0][0][1] then */
          enum { lc191 = 2 };
          lc_getupvalue(L,lua_upvalueindex(1),1,15);
          lua_pushliteral(L,"n");
          lua_gettable(L,-2);
          lua_remove(L,-2);
          if (lua_toboolean(L,-1)) {
            lua_pop(L,1);
            lua_getfield(L,LUA_ENVIRONINDEX,"data");
            lc_getupvalue(L,lua_upvalueindex(1),1,16);
            lua_pushnumber(L,0);
            lua_gettable(L,-2);
            lua_remove(L,-2);
            lua_pushnumber(L,0);
            lua_gettable(L,-2);
            lua_remove(L,-2);
            lua_pushnumber(L,-1);
            lua_gettable(L,-2);
            lua_remove(L,-2);
            lc_add(L,1,-1);
            lua_remove(L,-2);
            lua_gettable(L,-2);
            lua_remove(L,-2);
            lc_getupvalue(L,lua_upvalueindex(1),1,17);
            lua_pushliteral(L,"air");
            lua_gettable(L,-2);
            lua_remove(L,-2);
            const int lc192 = lua_equal(L,-2,-1);
            lua_pop(L,2);
            lua_pushboolean(L,lc192);
          }
          if (lua_toboolean(L,-1)) {
            lua_pop(L,1);
            lua_getfield(L,LUA_ENVIRONINDEX,"data");
            lc_getupvalue(L,lua_upvalueindex(1),1,16);
            lc_getupvalue(L,lua_upvalueindex(1),1,15);
            lua_pushliteral(L,"e");
            lua_gettable(L,-2);
            lua_remove(L,-2);
            if (lua_toboolean(L,-1)) {
              lua_pop(L,1);
              lua_pushnumber(L,1);
            }
            if (!(lua_toboolean(L,-1))) {
              lua_pop(L,1);
              lc_getupvalue(L,lua_upvalueindex(1),1,15);
              lua_pushliteral(L,"w");
              lua_gettable(L,-2);
              lua_remove(L,-2);
              if (lua_toboolean(L,-1)) {
                lua_pop(L,1);
                lua_pushnumber(L,-1);
              }
            }
            if (!(lua_toboolean(L,-1))) {
              lua_pop(L,1);
              lua_pushnumber(L,0);
            }
            lua_gettable(L,-2);
            lua_remove(L,-2);
            lc_getupvalue(L,lua_upvalueindex(1),1,15);
            lua_pushliteral(L,"u");
            lua_gettable(L,-2);
            lua_remove(L,-2);
            if (lua_toboolean(L,-1)) {
              lua_pop(L,1);
              lua_pushnumber(L,1);
            }
            if (!(lua_toboolean(L,-1))) {
              lua_pop(L,1);
              lc_getupvalue(L,lua_upvalueindex(1),1,15);
              lua_pushliteral(L,"d");
              lua_gettable(L,-2);
              lua_remove(L,-2);
              if (lua_toboolean(L,-1)) {
                lua_pop(L,1);
                lua_pushnumber(L,-1);
              }
            }
            if (!(lua_toboolean(L,-1))) {
              lua_pop(L,1);
              lua_pushnumber(L,0);
            }
            lua_gettable(L,-2);
            lua_remove(L,-2);
            lua_pushnumber(L,-1);
            lua_gettable(L,-2);
            lua_remove(L,-2);
            lc_add(L,1,-1);
            lua_remove(L,-2);
            lua_gettable(L,-2);
            lua_remove(L,-2);
            lc_getupvalue(L,lua_upvalueindex(1),1,17);
            lua_pushvalue(L,2);
            lua_gettable(L,-2);
            lua_remove(L,-2);
            const int lc193 = lua_equal(L,-2,-1);
            lua_pop(L,2);
            lua_pushboolean(L,lc193);
          }
          if (lua_toboolean(L,-1)) {
            lua_pop(L,1);
            lua_getfield(L,LUA_ENVIRONINDEX,"math");
            lua_pushliteral(L,"mod");
            lua_gettable(L,-2);
            lua_remove(L,-2);
            lua_pushvalue(L,1);
            lc_getupvalue(L,lua_upvalueindex(1),1,16);
            lua_pushnumber(L,0);
            lua_gettable(L,-2);
            lua_remove(L,-2);
            lua_pushnumber(L,1);
            lua_gettable(L,-2);
            lua_remove(L,-2);
            lua_pushnumber(L,0);
            lua_gettable(L,-2);
            lua_remove(L,-2);
            lua_call(L,2,1);
            lc_getupvalue(L,lua_upvalueindex(1),1,16);
            lua_pushnumber(L,0);
            lua_gettable(L,-2);
            lua_remove(L,-2);
            lua_pushnumber(L,0);
            lua_gettable(L,-2);
            lua_remove(L,-2);
            lua_pushnumber(L,1);
            lua_gettable(L,-2);
            lua_remove(L,-2);
            const int lc194 = lua_equal(L,-2,-1);
            lua_pop(L,2);
            lua_pushboolean(L,lc194);
            lua_pushboolean(L,!(lua_toboolean(L,-1)));
            lua_remove(L,-2);
          }
          const int lc195 = lua_toboolean(L,-1);
          lua_pop(L,1);
          if (lc195) {
            
            /* data[vpos+cube3[0][0][-1]],prm2[vpos+cube3[0][0][-1]] = dpstn["slp_"..m.."_outer_cut"],box.f */
            lc_getupvalue(L,lua_upvalueindex(1),1,17);
            lua_pushliteral(L,"slp_");
            lua_pushvalue(L,2);
            lua_pushliteral(L,"_outer_cut");
            lua_concat(L,2);
            lua_concat(L,2);
            lua_gettable(L,-2);
            lua_remove(L,-2);
            lc_getupvalue(L,lua_upvalueindex(1),1,15);
            lua_pushliteral(L,"f");
            lua_gettable(L,-2);
            lua_remove(L,-2);
            lua_getfield(L,LUA_ENVIRONINDEX,"prm2");
            lua_insert(L,-2);
            lc_getupvalue(L,lua_upvalueindex(1),1,16);
            lua_pushnumber(L,0);
            lua_gettable(L,-2);
            lua_remove(L,-2);
            lua_pushnumber(L,0);
            lua_gettable(L,-2);
            lua_remove(L,-2);
            lua_pushnumber(L,-1);
            lua_gettable(L,-2);
            lua_remove(L,-2);
            lc_add(L,1,-1);
            lua_remove(L,-2);
            lua_insert(L,-2);
            lua_settable(L,-3);
            lua_pop(L,1);
            lua_getfield(L,LUA_ENVIRONINDEX,"data");
            lua_insert(L,-2);
            lc_getupvalue(L,lua_upvalueindex(1),1,16);
            lua_pushnumber(L,0);
            lua_gettable(L,-2);
            lua_remove(L,-2);
            lua_pushnumber(L,0);
            lua_gettable(L,-2);
            lua_remove(L,-2);
            lua_pushnumber(L,-1);
            lua_gettable(L,-2);
            lua_remove(L,-2);
            lc_add(L,1,-1);
            lua_remove(L,-2);
            lua_insert(L,-2);
            lua_settable(L,-3);
            lua_pop(L,1);
            assert(lua_gettop(L) == 2);
          }
          lua_settop(L,lc191);
          assert(lua_gettop(L) == 2);
        }
        lua_settop(L,lc180);
        assert(lua_gettop(L) == 2);
      }
      lua_settop(L,lc177);
    }
    lua_settop(L,lc157);
    assert(lua_gettop(L) == 2);
  }
  lua_settop(L,lc155);
  assert(lua_gettop(L) == 2);
  return 0;
}


/* function(minp, maxp) */
static int lcf241 (lua_State * L) {
  lua_checkstack(L,28);
  enum { lc_nformalargs = 2 };
  lua_settop(L,2);
  
  /* minetest.log("action", "erosion:on_generated") */
  lua_getfield(L,LUA_ENVIRONINDEX,"minetest");
  lua_pushliteral(L,"log");
  lua_gettable(L,-2);
  lua_remove(L,-2);
  lua_pushliteral(L,"action");
  lua_pushliteral(L,"erosion:on_generated");
  lua_call(L,2,0);
  assert(lua_gettop(L) == 2);
  
  /* collectgarbage("collect") */
  lua_getfield(L,LUA_ENVIRONINDEX,"collectgarbage");
  lua_pushliteral(L,"collect");
  lua_call(L,1,0);
  assert(lua_gettop(L) == 2);
  
  /* if minp.y > 256 then */
  enum { lc196 = 2 };
  lua_pushnumber(L,256);
  lua_pushliteral(L,"y");
  lua_gettable(L,1);
  const int lc197 = lua_lessthan(L,-2,-1);
  lua_pop(L,2);
  lua_pushboolean(L,lc197);
  const int lc198 = lua_toboolean(L,-1);
  lua_pop(L,1);
  if (lc198) {
    
    /* return */
    return 0;
    assert(lua_gettop(L) == 2);
  }
  lua_settop(L,lc196);
  assert(lua_gettop(L) == 2);
  
  /* local vm, emin, emax = minetest.get_mapgen_object("voxelmanip") */
  lua_getfield(L,LUA_ENVIRONINDEX,"minetest");
  lua_pushliteral(L,"get_mapgen_object");
  lua_gettable(L,-2);
  lua_remove(L,-2);
  lua_pushliteral(L,"voxelmanip");
  lua_call(L,1,3);
  assert(lua_gettop(L) == 5);
  
  /* local data,prm2 = vm:get_data(),vm:get_param2_data() */
  lua_pushvalue(L,3);
  lua_pushliteral(L,"get_data");
  lua_gettable(L,-2);
  lua_insert(L,-2);
  lua_call(L,1,1);
  lua_pushvalue(L,3);
  lua_pushliteral(L,"get_param2_data");
  lua_gettable(L,-2);
  lua_insert(L,-2);
  lua_call(L,1,1);
  assert(lua_gettop(L) == 7);
  
  /* local vxa = VoxelArea:new{MinEdge=emin, MaxEdge=emax} */
  lua_getfield(L,LUA_ENVIRONINDEX,"VoxelArea");
  lua_pushliteral(L,"new");
  lua_gettable(L,-2);
  lua_insert(L,-2);
  lua_createtable(L,0,2);
  lua_pushliteral(L,"MinEdge");
  lua_pushvalue(L,4);
  lua_rawset(L,-3);
  lua_pushliteral(L,"MaxEdge");
  lua_pushvalue(L,5);
  lua_rawset(L,-3);
  lua_call(L,2,1);
  assert(lua_gettop(L) == 8);
  
  /* for x=-1,1 do */
  lua_pushnumber(L,-1);
  lua_pushnumber(L,1);
  if (!((lua_isnumber(L,-2) && lua_isnumber(L,-1)))) {
    luaL_error(L,"'for' limit must be a number");
  }
  double lc199_var = lua_tonumber(L,-2);
  const double lc200_limit = lua_tonumber(L,-1);
  const double lc201_step = 1;
  lua_pop(L,2);
  enum { lc202 = 8 };
  while ((((lc201_step > 0) && (lc199_var <= lc200_limit)) || ((lc201_step <= 0) && (lc199_var >= lc200_limit)))) {
    
    /* internal: local x at index 9 */
    lua_pushnumber(L,lc199_var);
    
    /* for y=-1,1 do */
    lua_pushnumber(L,-1);
    lua_pushnumber(L,1);
    if (!((lua_isnumber(L,-2) && lua_isnumber(L,-1)))) {
      luaL_error(L,"'for' limit must be a number");
    }
    double lc203_var = lua_tonumber(L,-2);
    const double lc204_limit = lua_tonumber(L,-1);
    const double lc205_step = 1;
    lua_pop(L,2);
    enum { lc206 = 9 };
    while ((((lc205_step > 0) && (lc203_var <= lc204_limit)) || ((lc205_step <= 0) && (lc203_var >= lc204_limit)))) {
      
      /* internal: local y at index 10 */
      lua_pushnumber(L,lc203_var);
      
      /* for z=-1,1 do */
      lua_pushnumber(L,-1);
      lua_pushnumber(L,1);
      if (!((lua_isnumber(L,-2) && lua_isnumber(L,-1)))) {
        luaL_error(L,"'for' limit must be a number");
      }
      double lc207_var = lua_tonumber(L,-2);
      const double lc208_limit = lua_tonumber(L,-1);
      const double lc209_step = 1;
      lua_pop(L,2);
      enum { lc210 = 10 };
      while ((((lc209_step > 0) && (lc207_var <= lc208_limit)) || ((lc209_step <= 0) && (lc207_var >= lc208_limit)))) {
        
        /* internal: local z at index 11 */
        lua_pushnumber(L,lc207_var);
        
        /* cube3[x][y][z]=x+y*vxa.ystride+z*vxa.zstride */
        lua_pushliteral(L,"ystride");
        lua_gettable(L,8);
        lc_mul(L,10,-1);
        lua_remove(L,-2);
        lc_add(L,9,-1);
        lua_remove(L,-2);
        lua_pushliteral(L,"zstride");
        lua_gettable(L,8);
        lc_mul(L,11,-1);
        lua_remove(L,-2);
        lc_add(L,-2,-1);
        lua_remove(L,-2);
        lua_remove(L,-2);
        lc_getupvalue(L,lua_upvalueindex(1),1,16);
        lua_pushvalue(L,9);
        lua_gettable(L,-2);
        lua_remove(L,-2);
        lua_pushvalue(L,10);
        lua_gettable(L,-2);
        lua_remove(L,-2);
        lua_insert(L,-2);
        lua_pushvalue(L,11);
        lua_insert(L,-2);
        lua_settable(L,-3);
        lua_pop(L,1);
        assert(lua_gettop(L) == 11);
        
        /* internal: stack cleanup on scope exit */
        lua_pop(L,1);
        lc207_var += lc209_step;
      }
      lua_settop(L,lc210);
      assert(lua_gettop(L) == 10);
      
      /* internal: stack cleanup on scope exit */
      lua_pop(L,1);
      lc203_var += lc205_step;
    }
    lua_settop(L,lc206);
    assert(lua_gettop(L) == 9);
    
    /* internal: stack cleanup on scope exit */
    lua_pop(L,1);
    lc199_var += lc201_step;
  }
  lua_settop(L,lc202);
  assert(lua_gettop(L) == 8);
  
  /* for vpos=vxa:index(minp.x,minp.y,minp.z),vxa:index(maxp.x,maxp.y,maxp.z) do */
  lua_pushvalue(L,8);
  lua_pushliteral(L,"index");
  lua_gettable(L,-2);
  lua_insert(L,-2);
  lua_pushliteral(L,"x");
  lua_gettable(L,1);
  lua_pushliteral(L,"y");
  lua_gettable(L,1);
  lua_pushliteral(L,"z");
  lua_gettable(L,1);
  lua_call(L,4,1);
  lua_pushvalue(L,8);
  lua_pushliteral(L,"index");
  lua_gettable(L,-2);
  lua_insert(L,-2);
  lua_pushliteral(L,"x");
  lua_gettable(L,2);
  lua_pushliteral(L,"y");
  lua_gettable(L,2);
  lua_pushliteral(L,"z");
  lua_gettable(L,2);
  lua_call(L,4,1);
  if (!((lua_isnumber(L,-2) && lua_isnumber(L,-1)))) {
    luaL_error(L,"'for' limit must be a number");
  }
  double lc211_var = lua_tonumber(L,-2);
  const double lc212_limit = lua_tonumber(L,-1);
  const double lc213_step = 1;
  lua_pop(L,2);
  enum { lc214 = 8 };
  while ((((lc213_step > 0) && (lc211_var <= lc212_limit)) || ((lc213_step <= 0) && (lc211_var >= lc212_limit)))) {
    
    /* internal: local vpos at index 9 */
    lua_pushnumber(L,lc211_var);
    
    /* if data[vpos] == dpstn.air then */
    enum { lc215 = 9 };
    lua_pushvalue(L,9);
    lua_gettable(L,6);
    lc_getupvalue(L,lua_upvalueindex(1),1,17);
    lua_pushliteral(L,"air");
    lua_gettable(L,-2);
    lua_remove(L,-2);
    const int lc216 = lua_equal(L,-2,-1);
    lua_pop(L,2);
    lua_pushboolean(L,lc216);
    const int lc217 = lua_toboolean(L,-1);
    lua_pop(L,1);
    if (lc217) {
      
      /* for i=1,#gen_nodes do */
      lua_pushnumber(L,1);
      lc_getupvalue(L,lua_upvalueindex(1),8,4);
      const double lc221 = lua_objlen(L,-1);
      lua_pop(L,1);
      lua_pushnumber(L,lc221);
      if (!((lua_isnumber(L,-2) && lua_isnumber(L,-1)))) {
        luaL_error(L,"'for' limit must be a number");
      }
      double lc218_var = lua_tonumber(L,-2);
      const double lc219_limit = lua_tonumber(L,-1);
      const double lc220_step = 1;
      lua_pop(L,2);
      enum { lc222 = 9 };
      while ((((lc220_step > 0) && (lc218_var <= lc219_limit)) || ((lc220_step <= 0) && (lc218_var >= lc219_limit)))) {
        
        /* internal: local i at index 10 */
        lua_pushnumber(L,lc218_var);
        
        /* place_slope(data,prm2,vpos,gen_nodes[i]) */
        lc_getupvalue(L,lua_upvalueindex(1),0,18);
        lua_pushvalue(L,6);
        lua_pushvalue(L,7);
        lua_pushvalue(L,9);
        lc_getupvalue(L,lua_upvalueindex(1),8,4);
        lua_pushvalue(L,10);
        lua_gettable(L,-2);
        lua_remove(L,-2);
        lua_call(L,4,0);
        assert(lua_gettop(L) == 10);
        
        /* internal: stack cleanup on scope exit */
        lua_pop(L,1);
        lc218_var += lc220_step;
      }
      lua_settop(L,lc222);
      assert(lua_gettop(L) == 9);
    }
    lua_settop(L,lc215);
    assert(lua_gettop(L) == 9);
    
    /* internal: stack cleanup on scope exit */
    lua_pop(L,1);
    lc211_var += lc213_step;
  }
  lua_settop(L,lc214);
  assert(lua_gettop(L) == 8);
  
  /* if maxp.y > 2 then */
  enum { lc223 = 8 };
  lua_pushnumber(L,2);
  lua_pushliteral(L,"y");
  lua_gettable(L,2);
  const int lc224 = lua_lessthan(L,-2,-1);
  lua_pop(L,2);
  lua_pushboolean(L,lc224);
  const int lc225 = lua_toboolean(L,-1);
  lua_pop(L,1);
  if (lc225) {
    
    /* local heightmap,hndx,vpos = minetest.get_mapgen_object("heightmap"),1 */
    lua_getfield(L,LUA_ENVIRONINDEX,"minetest");
    lua_pushliteral(L,"get_mapgen_object");
    lua_gettable(L,-2);
    lua_remove(L,-2);
    lua_pushliteral(L,"heightmap");
    lua_call(L,1,1);
    lua_pushnumber(L,1);
    lua_settop(L,(lua_gettop(L) + 1));
    assert(lua_gettop(L) == 11);
    
    /* if heightmap ~= nil then */
    enum { lc226 = 11 };
    lua_pushnil(L);
    const int lc227 = lua_equal(L,9,-1);
    lua_pop(L,1);
    lua_pushboolean(L,lc227);
    lua_pushboolean(L,!(lua_toboolean(L,-1)));
    lua_remove(L,-2);
    const int lc228 = lua_toboolean(L,-1);
    lua_pop(L,1);
    if (lc228) {
      
      /* for z=minp.z,maxp.z do */
      lua_pushliteral(L,"z");
      lua_gettable(L,1);
      lua_pushliteral(L,"z");
      lua_gettable(L,2);
      if (!((lua_isnumber(L,-2) && lua_isnumber(L,-1)))) {
        luaL_error(L,"'for' limit must be a number");
      }
      double lc229_var = lua_tonumber(L,-2);
      const double lc230_limit = lua_tonumber(L,-1);
      const double lc231_step = 1;
      lua_pop(L,2);
      enum { lc232 = 11 };
      while ((((lc231_step > 0) && (lc229_var <= lc230_limit)) || ((lc231_step <= 0) && (lc229_var >= lc230_limit)))) {
        
        /* internal: local z at index 12 */
        lua_pushnumber(L,lc229_var);
        
        /* for x=minp.x,maxp.x do */
        lua_pushliteral(L,"x");
        lua_gettable(L,1);
        lua_pushliteral(L,"x");
        lua_gettable(L,2);
        if (!((lua_isnumber(L,-2) && lua_isnumber(L,-1)))) {
          luaL_error(L,"'for' limit must be a number");
        }
        double lc233_var = lua_tonumber(L,-2);
        const double lc234_limit = lua_tonumber(L,-1);
        const double lc235_step = 1;
        lua_pop(L,2);
        enum { lc236 = 12 };
        while ((((lc235_step > 0) && (lc233_var <= lc234_limit)) || ((lc235_step <= 0) && (lc233_var >= lc234_limit)))) {
          
          /* internal: local x at index 13 */
          lua_pushnumber(L,lc233_var);
          
          /* vpos = vxa:index(x,heightmap[hndx]+1,z) */
          lua_pushvalue(L,8);
          lua_pushliteral(L,"index");
          lua_gettable(L,-2);
          lua_insert(L,-2);
          lua_pushvalue(L,13);
          lua_pushvalue(L,10);
          lua_gettable(L,9);
          lua_pushnumber(L,1);
          lc_add(L,-2,-1);
          lua_remove(L,-2);
          lua_remove(L,-2);
          lua_pushvalue(L,12);
          lua_call(L,4,1);
          lua_replace(L,11);
          assert(lua_gettop(L) == 13);
          
          /* if data[vpos] == dpstn.air then */
          enum { lc237 = 13 };
          lua_pushvalue(L,11);
          lua_gettable(L,6);
          lc_getupvalue(L,lua_upvalueindex(1),1,17);
          lua_pushliteral(L,"air");
          lua_gettable(L,-2);
          lua_remove(L,-2);
          const int lc238 = lua_equal(L,-2,-1);
          lua_pop(L,2);
          lua_pushboolean(L,lc238);
          const int lc239 = lua_toboolean(L,-1);
          lua_pop(L,1);
          if (lc239) {
            
            /* for k,_ in pairs(eroding_nodes) do
             * internal: local f, s, var = explist */
            enum { lc240 = 13 };
            lua_getfield(L,LUA_ENVIRONINDEX,"pairs");
            lc_getupvalue(L,lua_upvalueindex(1),9,1);
            lua_call(L,1,3);
            while (1) {
              
              /* internal: local var_1, ..., var_n = f(s, var)
               *           if var_1 == nil then break end
               *           var = var_1 */
              lua_pushvalue(L,-3);
              lua_pushvalue(L,-3);
              lua_pushvalue(L,-3);
              lua_call(L,2,2);
              if (lua_isnil(L,-2)) {
                break;
              }
              lua_pushvalue(L,-2);
              lua_replace(L,-4);
              
              /* internal: local k with idx 17
               * internal: local _ with idx 18 */
              
              
              /* place_slope(data,prm2,vpos,k) */
              lc_getupvalue(L,lua_upvalueindex(1),0,18);
              lua_pushvalue(L,6);
              lua_pushvalue(L,7);
              lua_pushvalue(L,11);
              lua_pushvalue(L,17);
              lua_call(L,4,0);
              assert(lua_gettop(L) == 18);
              
              /* internal: stack cleanup on scope exit */
              lua_pop(L,2);
            }
            lua_settop(L,lc240);
            assert(lua_gettop(L) == 13);
          }
          lua_settop(L,lc237);
          assert(lua_gettop(L) == 13);
          
          /* hndx = hndx+1 */
          lua_pushnumber(L,1);
          lc_add(L,10,-1);
          lua_remove(L,-2);
          lua_replace(L,10);
          assert(lua_gettop(L) == 13);
          
          /* internal: stack cleanup on scope exit */
          lua_pop(L,1);
          lc233_var += lc235_step;
        }
        lua_settop(L,lc236);
        assert(lua_gettop(L) == 12);
        
        /* internal: stack cleanup on scope exit */
        lua_pop(L,1);
        lc229_var += lc231_step;
      }
      lua_settop(L,lc232);
      assert(lua_gettop(L) == 11);
    }
    lua_settop(L,lc226);
    assert(lua_gettop(L) == 11);
  }
  lua_settop(L,lc223);
  assert(lua_gettop(L) == 8);
  
  /* vm:set_data(data) */
  lua_pushvalue(L,3);
  lua_pushliteral(L,"set_data");
  lua_gettable(L,-2);
  lua_insert(L,-2);
  lua_pushvalue(L,6);
  lua_call(L,2,0);
  assert(lua_gettop(L) == 8);
  
  /* vm:set_param2_data(prm2) */
  lua_pushvalue(L,3);
  lua_pushliteral(L,"set_param2_data");
  lua_gettable(L,-2);
  lua_insert(L,-2);
  lua_pushvalue(L,7);
  lua_call(L,2,0);
  assert(lua_gettop(L) == 8);
  
  /* vm:calc_lighting() */
  lua_pushvalue(L,3);
  lua_pushliteral(L,"calc_lighting");
  lua_gettable(L,-2);
  lua_insert(L,-2);
  lua_call(L,1,0);
  assert(lua_gettop(L) == 8);
  
  /* vm:write_to_map(data) */
  lua_pushvalue(L,3);
  lua_pushliteral(L,"write_to_map");
  lua_gettable(L,-2);
  lua_insert(L,-2);
  lua_pushvalue(L,6);
  lua_call(L,2,0);
  assert(lua_gettop(L) == 8);
  return 0;
}


/* name: wwthrngCL
 * function(p,n) */
static int lcf1_wwthrngCL (lua_State * L) {
  enum { lc_nformalargs = 2 };
  lua_settop(L,2);
  
  /* p.y = p.y+1 */
  lua_pushliteral(L,"y");
  lua_gettable(L,1);
  lua_pushnumber(L,1);
  lc_add(L,-2,-1);
  lua_remove(L,-2);
  lua_remove(L,-2);
  lua_pushliteral(L,"y");
  lua_insert(L,-2);
  lua_settable(L,1);
  assert(lua_gettop(L) == 2);
  
  /* local k = minetest.get_node(p).name */
  lua_getfield(L,LUA_ENVIRONINDEX,"minetest");
  lua_pushliteral(L,"get_node");
  lua_gettable(L,-2);
  lua_remove(L,-2);
  lua_pushvalue(L,1);
  lua_call(L,1,1);
  lua_pushliteral(L,"name");
  lua_gettable(L,-2);
  lua_remove(L,-2);
  assert(lua_gettop(L) == 3);
  
  /* if k == "air" then */
  enum { lc242 = 3 };
  lua_pushliteral(L,"air");
  const int lc243 = lua_equal(L,3,-1);
  lua_pop(L,1);
  lua_pushboolean(L,lc243);
  const int lc244 = lua_toboolean(L,-1);
  lua_pop(L,1);
  if (lc244) {
    
    /* p.y = p.y-1 */
    lua_pushliteral(L,"y");
    lua_gettable(L,1);
    lua_pushnumber(L,1);
    lc_sub(L,-2,-1);
    lua_remove(L,-2);
    lua_remove(L,-2);
    lua_pushliteral(L,"y");
    lua_insert(L,-2);
    lua_settable(L,1);
    assert(lua_gettop(L) == 3);
    
    /* erosionCL(p,n) */
    lua_getfield(L,LUA_ENVIRONINDEX,"erosionCL");
    lua_pushvalue(L,1);
    lua_pushvalue(L,2);
    lua_call(L,2,0);
    assert(lua_gettop(L) == 3);
  }
  lua_settop(L,lc242);
  assert(lua_gettop(L) == 3);
  return 0;
}


/* name: (main)
 * function(...) */
static int lcf_main (lua_State * L) {
  lua_checkstack(L,38);
  enum { lc_nformalargs = 0 };
  const int lc_nactualargs = lua_gettop(L);
  const int lc_nextra = (lc_nactualargs - lc_nformalargs);
  
  /* -- Terrain erosion mechanics using moreblocks' slope blocks
   * --[[
   * 
   * 2016-11-28 modified by MrCerealGuy <mrcerealguy@gmx.de>
   * 	some modifications
   * 	
   * 2017-01-06 modified by MrCerealGuy <mrcerealguy@gmx.de>
   * 	exit if mod is deactivated
   * 
   * --]]
   * local DIR_DELIM = DIR_DELIM or "/" */
  lua_getfield(L,LUA_ENVIRONINDEX,"DIR_DELIM");
  if (!(lua_toboolean(L,-1))) {
    lua_pop(L,1);
    lua_pushliteral(L,"/");
  }
  assert(lua_gettop(L) - lc_nextra == 1);
  
  /* local world_file = minetest.get_worldpath()..DIR_DELIM.."world.mt" */
  lua_getfield(L,LUA_ENVIRONINDEX,"minetest");
  lua_pushliteral(L,"get_worldpath");
  lua_gettable(L,-2);
  lua_remove(L,-2);
  lua_call(L,0,1);
  lua_pushvalue(L,(1 + lc_nextra));
  lua_pushliteral(L,"world.mt");
  lua_concat(L,2);
  lua_concat(L,2);
  assert(lua_gettop(L) - lc_nextra == 2);
  
  /* local world_conf = Settings(world_file) */
  lua_getfield(L,LUA_ENVIRONINDEX,"Settings");
  lua_pushvalue(L,(2 + lc_nextra));
  lua_call(L,1,1);
  assert(lua_gettop(L) - lc_nextra == 3);
  
  /* local enable_erosion = world_conf:get("enable_erosion") */
  lua_pushvalue(L,(3 + lc_nextra));
  lua_pushliteral(L,"get");
  lua_gettable(L,-2);
  lua_insert(L,-2);
  lua_pushliteral(L,"enable_erosion");
  lua_call(L,2,1);
  assert(lua_gettop(L) - lc_nextra == 4);
  
  /* if enable_erosion ~= nil and enable_erosion == "false" then */
  enum { lc1 = 4 };
  lua_pushnil(L);
  const int lc2 = lua_equal(L,(4 + lc_nextra),-1);
  lua_pop(L,1);
  lua_pushboolean(L,lc2);
  lua_pushboolean(L,!(lua_toboolean(L,-1)));
  lua_remove(L,-2);
  if (lua_toboolean(L,-1)) {
    lua_pop(L,1);
    lua_pushvalue(L,(4 + lc_nextra));
    lua_pushliteral(L,"false");
    const int lc3 = lua_equal(L,-2,-1);
    lua_pop(L,2);
    lua_pushboolean(L,lc3);
  }
  const int lc4 = lua_toboolean(L,-1);
  lua_pop(L,1);
  if (lc4) {
    
    /* minetest.log("info", "[erosions] skip loading mod.") */
    lua_getfield(L,LUA_ENVIRONINDEX,"minetest");
    lua_pushliteral(L,"log");
    lua_gettable(L,-2);
    lua_remove(L,-2);
    lua_pushliteral(L,"info");
    lua_pushliteral(L,"[erosions] skip loading mod.");
    lua_call(L,2,0);
    assert(lua_gettop(L) - lc_nextra == 4);
    
    /* return */
    return 0;
    assert(lua_gettop(L) - lc_nextra == 4);
  }
  lua_settop(L,(lc1 + lc_nextra));
  assert(lua_gettop(L) - lc_nextra == 4);
  
  /* -- --------------------------------------------------------------------------------------------------------
   * if not rawget(_G,"stairsplus") then */
  enum { lc5 = 4 };
  lua_getfield(L,LUA_ENVIRONINDEX,"rawget");
  lua_getfield(L,LUA_ENVIRONINDEX,"_G");
  lua_pushliteral(L,"stairsplus");
  lua_call(L,2,1);
  lua_pushboolean(L,!(lua_toboolean(L,-1)));
  lua_remove(L,-2);
  const int lc6 = lua_toboolean(L,-1);
  lua_pop(L,1);
  if (lc6) {
    
    /* minetest.log("info", "erosion: stairsplus not found") */
    lua_getfield(L,LUA_ENVIRONINDEX,"minetest");
    lua_pushliteral(L,"log");
    lua_gettable(L,-2);
    lua_remove(L,-2);
    lua_pushliteral(L,"info");
    lua_pushliteral(L,"erosion: stairsplus not found");
    lua_call(L,2,0);
    assert(lua_gettop(L) - lc_nextra == 4);
    
    /* return */
    return 0;
    assert(lua_gettop(L) - lc_nextra == 4);
  }
  lua_settop(L,(lc5 + lc_nextra));
  assert(lua_gettop(L) - lc_nextra == 4);
  
  /* local nntbl,eroding_lut,eroded_lut,eroding_nodes = {},{},{},{--mod defining sloped nodes, materials produced by erosion
   * 	stone = {"moreblocks:","gravel"},
   * 	cobble = {"moreblocks:","gravel"},
   * 	mossycobble = {"moreblocks:","gravel"},
   * 	desert_stone = {"moreblocks:","desert_sand"},
   * 	desert_cobble = {"moreblocks:","desert_sand"},
   * 	sandstone = {"moreblocks:","sand"},
   * 	dirt = {"erosion:","dirt"},
   * 	dirt_with_grass = {"erosion:","dirt"},
   * 	dirt_with_grass_footsteps = {"erosion:","dirt"},
   * 	dirt_with_dry_grass = {"erosion:","dirt"},
   * 	dirt_with_snow = {"erosion:","dirt"},
   * 	sand = {"erosion:","sand"},
   * 	desert_sand = {"erosion:","desert_sand"},
   * 	gravel = {"erosion:","gravel"},
   * 	clay = {"erosion:","clay"},
   * 	snowblock = {"erosion:","snowblock"},
   * 	ice = {"moreblocks:","snowblock"},
   * } */
  lc_newclosuretable(L,lua_upvalueindex(1));
  enum { lc7 = 5 };
  assert((lua_gettop(L) == (lc7 + lc_nextra)));
  lua_newtable(L);
  lua_newtable(L);
  lua_newtable(L);
  lua_createtable(L,0,17);
  lua_pushliteral(L,"stone");
  lua_createtable(L,2,0);
  lua_pushliteral(L,"moreblocks:");
  lua_rawseti(L,-2,1);
  lua_pushliteral(L,"gravel");
  lua_rawseti(L,-2,2);
  lua_rawset(L,-3);
  lua_pushliteral(L,"cobble");
  lua_createtable(L,2,0);
  lua_pushliteral(L,"moreblocks:");
  lua_rawseti(L,-2,1);
  lua_pushliteral(L,"gravel");
  lua_rawseti(L,-2,2);
  lua_rawset(L,-3);
  lua_pushliteral(L,"mossycobble");
  lua_createtable(L,2,0);
  lua_pushliteral(L,"moreblocks:");
  lua_rawseti(L,-2,1);
  lua_pushliteral(L,"gravel");
  lua_rawseti(L,-2,2);
  lua_rawset(L,-3);
  lua_pushliteral(L,"desert_stone");
  lua_createtable(L,2,0);
  lua_pushliteral(L,"moreblocks:");
  lua_rawseti(L,-2,1);
  lua_pushliteral(L,"desert_sand");
  lua_rawseti(L,-2,2);
  lua_rawset(L,-3);
  lua_pushliteral(L,"desert_cobble");
  lua_createtable(L,2,0);
  lua_pushliteral(L,"moreblocks:");
  lua_rawseti(L,-2,1);
  lua_pushliteral(L,"desert_sand");
  lua_rawseti(L,-2,2);
  lua_rawset(L,-3);
  lua_pushliteral(L,"sandstone");
  lua_createtable(L,2,0);
  lua_pushliteral(L,"moreblocks:");
  lua_rawseti(L,-2,1);
  lua_pushliteral(L,"sand");
  lua_rawseti(L,-2,2);
  lua_rawset(L,-3);
  lua_pushliteral(L,"dirt");
  lua_createtable(L,2,0);
  lua_pushliteral(L,"erosion:");
  lua_rawseti(L,-2,1);
  lua_pushliteral(L,"dirt");
  lua_rawseti(L,-2,2);
  lua_rawset(L,-3);
  lua_pushliteral(L,"dirt_with_grass");
  lua_createtable(L,2,0);
  lua_pushliteral(L,"erosion:");
  lua_rawseti(L,-2,1);
  lua_pushliteral(L,"dirt");
  lua_rawseti(L,-2,2);
  lua_rawset(L,-3);
  lua_pushliteral(L,"dirt_with_grass_footsteps");
  lua_createtable(L,2,0);
  lua_pushliteral(L,"erosion:");
  lua_rawseti(L,-2,1);
  lua_pushliteral(L,"dirt");
  lua_rawseti(L,-2,2);
  lua_rawset(L,-3);
  lua_pushliteral(L,"dirt_with_dry_grass");
  lua_createtable(L,2,0);
  lua_pushliteral(L,"erosion:");
  lua_rawseti(L,-2,1);
  lua_pushliteral(L,"dirt");
  lua_rawseti(L,-2,2);
  lua_rawset(L,-3);
  lua_pushliteral(L,"dirt_with_snow");
  lua_createtable(L,2,0);
  lua_pushliteral(L,"erosion:");
  lua_rawseti(L,-2,1);
  lua_pushliteral(L,"dirt");
  lua_rawseti(L,-2,2);
  lua_rawset(L,-3);
  lua_pushliteral(L,"sand");
  lua_createtable(L,2,0);
  lua_pushliteral(L,"erosion:");
  lua_rawseti(L,-2,1);
  lua_pushliteral(L,"sand");
  lua_rawseti(L,-2,2);
  lua_rawset(L,-3);
  lua_pushliteral(L,"desert_sand");
  lua_createtable(L,2,0);
  lua_pushliteral(L,"erosion:");
  lua_rawseti(L,-2,1);
  lua_pushliteral(L,"desert_sand");
  lua_rawseti(L,-2,2);
  lua_rawset(L,-3);
  lua_pushliteral(L,"gravel");
  lua_createtable(L,2,0);
  lua_pushliteral(L,"erosion:");
  lua_rawseti(L,-2,1);
  lua_pushliteral(L,"gravel");
  lua_rawseti(L,-2,2);
  lua_rawset(L,-3);
  lua_pushliteral(L,"clay");
  lua_createtable(L,2,0);
  lua_pushliteral(L,"erosion:");
  lua_rawseti(L,-2,1);
  lua_pushliteral(L,"clay");
  lua_rawseti(L,-2,2);
  lua_rawset(L,-3);
  lua_pushliteral(L,"snowblock");
  lua_createtable(L,2,0);
  lua_pushliteral(L,"erosion:");
  lua_rawseti(L,-2,1);
  lua_pushliteral(L,"snowblock");
  lua_rawseti(L,-2,2);
  lua_rawset(L,-3);
  lua_pushliteral(L,"ice");
  lua_createtable(L,2,0);
  lua_pushliteral(L,"moreblocks:");
  lua_rawseti(L,-2,1);
  lua_pushliteral(L,"snowblock");
  lua_rawseti(L,-2,2);
  lua_rawset(L,-3);
  lua_rawseti(L,(lc7 + lc_nextra),1);
  lua_rawseti(L,(lc7 + lc_nextra),2);
  lua_rawseti(L,(lc7 + lc_nextra),3);
  assert(lua_gettop(L) - lc_nextra == 6);
  
  /* local gen_nodes = {"stone","desert_stone","sandstone","ice"} */
  lc_newclosuretable(L,(lc7 + lc_nextra));
  enum { lc8 = 7 };
  assert((lua_gettop(L) == (lc8 + lc_nextra)));
  lua_createtable(L,4,0);
  lua_pushliteral(L,"stone");
  lua_rawseti(L,-2,1);
  lua_pushliteral(L,"desert_stone");
  lua_rawseti(L,-2,2);
  lua_pushliteral(L,"sandstone");
  lua_rawseti(L,-2,3);
  lua_pushliteral(L,"ice");
  lua_rawseti(L,-2,4);
  lua_rawseti(L,(lc8 + lc_nextra),4);
  assert(lua_gettop(L) - lc_nextra == 7);
  
  /* local lntbl,erosion_materials = {},{--erosion products to define
   * 	sand = {
   * 		description = "Sand",
   * 		tiles = {"default_sand.png"},
   * 		groups = {sand = 1},
   * 		sounds = default.node_sound_sand_defaults(),
   * 	},
   * 	desert_sand = {
   * 		description = "Desert Sand",
   * 		tiles = {"default_desert_sand.png"},
   * 		groups = {sand = 1},
   * 		sounds = default.node_sound_sand_defaults(),
   * 	},
   * 	gravel = {
   * 		description= "Gravel",
   * 		groups = {},
   * 		tiles={"default_gravel.png"},
   * 		sounds = default.node_sound_gravel_defaults(),
   * 	},
   * 	dirt = {
   * 		description = "Dirt",
   * 		tiles = {"default_dirt.png"},
   * 		groups = {},
   * 		sounds = default.node_sound_dirt_defaults(),
   * 	},
   * 	dirt_with_grass = {
   * 		description = "Grass Turf",
   * 		tiles = {"default_grass.png", "default_dirt.png",
   * 			{name = "default_dirt.png^default_grass_side.png",
   * 				tileable_vertical = false}},
   * 		groups = {},
   * 		sounds = default.node_sound_dirt_defaults({footstep = {name = "default_grass_footstep", gain = 0.25},}),
   * 	},
   * 	dirt_with_dry_grass = {
   * 		description = "Dry Turf",
   * 		tiles = {"default_dry_grass.png",
   * 			"default_dirt.png",
   * 			{name = "default_dirt.png^default_dry_grass_side.png",
   * 				tileable_vertical = false}},
   * 		groups = {},
   * 		drop = 'default:dirt',
   * 		sounds = default.node_sound_dirt_defaults({footstep = {name = "default_grass_footstep", gain = 0.4},}),
   * 	},
   * 	dirt_with_snow = {
   * 		description = "Snow Turf",
   * 		tiles = {"default_snow.png", "default_dirt.png",
   * 			{name = "default_dirt.png^default_snow_side.png",
   * 				tileable_vertical = false}},
   * 		groups = {},
   * 		drop = 'default:dirt',
   * 		sounds = default.node_sound_dirt_defaults({footstep = {name = "default_snow_footstep", gain = 0.15},}),
   * 	},
   * 	clay = {
   * 		description = "Clay",
   * 		tiles = {"default_clay.png"},
   * 		groups = {},
   * 		drop = 'default:clay_lump 4',
   * 		sounds = default.node_sound_dirt_defaults(),
   * 	},
   * 	snowblock = {
   * 		description = "Drifted Snow",
   * 		tiles = {"default_snow.png"},
   * 		groups = {puts_out_fire = 1},
   * 		sounds = default.node_sound_dirt_defaults({footstep = {
   * 			name = "default_snow_footstep", gain = 0.15},
   * 			dug = {name = "default_snow_footstep", gain = 0.2},
   * 			dig = {name = "default_snow_footstep", gain = 0.2}
   * 		}),
   * 	},
   * --[[	ice = {
   * 		description = "Ice",
   * 		tiles = {"default_ice.png"},
   * 		is_ground_content = false,
   * 		paramtype = "light",
   * 		groups = {cracky = 3, puts_out_fire = 1},
   * 		sounds = default.node_sound_glass_defaults(),
   * 	}--]]
   * } */
  lc_newclosuretable(L,(lc8 + lc_nextra));
  enum { lc9 = 8 };
  assert((lua_gettop(L) == (lc9 + lc_nextra)));
  lua_newtable(L);
  lua_createtable(L,0,9);
  lua_pushliteral(L,"sand");
  lua_createtable(L,0,4);
  lua_pushliteral(L,"description");
  lua_pushliteral(L,"Sand");
  lua_rawset(L,-3);
  lua_pushliteral(L,"tiles");
  lua_createtable(L,1,0);
  lua_pushliteral(L,"default_sand.png");
  lua_rawseti(L,-2,1);
  lua_rawset(L,-3);
  lua_pushliteral(L,"groups");
  lua_createtable(L,0,1);
  lua_pushliteral(L,"sand");
  lua_pushnumber(L,1);
  lua_rawset(L,-3);
  lua_rawset(L,-3);
  lua_pushliteral(L,"sounds");
  lua_getfield(L,LUA_ENVIRONINDEX,"default");
  lua_pushliteral(L,"node_sound_sand_defaults");
  lua_gettable(L,-2);
  lua_remove(L,-2);
  lua_call(L,0,1);
  lua_rawset(L,-3);
  lua_rawset(L,-3);
  lua_pushliteral(L,"desert_sand");
  lua_createtable(L,0,4);
  lua_pushliteral(L,"description");
  lua_pushliteral(L,"Desert Sand");
  lua_rawset(L,-3);
  lua_pushliteral(L,"tiles");
  lua_createtable(L,1,0);
  lua_pushliteral(L,"default_desert_sand.png");
  lua_rawseti(L,-2,1);
  lua_rawset(L,-3);
  lua_pushliteral(L,"groups");
  lua_createtable(L,0,1);
  lua_pushliteral(L,"sand");
  lua_pushnumber(L,1);
  lua_rawset(L,-3);
  lua_rawset(L,-3);
  lua_pushliteral(L,"sounds");
  lua_getfield(L,LUA_ENVIRONINDEX,"default");
  lua_pushliteral(L,"node_sound_sand_defaults");
  lua_gettable(L,-2);
  lua_remove(L,-2);
  lua_call(L,0,1);
  lua_rawset(L,-3);
  lua_rawset(L,-3);
  lua_pushliteral(L,"gravel");
  lua_createtable(L,0,4);
  lua_pushliteral(L,"description");
  lua_pushliteral(L,"Gravel");
  lua_rawset(L,-3);
  lua_pushliteral(L,"groups");
  lua_newtable(L);
  lua_rawset(L,-3);
  lua_pushliteral(L,"tiles");
  lua_createtable(L,1,0);
  lua_pushliteral(L,"default_gravel.png");
  lua_rawseti(L,-2,1);
  lua_rawset(L,-3);
  lua_pushliteral(L,"sounds");
  lua_getfield(L,LUA_ENVIRONINDEX,"default");
  lua_pushliteral(L,"node_sound_gravel_defaults");
  lua_gettable(L,-2);
  lua_remove(L,-2);
  lua_call(L,0,1);
  lua_rawset(L,-3);
  lua_rawset(L,-3);
  lua_pushliteral(L,"dirt");
  lua_createtable(L,0,4);
  lua_pushliteral(L,"description");
  lua_pushliteral(L,"Dirt");
  lua_rawset(L,-3);
  lua_pushliteral(L,"tiles");
  lua_createtable(L,1,0);
  lua_pushliteral(L,"default_dirt.png");
  lua_rawseti(L,-2,1);
  lua_rawset(L,-3);
  lua_pushliteral(L,"groups");
  lua_newtable(L);
  lua_rawset(L,-3);
  lua_pushliteral(L,"sounds");
  lua_getfield(L,LUA_ENVIRONINDEX,"default");
  lua_pushliteral(L,"node_sound_dirt_defaults");
  lua_gettable(L,-2);
  lua_remove(L,-2);
  lua_call(L,0,1);
  lua_rawset(L,-3);
  lua_rawset(L,-3);
  lua_pushliteral(L,"dirt_with_grass");
  lua_createtable(L,0,4);
  lua_pushliteral(L,"description");
  lua_pushliteral(L,"Grass Turf");
  lua_rawset(L,-3);
  lua_pushliteral(L,"tiles");
  lua_createtable(L,3,0);
  lua_pushliteral(L,"default_grass.png");
  lua_rawseti(L,-2,1);
  lua_pushliteral(L,"default_dirt.png");
  lua_rawseti(L,-2,2);
  lua_createtable(L,0,2);
  lua_pushliteral(L,"name");
  lua_pushliteral(L,"default_dirt.png^default_grass_side.png");
  lua_rawset(L,-3);
  lua_pushliteral(L,"tileable_vertical");
  lua_pushboolean(L,0);
  lua_rawset(L,-3);
  lua_rawseti(L,-2,3);
  lua_rawset(L,-3);
  lua_pushliteral(L,"groups");
  lua_newtable(L);
  lua_rawset(L,-3);
  lua_pushliteral(L,"sounds");
  lua_getfield(L,LUA_ENVIRONINDEX,"default");
  lua_pushliteral(L,"node_sound_dirt_defaults");
  lua_gettable(L,-2);
  lua_remove(L,-2);
  lua_createtable(L,0,1);
  lua_pushliteral(L,"footstep");
  lua_createtable(L,0,2);
  lua_pushliteral(L,"name");
  lua_pushliteral(L,"default_grass_footstep");
  lua_rawset(L,-3);
  lua_pushliteral(L,"gain");
  lua_pushnumber(L,0.25);
  lua_rawset(L,-3);
  lua_rawset(L,-3);
  lua_call(L,1,1);
  lua_rawset(L,-3);
  lua_rawset(L,-3);
  lua_pushliteral(L,"dirt_with_dry_grass");
  lua_createtable(L,0,5);
  lua_pushliteral(L,"description");
  lua_pushliteral(L,"Dry Turf");
  lua_rawset(L,-3);
  lua_pushliteral(L,"tiles");
  lua_createtable(L,3,0);
  lua_pushliteral(L,"default_dry_grass.png");
  lua_rawseti(L,-2,1);
  lua_pushliteral(L,"default_dirt.png");
  lua_rawseti(L,-2,2);
  lua_createtable(L,0,2);
  lua_pushliteral(L,"name");
  lua_pushliteral(L,"default_dirt.png^default_dry_grass_side.png");
  lua_rawset(L,-3);
  lua_pushliteral(L,"tileable_vertical");
  lua_pushboolean(L,0);
  lua_rawset(L,-3);
  lua_rawseti(L,-2,3);
  lua_rawset(L,-3);
  lua_pushliteral(L,"groups");
  lua_newtable(L);
  lua_rawset(L,-3);
  lua_pushliteral(L,"drop");
  lua_pushliteral(L,"default:dirt");
  lua_rawset(L,-3);
  lua_pushliteral(L,"sounds");
  lua_getfield(L,LUA_ENVIRONINDEX,"default");
  lua_pushliteral(L,"node_sound_dirt_defaults");
  lua_gettable(L,-2);
  lua_remove(L,-2);
  lua_createtable(L,0,1);
  lua_pushliteral(L,"footstep");
  lua_createtable(L,0,2);
  lua_pushliteral(L,"name");
  lua_pushliteral(L,"default_grass_footstep");
  lua_rawset(L,-3);
  lua_pushliteral(L,"gain");
  lua_pushnumber(L,0.4);
  lua_rawset(L,-3);
  lua_rawset(L,-3);
  lua_call(L,1,1);
  lua_rawset(L,-3);
  lua_rawset(L,-3);
  lua_pushliteral(L,"dirt_with_snow");
  lua_createtable(L,0,5);
  lua_pushliteral(L,"description");
  lua_pushliteral(L,"Snow Turf");
  lua_rawset(L,-3);
  lua_pushliteral(L,"tiles");
  lua_createtable(L,3,0);
  lua_pushliteral(L,"default_snow.png");
  lua_rawseti(L,-2,1);
  lua_pushliteral(L,"default_dirt.png");
  lua_rawseti(L,-2,2);
  lua_createtable(L,0,2);
  lua_pushliteral(L,"name");
  lua_pushliteral(L,"default_dirt.png^default_snow_side.png");
  lua_rawset(L,-3);
  lua_pushliteral(L,"tileable_vertical");
  lua_pushboolean(L,0);
  lua_rawset(L,-3);
  lua_rawseti(L,-2,3);
  lua_rawset(L,-3);
  lua_pushliteral(L,"groups");
  lua_newtable(L);
  lua_rawset(L,-3);
  lua_pushliteral(L,"drop");
  lua_pushliteral(L,"default:dirt");
  lua_rawset(L,-3);
  lua_pushliteral(L,"sounds");
  lua_getfield(L,LUA_ENVIRONINDEX,"default");
  lua_pushliteral(L,"node_sound_dirt_defaults");
  lua_gettable(L,-2);
  lua_remove(L,-2);
  lua_createtable(L,0,1);
  lua_pushliteral(L,"footstep");
  lua_createtable(L,0,2);
  lua_pushliteral(L,"name");
  lua_pushliteral(L,"default_snow_footstep");
  lua_rawset(L,-3);
  lua_pushliteral(L,"gain");
  lua_pushnumber(L,0.15);
  lua_rawset(L,-3);
  lua_rawset(L,-3);
  lua_call(L,1,1);
  lua_rawset(L,-3);
  lua_rawset(L,-3);
  lua_pushliteral(L,"clay");
  lua_createtable(L,0,5);
  lua_pushliteral(L,"description");
  lua_pushliteral(L,"Clay");
  lua_rawset(L,-3);
  lua_pushliteral(L,"tiles");
  lua_createtable(L,1,0);
  lua_pushliteral(L,"default_clay.png");
  lua_rawseti(L,-2,1);
  lua_rawset(L,-3);
  lua_pushliteral(L,"groups");
  lua_newtable(L);
  lua_rawset(L,-3);
  lua_pushliteral(L,"drop");
  lua_pushliteral(L,"default:clay_lump 4");
  lua_rawset(L,-3);
  lua_pushliteral(L,"sounds");
  lua_getfield(L,LUA_ENVIRONINDEX,"default");
  lua_pushliteral(L,"node_sound_dirt_defaults");
  lua_gettable(L,-2);
  lua_remove(L,-2);
  lua_call(L,0,1);
  lua_rawset(L,-3);
  lua_rawset(L,-3);
  lua_pushliteral(L,"snowblock");
  lua_createtable(L,0,4);
  lua_pushliteral(L,"description");
  lua_pushliteral(L,"Drifted Snow");
  lua_rawset(L,-3);
  lua_pushliteral(L,"tiles");
  lua_createtable(L,1,0);
  lua_pushliteral(L,"default_snow.png");
  lua_rawseti(L,-2,1);
  lua_rawset(L,-3);
  lua_pushliteral(L,"groups");
  lua_createtable(L,0,1);
  lua_pushliteral(L,"puts_out_fire");
  lua_pushnumber(L,1);
  lua_rawset(L,-3);
  lua_rawset(L,-3);
  lua_pushliteral(L,"sounds");
  lua_getfield(L,LUA_ENVIRONINDEX,"default");
  lua_pushliteral(L,"node_sound_dirt_defaults");
  lua_gettable(L,-2);
  lua_remove(L,-2);
  lua_createtable(L,0,3);
  lua_pushliteral(L,"footstep");
  lua_createtable(L,0,2);
  lua_pushliteral(L,"name");
  lua_pushliteral(L,"default_snow_footstep");
  lua_rawset(L,-3);
  lua_pushliteral(L,"gain");
  lua_pushnumber(L,0.15);
  lua_rawset(L,-3);
  lua_rawset(L,-3);
  lua_pushliteral(L,"dug");
  lua_createtable(L,0,2);
  lua_pushliteral(L,"name");
  lua_pushliteral(L,"default_snow_footstep");
  lua_rawset(L,-3);
  lua_pushliteral(L,"gain");
  lua_pushnumber(L,0.2);
  lua_rawset(L,-3);
  lua_rawset(L,-3);
  lua_pushliteral(L,"dig");
  lua_createtable(L,0,2);
  lua_pushliteral(L,"name");
  lua_pushliteral(L,"default_snow_footstep");
  lua_rawset(L,-3);
  lua_pushliteral(L,"gain");
  lua_pushnumber(L,0.2);
  lua_rawset(L,-3);
  lua_rawset(L,-3);
  lua_call(L,1,1);
  lua_rawset(L,-3);
  lua_rawset(L,-3);
  lua_rawseti(L,(lc9 + lc_nextra),5);
  assert(lua_gettop(L) - lc_nextra == 9);
  
  /* for k,v in pairs(erosion_materials) do
   * internal: local f, s, var = explist */
  enum { lc10 = 9 };
  lua_getfield(L,LUA_ENVIRONINDEX,"pairs");
  lc_getupvalue(L,(lc9 + lc_nextra),0,5);
  lua_call(L,1,3);
  while (1) {
    
    /* internal: local var_1, ..., var_n = f(s, var)
     *           if var_1 == nil then break end
     *           var = var_1 */
    lua_pushvalue(L,-3);
    lua_pushvalue(L,-3);
    lua_pushvalue(L,-3);
    lua_call(L,2,2);
    if (lua_isnil(L,-2)) {
      break;
    }
    lua_pushvalue(L,-2);
    lua_replace(L,-4);
    
    /* internal: local k with idx 13
     * internal: local v with idx 14 */
    
    
    /* lntbl[#lntbl+1] = "default:"..k */
    lua_pushliteral(L,"default:");
    lua_pushvalue(L,(13 + lc_nextra));
    lua_concat(L,2);
    const double lc11 = lua_objlen(L,(9 + lc_nextra));
    lua_pushnumber(L,lc11);
    lua_pushnumber(L,1);
    lc_add(L,-2,-1);
    lua_remove(L,-2);
    lua_remove(L,-2);
    lua_insert(L,-2);
    lua_settable(L,(9 + lc_nextra));
    assert(lua_gettop(L) - lc_nextra == 14);
    
    /* internal: stack cleanup on scope exit */
    lua_pop(L,2);
  }
  lua_settop(L,(lc10 + lc_nextra));
  assert(lua_gettop(L) - lc_nextra == 9);
  
  /* local sntbl,snt1,snt2,slopes = {},{},{},{
   * 	[""] = 2,
   * 	_half = 1,
   * 	_half_raised = 3,
   * 	_inner = 1,
   * 	_inner_half = 1,
   * 	_inner_half_raised = 3,
   * 	_inner_cut = 3,
   * 	_inner_cut_half = 2,
   * 	_inner_cut_half_raised = 3,
   * 	_outer = 1,
   * 	_outer_half = 1,
   * 	_outer_half_raised = 3,
   * 	_outer_cut = 1,
   * 	_outer_cut_half = 1,
   * 	_outer_cut_half_raised = 2,
   * 	_cut = 2,
   * } */
  lc_newclosuretable(L,(lc9 + lc_nextra));
  enum { lc12 = 10 };
  assert((lua_gettop(L) == (lc12 + lc_nextra)));
  lua_newtable(L);
  lua_newtable(L);
  lua_newtable(L);
  lua_createtable(L,0,16);
  lua_pushliteral(L,"");
  lua_pushnumber(L,2);
  lua_rawset(L,-3);
  lua_pushliteral(L,"_half");
  lua_pushnumber(L,1);
  lua_rawset(L,-3);
  lua_pushliteral(L,"_half_raised");
  lua_pushnumber(L,3);
  lua_rawset(L,-3);
  lua_pushliteral(L,"_inner");
  lua_pushnumber(L,1);
  lua_rawset(L,-3);
  lua_pushliteral(L,"_inner_half");
  lua_pushnumber(L,1);
  lua_rawset(L,-3);
  lua_pushliteral(L,"_inner_half_raised");
  lua_pushnumber(L,3);
  lua_rawset(L,-3);
  lua_pushliteral(L,"_inner_cut");
  lua_pushnumber(L,3);
  lua_rawset(L,-3);
  lua_pushliteral(L,"_inner_cut_half");
  lua_pushnumber(L,2);
  lua_rawset(L,-3);
  lua_pushliteral(L,"_inner_cut_half_raised");
  lua_pushnumber(L,3);
  lua_rawset(L,-3);
  lua_pushliteral(L,"_outer");
  lua_pushnumber(L,1);
  lua_rawset(L,-3);
  lua_pushliteral(L,"_outer_half");
  lua_pushnumber(L,1);
  lua_rawset(L,-3);
  lua_pushliteral(L,"_outer_half_raised");
  lua_pushnumber(L,3);
  lua_rawset(L,-3);
  lua_pushliteral(L,"_outer_cut");
  lua_pushnumber(L,1);
  lua_rawset(L,-3);
  lua_pushliteral(L,"_outer_cut_half");
  lua_pushnumber(L,1);
  lua_rawset(L,-3);
  lua_pushliteral(L,"_outer_cut_half_raised");
  lua_pushnumber(L,2);
  lua_rawset(L,-3);
  lua_pushliteral(L,"_cut");
  lua_pushnumber(L,2);
  lua_rawset(L,-3);
  lua_rawseti(L,(lc12 + lc_nextra),6);
  lua_rawseti(L,(lc12 + lc_nextra),7);
  lua_rawseti(L,(lc12 + lc_nextra),8);
  assert(lua_gettop(L) - lc_nextra == 11);
  
  /* function table.val_to_str ( v )
   *   if "string" == type( v ) then
   *     v = string.gsub( v, "\n", "\\n" )
   *     if string.match( string.gsub(v,"[^'\"]",""), '^"+$' ) then
   *       return "'" .. v .. "'"
   *     end
   *     return '"' .. string.gsub(v,'"', '\\"' ) .. '"'
   *   else
   *     return "table" == type( v ) and table.tostring( v ) or
   *       tostring( v )
   *   end
   * end */
  lua_pushcfunction(L,lcf1_table_val_to_str);
  lua_getfield(L,LUA_ENVIRONINDEX,"table");
  lua_insert(L,-2);
  lua_pushliteral(L,"val_to_str");
  lua_insert(L,-2);
  lua_settable(L,-3);
  lua_pop(L,1);
  assert(lua_gettop(L) - lc_nextra == 11);
  
  /* function table.key_to_str ( k )
   *   if "string" == type( k ) and string.match( k, "^[_%a][_%a%d]*$" ) then
   *     return k
   *   else
   *     return "[" .. table.val_to_str( k ) .. "]"
   *   end
   * end */
  lua_pushcfunction(L,lcf1_table_key_to_str);
  lua_getfield(L,LUA_ENVIRONINDEX,"table");
  lua_insert(L,-2);
  lua_pushliteral(L,"key_to_str");
  lua_insert(L,-2);
  lua_settable(L,-3);
  lua_pop(L,1);
  assert(lua_gettop(L) - lc_nextra == 11);
  
  /* function table.tostring( tbl )
   *   local result, done = {}, {}
   *   for k, v in ipairs( tbl ) do
   *     table.insert( result, table.val_to_str( v ) )
   *     done[ k ] = true
   *   end
   *   for k, v in pairs( tbl ) do
   *     if not done[ k ] then
   *       table.insert( result,
   *         table.key_to_str( k ) .. "=" .. table.val_to_str( v ) )
   *     end
   *   end
   *   return "{" .. table.concat( result, "," ) .. "}"
   * end */
  lua_pushcfunction(L,lcf1_table_tostring);
  lua_getfield(L,LUA_ENVIRONINDEX,"table");
  lua_insert(L,-2);
  lua_pushliteral(L,"tostring");
  lua_insert(L,-2);
  lua_settable(L,-3);
  lua_pop(L,1);
  assert(lua_gettop(L) - lc_nextra == 11);
  
  /* for k,v in pairs(eroding_nodes) do
   * internal: local f, s, var = explist */
  enum { lc27 = 11 };
  lua_getfield(L,LUA_ENVIRONINDEX,"pairs");
  lc_getupvalue(L,(lc12 + lc_nextra),3,1);
  lua_call(L,1,3);
  while (1) {
    
    /* internal: local var_1, ..., var_n = f(s, var)
     *           if var_1 == nil then break end
     *           var = var_1 */
    lua_pushvalue(L,-3);
    lua_pushvalue(L,-3);
    lua_pushvalue(L,-3);
    lua_call(L,2,2);
    if (lua_isnil(L,-2)) {
      break;
    }
    lua_pushvalue(L,-2);
    lua_replace(L,-4);
    
    /* internal: local k with idx 15
     * internal: local v with idx 16 */
    
    
    /* nntbl[#nntbl+1] = "default:"..k */
    lua_pushliteral(L,"default:");
    lua_pushvalue(L,(15 + lc_nextra));
    lua_concat(L,2);
    const double lc28 = lua_objlen(L,(6 + lc_nextra));
    lua_pushnumber(L,lc28);
    lua_pushnumber(L,1);
    lc_add(L,-2,-1);
    lua_remove(L,-2);
    lua_remove(L,-2);
    lua_insert(L,-2);
    lua_settable(L,(6 + lc_nextra));
    assert(lua_gettop(L) - lc_nextra == 16);
    
    /* eroding_lut["default:"..k] = k */
    lua_pushvalue(L,(15 + lc_nextra));
    lc_getupvalue(L,(lc12 + lc_nextra),3,3);
    lua_insert(L,-2);
    lua_pushliteral(L,"default:");
    lua_pushvalue(L,(15 + lc_nextra));
    lua_concat(L,2);
    lua_insert(L,-2);
    lua_settable(L,-3);
    lua_pop(L,1);
    assert(lua_gettop(L) - lc_nextra == 16);
    
    /* if erosion_materials[k] then */
    enum { lc29 = 16 };
    lc_getupvalue(L,(lc12 + lc_nextra),1,5);
    lua_pushvalue(L,(15 + lc_nextra));
    lua_gettable(L,-2);
    lua_remove(L,-2);
    const int lc30 = lua_toboolean(L,-1);
    lua_pop(L,1);
    if (lc30) {
      
      /* for s,d in pairs(slopes) do
       * internal: local f, s, var = explist */
      enum { lc31 = 16 };
      lua_getfield(L,LUA_ENVIRONINDEX,"pairs");
      lc_getupvalue(L,(lc12 + lc_nextra),0,6);
      lua_call(L,1,3);
      while (1) {
        
        /* internal: local var_1, ..., var_n = f(s, var)
         *           if var_1 == nil then break end
         *           var = var_1 */
        lua_pushvalue(L,-3);
        lua_pushvalue(L,-3);
        lua_pushvalue(L,-3);
        lua_call(L,2,2);
        if (lua_isnil(L,-2)) {
          break;
        }
        lua_pushvalue(L,-2);
        lua_replace(L,-4);
        
        /* internal: local s with idx 20
         * internal: local d with idx 21 */
        
        
        /* eroded_lut[v[1].."slope_"..k..s] = {k,s} */
        lua_createtable(L,2,0);
        lua_pushvalue(L,(15 + lc_nextra));
        lua_rawseti(L,-2,1);
        lua_pushvalue(L,(20 + lc_nextra));
        lua_rawseti(L,-2,2);
        lc_getupvalue(L,(lc12 + lc_nextra),3,2);
        lua_insert(L,-2);
        lua_pushnumber(L,1);
        lua_gettable(L,(16 + lc_nextra));
        lua_pushliteral(L,"slope_");
        lua_pushvalue(L,(15 + lc_nextra));
        lua_pushvalue(L,(20 + lc_nextra));
        lua_concat(L,2);
        lua_concat(L,2);
        lua_concat(L,2);
        lua_insert(L,-2);
        lua_settable(L,-3);
        lua_pop(L,1);
        assert(lua_gettop(L) - lc_nextra == 21);
        
        /* internal: stack cleanup on scope exit */
        lua_pop(L,2);
      }
      lua_settop(L,(lc31 + lc_nextra));
      assert(lua_gettop(L) - lc_nextra == 16);
    }
    lua_settop(L,(lc29 + lc_nextra));
    assert(lua_gettop(L) - lc_nextra == 16);
    
    /* if string.find(k,"cobble") then */
    enum { lc32 = 16 };
    lua_getfield(L,LUA_ENVIRONINDEX,"string");
    lua_pushliteral(L,"find");
    lua_gettable(L,-2);
    lua_remove(L,-2);
    lua_pushvalue(L,(15 + lc_nextra));
    lua_pushliteral(L,"cobble");
    lua_call(L,2,1);
    const int lc33 = lua_toboolean(L,-1);
    lua_pop(L,1);
    if (lc33) {
      
      /* for s,d in pairs(slopes) do
       * internal: local f, s, var = explist */
      enum { lc34 = 16 };
      lua_getfield(L,LUA_ENVIRONINDEX,"pairs");
      lc_getupvalue(L,(lc12 + lc_nextra),0,6);
      lua_call(L,1,3);
      while (1) {
        
        /* internal: local var_1, ..., var_n = f(s, var)
         *           if var_1 == nil then break end
         *           var = var_1 */
        lua_pushvalue(L,-3);
        lua_pushvalue(L,-3);
        lua_pushvalue(L,-3);
        lua_call(L,2,2);
        if (lua_isnil(L,-2)) {
          break;
        }
        lua_pushvalue(L,-2);
        lua_replace(L,-4);
        
        /* internal: local s with idx 20
         * internal: local d with idx 21 */
        
        
        /* minetest.register_craft({
         * 				output = v[1].."micro_"..k.." "..slopes[s]*2-1,
         * 				recipe = {{v[1].."slope_"..k..s}}
         * 			}) */
        lua_getfield(L,LUA_ENVIRONINDEX,"minetest");
        lua_pushliteral(L,"register_craft");
        lua_gettable(L,-2);
        lua_remove(L,-2);
        lua_createtable(L,0,2);
        lua_pushliteral(L,"output");
        lua_pushnumber(L,1);
        lua_gettable(L,(16 + lc_nextra));
        lua_pushliteral(L,"micro_");
        lua_pushvalue(L,(15 + lc_nextra));
        lua_pushliteral(L," ");
        lc_getupvalue(L,(lc12 + lc_nextra),0,6);
        lua_pushvalue(L,(20 + lc_nextra));
        lua_gettable(L,-2);
        lua_remove(L,-2);
        lua_pushnumber(L,2);
        lc_mul(L,-2,-1);
        lua_remove(L,-2);
        lua_remove(L,-2);
        lua_pushnumber(L,1);
        lc_sub(L,-2,-1);
        lua_remove(L,-2);
        lua_remove(L,-2);
        lua_concat(L,2);
        lua_concat(L,2);
        lua_concat(L,2);
        lua_concat(L,2);
        lua_rawset(L,-3);
        lua_pushliteral(L,"recipe");
        lua_createtable(L,1,0);
        lua_createtable(L,1,0);
        lua_pushnumber(L,1);
        lua_gettable(L,(16 + lc_nextra));
        lua_pushliteral(L,"slope_");
        lua_pushvalue(L,(15 + lc_nextra));
        lua_pushvalue(L,(20 + lc_nextra));
        lua_concat(L,2);
        lua_concat(L,2);
        lua_concat(L,2);
        lua_rawseti(L,-2,1);
        lua_rawseti(L,-2,1);
        lua_rawset(L,-3);
        lua_call(L,1,0);
        assert(lua_gettop(L) - lc_nextra == 21);
        
        /* internal: stack cleanup on scope exit */
        lua_pop(L,2);
      }
      lua_settop(L,(lc34 + lc_nextra));
      assert(lua_gettop(L) - lc_nextra == 16);
    }
    lua_settop(L,(lc32 + lc_nextra));
    assert(lua_gettop(L) - lc_nextra == 16);
    
    /* internal: stack cleanup on scope exit */
    lua_pop(L,2);
  }
  lua_settop(L,(lc27 + lc_nextra));
  assert(lua_gettop(L) - lc_nextra == 11);
  
  /* local bstbl = {{"_half","","_half_raised"},{"_outer_cut_half","_cut","_inner_cut_half_raised"}} */
  lc_newclosuretable(L,(lc12 + lc_nextra));
  enum { lc35 = 12 };
  assert((lua_gettop(L) == (lc35 + lc_nextra)));
  lua_createtable(L,2,0);
  lua_createtable(L,3,0);
  lua_pushliteral(L,"_half");
  lua_rawseti(L,-2,1);
  lua_pushliteral(L,"");
  lua_rawseti(L,-2,2);
  lua_pushliteral(L,"_half_raised");
  lua_rawseti(L,-2,3);
  lua_rawseti(L,-2,1);
  lua_createtable(L,3,0);
  lua_pushliteral(L,"_outer_cut_half");
  lua_rawseti(L,-2,1);
  lua_pushliteral(L,"_cut");
  lua_rawseti(L,-2,2);
  lua_pushliteral(L,"_inner_cut_half_raised");
  lua_rawseti(L,-2,3);
  lua_rawseti(L,-2,2);
  lua_rawseti(L,(lc35 + lc_nextra),9);
  assert(lua_gettop(L) - lc_nextra == 12);
  
  /* local function get_adjacent_nodes(p,nlst)
   * 	local xsr,nvt = minetest.find_nodes_in_area({x=p.x-1,y=p.y,z=p.z-1},{x=p.x+1,y=p.y,z=p.z+1},nlst),{}
   * 	for i=1,#xsr do
   * 		nvt[xsr[i].x] = nvt[xsr[i].x] or {}
   * 		nvt[xsr[i].x][xsr[i].z] = i
   * 	end
   * 	return xsr,nvt
   * end */
  lc_newclosuretable(L,(lc35 + lc_nextra));
  enum { lc36 = 13 };
  assert((lua_gettop(L) == (lc36 + lc_nextra)));
  lua_pushcfunction(L,lcf1_get_adjacent_nodes);
  lua_rawseti(L,(lc36 + lc_nextra),10);
  assert(lua_gettop(L) - lc_nextra == 13);
  
  /* local function orient_pile(k,m,p) local _,t0 = get_adjacent_nodes(p,{"air"})
   * 	local a,t1 = get_adjacent_nodes(p,snt1)
   * 	local _,t2 = get_adjacent_nodes(p,snt2)
   * 	local x1,z1,x2,z2,d,nm =
   * 	t0[p.x-1] and t0[p.x-1][p.z] and 0 or t1[p.x-1] and t1[p.x-1][p.z] and 1 or t2[p.x-1] and t2[p.x-1][p.z] and 2 or 3,
   * 	t0[p.x] and t0[p.x][p.z-1] and 0 or t1[p.x] and t1[p.x][p.z-1] and 1 or t2[p.x] and t2[p.x][p.z-1] and 2 or 3,
   * 	t0[p.x+1] and t0[p.x+1][p.z] and 0 or t1[p.x+1] and t1[p.x+1][p.z] and 1 or t2[p.x+1] and t2[p.x+1][p.z] and 2 or 3,
   * 	t0[p.x] and t0[p.x][p.z+1] and 0 or t1[p.x] and t1[p.x][p.z+1] and 1 or t2[p.x] and t2[p.x][p.z+1] and 2 or 3
   * 	d = m>3 and 0
   * 	or z2 > z1 and x1 == x2 and 0
   * 	or x2 > x1 and z1 == z2 and 1
   * 	or z1 > z2 and x1 == x2 and 2
   * 	or x1 > x2 and z1 == z2 and 3
   * 	or z2 > z1 and x1 > x2 and 4
   * 	or x2 > x1 and z2 > z1 and 5
   * 	or z1 > z2 and x2 > x1 and 6
   * 	or x1 > x2 and z1 > z2 and 7 or 4
   * 	nm = m<4 and "erosion:slope_"..k..bstbl[d<4 and 1 or 2][m] or "default:"..k
   * 	minetest.swap_node(p,{name=nm,param2=d<4 and d or d-4})
   * 	return a
   * end */
  lc_newclosuretable(L,(lc36 + lc_nextra));
  enum { lc42 = 14 };
  assert((lua_gettop(L) == (lc42 + lc_nextra)));
  lua_pushvalue(L,(lc42 + lc_nextra));
  lua_pushcclosure(L,lcf1_orient_pile,1);
  lua_rawseti(L,(lc42 + lc_nextra),11);
  assert(lua_gettop(L) - lc_nextra == 14);
  
  /* local function pile_up(k,m,p) p.y = p.y-1
   * 	local un,p1,n = minetest.get_node(p),"erosion:slope_"
   * 	local a
   * 	if erosion_materials[eroding_lut[un.name]] then erosionCL(p,un) un = minetest.get_node(p) end
   * 	if un.name == "air" or un.name == "default:water_source" then
   * 	elseif eroded_lut[un.name] then
   * 		orient_pile(k,m+slopes[eroded_lut[un.name][2]],p)
   * 		p.y = p.y+1
   * 		minetest.set_node(p,{name="air"})
   * 	else p.y = p.y+1
   * 		a = orient_pile(k,m,p)
   * 		for i=1,#a do local nn = minetest.get_node(a[i])
   * 			orient_pile(eroded_lut[nn.name][1],slopes[eroded_lut[nn.name][2]],a[i])
   * 		end
   * --		p1 = p1..k..bstbl[n<4 and 1 or 2][m]
   * --		minetest.swap_node(p,{name=p1,param2=n<4 and n or n-4})
   * 	end
   * end */
  lc_newclosuretable(L,(lc42 + lc_nextra));
  enum { lc63 = 15 };
  assert((lua_gettop(L) == (lc63 + lc_nextra)));
  lua_pushvalue(L,(lc63 + lc_nextra));
  lua_pushcclosure(L,lcf1_pile_up,1);
  lua_rawseti(L,(lc63 + lc_nextra),12);
  assert(lua_gettop(L) - lc_nextra == 15);
  
  /* local function slide_off(p,nd)
   * 	if eroded_lut[nd.name] then p.y = p.y-1
   * 	
   * 	local un = minetest.get_node(p).name
   * 	
   * 	if eroded_lut[un] then p.y = p.y+1
   * 		pile_up(eroded_lut[nd.name][1],slopes[eroded_lut[nd.name][2]],p)
   * 	elseif string.sub(un,1,17) == "moreblocks:slope_" then
   * 		local o = get_adjacent_nodes(p,{"air"})
   * 		if o[1] then p.y = p.y+1
   * 			local n = slopes[eroded_lut[nd.name][2]]
   * 			for i=1,#o>n and n or #o do minetest.place_node(o[1],{name="erosion:fall_"..eroding_nodes[eroded_lut[nd.name][1]][2]}) end
   * 			minetest.set_node(p,{name="air"})
   * 		end
   * 	end
   * end end */
  lua_pushvalue(L,(lc63 + lc_nextra));
  lua_pushcclosure(L,lcf1_slide_off,1);
  assert(lua_gettop(L) - lc_nextra == 16);
  
  /* for k,v in pairs(erosion_materials) do
   * internal: local f, s, var = explist */
  enum { lc93 = 16 };
  lua_getfield(L,LUA_ENVIRONINDEX,"pairs");
  lc_getupvalue(L,(lc63 + lc_nextra),5,5);
  lua_call(L,1,3);
  while (1) {
    lc_newclosuretable(L,(lc63 + lc_nextra));
    enum { lc94 = 20 };
    assert((lua_gettop(L) == (lc94 + lc_nextra)));
    
    /* internal: local var_1, ..., var_n = f(s, var)
     *           if var_1 == nil then break end
     *           var = var_1 */
    lua_pushvalue(L,-4);
    lua_pushvalue(L,-4);
    lua_pushvalue(L,-4);
    lua_call(L,2,2);
    if (lua_isnil(L,-2)) {
      break;
    }
    lua_pushvalue(L,-2);
    lua_replace(L,-5);
    
    /* internal: upvalue-enabled local k with id 13
     * internal: local v with idx 21 */
    lua_pushvalue(L,-2);
    lua_rawseti(L,(lc94 + lc_nextra),13);
    lua_remove(L,-2);
    
    /* local drt = eroding_nodes[k][2] == "dirt" */
    lc_getupvalue(L,(lc94 + lc_nextra),8,1);
    lc_getupvalue(L,(lc94 + lc_nextra),0,13);
    lua_gettable(L,-2);
    lua_remove(L,-2);
    lua_pushnumber(L,2);
    lua_gettable(L,-2);
    lua_remove(L,-2);
    lua_pushliteral(L,"dirt");
    const int lc95 = lua_equal(L,-2,-1);
    lua_pop(L,2);
    lua_pushboolean(L,lc95);
    assert(lua_gettop(L) - lc_nextra == 22);
    
    /* v.groups.crumbly,v.groups.falling_node,v.groups.not_in_creative_inventory = 3,1,1 */
    lua_pushnumber(L,3);
    lua_pushnumber(L,1);
    lua_pushnumber(L,1);
    lua_pushliteral(L,"groups");
    lua_gettable(L,(21 + lc_nextra));
    lua_insert(L,-2);
    lua_pushliteral(L,"not_in_creative_inventory");
    lua_insert(L,-2);
    lua_settable(L,-3);
    lua_pop(L,1);
    lua_pushliteral(L,"groups");
    lua_gettable(L,(21 + lc_nextra));
    lua_insert(L,-2);
    lua_pushliteral(L,"falling_node");
    lua_insert(L,-2);
    lua_settable(L,-3);
    lua_pop(L,1);
    lua_pushliteral(L,"groups");
    lua_gettable(L,(21 + lc_nextra));
    lua_insert(L,-2);
    lua_pushliteral(L,"crumbly");
    lua_insert(L,-2);
    lua_settable(L,-3);
    lua_pop(L,1);
    assert(lua_gettop(L) - lc_nextra == 22);
    
    /* if not drt or k == "dirt" then */
    enum { lc96 = 22 };
    lua_pushboolean(L,!(lua_toboolean(L,(22 + lc_nextra))));
    if (!(lua_toboolean(L,-1))) {
      lua_pop(L,1);
      lc_getupvalue(L,(lc94 + lc_nextra),0,13);
      lua_pushliteral(L,"dirt");
      const int lc97 = lua_equal(L,-2,-1);
      lua_pop(L,2);
      lua_pushboolean(L,lc97);
    }
    const int lc98 = lua_toboolean(L,-1);
    lua_pop(L,1);
    if (lc98) {
      
      /* minetest.register_node("erosion:fall_"..k, {
       * 			description = "Loose "..v.description,
       * 			tiles = v.tiles,
       * 			groups = v.groups,
       * 			sounds = v.sounds,
       * 			on_construct = function(pos) pile_up(k,1,pos) end,
       * 		}) */
      lua_getfield(L,LUA_ENVIRONINDEX,"minetest");
      lua_pushliteral(L,"register_node");
      lua_gettable(L,-2);
      lua_remove(L,-2);
      lua_pushliteral(L,"erosion:fall_");
      lc_getupvalue(L,(lc94 + lc_nextra),0,13);
      lua_concat(L,2);
      lua_createtable(L,0,5);
      lua_pushliteral(L,"description");
      lua_pushliteral(L,"Loose ");
      lua_pushliteral(L,"description");
      lua_gettable(L,(21 + lc_nextra));
      lua_concat(L,2);
      lua_rawset(L,-3);
      lua_pushliteral(L,"tiles");
      lua_pushliteral(L,"tiles");
      lua_gettable(L,(21 + lc_nextra));
      lua_rawset(L,-3);
      lua_pushliteral(L,"groups");
      lua_pushliteral(L,"groups");
      lua_gettable(L,(21 + lc_nextra));
      lua_rawset(L,-3);
      lua_pushliteral(L,"sounds");
      lua_pushliteral(L,"sounds");
      lua_gettable(L,(21 + lc_nextra));
      lua_rawset(L,-3);
      lua_pushliteral(L,"on_construct");
      lua_pushvalue(L,(lc94 + lc_nextra));
      lua_pushcclosure(L,lcf99,1);
      lua_rawset(L,-3);
      lua_call(L,2,0);
      assert(lua_gettop(L) - lc_nextra == 22);
      
      /* minetest.register_craft({
       * 			type="shapeless",
       * 			output = "default:"..k,
       * 			recipe = {"erosion:fall_"..k,"erosion:fall_"..k,"erosion:fall_"..k,"erosion:fall_"..k,},
       * 		}) */
      lua_getfield(L,LUA_ENVIRONINDEX,"minetest");
      lua_pushliteral(L,"register_craft");
      lua_gettable(L,-2);
      lua_remove(L,-2);
      lua_createtable(L,0,3);
      lua_pushliteral(L,"type");
      lua_pushliteral(L,"shapeless");
      lua_rawset(L,-3);
      lua_pushliteral(L,"output");
      lua_pushliteral(L,"default:");
      lc_getupvalue(L,(lc94 + lc_nextra),0,13);
      lua_concat(L,2);
      lua_rawset(L,-3);
      lua_pushliteral(L,"recipe");
      lua_createtable(L,4,0);
      lua_pushliteral(L,"erosion:fall_");
      lc_getupvalue(L,(lc94 + lc_nextra),0,13);
      lua_concat(L,2);
      lua_rawseti(L,-2,1);
      lua_pushliteral(L,"erosion:fall_");
      lc_getupvalue(L,(lc94 + lc_nextra),0,13);
      lua_concat(L,2);
      lua_rawseti(L,-2,2);
      lua_pushliteral(L,"erosion:fall_");
      lc_getupvalue(L,(lc94 + lc_nextra),0,13);
      lua_concat(L,2);
      lua_rawseti(L,-2,3);
      lua_pushliteral(L,"erosion:fall_");
      lc_getupvalue(L,(lc94 + lc_nextra),0,13);
      lua_concat(L,2);
      lua_rawseti(L,-2,4);
      lua_rawset(L,-3);
      lua_call(L,1,0);
      assert(lua_gettop(L) - lc_nextra == 22);
    }
    lua_settop(L,(lc96 + lc_nextra));
    assert(lua_gettop(L) - lc_nextra == 22);
    
    /* stairsplus:register_slope("erosion",k,"erosion:"..k,v) */
    lua_getfield(L,LUA_ENVIRONINDEX,"stairsplus");
    lua_pushliteral(L,"register_slope");
    lua_gettable(L,-2);
    lua_insert(L,-2);
    lua_pushliteral(L,"erosion");
    lc_getupvalue(L,(lc94 + lc_nextra),0,13);
    lua_pushliteral(L,"erosion:");
    lc_getupvalue(L,(lc94 + lc_nextra),0,13);
    lua_concat(L,2);
    lua_pushvalue(L,(21 + lc_nextra));
    lua_call(L,5,0);
    assert(lua_gettop(L) - lc_nextra == 22);
    
    /* if drt then */
    enum { lc100 = 22 };
    if (lua_toboolean(L,(22 + lc_nextra))) {
      
      /* minetest.override_item("default:"..k,{groups = {crumbly=3,falling_node=1,soil=1}}) */
      lua_getfield(L,LUA_ENVIRONINDEX,"minetest");
      lua_pushliteral(L,"override_item");
      lua_gettable(L,-2);
      lua_remove(L,-2);
      lua_pushliteral(L,"default:");
      lc_getupvalue(L,(lc94 + lc_nextra),0,13);
      lua_concat(L,2);
      lua_createtable(L,0,1);
      lua_pushliteral(L,"groups");
      lua_createtable(L,0,3);
      lua_pushliteral(L,"crumbly");
      lua_pushnumber(L,3);
      lua_rawset(L,-3);
      lua_pushliteral(L,"falling_node");
      lua_pushnumber(L,1);
      lua_rawset(L,-3);
      lua_pushliteral(L,"soil");
      lua_pushnumber(L,1);
      lua_rawset(L,-3);
      lua_rawset(L,-3);
      lua_call(L,2,0);
      assert(lua_gettop(L) - lc_nextra == 22);
    }
    lua_settop(L,(lc100 + lc_nextra));
    assert(lua_gettop(L) - lc_nextra == 22);
    
    /* for s,d in pairs(slopes) do
     * internal: local f, s, var = explist */
    enum { lc101 = 22 };
    lua_getfield(L,LUA_ENVIRONINDEX,"pairs");
    lc_getupvalue(L,(lc94 + lc_nextra),5,6);
    lua_call(L,1,3);
    while (1) {
      lc_newclosuretable(L,(lc94 + lc_nextra));
      enum { lc102 = 26 };
      assert((lua_gettop(L) == (lc102 + lc_nextra)));
      
      /* internal: local var_1, ..., var_n = f(s, var)
       *           if var_1 == nil then break end
       *           var = var_1 */
      lua_pushvalue(L,-4);
      lua_pushvalue(L,-4);
      lua_pushvalue(L,-4);
      lua_call(L,2,2);
      if (lua_isnil(L,-2)) {
        break;
      }
      lua_pushvalue(L,-2);
      lua_replace(L,-5);
      
      /* internal: upvalue-enabled local d with id 14
       * internal: local s with idx 27 */
      lua_rawseti(L,-3,14);
      
      /* sntbl[#sntbl+1] = "erosion:slope_"..k..s */
      lua_pushliteral(L,"erosion:slope_");
      lc_getupvalue(L,(lc102 + lc_nextra),1,13);
      lua_pushvalue(L,(27 + lc_nextra));
      lua_concat(L,2);
      lua_concat(L,2);
      const double lc103 = lua_objlen(L,(11 + lc_nextra));
      lua_pushnumber(L,lc103);
      lua_pushnumber(L,1);
      lc_add(L,-2,-1);
      lua_remove(L,-2);
      lua_remove(L,-2);
      lua_insert(L,-2);
      lua_settable(L,(11 + lc_nextra));
      assert(lua_gettop(L) - lc_nextra == 27);
      
      /* if d<3 then */
      enum { lc104 = 27 };
      lc_getupvalue(L,(lc102 + lc_nextra),0,14);
      lua_pushnumber(L,3);
      const int lc105 = lua_lessthan(L,-2,-1);
      lua_pop(L,2);
      lua_pushboolean(L,lc105);
      const int lc106 = lua_toboolean(L,-1);
      lua_pop(L,1);
      if (lc106) {
        
        /* snt1[#snt1+1] = "erosion:slope_"..k..s */
        lua_pushliteral(L,"erosion:slope_");
        lc_getupvalue(L,(lc102 + lc_nextra),1,13);
        lua_pushvalue(L,(27 + lc_nextra));
        lua_concat(L,2);
        lua_concat(L,2);
        lc_getupvalue(L,(lc102 + lc_nextra),6,8);
        lua_insert(L,-2);
        lc_getupvalue(L,(lc102 + lc_nextra),6,8);
        const double lc107 = lua_objlen(L,-1);
        lua_pop(L,1);
        lua_pushnumber(L,lc107);
        lua_pushnumber(L,1);
        lc_add(L,-2,-1);
        lua_remove(L,-2);
        lua_remove(L,-2);
        lua_insert(L,-2);
        lua_settable(L,-3);
        lua_pop(L,1);
        assert(lua_gettop(L) - lc_nextra == 27);
      }
      else {
        
        /* else
         * snt2[#snt2+1] = "erosion:slope_"..k..s */
        lua_pushliteral(L,"erosion:slope_");
        lc_getupvalue(L,(lc102 + lc_nextra),1,13);
        lua_pushvalue(L,(27 + lc_nextra));
        lua_concat(L,2);
        lua_concat(L,2);
        lc_getupvalue(L,(lc102 + lc_nextra),6,7);
        lua_insert(L,-2);
        lc_getupvalue(L,(lc102 + lc_nextra),6,7);
        const double lc108 = lua_objlen(L,-1);
        lua_pop(L,1);
        lua_pushnumber(L,lc108);
        lua_pushnumber(L,1);
        lc_add(L,-2,-1);
        lua_remove(L,-2);
        lua_remove(L,-2);
        lua_insert(L,-2);
        lua_settable(L,-3);
        lua_pop(L,1);
        assert(lua_gettop(L) - lc_nextra == 27);
      }
      lua_settop(L,(lc104 + lc_nextra));
      assert(lua_gettop(L) - lc_nextra == 27);
      
      /* minetest.override_item("erosion:slope_"..k..s,
       * 			{drop = "erosion:fall_"..(not drt and k or "dirt").." "..d,
       * 			on_construct = function(pos) pile_up(k,d,pos) end
       * 		}) */
      lua_getfield(L,LUA_ENVIRONINDEX,"minetest");
      lua_pushliteral(L,"override_item");
      lua_gettable(L,-2);
      lua_remove(L,-2);
      lua_pushliteral(L,"erosion:slope_");
      lc_getupvalue(L,(lc102 + lc_nextra),1,13);
      lua_pushvalue(L,(27 + lc_nextra));
      lua_concat(L,2);
      lua_concat(L,2);
      lua_createtable(L,0,2);
      lua_pushliteral(L,"drop");
      lua_pushliteral(L,"erosion:fall_");
      lua_pushboolean(L,!(lua_toboolean(L,(22 + lc_nextra))));
      if (lua_toboolean(L,-1)) {
        lua_pop(L,1);
        lc_getupvalue(L,(lc102 + lc_nextra),1,13);
      }
      if (!(lua_toboolean(L,-1))) {
        lua_pop(L,1);
        lua_pushliteral(L,"dirt");
      }
      lua_pushliteral(L," ");
      lc_getupvalue(L,(lc102 + lc_nextra),0,14);
      lua_concat(L,2);
      lua_concat(L,2);
      lua_concat(L,2);
      lua_rawset(L,-3);
      lua_pushliteral(L,"on_construct");
      lua_pushvalue(L,(lc102 + lc_nextra));
      lua_pushcclosure(L,lcf109,1);
      lua_rawset(L,-3);
      lua_call(L,2,0);
      assert(lua_gettop(L) - lc_nextra == 27);
      
      /* internal: stack cleanup on scope exit */
      lua_pop(L,2);
    }
    lua_settop(L,(lc101 + lc_nextra));
    assert(lua_gettop(L) - lc_nextra == 22);
    
    /* internal: stack cleanup on scope exit */
    lua_pop(L,3);
  }
  lua_settop(L,(lc93 + lc_nextra));
  assert(lua_gettop(L) - lc_nextra == 16);
  
  /* stairsplus:register_slope("moreblocks","ice","moreblocks:ice",{
   * 	description = "Ice",
   * 	tiles = {"default_ice.png"},
   * 	is_ground_content = false,
   * 	paramtype = "light",
   * 	groups = {cracky = 3, puts_out_fire = 1},
   * 	sounds = default.node_sound_glass_defaults(),
   * }) */
  lua_getfield(L,LUA_ENVIRONINDEX,"stairsplus");
  lua_pushliteral(L,"register_slope");
  lua_gettable(L,-2);
  lua_insert(L,-2);
  lua_pushliteral(L,"moreblocks");
  lua_pushliteral(L,"ice");
  lua_pushliteral(L,"moreblocks:ice");
  lua_createtable(L,0,6);
  lua_pushliteral(L,"description");
  lua_pushliteral(L,"Ice");
  lua_rawset(L,-3);
  lua_pushliteral(L,"tiles");
  lua_createtable(L,1,0);
  lua_pushliteral(L,"default_ice.png");
  lua_rawseti(L,-2,1);
  lua_rawset(L,-3);
  lua_pushliteral(L,"is_ground_content");
  lua_pushboolean(L,0);
  lua_rawset(L,-3);
  lua_pushliteral(L,"paramtype");
  lua_pushliteral(L,"light");
  lua_rawset(L,-3);
  lua_pushliteral(L,"groups");
  lua_createtable(L,0,2);
  lua_pushliteral(L,"cracky");
  lua_pushnumber(L,3);
  lua_rawset(L,-3);
  lua_pushliteral(L,"puts_out_fire");
  lua_pushnumber(L,1);
  lua_rawset(L,-3);
  lua_rawset(L,-3);
  lua_pushliteral(L,"sounds");
  lua_getfield(L,LUA_ENVIRONINDEX,"default");
  lua_pushliteral(L,"node_sound_glass_defaults");
  lua_gettable(L,-2);
  lua_remove(L,-2);
  lua_call(L,0,1);
  lua_rawset(L,-3);
  lua_call(L,5,0);
  assert(lua_gettop(L) - lc_nextra == 16);
  
  /* function erosionCL(p,node) if not eroding_lut[node.name] then return end
   * 	local rmnn,flmt = eroding_nodes[eroding_lut[node.name]][1].."slope_"..eroding_lut[node.name],
   * 		"erosion:fall_"..eroding_nodes[eroding_lut[node.name]][2]
   * 	local xpsr,nvtbl = get_adjacent_nodes(p,{"air"})
   * 	if xpsr[1] then
   * 		local xr,zr = 0,0
   * 		if nvtbl[p.x] and nvtbl[p.x][p.z-1] then xr = 5
   * 			minetest.place_node({x=p.x,y=p.y,z=p.z-1},{name=flmt})
   * 		elseif nvtbl[p.x] and nvtbl[p.x][p.z+1] then xr = 3
   * 			minetest.place_node({x=p.x,y=p.y,z=p.z+1},{name=flmt})
   * 		end
   * 		if nvtbl[p.x-1] and nvtbl[p.x-1][p.z] then zr = 6
   * 			minetest.place_node({x=p.x-1,y=p.y,z=p.z},{name=flmt})
   * 		elseif nvtbl[p.x+1] and nvtbl[p.x+1][p.z] then zr = 4
   * 			minetest.place_node({x=p.x+1,y=p.y,z=p.z},{name=flmt})
   * 		end
   * 		if xr+zr < 1 then xr,zr = p.x-xpsr[1].x,p.z-xpsr[1].z+15
   * 			minetest.place_node(xpsr[1],{name=flmt})
   * 		end
   * 		if xr+zr < 7 then minetest.swap_node(p,{name=rmnn.."_half_raised",param2=math.mod(xr+zr-1,4)})
   * 		elseif xr+zr < 13 then minetest.swap_node(p,{name=rmnn.."_cut",param2=math.mod(xr>4 and zr/2-2 or 5-zr/2,4)})
   * 		else minetest.swap_node(p,{name=rmnn.."_inner_cut_half_raised",param2=math.mod(xr>0 and 9-zr/2 or zr/2,4)}) end
   * 	end
   * end */
  lua_pushvalue(L,(lc63 + lc_nextra));
  lua_pushcclosure(L,lcf1_erosionCL,1);
  lua_setfield(L,LUA_ENVIRONINDEX,"erosionCL");
  assert(lua_gettop(L) - lc_nextra == 16);
  
  /* local dpstn,cube3,box = {},{},{} */
  lc_newclosuretable(L,(lc63 + lc_nextra));
  enum { lc133 = 17 };
  assert((lua_gettop(L) == (lc133 + lc_nextra)));
  lua_newtable(L);
  lua_newtable(L);
  lua_newtable(L);
  lua_rawseti(L,(lc133 + lc_nextra),15);
  lua_rawseti(L,(lc133 + lc_nextra),16);
  lua_rawseti(L,(lc133 + lc_nextra),17);
  assert(lua_gettop(L) - lc_nextra == 17);
  
  /* for x=-1,1 do */
  lua_pushnumber(L,-1);
  lua_pushnumber(L,1);
  if (!((lua_isnumber(L,-2) && lua_isnumber(L,-1)))) {
    luaL_error(L,"'for' limit must be a number");
  }
  double lc134_var = lua_tonumber(L,-2);
  const double lc135_limit = lua_tonumber(L,-1);
  const double lc136_step = 1;
  lua_pop(L,2);
  enum { lc137 = 17 };
  while ((((lc136_step > 0) && (lc134_var <= lc135_limit)) || ((lc136_step <= 0) && (lc134_var >= lc135_limit)))) {
    
    /* internal: local x at index 18 */
    lua_pushnumber(L,lc134_var);
    
    /* cube3[x]={} */
    lua_newtable(L);
    lc_getupvalue(L,(lc133 + lc_nextra),0,16);
    lua_insert(L,-2);
    lua_pushvalue(L,(18 + lc_nextra));
    lua_insert(L,-2);
    lua_settable(L,-3);
    lua_pop(L,1);
    assert(lua_gettop(L) - lc_nextra == 18);
    
    /* for y=-1,1 do */
    lua_pushnumber(L,-1);
    lua_pushnumber(L,1);
    if (!((lua_isnumber(L,-2) && lua_isnumber(L,-1)))) {
      luaL_error(L,"'for' limit must be a number");
    }
    double lc138_var = lua_tonumber(L,-2);
    const double lc139_limit = lua_tonumber(L,-1);
    const double lc140_step = 1;
    lua_pop(L,2);
    enum { lc141 = 18 };
    while ((((lc140_step > 0) && (lc138_var <= lc139_limit)) || ((lc140_step <= 0) && (lc138_var >= lc139_limit)))) {
      
      /* internal: local y at index 19 */
      lua_pushnumber(L,lc138_var);
      
      /* cube3[x][y]={} */
      lua_newtable(L);
      lc_getupvalue(L,(lc133 + lc_nextra),0,16);
      lua_pushvalue(L,(18 + lc_nextra));
      lua_gettable(L,-2);
      lua_remove(L,-2);
      lua_insert(L,-2);
      lua_pushvalue(L,(19 + lc_nextra));
      lua_insert(L,-2);
      lua_settable(L,-3);
      lua_pop(L,1);
      assert(lua_gettop(L) - lc_nextra == 19);
      
      /* internal: stack cleanup on scope exit */
      lua_pop(L,1);
      lc138_var += lc140_step;
    }
    lua_settop(L,(lc141 + lc_nextra));
    assert(lua_gettop(L) - lc_nextra == 18);
    
    /* internal: stack cleanup on scope exit */
    lua_pop(L,1);
    lc134_var += lc136_step;
  }
  lua_settop(L,(lc137 + lc_nextra));
  assert(lua_gettop(L) - lc_nextra == 17);
  
  /* for k,v in pairs(eroding_nodes) do
   * internal: local f, s, var = explist */
  enum { lc142 = 17 };
  lua_getfield(L,LUA_ENVIRONINDEX,"pairs");
  lc_getupvalue(L,(lc133 + lc_nextra),8,1);
  lua_call(L,1,3);
  while (1) {
    
    /* internal: local var_1, ..., var_n = f(s, var)
     *           if var_1 == nil then break end
     *           var = var_1 */
    lua_pushvalue(L,-3);
    lua_pushvalue(L,-3);
    lua_pushvalue(L,-3);
    lua_call(L,2,2);
    if (lua_isnil(L,-2)) {
      break;
    }
    lua_pushvalue(L,-2);
    lua_replace(L,-4);
    
    /* internal: local k with idx 21
     * internal: local v with idx 22 */
    
    
    /* dpstn[k] = minetest.get_content_id("default:"..k) */
    lua_getfield(L,LUA_ENVIRONINDEX,"minetest");
    lua_pushliteral(L,"get_content_id");
    lua_gettable(L,-2);
    lua_remove(L,-2);
    lua_pushliteral(L,"default:");
    lua_pushvalue(L,(21 + lc_nextra));
    lua_concat(L,2);
    lua_call(L,1,1);
    lc_getupvalue(L,(lc133 + lc_nextra),0,17);
    lua_insert(L,-2);
    lua_pushvalue(L,(21 + lc_nextra));
    lua_insert(L,-2);
    lua_settable(L,-3);
    lua_pop(L,1);
    assert(lua_gettop(L) - lc_nextra == 22);
    
    /* for s,_ in pairs(slopes) do
     * internal: local f, s, var = explist */
    enum { lc143 = 22 };
    lua_getfield(L,LUA_ENVIRONINDEX,"pairs");
    lc_getupvalue(L,(lc133 + lc_nextra),5,6);
    lua_call(L,1,3);
    while (1) {
      
      /* internal: local var_1, ..., var_n = f(s, var)
       *           if var_1 == nil then break end
       *           var = var_1 */
      lua_pushvalue(L,-3);
      lua_pushvalue(L,-3);
      lua_pushvalue(L,-3);
      lua_call(L,2,2);
      if (lua_isnil(L,-2)) {
        break;
      }
      lua_pushvalue(L,-2);
      lua_replace(L,-4);
      
      /* internal: local s with idx 26
       * internal: local _ with idx 27 */
      
      
      /* dpstn["slp_"..k..s] = minetest.get_content_id(eroding_nodes[k][1].."slope_"..k..s) */
      lua_getfield(L,LUA_ENVIRONINDEX,"minetest");
      lua_pushliteral(L,"get_content_id");
      lua_gettable(L,-2);
      lua_remove(L,-2);
      lc_getupvalue(L,(lc133 + lc_nextra),8,1);
      lua_pushvalue(L,(21 + lc_nextra));
      lua_gettable(L,-2);
      lua_remove(L,-2);
      lua_pushnumber(L,1);
      lua_gettable(L,-2);
      lua_remove(L,-2);
      lua_pushliteral(L,"slope_");
      lua_pushvalue(L,(21 + lc_nextra));
      lua_pushvalue(L,(26 + lc_nextra));
      lua_concat(L,2);
      lua_concat(L,2);
      lua_concat(L,2);
      lua_call(L,1,1);
      lc_getupvalue(L,(lc133 + lc_nextra),0,17);
      lua_insert(L,-2);
      lua_pushliteral(L,"slp_");
      lua_pushvalue(L,(21 + lc_nextra));
      lua_pushvalue(L,(26 + lc_nextra));
      lua_concat(L,2);
      lua_concat(L,2);
      lua_insert(L,-2);
      lua_settable(L,-3);
      lua_pop(L,1);
      assert(lua_gettop(L) - lc_nextra == 27);
      
      /* internal: stack cleanup on scope exit */
      lua_pop(L,2);
    }
    lua_settop(L,(lc143 + lc_nextra));
    assert(lua_gettop(L) - lc_nextra == 22);
    
    /* internal: stack cleanup on scope exit */
    lua_pop(L,2);
  }
  lua_settop(L,(lc142 + lc_nextra));
  assert(lua_gettop(L) - lc_nextra == 17);
  
  /* dpstn.air = minetest.get_content_id("air") */
  lua_getfield(L,LUA_ENVIRONINDEX,"minetest");
  lua_pushliteral(L,"get_content_id");
  lua_gettable(L,-2);
  lua_remove(L,-2);
  lua_pushliteral(L,"air");
  lua_call(L,1,1);
  lc_getupvalue(L,(lc133 + lc_nextra),0,17);
  lua_insert(L,-2);
  lua_pushliteral(L,"air");
  lua_insert(L,-2);
  lua_settable(L,-3);
  lua_pop(L,1);
  assert(lua_gettop(L) - lc_nextra == 17);
  
  /* local function place_slope(vpos,m)
   * 	if data == nil or prm2 == nil then
   * 		return
   * 	end
   * 
   * 	box.w = data[vpos+cube3[-1][0][0]] == dpstn[m]
   * 	box.e = data[vpos+cube3[1][0][0]] == dpstn[m]
   * 	box.d = data[vpos+cube3[0][-1][0]] == dpstn[m]
   * 	box.u = data[vpos+cube3[0][1][0]] == dpstn[m]
   * 	box.s = data[vpos+cube3[0][0][-1]] == dpstn[m]
   * 	box.n = data[vpos+cube3[0][0][1]] == dpstn[m]
   * 	
   * 	if box.w or	box.e or box.d or box.u or box.s or box.n then
   * 		box.t = (box.w and 1 or 0)+(box.e and 1 or 0)+(box.d and 1 or 0)+(box.u and 1 or 0)+(box.s and 1 or 0)+(box.n and 1 or 0)
   * 		if box.t == 2 then
   * 			box.f = box.d and box.n and 10
   * 			or box.d and box.e and 1
   * 			or box.d and box.s and 2
   * 			or box.d and box.w and 13
   * 			or box.u and box.n and 20
   * 			or box.u and box.w and 21
   * 			or box.u and box.s and 6
   * 			or box.u and box.e and 17
   * 			or box.e and box.s and 18
   * 			or box.w and box.s and 7
   * 			or box.e and box.n and 9
   * 			or box.w and box.n and 12
   * 			if box.f then
   * 				data[vpos],prm2[vpos] = dpstn["slp_"..m],box.f
   * 				
   * 				if not box.e and data[vpos+cube3[-1][0][0]] == dpstn.air
   * 				and data[vpos+cube3[-1][box.u and 1 or box.d and -1 or 0][box.n and 1 or box.s and -1 or 0]] == dpstn[m]
   * 				and math.mod(vpos,cube3[0][0][1])~=1 then
   * 					data[vpos+cube3[-1][0][0]],prm2[vpos+cube3[-1][0][0]] = dpstn["slp_"..m.."_outer_cut"],box.f
   * 				end
   * 				
   * 				if not box.u and data[vpos+cube3[0][-1][0]] == dpstn.air
   * 				and data[vpos+cube3[box.e and 1 or box.w and -1 or 0][-1][box.n and 1 or box.s and -1 or 0]] == dpstn[m]
   * 				and vpos>cube3[0][1][0] then
   * 					data[vpos+cube3[0][-1][0]],prm2[vpos+cube3[0][-1][0]] = dpstn["slp_"..m.."_outer_cut"],box.f
   * 				end
   * 				
   * 				if not box.n and data[vpos+cube3[0][0][-1]] == dpstn.air
   * 				and data[vpos+cube3[box.e and 1 or box.w and -1 or 0][box.u and 1 or box.d and -1 or 0][-1]] == dpstn[m]
   * 				and math.mod(vpos,cube3[0][1][0])~=cube3[0][0][1] then
   * 					data[vpos+cube3[0][0][-1]],prm2[vpos+cube3[0][0][-1]] = dpstn["slp_"..m.."_outer_cut"],box.f
   * 				end
   * 			end
   * 		elseif box.t == 3 then
   * 			box.f = box.d and box.n and box.w and 0
   * 			or box.d and box.e and box.n and 1
   * 			or box.d and box.s and box.e and 2
   * 			or box.d and box.w and box.s and 3
   * 			or box.u and box.n and box.e and 20
   * 			or box.u and box.w and box.n and 21
   * 			or box.u and box.s and box.w and 22
   * 			or box.u and box.e and box.s and 23
   * 			
   * 			if box.f then
   * 				data[vpos],prm2[vpos] = dpstn["slp_"..m.."_inner_cut"],box.f
   * 				
   * 				if box.e and data[vpos+cube3[-1][0][0]] == dpstn.air
   * 				and data[vpos+cube3[-1][box.u and 1 or box.d and -1 or 0][box.n and 1 or box.s and -1 or 0]] == dpstn[m]
   * 				and math.mod(vpos,cube3[0][0][1])~=1 then
   * 					data[vpos+cube3[-1][0][0]],prm2[vpos+cube3[-1][0][0]] = dpstn["slp_"..m.."_outer_cut"],box.f
   * 				end
   * 				
   * 				if box.u and data[vpos+cube3[0][-1][0]] == dpstn.air and vpos>cube3[0][1][0] then
   * 					data[vpos+cube3[0][-1][0]],prm2[vpos+cube3[0][-1][0]] = dpstn["slp_"..m.."_outer_cut"],box.f
   * 				end
   * 				
   * 				if box.n and data[vpos+cube3[0][0][-1]] == dpstn.air
   * 				and data[vpos+cube3[box.e and 1 or box.w and -1 or 0][box.u and 1 or box.d and -1 or 0][-1]] == dpstn[m]
   * 				and math.mod(vpos,cube3[0][1][0])~=cube3[0][0][1] then
   * 					data[vpos+cube3[0][0][-1]],prm2[vpos+cube3[0][0][-1]] = dpstn["slp_"..m.."_outer_cut"],box.f
   * 				end
   * 			end
   * 		end
   * 	end
   * end */
  lc_newclosuretable(L,(lc133 + lc_nextra));
  enum { lc144 = 18 };
  assert((lua_gettop(L) == (lc144 + lc_nextra)));
  lua_pushvalue(L,(lc144 + lc_nextra));
  lua_pushcclosure(L,lcf1_place_slope,1);
  lua_rawseti(L,(lc144 + lc_nextra),18);
  assert(lua_gettop(L) - lc_nextra == 18);
  
  /* minetest.register_on_generated(function(minp, maxp)
   * 	minetest.log("action", "erosion:on_generated")
   * 	
   * 	collectgarbage("collect")
   * 
   * 	if minp.y > 256 then
   * 		return
   * 	end
   * 	
   * 	local vm, emin, emax = minetest.get_mapgen_object("voxelmanip")
   * 	local data,prm2 = vm:get_data(),vm:get_param2_data()
   * 	local vxa = VoxelArea:new{MinEdge=emin, MaxEdge=emax}
   * 	
   * 	for x=-1,1 do 
   * 		for y=-1,1 do
   * 			for z=-1,1 do
   * 				cube3[x][y][z]=x+y*vxa.ystride+z*vxa.zstride
   * 			end
   * 		end
   * 	end
   * 	
   * 	for vpos=vxa:index(minp.x,minp.y,minp.z),vxa:index(maxp.x,maxp.y,maxp.z) do
   * 		 if data[vpos] == dpstn.air then
   * 			for i=1,#gen_nodes do 
   * 				place_slope(data,prm2,vpos,gen_nodes[i])
   * 			end
   * 		end
   * 	end
   * 	
   * 	if maxp.y > 2 then
   * 		local heightmap,hndx,vpos = minetest.get_mapgen_object("heightmap"),1
   * 		
   * 		if heightmap ~= nil then
   * 		
   * 			for z=minp.z,maxp.z do
   * 				for x=minp.x,maxp.x do
   * 					vpos = vxa:index(x,heightmap[hndx]+1,z)
   * 					
   * 					if data[vpos] == dpstn.air then 
   * 						for k,_ in pairs(eroding_nodes) do 
   * 							place_slope(data,prm2,vpos,k)
   * 						end
   * 					end
   * 					
   * 					hndx = hndx+1
   * 				end
   * 			end
   * 		end
   * 	end
   * 	vm:set_data(data)
   * 	vm:set_param2_data(prm2)
   * 	vm:calc_lighting()
   * 	vm:write_to_map(data)
   * end) */
  lua_getfield(L,LUA_ENVIRONINDEX,"minetest");
  lua_pushliteral(L,"register_on_generated");
  lua_gettable(L,-2);
  lua_remove(L,-2);
  lua_pushvalue(L,(lc144 + lc_nextra));
  lua_pushcclosure(L,lcf241,1);
  lua_call(L,1,0);
  assert(lua_gettop(L) - lc_nextra == 18);
  
  /* local function wwthrngCL(p,n) p.y = p.y+1
   * 	local k = minetest.get_node(p).name
   * 	
   * 	if k == "air" then
   * 		p.y = p.y-1
   * 		erosionCL(p,n)
   * 	end
   * end */
  lua_pushcfunction(L,lcf1_wwthrngCL);
  assert(lua_gettop(L) - lc_nextra == 19);
  
  /* minetest.register_abm({
   * 	nodenames = nntbl,
   * 	neighbors = {"air"},
   * 	interval = 370,
   * 	chance = 9,
   * 	action = wwthrngCL,
   * }) */
  lua_getfield(L,LUA_ENVIRONINDEX,"minetest");
  lua_pushliteral(L,"register_abm");
  lua_gettable(L,-2);
  lua_remove(L,-2);
  lua_createtable(L,0,5);
  lua_pushliteral(L,"nodenames");
  lua_pushvalue(L,(6 + lc_nextra));
  lua_rawset(L,-3);
  lua_pushliteral(L,"neighbors");
  lua_createtable(L,1,0);
  lua_pushliteral(L,"air");
  lua_rawseti(L,-2,1);
  lua_rawset(L,-3);
  lua_pushliteral(L,"interval");
  lua_pushnumber(L,370);
  lua_rawset(L,-3);
  lua_pushliteral(L,"chance");
  lua_pushnumber(L,9);
  lua_rawset(L,-3);
  lua_pushliteral(L,"action");
  lua_pushvalue(L,(19 + lc_nextra));
  lua_rawset(L,-3);
  lua_call(L,1,0);
  assert(lua_gettop(L) - lc_nextra == 19);
  
  /* minetest.register_abm({
   * 	nodenames = lntbl,
   * 	neighbors = {"air"},
   * 	interval = 170,
   * 	chance = 7,
   * 	action = wwthrngCL,
   * }) */
  lua_getfield(L,LUA_ENVIRONINDEX,"minetest");
  lua_pushliteral(L,"register_abm");
  lua_gettable(L,-2);
  lua_remove(L,-2);
  lua_createtable(L,0,5);
  lua_pushliteral(L,"nodenames");
  lua_pushvalue(L,(9 + lc_nextra));
  lua_rawset(L,-3);
  lua_pushliteral(L,"neighbors");
  lua_createtable(L,1,0);
  lua_pushliteral(L,"air");
  lua_rawseti(L,-2,1);
  lua_rawset(L,-3);
  lua_pushliteral(L,"interval");
  lua_pushnumber(L,170);
  lua_rawset(L,-3);
  lua_pushliteral(L,"chance");
  lua_pushnumber(L,7);
  lua_rawset(L,-3);
  lua_pushliteral(L,"action");
  lua_pushvalue(L,(19 + lc_nextra));
  lua_rawset(L,-3);
  lua_call(L,1,0);
  assert(lua_gettop(L) - lc_nextra == 19);
  
  /* minetest.register_abm({
   * 	nodenames = sntbl,
   * 	neighbors = {"air"},
   * 	interval = 70,
   * 	chance = 3,
   * 	action = slide_off,
   * }) */
  lua_getfield(L,LUA_ENVIRONINDEX,"minetest");
  lua_pushliteral(L,"register_abm");
  lua_gettable(L,-2);
  lua_remove(L,-2);
  lua_createtable(L,0,5);
  lua_pushliteral(L,"nodenames");
  lua_pushvalue(L,(11 + lc_nextra));
  lua_rawset(L,-3);
  lua_pushliteral(L,"neighbors");
  lua_createtable(L,1,0);
  lua_pushliteral(L,"air");
  lua_rawseti(L,-2,1);
  lua_rawset(L,-3);
  lua_pushliteral(L,"interval");
  lua_pushnumber(L,70);
  lua_rawset(L,-3);
  lua_pushliteral(L,"chance");
  lua_pushnumber(L,3);
  lua_rawset(L,-3);
  lua_pushliteral(L,"action");
  lua_pushvalue(L,(16 + lc_nextra));
  lua_rawset(L,-3);
  lua_call(L,1,0);
  assert(lua_gettop(L) - lc_nextra == 19);
  
  /* minetest.register_on_punchnode(wwthrngCL) */
  lua_getfield(L,LUA_ENVIRONINDEX,"minetest");
  lua_pushliteral(L,"register_on_punchnode");
  lua_gettable(L,-2);
  lua_remove(L,-2);
  lua_pushvalue(L,(19 + lc_nextra));
  lua_call(L,1,0);
  assert(lua_gettop(L) - lc_nextra == 19);
  return 0;
}


/* from lua.c */
static int traceback (lua_State *L) {
  if (!lua_isstring(L, 1))  /* 'message' not a string? */
    return 1;  /* keep it intact */
  lua_getfield(L, LUA_GLOBALSINDEX, "debug");
  if (!lua_istable(L, -1)) {
    lua_pop(L, 1);
    return 1;
  }
  lua_getfield(L, -1, "traceback");
  if (!lua_isfunction(L, -1)) {
    lua_pop(L, 2);
    return 1;
  }
  lua_pushvalue(L, 1);  /* pass error message */
  lua_pushinteger(L, 2);  /* skip this function and traceback */
  lua_call(L, 2, 1);  /* call debug.traceback */
  return 1;
}


static void lc_l_message (const char *pname, const char *msg) {
  if (pname) fprintf(stderr, "%s: ", pname);
  fprintf(stderr, "%s\n", msg);
  fflush(stderr);
}

static int lc_report (lua_State *L, int status) {
  if (status && !lua_isnil(L, -1)) {
    const char *msg = lua_tostring(L, -1);
    if (msg == NULL) msg = "(error object is not a string)";
    /*FIX-IMROVE:progname*/
    lc_l_message("lua", msg);
    lua_pop(L, 1);
  }
  return status;
}

static int lc_docall (lua_State *L, int narg, int clear) {
  int status;
  int base = lua_gettop(L) - narg;  /* function index */
  lua_pushcfunction(L, traceback);  /* push traceback function */
  lua_insert(L, base);  /* put it under chunk and args */
  /*FIX? signal(SIGINT, laction); */
  status = lua_pcall(L, narg, (clear ? 0 : LUA_MULTRET), base);
  /*FIX? signal(SIGINT, SIG_DFL); */
  lua_remove(L, base);  /* remove traceback function */
  /* force a complete garbage collection in case of errors */
  if (status != 0) lua_gc(L, LUA_GCCOLLECT, 0);
  return status;
}

static int lc_dofile (lua_State *L, const char *name) {
  int status = luaL_loadfile(L, name) || lc_docall(L, 0, 1);
  return lc_report(L, status);
}

static int lc_dostring (lua_State *L, const char *s, const char *name) {
  int status = luaL_loadbuffer(L, s, strlen(s), name) || lc_docall(L, 0, 1);
  return lc_report(L, status);
}

static int lc_handle_luainit (lua_State *L) {
  const char *init = getenv(LUA_INIT);
  if (init == NULL) return 0;  /* status OK */
  else if (init[0] == '@')
    return lc_dofile(L, init+1);
  else
    return lc_dostring(L, init, "=" LUA_INIT);
}


typedef struct {
  int c;
  const char ** v;
} lc_args_t;


/* create global arg table */
static void lc_createarg(lua_State * L, const lc_args_t * const args) {
  int i;
  lua_newtable(L);
  for (i=0; i < args->c; i++) {
    lua_pushstring(L, args->v[i]);
    lua_rawseti(L, -2, i);
  }
  lua_setglobal(L, "arg");
}


int lc_pmain_mod_erosion(lua_State * L) {
  luaL_openlibs(L);

  //const lc_args_t * const args = (lc_args_t*)lua_touserdata(L, 1);
  //lc_createarg(L, args);

  lua_pushcfunction(L, traceback);

  const int status1 = lc_handle_luainit(L);
  if (status1 != 0) return 0;

  /* note: IMPROVE: closure not always needed here */
  lua_newtable(L); /* closure table */
  lua_pushcclosure(L, lcf_main, 1);
  //int i;
  //for (i=1; i < args->c; i++) {
  //  lua_pushstring(L, args->v[i]);
  //}
  int status2 = lua_pcall(L, 0, 0, -2);//args->c-1, 0, -2);
  if (status2 != 0) {
    const char * msg = lua_tostring(L,-1);
    if (msg == NULL) msg = "(error object is not a string)";
    fputs(msg, stderr);
  }
  return 0;
}

/*
int main(int argc, const char ** argv) {
  lc_args_t args = {argc, argv};
  lua_State * L = luaL_newstate();
  if (! L) { fputs("Failed creating Lua state.", stderr); exit(1); }

  int status = lua_cpcall(L, lc_pmain, &args);
  if (status != 0) {
    fputs(lua_tostring(L,-1), stderr);
  }

  lua_close(L);
  return 0;
}
*/

