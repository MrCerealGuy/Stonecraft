/* WARNING: This file was automatically generated by lua2c. */

#ifdef __cplusplus
extern "C" {
#endif
#include <lua.h>
#include <lauxlib.h>
#include <lualib.h>
#ifdef __cplusplus
}
#endif
#include <stdio.h>
#include <stdlib.h>


#include <string.h>


#include <assert.h>

/* function(pos, placer) */
static int lcf3 (lua_State * L) {
  enum { lc_nformalargs = 2 };
  lua_settop(L,2);
  
  /* if placer:is_player() then */
  enum { lc1 = 2 };
  lua_pushvalue(L,2);
  lua_pushliteral(L,"is_player");
  lua_gettable(L,-2);
  lua_insert(L,-2);
  lua_call(L,1,1);
  const int lc2 = lua_toboolean(L,-1);
  lua_pop(L,1);
  if (lc2) {
    
    /* minetest.set_node(pos, {name = "ethereal:banana", param2 = 1}) */
    lua_getfield(L,LUA_ENVIRONINDEX,"minetest");
    lua_pushliteral(L,"set_node");
    lua_gettable(L,-2);
    lua_remove(L,-2);
    lua_pushvalue(L,1);
    lua_createtable(L,0,2);
    lua_pushliteral(L,"name");
    lua_pushliteral(L,"ethereal:banana");
    lua_rawset(L,-3);
    lua_pushliteral(L,"param2");
    lua_pushnumber(L,1);
    lua_rawset(L,-3);
    lua_call(L,2,0);
    assert(lua_gettop(L) == 2);
  }
  lua_settop(L,lc1);
  assert(lua_gettop(L) == 2);
  return 0;
}


/* function(pos, placer) */
static int lcf6 (lua_State * L) {
  enum { lc_nformalargs = 2 };
  lua_settop(L,2);
  
  /* if placer:is_player() then */
  enum { lc4 = 2 };
  lua_pushvalue(L,2);
  lua_pushliteral(L,"is_player");
  lua_gettable(L,-2);
  lua_insert(L,-2);
  lua_call(L,1,1);
  const int lc5 = lua_toboolean(L,-1);
  lua_pop(L,1);
  if (lc5) {
    
    /* minetest.set_node(pos, {name = "ethereal:orange", param2 = 1}) */
    lua_getfield(L,LUA_ENVIRONINDEX,"minetest");
    lua_pushliteral(L,"set_node");
    lua_gettable(L,-2);
    lua_remove(L,-2);
    lua_pushvalue(L,1);
    lua_createtable(L,0,2);
    lua_pushliteral(L,"name");
    lua_pushliteral(L,"ethereal:orange");
    lua_rawset(L,-3);
    lua_pushliteral(L,"param2");
    lua_pushnumber(L,1);
    lua_rawset(L,-3);
    lua_call(L,2,0);
    assert(lua_gettop(L) == 2);
  }
  lua_settop(L,lc4);
  assert(lua_gettop(L) == 2);
  return 0;
}


/* function(pos, placer, itemstack) */
static int lcf9 (lua_State * L) {
  enum { lc_nformalargs = 3 };
  lua_settop(L,3);
  
  /* if placer:is_player() then */
  enum { lc7 = 3 };
  lua_pushvalue(L,2);
  lua_pushliteral(L,"is_player");
  lua_gettable(L,-2);
  lua_insert(L,-2);
  lua_call(L,1,1);
  const int lc8 = lua_toboolean(L,-1);
  lua_pop(L,1);
  if (lc8) {
    
    /* minetest.set_node(pos, {name = "ethereal:golden_apple", param2 = 1}) */
    lua_getfield(L,LUA_ENVIRONINDEX,"minetest");
    lua_pushliteral(L,"set_node");
    lua_gettable(L,-2);
    lua_remove(L,-2);
    lua_pushvalue(L,1);
    lua_createtable(L,0,2);
    lua_pushliteral(L,"name");
    lua_pushliteral(L,"ethereal:golden_apple");
    lua_rawset(L,-3);
    lua_pushliteral(L,"param2");
    lua_pushnumber(L,1);
    lua_rawset(L,-3);
    lua_call(L,2,0);
    assert(lua_gettop(L) == 3);
  }
  lua_settop(L,lc7);
  assert(lua_gettop(L) == 3);
  return 0;
}


/* name: (main)
 * function(...) */
static int lcf_main (lua_State * L) {
  enum { lc_nformalargs = 0 };
  const int lc_nactualargs = lua_gettop(L);
  const int lc_nextra = (lc_nactualargs - lc_nformalargs);
  
  /* local S = ethereal.intllib */
  lua_getfield(L,LUA_ENVIRONINDEX,"ethereal");
  lua_pushliteral(L,"intllib");
  lua_gettable(L,-2);
  lua_remove(L,-2);
  assert(lua_gettop(L) - lc_nextra == 1);
  
  /* -- fix apples hanging in sky when no tree around
   * minetest.override_item("default:apple", {
   * 	drop = "default:apple",
   * }) */
  lua_getfield(L,LUA_ENVIRONINDEX,"minetest");
  lua_pushliteral(L,"override_item");
  lua_gettable(L,-2);
  lua_remove(L,-2);
  lua_pushliteral(L,"default:apple");
  lua_createtable(L,0,1);
  lua_pushliteral(L,"drop");
  lua_pushliteral(L,"default:apple");
  lua_rawset(L,-3);
  lua_call(L,2,0);
  assert(lua_gettop(L) - lc_nextra == 1);
  
  /* -- Banana (Heals one heart when eaten)
   * minetest.register_node("ethereal:banana", {
   * 	description = S("Banana"),
   * 	drawtype = "torchlike",
   * 	visual_scale = 1.0,
   * 	tiles = {"banana_single.png"},
   * 	inventory_image = "banana_single.png",
   * 	wield_image = "banana_single.png",
   * 	paramtype = "light",
   * 	sunlight_propagates = true,
   * 	walkable = false,
   * 	selection_box = {
   * 		type = "fixed",
   * 		fixed = {-0.2, -0.5, -0.2, 0.2, 0.2, 0.2}
   * 	},
   * 	groups = {
   * 		fleshy = 3, dig_immediate = 3, flammable = 2,
   * 		leafdecay = 1, leafdecay_drop = 1
   * 	},
   * 	drop = "ethereal:banana",
   * 	on_use = minetest.item_eat(2),
   * 	sounds = default.node_sound_leaves_defaults(),
   * 	after_place_node = function(pos, placer)
   * 		if placer:is_player() then
   * 			minetest.set_node(pos, {name = "ethereal:banana", param2 = 1})
   * 		end
   * 	end,
   * }) */
  lua_getfield(L,LUA_ENVIRONINDEX,"minetest");
  lua_pushliteral(L,"register_node");
  lua_gettable(L,-2);
  lua_remove(L,-2);
  lua_pushliteral(L,"ethereal:banana");
  lua_createtable(L,0,15);
  lua_pushliteral(L,"description");
  lua_pushvalue(L,(1 + lc_nextra));
  lua_pushliteral(L,"Banana");
  lua_call(L,1,1);
  lua_rawset(L,-3);
  lua_pushliteral(L,"drawtype");
  lua_pushliteral(L,"torchlike");
  lua_rawset(L,-3);
  lua_pushliteral(L,"visual_scale");
  lua_pushnumber(L,1);
  lua_rawset(L,-3);
  lua_pushliteral(L,"tiles");
  lua_createtable(L,1,0);
  lua_pushliteral(L,"banana_single.png");
  lua_rawseti(L,-2,1);
  lua_rawset(L,-3);
  lua_pushliteral(L,"inventory_image");
  lua_pushliteral(L,"banana_single.png");
  lua_rawset(L,-3);
  lua_pushliteral(L,"wield_image");
  lua_pushliteral(L,"banana_single.png");
  lua_rawset(L,-3);
  lua_pushliteral(L,"paramtype");
  lua_pushliteral(L,"light");
  lua_rawset(L,-3);
  lua_pushliteral(L,"sunlight_propagates");
  lua_pushboolean(L,1);
  lua_rawset(L,-3);
  lua_pushliteral(L,"walkable");
  lua_pushboolean(L,0);
  lua_rawset(L,-3);
  lua_pushliteral(L,"selection_box");
  lua_createtable(L,0,2);
  lua_pushliteral(L,"type");
  lua_pushliteral(L,"fixed");
  lua_rawset(L,-3);
  lua_pushliteral(L,"fixed");
  lua_createtable(L,6,0);
  lua_pushnumber(L,-0.2);
  lua_rawseti(L,-2,1);
  lua_pushnumber(L,-0.5);
  lua_rawseti(L,-2,2);
  lua_pushnumber(L,-0.2);
  lua_rawseti(L,-2,3);
  lua_pushnumber(L,0.2);
  lua_rawseti(L,-2,4);
  lua_pushnumber(L,0.2);
  lua_rawseti(L,-2,5);
  lua_pushnumber(L,0.2);
  lua_rawseti(L,-2,6);
  lua_rawset(L,-3);
  lua_rawset(L,-3);
  lua_pushliteral(L,"groups");
  lua_createtable(L,0,5);
  lua_pushliteral(L,"fleshy");
  lua_pushnumber(L,3);
  lua_rawset(L,-3);
  lua_pushliteral(L,"dig_immediate");
  lua_pushnumber(L,3);
  lua_rawset(L,-3);
  lua_pushliteral(L,"flammable");
  lua_pushnumber(L,2);
  lua_rawset(L,-3);
  lua_pushliteral(L,"leafdecay");
  lua_pushnumber(L,1);
  lua_rawset(L,-3);
  lua_pushliteral(L,"leafdecay_drop");
  lua_pushnumber(L,1);
  lua_rawset(L,-3);
  lua_rawset(L,-3);
  lua_pushliteral(L,"drop");
  lua_pushliteral(L,"ethereal:banana");
  lua_rawset(L,-3);
  lua_pushliteral(L,"on_use");
  lua_getfield(L,LUA_ENVIRONINDEX,"minetest");
  lua_pushliteral(L,"item_eat");
  lua_gettable(L,-2);
  lua_remove(L,-2);
  lua_pushnumber(L,2);
  lua_call(L,1,1);
  lua_rawset(L,-3);
  lua_pushliteral(L,"sounds");
  lua_getfield(L,LUA_ENVIRONINDEX,"default");
  lua_pushliteral(L,"node_sound_leaves_defaults");
  lua_gettable(L,-2);
  lua_remove(L,-2);
  lua_call(L,0,1);
  lua_rawset(L,-3);
  lua_pushliteral(L,"after_place_node");
  lua_pushcfunction(L,lcf3);
  lua_rawset(L,-3);
  lua_call(L,2,0);
  assert(lua_gettop(L) - lc_nextra == 1);
  
  /* -- Banana Dough
   * minetest.register_craftitem("ethereal:banana_dough", {
   * 	description = S("Banana Dough"),
   * 	inventory_image = "banana_dough.png",
   * }) */
  lua_getfield(L,LUA_ENVIRONINDEX,"minetest");
  lua_pushliteral(L,"register_craftitem");
  lua_gettable(L,-2);
  lua_remove(L,-2);
  lua_pushliteral(L,"ethereal:banana_dough");
  lua_createtable(L,0,2);
  lua_pushliteral(L,"description");
  lua_pushvalue(L,(1 + lc_nextra));
  lua_pushliteral(L,"Banana Dough");
  lua_call(L,1,1);
  lua_rawset(L,-3);
  lua_pushliteral(L,"inventory_image");
  lua_pushliteral(L,"banana_dough.png");
  lua_rawset(L,-3);
  lua_call(L,2,0);
  assert(lua_gettop(L) - lc_nextra == 1);
  
  /* minetest.register_craft({
   * 	type = "shapeless",
   * 	output = "ethereal:banana_dough",
   * 	recipe = {"farming:flour", "ethereal:banana"}
   * }) */
  lua_getfield(L,LUA_ENVIRONINDEX,"minetest");
  lua_pushliteral(L,"register_craft");
  lua_gettable(L,-2);
  lua_remove(L,-2);
  lua_createtable(L,0,3);
  lua_pushliteral(L,"type");
  lua_pushliteral(L,"shapeless");
  lua_rawset(L,-3);
  lua_pushliteral(L,"output");
  lua_pushliteral(L,"ethereal:banana_dough");
  lua_rawset(L,-3);
  lua_pushliteral(L,"recipe");
  lua_createtable(L,2,0);
  lua_pushliteral(L,"farming:flour");
  lua_rawseti(L,-2,1);
  lua_pushliteral(L,"ethereal:banana");
  lua_rawseti(L,-2,2);
  lua_rawset(L,-3);
  lua_call(L,1,0);
  assert(lua_gettop(L) - lc_nextra == 1);
  
  /* minetest.register_craft({
   * 	type = "cooking",
   * 	cooktime = 14,
   * 	output = "ethereal:banana_bread",
   * 	recipe = "ethereal:banana_dough"
   * }) */
  lua_getfield(L,LUA_ENVIRONINDEX,"minetest");
  lua_pushliteral(L,"register_craft");
  lua_gettable(L,-2);
  lua_remove(L,-2);
  lua_createtable(L,0,4);
  lua_pushliteral(L,"type");
  lua_pushliteral(L,"cooking");
  lua_rawset(L,-3);
  lua_pushliteral(L,"cooktime");
  lua_pushnumber(L,14);
  lua_rawset(L,-3);
  lua_pushliteral(L,"output");
  lua_pushliteral(L,"ethereal:banana_bread");
  lua_rawset(L,-3);
  lua_pushliteral(L,"recipe");
  lua_pushliteral(L,"ethereal:banana_dough");
  lua_rawset(L,-3);
  lua_call(L,1,0);
  assert(lua_gettop(L) - lc_nextra == 1);
  
  /* -- Orange (Heals 2 hearts when eaten)
   * minetest.register_node("ethereal:orange", {
   * 	description = S("Orange"),
   * 	drawtype = "plantlike",
   * 	visual_scale = 1.0,
   * 	tiles = {"farming_orange.png"},
   * 	inventory_image = "farming_orange.png",
   * 	wield_image = "farming_orange.png",
   * 	paramtype = "light",
   * 	sunlight_propagates = true,
   * 	walkable = false,
   * 	selection_box = {
   * 		type = "fixed",
   * 		fixed = {-0.2, -0.3, -0.2, 0.2, 0.2, 0.2}
   * 	},
   * 	groups = {
   * 		fleshy = 3, dig_immediate = 3, flammable = 2,
   * 		leafdecay = 3, leafdecay_drop = 1
   * 	},
   * 	drop = "ethereal:orange",
   * 	on_use = minetest.item_eat(4),
   * 	sounds = default.node_sound_leaves_defaults(),
   * 	after_place_node = function(pos, placer)
   * 		if placer:is_player() then
   * 			minetest.set_node(pos, {name = "ethereal:orange", param2 = 1})
   * 		end
   * 	end,
   * }) */
  lua_getfield(L,LUA_ENVIRONINDEX,"minetest");
  lua_pushliteral(L,"register_node");
  lua_gettable(L,-2);
  lua_remove(L,-2);
  lua_pushliteral(L,"ethereal:orange");
  lua_createtable(L,0,15);
  lua_pushliteral(L,"description");
  lua_pushvalue(L,(1 + lc_nextra));
  lua_pushliteral(L,"Orange");
  lua_call(L,1,1);
  lua_rawset(L,-3);
  lua_pushliteral(L,"drawtype");
  lua_pushliteral(L,"plantlike");
  lua_rawset(L,-3);
  lua_pushliteral(L,"visual_scale");
  lua_pushnumber(L,1);
  lua_rawset(L,-3);
  lua_pushliteral(L,"tiles");
  lua_createtable(L,1,0);
  lua_pushliteral(L,"farming_orange.png");
  lua_rawseti(L,-2,1);
  lua_rawset(L,-3);
  lua_pushliteral(L,"inventory_image");
  lua_pushliteral(L,"farming_orange.png");
  lua_rawset(L,-3);
  lua_pushliteral(L,"wield_image");
  lua_pushliteral(L,"farming_orange.png");
  lua_rawset(L,-3);
  lua_pushliteral(L,"paramtype");
  lua_pushliteral(L,"light");
  lua_rawset(L,-3);
  lua_pushliteral(L,"sunlight_propagates");
  lua_pushboolean(L,1);
  lua_rawset(L,-3);
  lua_pushliteral(L,"walkable");
  lua_pushboolean(L,0);
  lua_rawset(L,-3);
  lua_pushliteral(L,"selection_box");
  lua_createtable(L,0,2);
  lua_pushliteral(L,"type");
  lua_pushliteral(L,"fixed");
  lua_rawset(L,-3);
  lua_pushliteral(L,"fixed");
  lua_createtable(L,6,0);
  lua_pushnumber(L,-0.2);
  lua_rawseti(L,-2,1);
  lua_pushnumber(L,-0.3);
  lua_rawseti(L,-2,2);
  lua_pushnumber(L,-0.2);
  lua_rawseti(L,-2,3);
  lua_pushnumber(L,0.2);
  lua_rawseti(L,-2,4);
  lua_pushnumber(L,0.2);
  lua_rawseti(L,-2,5);
  lua_pushnumber(L,0.2);
  lua_rawseti(L,-2,6);
  lua_rawset(L,-3);
  lua_rawset(L,-3);
  lua_pushliteral(L,"groups");
  lua_createtable(L,0,5);
  lua_pushliteral(L,"fleshy");
  lua_pushnumber(L,3);
  lua_rawset(L,-3);
  lua_pushliteral(L,"dig_immediate");
  lua_pushnumber(L,3);
  lua_rawset(L,-3);
  lua_pushliteral(L,"flammable");
  lua_pushnumber(L,2);
  lua_rawset(L,-3);
  lua_pushliteral(L,"leafdecay");
  lua_pushnumber(L,3);
  lua_rawset(L,-3);
  lua_pushliteral(L,"leafdecay_drop");
  lua_pushnumber(L,1);
  lua_rawset(L,-3);
  lua_rawset(L,-3);
  lua_pushliteral(L,"drop");
  lua_pushliteral(L,"ethereal:orange");
  lua_rawset(L,-3);
  lua_pushliteral(L,"on_use");
  lua_getfield(L,LUA_ENVIRONINDEX,"minetest");
  lua_pushliteral(L,"item_eat");
  lua_gettable(L,-2);
  lua_remove(L,-2);
  lua_pushnumber(L,4);
  lua_call(L,1,1);
  lua_rawset(L,-3);
  lua_pushliteral(L,"sounds");
  lua_getfield(L,LUA_ENVIRONINDEX,"default");
  lua_pushliteral(L,"node_sound_leaves_defaults");
  lua_gettable(L,-2);
  lua_remove(L,-2);
  lua_call(L,0,1);
  lua_rawset(L,-3);
  lua_pushliteral(L,"after_place_node");
  lua_pushcfunction(L,lcf6);
  lua_rawset(L,-3);
  lua_call(L,2,0);
  assert(lua_gettop(L) - lc_nextra == 1);
  
  /* -- Pine Nuts (Heals 1/2 heart when eaten)
   * minetest.register_craftitem("ethereal:pine_nuts", {
   * 	description = S("Pine Nuts"),
   * 	inventory_image = "pine_nuts.png",
   * 	wield_image = "pine_nuts.png",
   * 	on_use = minetest.item_eat(1),
   * }) */
  lua_getfield(L,LUA_ENVIRONINDEX,"minetest");
  lua_pushliteral(L,"register_craftitem");
  lua_gettable(L,-2);
  lua_remove(L,-2);
  lua_pushliteral(L,"ethereal:pine_nuts");
  lua_createtable(L,0,4);
  lua_pushliteral(L,"description");
  lua_pushvalue(L,(1 + lc_nextra));
  lua_pushliteral(L,"Pine Nuts");
  lua_call(L,1,1);
  lua_rawset(L,-3);
  lua_pushliteral(L,"inventory_image");
  lua_pushliteral(L,"pine_nuts.png");
  lua_rawset(L,-3);
  lua_pushliteral(L,"wield_image");
  lua_pushliteral(L,"pine_nuts.png");
  lua_rawset(L,-3);
  lua_pushliteral(L,"on_use");
  lua_getfield(L,LUA_ENVIRONINDEX,"minetest");
  lua_pushliteral(L,"item_eat");
  lua_gettable(L,-2);
  lua_remove(L,-2);
  lua_pushnumber(L,1);
  lua_call(L,1,1);
  lua_rawset(L,-3);
  lua_call(L,2,0);
  assert(lua_gettop(L) - lc_nextra == 1);
  
  /* -- Banana Loaf (Heals 3 hearts when eaten)
   * minetest.register_craftitem("ethereal:banana_bread", {
   * 	description = S("Banana Loaf"),
   * 	inventory_image = "banana_bread.png",
   * 	wield_image = "banana_bread.png",
   * 	on_use = minetest.item_eat(6),
   * }) */
  lua_getfield(L,LUA_ENVIRONINDEX,"minetest");
  lua_pushliteral(L,"register_craftitem");
  lua_gettable(L,-2);
  lua_remove(L,-2);
  lua_pushliteral(L,"ethereal:banana_bread");
  lua_createtable(L,0,4);
  lua_pushliteral(L,"description");
  lua_pushvalue(L,(1 + lc_nextra));
  lua_pushliteral(L,"Banana Loaf");
  lua_call(L,1,1);
  lua_rawset(L,-3);
  lua_pushliteral(L,"inventory_image");
  lua_pushliteral(L,"banana_bread.png");
  lua_rawset(L,-3);
  lua_pushliteral(L,"wield_image");
  lua_pushliteral(L,"banana_bread.png");
  lua_rawset(L,-3);
  lua_pushliteral(L,"on_use");
  lua_getfield(L,LUA_ENVIRONINDEX,"minetest");
  lua_pushliteral(L,"item_eat");
  lua_gettable(L,-2);
  lua_remove(L,-2);
  lua_pushnumber(L,6);
  lua_call(L,1,1);
  lua_rawset(L,-3);
  lua_call(L,2,0);
  assert(lua_gettop(L) - lc_nextra == 1);
  
  /* -- Coconut (Gives 4 coconut slices, each heal 1/2 heart)
   * minetest.register_node("ethereal:coconut", {
   * 	description = S("Coconut"),
   * 	drawtype = "plantlike",
   * 	walkable = false,
   * 	paramtype = "light",
   * 	sunlight_propagates = true,
   * 	tiles = {"moretrees_coconut.png"},
   * 	inventory_image = "moretrees_coconut.png",
   * 	wield_image = "moretrees_coconut.png",
   * 	selection_box = {
   * 		type = "fixed",
   * 		fixed = {-0.35, -0.35, -0.35, 0.35, 0.35, 0.35}
   * 	},
   * 	groups = {
   * 		snappy = 1, oddly_breakable_by_hand = 1, cracky = 1,
   * 		choppy = 1, flammable = 1, leafdecay = 3, leafdecay_drop = 1
   * 	},
   * 	drop = "ethereal:coconut_slice 4",
   * 	sounds = default.node_sound_wood_defaults(),
   * }) */
  lua_getfield(L,LUA_ENVIRONINDEX,"minetest");
  lua_pushliteral(L,"register_node");
  lua_gettable(L,-2);
  lua_remove(L,-2);
  lua_pushliteral(L,"ethereal:coconut");
  lua_createtable(L,0,12);
  lua_pushliteral(L,"description");
  lua_pushvalue(L,(1 + lc_nextra));
  lua_pushliteral(L,"Coconut");
  lua_call(L,1,1);
  lua_rawset(L,-3);
  lua_pushliteral(L,"drawtype");
  lua_pushliteral(L,"plantlike");
  lua_rawset(L,-3);
  lua_pushliteral(L,"walkable");
  lua_pushboolean(L,0);
  lua_rawset(L,-3);
  lua_pushliteral(L,"paramtype");
  lua_pushliteral(L,"light");
  lua_rawset(L,-3);
  lua_pushliteral(L,"sunlight_propagates");
  lua_pushboolean(L,1);
  lua_rawset(L,-3);
  lua_pushliteral(L,"tiles");
  lua_createtable(L,1,0);
  lua_pushliteral(L,"moretrees_coconut.png");
  lua_rawseti(L,-2,1);
  lua_rawset(L,-3);
  lua_pushliteral(L,"inventory_image");
  lua_pushliteral(L,"moretrees_coconut.png");
  lua_rawset(L,-3);
  lua_pushliteral(L,"wield_image");
  lua_pushliteral(L,"moretrees_coconut.png");
  lua_rawset(L,-3);
  lua_pushliteral(L,"selection_box");
  lua_createtable(L,0,2);
  lua_pushliteral(L,"type");
  lua_pushliteral(L,"fixed");
  lua_rawset(L,-3);
  lua_pushliteral(L,"fixed");
  lua_createtable(L,6,0);
  lua_pushnumber(L,-0.35);
  lua_rawseti(L,-2,1);
  lua_pushnumber(L,-0.35);
  lua_rawseti(L,-2,2);
  lua_pushnumber(L,-0.35);
  lua_rawseti(L,-2,3);
  lua_pushnumber(L,0.35);
  lua_rawseti(L,-2,4);
  lua_pushnumber(L,0.35);
  lua_rawseti(L,-2,5);
  lua_pushnumber(L,0.35);
  lua_rawseti(L,-2,6);
  lua_rawset(L,-3);
  lua_rawset(L,-3);
  lua_pushliteral(L,"groups");
  lua_createtable(L,0,7);
  lua_pushliteral(L,"snappy");
  lua_pushnumber(L,1);
  lua_rawset(L,-3);
  lua_pushliteral(L,"oddly_breakable_by_hand");
  lua_pushnumber(L,1);
  lua_rawset(L,-3);
  lua_pushliteral(L,"cracky");
  lua_pushnumber(L,1);
  lua_rawset(L,-3);
  lua_pushliteral(L,"choppy");
  lua_pushnumber(L,1);
  lua_rawset(L,-3);
  lua_pushliteral(L,"flammable");
  lua_pushnumber(L,1);
  lua_rawset(L,-3);
  lua_pushliteral(L,"leafdecay");
  lua_pushnumber(L,3);
  lua_rawset(L,-3);
  lua_pushliteral(L,"leafdecay_drop");
  lua_pushnumber(L,1);
  lua_rawset(L,-3);
  lua_rawset(L,-3);
  lua_pushliteral(L,"drop");
  lua_pushliteral(L,"ethereal:coconut_slice 4");
  lua_rawset(L,-3);
  lua_pushliteral(L,"sounds");
  lua_getfield(L,LUA_ENVIRONINDEX,"default");
  lua_pushliteral(L,"node_sound_wood_defaults");
  lua_gettable(L,-2);
  lua_remove(L,-2);
  lua_call(L,0,1);
  lua_rawset(L,-3);
  lua_call(L,2,0);
  assert(lua_gettop(L) - lc_nextra == 1);
  
  /* -- Coconut Slice (Heals half heart when eaten)
   * minetest.register_craftitem("ethereal:coconut_slice", {
   * 	description = S("Coconut Slice"),
   * 	inventory_image = "moretrees_coconut_slice.png",
   * 	wield_image = "moretrees_coconut_slice.png",
   * 	on_use = minetest.item_eat(1),
   * }) */
  lua_getfield(L,LUA_ENVIRONINDEX,"minetest");
  lua_pushliteral(L,"register_craftitem");
  lua_gettable(L,-2);
  lua_remove(L,-2);
  lua_pushliteral(L,"ethereal:coconut_slice");
  lua_createtable(L,0,4);
  lua_pushliteral(L,"description");
  lua_pushvalue(L,(1 + lc_nextra));
  lua_pushliteral(L,"Coconut Slice");
  lua_call(L,1,1);
  lua_rawset(L,-3);
  lua_pushliteral(L,"inventory_image");
  lua_pushliteral(L,"moretrees_coconut_slice.png");
  lua_rawset(L,-3);
  lua_pushliteral(L,"wield_image");
  lua_pushliteral(L,"moretrees_coconut_slice.png");
  lua_rawset(L,-3);
  lua_pushliteral(L,"on_use");
  lua_getfield(L,LUA_ENVIRONINDEX,"minetest");
  lua_pushliteral(L,"item_eat");
  lua_gettable(L,-2);
  lua_remove(L,-2);
  lua_pushnumber(L,1);
  lua_call(L,1,1);
  lua_rawset(L,-3);
  lua_call(L,2,0);
  assert(lua_gettop(L) - lc_nextra == 1);
  
  /* -- Golden Apple (Found on Healing Tree, heals all 10 hearts)
   * minetest.register_node("ethereal:golden_apple", {
   * 	description = S("Golden Apple"),
   * 	drawtype = "plantlike",
   * 	visual_scale = 1.0,
   * 	tiles = {"default_apple_gold.png"},
   * 	inventory_image = "default_apple_gold.png",
   * 	wield_image = "default_apple_gold.png",
   * 	paramtype = "light",
   * 	sunlight_propagates = true,
   * 	walkable = false,
   * 	selection_box = {
   * 		type = "fixed",
   * 		fixed = {-0.2, -0.3, -0.2, 0.2, 0.2, 0.2}
   * 	},
   * 	groups = {
   * 		fleshy = 3, dig_immediate = 3,
   * 		leafdecay = 3,leafdecay_drop = 1
   * 	},
   * 	drop = "ethereal:golden_apple",
   * 	on_use = minetest.item_eat(20),
   * 	sounds = default.node_sound_leaves_defaults(),
   * 	after_place_node = function(pos, placer, itemstack)
   * 		if placer:is_player() then
   * 			minetest.set_node(pos, {name = "ethereal:golden_apple", param2 = 1})
   * 		end
   * 	end,
   * }) */
  lua_getfield(L,LUA_ENVIRONINDEX,"minetest");
  lua_pushliteral(L,"register_node");
  lua_gettable(L,-2);
  lua_remove(L,-2);
  lua_pushliteral(L,"ethereal:golden_apple");
  lua_createtable(L,0,15);
  lua_pushliteral(L,"description");
  lua_pushvalue(L,(1 + lc_nextra));
  lua_pushliteral(L,"Golden Apple");
  lua_call(L,1,1);
  lua_rawset(L,-3);
  lua_pushliteral(L,"drawtype");
  lua_pushliteral(L,"plantlike");
  lua_rawset(L,-3);
  lua_pushliteral(L,"visual_scale");
  lua_pushnumber(L,1);
  lua_rawset(L,-3);
  lua_pushliteral(L,"tiles");
  lua_createtable(L,1,0);
  lua_pushliteral(L,"default_apple_gold.png");
  lua_rawseti(L,-2,1);
  lua_rawset(L,-3);
  lua_pushliteral(L,"inventory_image");
  lua_pushliteral(L,"default_apple_gold.png");
  lua_rawset(L,-3);
  lua_pushliteral(L,"wield_image");
  lua_pushliteral(L,"default_apple_gold.png");
  lua_rawset(L,-3);
  lua_pushliteral(L,"paramtype");
  lua_pushliteral(L,"light");
  lua_rawset(L,-3);
  lua_pushliteral(L,"sunlight_propagates");
  lua_pushboolean(L,1);
  lua_rawset(L,-3);
  lua_pushliteral(L,"walkable");
  lua_pushboolean(L,0);
  lua_rawset(L,-3);
  lua_pushliteral(L,"selection_box");
  lua_createtable(L,0,2);
  lua_pushliteral(L,"type");
  lua_pushliteral(L,"fixed");
  lua_rawset(L,-3);
  lua_pushliteral(L,"fixed");
  lua_createtable(L,6,0);
  lua_pushnumber(L,-0.2);
  lua_rawseti(L,-2,1);
  lua_pushnumber(L,-0.3);
  lua_rawseti(L,-2,2);
  lua_pushnumber(L,-0.2);
  lua_rawseti(L,-2,3);
  lua_pushnumber(L,0.2);
  lua_rawseti(L,-2,4);
  lua_pushnumber(L,0.2);
  lua_rawseti(L,-2,5);
  lua_pushnumber(L,0.2);
  lua_rawseti(L,-2,6);
  lua_rawset(L,-3);
  lua_rawset(L,-3);
  lua_pushliteral(L,"groups");
  lua_createtable(L,0,4);
  lua_pushliteral(L,"fleshy");
  lua_pushnumber(L,3);
  lua_rawset(L,-3);
  lua_pushliteral(L,"dig_immediate");
  lua_pushnumber(L,3);
  lua_rawset(L,-3);
  lua_pushliteral(L,"leafdecay");
  lua_pushnumber(L,3);
  lua_rawset(L,-3);
  lua_pushliteral(L,"leafdecay_drop");
  lua_pushnumber(L,1);
  lua_rawset(L,-3);
  lua_rawset(L,-3);
  lua_pushliteral(L,"drop");
  lua_pushliteral(L,"ethereal:golden_apple");
  lua_rawset(L,-3);
  lua_pushliteral(L,"on_use");
  lua_getfield(L,LUA_ENVIRONINDEX,"minetest");
  lua_pushliteral(L,"item_eat");
  lua_gettable(L,-2);
  lua_remove(L,-2);
  lua_pushnumber(L,20);
  lua_call(L,1,1);
  lua_rawset(L,-3);
  lua_pushliteral(L,"sounds");
  lua_getfield(L,LUA_ENVIRONINDEX,"default");
  lua_pushliteral(L,"node_sound_leaves_defaults");
  lua_gettable(L,-2);
  lua_remove(L,-2);
  lua_call(L,0,1);
  lua_rawset(L,-3);
  lua_pushliteral(L,"after_place_node");
  lua_pushcfunction(L,lcf9);
  lua_rawset(L,-3);
  lua_call(L,2,0);
  assert(lua_gettop(L) - lc_nextra == 1);
  
  /* -- Hearty Stew (Heals 5 hearts - thanks to ZonerDarkRevention for his DokuCraft DeviantArt bowl texture)
   * minetest.register_craftitem("ethereal:hearty_stew", {
   * 	description = S("Hearty Stew"),
   * 	inventory_image = "hearty_stew.png",
   * 	wield_image = "hearty_stew.png",
   * 	on_use = minetest.item_eat(10, "ethereal:bowl"),
   * }) */
  lua_getfield(L,LUA_ENVIRONINDEX,"minetest");
  lua_pushliteral(L,"register_craftitem");
  lua_gettable(L,-2);
  lua_remove(L,-2);
  lua_pushliteral(L,"ethereal:hearty_stew");
  lua_createtable(L,0,4);
  lua_pushliteral(L,"description");
  lua_pushvalue(L,(1 + lc_nextra));
  lua_pushliteral(L,"Hearty Stew");
  lua_call(L,1,1);
  lua_rawset(L,-3);
  lua_pushliteral(L,"inventory_image");
  lua_pushliteral(L,"hearty_stew.png");
  lua_rawset(L,-3);
  lua_pushliteral(L,"wield_image");
  lua_pushliteral(L,"hearty_stew.png");
  lua_rawset(L,-3);
  lua_pushliteral(L,"on_use");
  lua_getfield(L,LUA_ENVIRONINDEX,"minetest");
  lua_pushliteral(L,"item_eat");
  lua_gettable(L,-2);
  lua_remove(L,-2);
  lua_pushnumber(L,10);
  lua_pushliteral(L,"ethereal:bowl");
  lua_call(L,2,1);
  lua_rawset(L,-3);
  lua_call(L,2,0);
  assert(lua_gettop(L) - lc_nextra == 1);
  
  /* minetest.register_craft({
   * 	output = "ethereal:hearty_stew",
   * 	recipe = {
   * 		{"ethereal:wild_onion_plant","ethereal:mushroom_plant", "ethereal:fern_tubers"},
   * 		{"","ethereal:mushroom_plant", ""},
   * 		{"","ethereal:bowl", ""},
   * 	}
   * }) */
  lua_getfield(L,LUA_ENVIRONINDEX,"minetest");
  lua_pushliteral(L,"register_craft");
  lua_gettable(L,-2);
  lua_remove(L,-2);
  lua_createtable(L,0,2);
  lua_pushliteral(L,"output");
  lua_pushliteral(L,"ethereal:hearty_stew");
  lua_rawset(L,-3);
  lua_pushliteral(L,"recipe");
  lua_createtable(L,3,0);
  lua_createtable(L,3,0);
  lua_pushliteral(L,"ethereal:wild_onion_plant");
  lua_rawseti(L,-2,1);
  lua_pushliteral(L,"ethereal:mushroom_plant");
  lua_rawseti(L,-2,2);
  lua_pushliteral(L,"ethereal:fern_tubers");
  lua_rawseti(L,-2,3);
  lua_rawseti(L,-2,1);
  lua_createtable(L,3,0);
  lua_pushliteral(L,"");
  lua_rawseti(L,-2,1);
  lua_pushliteral(L,"ethereal:mushroom_plant");
  lua_rawseti(L,-2,2);
  lua_pushliteral(L,"");
  lua_rawseti(L,-2,3);
  lua_rawseti(L,-2,2);
  lua_createtable(L,3,0);
  lua_pushliteral(L,"");
  lua_rawseti(L,-2,1);
  lua_pushliteral(L,"ethereal:bowl");
  lua_rawseti(L,-2,2);
  lua_pushliteral(L,"");
  lua_rawseti(L,-2,3);
  lua_rawseti(L,-2,3);
  lua_rawset(L,-3);
  lua_call(L,1,0);
  assert(lua_gettop(L) - lc_nextra == 1);
  
  /* -- Extra recipe for hearty stew
   * if farming and farming.mod and farming.mod == "redo" then */
  enum { lc10 = 1 };
  lua_getfield(L,LUA_ENVIRONINDEX,"farming");
  if (lua_toboolean(L,-1)) {
    lua_pop(L,1);
    lua_getfield(L,LUA_ENVIRONINDEX,"farming");
    lua_pushliteral(L,"mod");
    lua_gettable(L,-2);
    lua_remove(L,-2);
  }
  if (lua_toboolean(L,-1)) {
    lua_pop(L,1);
    lua_getfield(L,LUA_ENVIRONINDEX,"farming");
    lua_pushliteral(L,"mod");
    lua_gettable(L,-2);
    lua_remove(L,-2);
    lua_pushliteral(L,"redo");
    const int lc11 = lua_equal(L,-2,-1);
    lua_pop(L,2);
    lua_pushboolean(L,lc11);
  }
  const int lc12 = lua_toboolean(L,-1);
  lua_pop(L,1);
  if (lc12) {
    
    /* minetest.register_craft({
     * 	output = "ethereal:hearty_stew",
     * 	recipe = {
     * 		{"ethereal:wild_onion_plant","ethereal:mushroom_plant", "farming:beans"},
     * 		{"","ethereal:mushroom_plant", ""},
     * 		{"","ethereal:bowl", ""},
     * 	}
     * }) */
    lua_getfield(L,LUA_ENVIRONINDEX,"minetest");
    lua_pushliteral(L,"register_craft");
    lua_gettable(L,-2);
    lua_remove(L,-2);
    lua_createtable(L,0,2);
    lua_pushliteral(L,"output");
    lua_pushliteral(L,"ethereal:hearty_stew");
    lua_rawset(L,-3);
    lua_pushliteral(L,"recipe");
    lua_createtable(L,3,0);
    lua_createtable(L,3,0);
    lua_pushliteral(L,"ethereal:wild_onion_plant");
    lua_rawseti(L,-2,1);
    lua_pushliteral(L,"ethereal:mushroom_plant");
    lua_rawseti(L,-2,2);
    lua_pushliteral(L,"farming:beans");
    lua_rawseti(L,-2,3);
    lua_rawseti(L,-2,1);
    lua_createtable(L,3,0);
    lua_pushliteral(L,"");
    lua_rawseti(L,-2,1);
    lua_pushliteral(L,"ethereal:mushroom_plant");
    lua_rawseti(L,-2,2);
    lua_pushliteral(L,"");
    lua_rawseti(L,-2,3);
    lua_rawseti(L,-2,2);
    lua_createtable(L,3,0);
    lua_pushliteral(L,"");
    lua_rawseti(L,-2,1);
    lua_pushliteral(L,"ethereal:bowl");
    lua_rawseti(L,-2,2);
    lua_pushliteral(L,"");
    lua_rawseti(L,-2,3);
    lua_rawseti(L,-2,3);
    lua_rawset(L,-3);
    lua_call(L,1,0);
    assert(lua_gettop(L) - lc_nextra == 1);
  }
  lua_settop(L,(lc10 + lc_nextra));
  assert(lua_gettop(L) - lc_nextra == 1);
  
  /* -- Bucket of Cactus Pulp
   * minetest.register_craftitem("ethereal:bucket_cactus", {
   * 	description = S("Bucket of Cactus Pulp"),
   * 	inventory_image = "bucket_cactus.png",
   * 	wield_image = "bucket_cactus.png",
   * 	stack_max = 1,
   * 	on_use = minetest.item_eat(2, "bucket:bucket_empty"),
   * }) */
  lua_getfield(L,LUA_ENVIRONINDEX,"minetest");
  lua_pushliteral(L,"register_craftitem");
  lua_gettable(L,-2);
  lua_remove(L,-2);
  lua_pushliteral(L,"ethereal:bucket_cactus");
  lua_createtable(L,0,5);
  lua_pushliteral(L,"description");
  lua_pushvalue(L,(1 + lc_nextra));
  lua_pushliteral(L,"Bucket of Cactus Pulp");
  lua_call(L,1,1);
  lua_rawset(L,-3);
  lua_pushliteral(L,"inventory_image");
  lua_pushliteral(L,"bucket_cactus.png");
  lua_rawset(L,-3);
  lua_pushliteral(L,"wield_image");
  lua_pushliteral(L,"bucket_cactus.png");
  lua_rawset(L,-3);
  lua_pushliteral(L,"stack_max");
  lua_pushnumber(L,1);
  lua_rawset(L,-3);
  lua_pushliteral(L,"on_use");
  lua_getfield(L,LUA_ENVIRONINDEX,"minetest");
  lua_pushliteral(L,"item_eat");
  lua_gettable(L,-2);
  lua_remove(L,-2);
  lua_pushnumber(L,2);
  lua_pushliteral(L,"bucket:bucket_empty");
  lua_call(L,2,1);
  lua_rawset(L,-3);
  lua_call(L,2,0);
  assert(lua_gettop(L) - lc_nextra == 1);
  
  /* minetest.register_craft({
   * 	output = "ethereal:bucket_cactus",
   * 	recipe = {
   * 		{"bucket:bucket_empty","default:cactus"},
   * 	}
   * }) */
  lua_getfield(L,LUA_ENVIRONINDEX,"minetest");
  lua_pushliteral(L,"register_craft");
  lua_gettable(L,-2);
  lua_remove(L,-2);
  lua_createtable(L,0,2);
  lua_pushliteral(L,"output");
  lua_pushliteral(L,"ethereal:bucket_cactus");
  lua_rawset(L,-3);
  lua_pushliteral(L,"recipe");
  lua_createtable(L,1,0);
  lua_createtable(L,2,0);
  lua_pushliteral(L,"bucket:bucket_empty");
  lua_rawseti(L,-2,1);
  lua_pushliteral(L,"default:cactus");
  lua_rawseti(L,-2,2);
  lua_rawseti(L,-2,1);
  lua_rawset(L,-3);
  lua_call(L,1,0);
  assert(lua_gettop(L) - lc_nextra == 1);
  return 0;
}


/* from lua.c */
static int traceback (lua_State *L) {
  if (!lua_isstring(L, 1))  /* 'message' not a string? */
    return 1;  /* keep it intact */
  lua_getfield(L, LUA_GLOBALSINDEX, "debug");
  if (!lua_istable(L, -1)) {
    lua_pop(L, 1);
    return 1;
  }
  lua_getfield(L, -1, "traceback");
  if (!lua_isfunction(L, -1)) {
    lua_pop(L, 2);
    return 1;
  }
  lua_pushvalue(L, 1);  /* pass error message */
  lua_pushinteger(L, 2);  /* skip this function and traceback */
  lua_call(L, 2, 1);  /* call debug.traceback */
  return 1;
}


static void lc_l_message (const char *pname, const char *msg) {
  if (pname) fprintf(stderr, "%s: ", pname);
  fprintf(stderr, "%s\n", msg);
  fflush(stderr);
}

static int lc_report (lua_State *L, int status) {
  if (status && !lua_isnil(L, -1)) {
    const char *msg = lua_tostring(L, -1);
    if (msg == NULL) msg = "(error object is not a string)";
    /*FIX-IMROVE:progname*/
    lc_l_message("lua", msg);
    lua_pop(L, 1);
  }
  return status;
}

static int lc_docall (lua_State *L, int narg, int clear) {
  int status;
  int base = lua_gettop(L) - narg;  /* function index */
  lua_pushcfunction(L, traceback);  /* push traceback function */
  lua_insert(L, base);  /* put it under chunk and args */
  /*FIX? signal(SIGINT, laction); */
  status = lua_pcall(L, narg, (clear ? 0 : LUA_MULTRET), base);
  /*FIX? signal(SIGINT, SIG_DFL); */
  lua_remove(L, base);  /* remove traceback function */
  /* force a complete garbage collection in case of errors */
  if (status != 0) lua_gc(L, LUA_GCCOLLECT, 0);
  return status;
}

static int lc_dofile (lua_State *L, const char *name) {
  int status = luaL_loadfile(L, name) || lc_docall(L, 0, 1);
  return lc_report(L, status);
}

static int lc_dostring (lua_State *L, const char *s, const char *name) {
  int status = luaL_loadbuffer(L, s, strlen(s), name) || lc_docall(L, 0, 1);
  return lc_report(L, status);
}

static int lc_handle_luainit (lua_State *L) {
  const char *init = getenv(LUA_INIT);
  if (init == NULL) return 0;  /* status OK */
  else if (init[0] == '@')
    return lc_dofile(L, init+1);
  else
    return lc_dostring(L, init, "=" LUA_INIT);
}


typedef struct {
  int c;
  const char ** v;
} lc_args_t;


/* create global arg table */
static void lc_createarg(lua_State * L, const lc_args_t * const args) {
  int i;
  lua_newtable(L);
  for (i=0; i < args->c; i++) {
    lua_pushstring(L, args->v[i]);
    lua_rawseti(L, -2, i);
  }
  lua_setglobal(L, "arg");
}


int lc_pmain_mod_ethereal_food(lua_State * L) {
  luaL_openlibs(L);

  lua_pushcfunction(L, traceback);

  const int status1 = lc_handle_luainit(L);
  if (status1 != 0) return 0;

  /* note: IMPROVE: closure not always needed here */
  lua_newtable(L); /* closure table */
  lua_pushcclosure(L, lcf_main, 1);

  int status2 = lua_pcall(L, 0, 0, -2);
  if (status2 != 0) {
    const char * msg = lua_tostring(L,-1);
    if (msg == NULL) msg = "(error object is not a string)";
    fputs(msg, stderr);
  }
  return 0;
}


