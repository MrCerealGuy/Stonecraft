/* WARNING: This file was automatically generated by lua2c. */

#ifdef __cplusplus
extern "C" {
#endif
#include <lua.h>
#include <lauxlib.h>
#include <lualib.h>
#ifdef __cplusplus
}
#endif
#include <stdio.h>
#include <stdlib.h>


#include <string.h>


#include <assert.h>

/* name: (main)
 * function(...) */
static int lcf_main (lua_State * L) {
  enum { lc_nformalargs = 0 };
  const int lc_nactualargs = lua_gettop(L);
  const int lc_nextra = (lc_nactualargs - lc_nformalargs);
  
  /* local S = ethereal.intllib */
  lua_getfield(L,LUA_ENVIRONINDEX,"ethereal");
  lua_pushliteral(L,"intllib");
  lua_gettable(L,-2);
  lua_remove(L,-2);
  assert(lua_gettop(L) - lc_nextra == 1);
  
  /* -- set leaftype (value inside init.lua)
   * local leaftype = "plantlike" */
  lua_pushliteral(L,"plantlike");
  assert(lua_gettop(L) - lc_nextra == 2);
  
  /* if ethereal.leaftype ~= 0 then */
  enum { lc1 = 2 };
  lua_getfield(L,LUA_ENVIRONINDEX,"ethereal");
  lua_pushliteral(L,"leaftype");
  lua_gettable(L,-2);
  lua_remove(L,-2);
  lua_pushnumber(L,0);
  const int lc2 = lua_equal(L,-2,-1);
  lua_pop(L,2);
  lua_pushboolean(L,lc2);
  lua_pushboolean(L,!(lua_toboolean(L,-1)));
  lua_remove(L,-2);
  const int lc3 = lua_toboolean(L,-1);
  lua_pop(L,1);
  if (lc3) {
    
    /* leaftype = "allfaces_optional" */
    lua_pushliteral(L,"allfaces_optional");
    lua_replace(L,(2 + lc_nextra));
    assert(lua_gettop(L) - lc_nextra == 2);
  }
  lua_settop(L,(lc1 + lc_nextra));
  assert(lua_gettop(L) - lc_nextra == 2);
  
  /* -- default apple tree leaves
   * minetest.override_item("default:leaves", {
   * 	drawtype = leaftype,
   * 	visual_scale = 1.2,
   * 	inventory_image = "default_leaves.png",
   * 	wield_image = "default_leaves.png",
   * 	walkable = ethereal.leafwalk,
   * }) */
  lua_getfield(L,LUA_ENVIRONINDEX,"minetest");
  lua_pushliteral(L,"override_item");
  lua_gettable(L,-2);
  lua_remove(L,-2);
  lua_pushliteral(L,"default:leaves");
  lua_createtable(L,0,5);
  lua_pushliteral(L,"drawtype");
  lua_pushvalue(L,(2 + lc_nextra));
  lua_rawset(L,-3);
  lua_pushliteral(L,"visual_scale");
  lua_pushnumber(L,1.2);
  lua_rawset(L,-3);
  lua_pushliteral(L,"inventory_image");
  lua_pushliteral(L,"default_leaves.png");
  lua_rawset(L,-3);
  lua_pushliteral(L,"wield_image");
  lua_pushliteral(L,"default_leaves.png");
  lua_rawset(L,-3);
  lua_pushliteral(L,"walkable");
  lua_getfield(L,LUA_ENVIRONINDEX,"ethereal");
  lua_pushliteral(L,"leafwalk");
  lua_gettable(L,-2);
  lua_remove(L,-2);
  lua_rawset(L,-3);
  lua_call(L,2,0);
  assert(lua_gettop(L) - lc_nextra == 2);
  
  /* -- default jungle tree leaves
   * minetest.override_item("default:jungleleaves", {
   * 	drawtype = leaftype,
   * 	visual_scale = 1.2,
   * 	inventory_image = "default_jungleleaves.png",
   * 	wield_image = "default_jungleleaves.png",
   * 	walkable = ethereal.leafwalk,
   * }) */
  lua_getfield(L,LUA_ENVIRONINDEX,"minetest");
  lua_pushliteral(L,"override_item");
  lua_gettable(L,-2);
  lua_remove(L,-2);
  lua_pushliteral(L,"default:jungleleaves");
  lua_createtable(L,0,5);
  lua_pushliteral(L,"drawtype");
  lua_pushvalue(L,(2 + lc_nextra));
  lua_rawset(L,-3);
  lua_pushliteral(L,"visual_scale");
  lua_pushnumber(L,1.2);
  lua_rawset(L,-3);
  lua_pushliteral(L,"inventory_image");
  lua_pushliteral(L,"default_jungleleaves.png");
  lua_rawset(L,-3);
  lua_pushliteral(L,"wield_image");
  lua_pushliteral(L,"default_jungleleaves.png");
  lua_rawset(L,-3);
  lua_pushliteral(L,"walkable");
  lua_getfield(L,LUA_ENVIRONINDEX,"ethereal");
  lua_pushliteral(L,"leafwalk");
  lua_gettable(L,-2);
  lua_remove(L,-2);
  lua_rawset(L,-3);
  lua_call(L,2,0);
  assert(lua_gettop(L) - lc_nextra == 2);
  
  /* -- default pine tree leaves
   * minetest.override_item("default:pine_needles", {
   * 	drawtype = leaftype,
   * 	visual_scale = 1.2,
   * 	inventory_image = "default_pine_needles.png",
   * 	wield_image = "default_pine_needles.png",
   * 	walkable = ethereal.leafwalk,
   * 	drop = {
   * 		max_items = 1,
   * 		items = {
   * 			{items = {"default:pine_sapling"}, rarity = 20},
   * 			{items = {"ethereal:pine_nuts"}, rarity = 5},
   * 			{items = {"default:pine_needles"}}
   * 		}
   * 	},
   * }) */
  lua_getfield(L,LUA_ENVIRONINDEX,"minetest");
  lua_pushliteral(L,"override_item");
  lua_gettable(L,-2);
  lua_remove(L,-2);
  lua_pushliteral(L,"default:pine_needles");
  lua_createtable(L,0,6);
  lua_pushliteral(L,"drawtype");
  lua_pushvalue(L,(2 + lc_nextra));
  lua_rawset(L,-3);
  lua_pushliteral(L,"visual_scale");
  lua_pushnumber(L,1.2);
  lua_rawset(L,-3);
  lua_pushliteral(L,"inventory_image");
  lua_pushliteral(L,"default_pine_needles.png");
  lua_rawset(L,-3);
  lua_pushliteral(L,"wield_image");
  lua_pushliteral(L,"default_pine_needles.png");
  lua_rawset(L,-3);
  lua_pushliteral(L,"walkable");
  lua_getfield(L,LUA_ENVIRONINDEX,"ethereal");
  lua_pushliteral(L,"leafwalk");
  lua_gettable(L,-2);
  lua_remove(L,-2);
  lua_rawset(L,-3);
  lua_pushliteral(L,"drop");
  lua_createtable(L,0,2);
  lua_pushliteral(L,"max_items");
  lua_pushnumber(L,1);
  lua_rawset(L,-3);
  lua_pushliteral(L,"items");
  lua_createtable(L,3,0);
  lua_createtable(L,0,2);
  lua_pushliteral(L,"items");
  lua_createtable(L,1,0);
  lua_pushliteral(L,"default:pine_sapling");
  lua_rawseti(L,-2,1);
  lua_rawset(L,-3);
  lua_pushliteral(L,"rarity");
  lua_pushnumber(L,20);
  lua_rawset(L,-3);
  lua_rawseti(L,-2,1);
  lua_createtable(L,0,2);
  lua_pushliteral(L,"items");
  lua_createtable(L,1,0);
  lua_pushliteral(L,"ethereal:pine_nuts");
  lua_rawseti(L,-2,1);
  lua_rawset(L,-3);
  lua_pushliteral(L,"rarity");
  lua_pushnumber(L,5);
  lua_rawset(L,-3);
  lua_rawseti(L,-2,2);
  lua_createtable(L,0,1);
  lua_pushliteral(L,"items");
  lua_createtable(L,1,0);
  lua_pushliteral(L,"default:pine_needles");
  lua_rawseti(L,-2,1);
  lua_rawset(L,-3);
  lua_rawseti(L,-2,3);
  lua_rawset(L,-3);
  lua_rawset(L,-3);
  lua_call(L,2,0);
  assert(lua_gettop(L) - lc_nextra == 2);
  
  /* -- default acacia tree leaves
   * minetest.override_item("default:acacia_leaves", {
   * 	drawtype = leaftype,
   * --	tiles = {"moretrees_acacia_leaves.png"},
   * 	inventory_image = "default_acacia_leaves.png",
   * 	wield_image = "default_acacia_leaves.png",
   * 	visual_scale = 1.2,
   * 	walkable = ethereal.leafwalk,
   * }) */
  lua_getfield(L,LUA_ENVIRONINDEX,"minetest");
  lua_pushliteral(L,"override_item");
  lua_gettable(L,-2);
  lua_remove(L,-2);
  lua_pushliteral(L,"default:acacia_leaves");
  lua_createtable(L,0,5);
  lua_pushliteral(L,"drawtype");
  lua_pushvalue(L,(2 + lc_nextra));
  lua_rawset(L,-3);
  lua_pushliteral(L,"inventory_image");
  lua_pushliteral(L,"default_acacia_leaves.png");
  lua_rawset(L,-3);
  lua_pushliteral(L,"wield_image");
  lua_pushliteral(L,"default_acacia_leaves.png");
  lua_rawset(L,-3);
  lua_pushliteral(L,"visual_scale");
  lua_pushnumber(L,1.2);
  lua_rawset(L,-3);
  lua_pushliteral(L,"walkable");
  lua_getfield(L,LUA_ENVIRONINDEX,"ethereal");
  lua_pushliteral(L,"leafwalk");
  lua_gettable(L,-2);
  lua_remove(L,-2);
  lua_rawset(L,-3);
  lua_call(L,2,0);
  assert(lua_gettop(L) - lc_nextra == 2);
  
  /* -- default aspen tree leaves
   * minetest.override_item("default:aspen_leaves", {
   * 	drawtype = leaftype,
   * 	inventory_image = "default_aspen_leaves.png",
   * 	wield_image = "default_aspen_leaves.png",
   * 	visual_scale = 1.2,
   * 	walkable = ethereal.leafwalk,
   * }) */
  lua_getfield(L,LUA_ENVIRONINDEX,"minetest");
  lua_pushliteral(L,"override_item");
  lua_gettable(L,-2);
  lua_remove(L,-2);
  lua_pushliteral(L,"default:aspen_leaves");
  lua_createtable(L,0,5);
  lua_pushliteral(L,"drawtype");
  lua_pushvalue(L,(2 + lc_nextra));
  lua_rawset(L,-3);
  lua_pushliteral(L,"inventory_image");
  lua_pushliteral(L,"default_aspen_leaves.png");
  lua_rawset(L,-3);
  lua_pushliteral(L,"wield_image");
  lua_pushliteral(L,"default_aspen_leaves.png");
  lua_rawset(L,-3);
  lua_pushliteral(L,"visual_scale");
  lua_pushnumber(L,1.2);
  lua_rawset(L,-3);
  lua_pushliteral(L,"walkable");
  lua_getfield(L,LUA_ENVIRONINDEX,"ethereal");
  lua_pushliteral(L,"leafwalk");
  lua_gettable(L,-2);
  lua_remove(L,-2);
  lua_rawset(L,-3);
  lua_call(L,2,0);
  assert(lua_gettop(L) - lc_nextra == 2);
  
  /* -- willow twig
   * minetest.register_node("ethereal:willow_twig", {
   * 	description = S("Willow Twig"),
   * 	drawtype = "plantlike",
   * 	tiles = {"willow_twig.png"},
   * 	inventory_image = "willow_twig.png",
   * 	wield_image = "willow_twig.png",
   * 	paramtype = "light",
   * 	walkable = ethereal.leafwalk,
   * 	visual_scale = 1.2,
   * 	waving = 1,
   * 	groups = {snappy = 3, leafdecay = 3, leaves = 1, flammable = 2},
   * 	drop = {
   * 		max_items = 1,
   * 		items = {
   * 			{items = {"ethereal:willow_sapling"}, rarity = 50},
   * 			{items = {"ethereal:willow_twig"}}
   * 		}
   * 	},
   * 	sounds = default.node_sound_leaves_defaults(),
   * 	after_place_node = default.after_place_leaves,
   * }) */
  lua_getfield(L,LUA_ENVIRONINDEX,"minetest");
  lua_pushliteral(L,"register_node");
  lua_gettable(L,-2);
  lua_remove(L,-2);
  lua_pushliteral(L,"ethereal:willow_twig");
  lua_createtable(L,0,13);
  lua_pushliteral(L,"description");
  lua_pushvalue(L,(1 + lc_nextra));
  lua_pushliteral(L,"Willow Twig");
  lua_call(L,1,1);
  lua_rawset(L,-3);
  lua_pushliteral(L,"drawtype");
  lua_pushliteral(L,"plantlike");
  lua_rawset(L,-3);
  lua_pushliteral(L,"tiles");
  lua_createtable(L,1,0);
  lua_pushliteral(L,"willow_twig.png");
  lua_rawseti(L,-2,1);
  lua_rawset(L,-3);
  lua_pushliteral(L,"inventory_image");
  lua_pushliteral(L,"willow_twig.png");
  lua_rawset(L,-3);
  lua_pushliteral(L,"wield_image");
  lua_pushliteral(L,"willow_twig.png");
  lua_rawset(L,-3);
  lua_pushliteral(L,"paramtype");
  lua_pushliteral(L,"light");
  lua_rawset(L,-3);
  lua_pushliteral(L,"walkable");
  lua_getfield(L,LUA_ENVIRONINDEX,"ethereal");
  lua_pushliteral(L,"leafwalk");
  lua_gettable(L,-2);
  lua_remove(L,-2);
  lua_rawset(L,-3);
  lua_pushliteral(L,"visual_scale");
  lua_pushnumber(L,1.2);
  lua_rawset(L,-3);
  lua_pushliteral(L,"waving");
  lua_pushnumber(L,1);
  lua_rawset(L,-3);
  lua_pushliteral(L,"groups");
  lua_createtable(L,0,4);
  lua_pushliteral(L,"snappy");
  lua_pushnumber(L,3);
  lua_rawset(L,-3);
  lua_pushliteral(L,"leafdecay");
  lua_pushnumber(L,3);
  lua_rawset(L,-3);
  lua_pushliteral(L,"leaves");
  lua_pushnumber(L,1);
  lua_rawset(L,-3);
  lua_pushliteral(L,"flammable");
  lua_pushnumber(L,2);
  lua_rawset(L,-3);
  lua_rawset(L,-3);
  lua_pushliteral(L,"drop");
  lua_createtable(L,0,2);
  lua_pushliteral(L,"max_items");
  lua_pushnumber(L,1);
  lua_rawset(L,-3);
  lua_pushliteral(L,"items");
  lua_createtable(L,2,0);
  lua_createtable(L,0,2);
  lua_pushliteral(L,"items");
  lua_createtable(L,1,0);
  lua_pushliteral(L,"ethereal:willow_sapling");
  lua_rawseti(L,-2,1);
  lua_rawset(L,-3);
  lua_pushliteral(L,"rarity");
  lua_pushnumber(L,50);
  lua_rawset(L,-3);
  lua_rawseti(L,-2,1);
  lua_createtable(L,0,1);
  lua_pushliteral(L,"items");
  lua_createtable(L,1,0);
  lua_pushliteral(L,"ethereal:willow_twig");
  lua_rawseti(L,-2,1);
  lua_rawset(L,-3);
  lua_rawseti(L,-2,2);
  lua_rawset(L,-3);
  lua_rawset(L,-3);
  lua_pushliteral(L,"sounds");
  lua_getfield(L,LUA_ENVIRONINDEX,"default");
  lua_pushliteral(L,"node_sound_leaves_defaults");
  lua_gettable(L,-2);
  lua_remove(L,-2);
  lua_call(L,0,1);
  lua_rawset(L,-3);
  lua_pushliteral(L,"after_place_node");
  lua_getfield(L,LUA_ENVIRONINDEX,"default");
  lua_pushliteral(L,"after_place_leaves");
  lua_gettable(L,-2);
  lua_remove(L,-2);
  lua_rawset(L,-3);
  lua_call(L,2,0);
  assert(lua_gettop(L) - lc_nextra == 2);
  
  /* -- redwood leaves
   * minetest.register_node("ethereal:redwood_leaves", {
   * 	description = S("Redwood Leaves"),
   * 	drawtype = leaftype,
   * 	visual_scale = 1.2,
   * 	tiles = {"redwood_leaves.png"},
   * 	inventory_image = "redwood_leaves.png",
   * 	wield_image = "redwood_leaves.png",
   * 	paramtype = "light",
   * 	walkable = ethereal.leafwalk,
   * 	waving = 1,
   * 	groups = {snappy = 3, leafdecay = 3, leaves = 1, flammable = 2},
   * 	drop = {
   * 		max_items = 1,
   * 		items = {
   * 			{items = {"ethereal:redwood_sapling"}, rarity = 50},
   * 			{items = {"ethereal:redwood_leaves"}}
   * 		}
   * 	},
   * 	sounds = default.node_sound_leaves_defaults(),
   * 	after_place_node = default.after_place_leaves,
   * }) */
  lua_getfield(L,LUA_ENVIRONINDEX,"minetest");
  lua_pushliteral(L,"register_node");
  lua_gettable(L,-2);
  lua_remove(L,-2);
  lua_pushliteral(L,"ethereal:redwood_leaves");
  lua_createtable(L,0,13);
  lua_pushliteral(L,"description");
  lua_pushvalue(L,(1 + lc_nextra));
  lua_pushliteral(L,"Redwood Leaves");
  lua_call(L,1,1);
  lua_rawset(L,-3);
  lua_pushliteral(L,"drawtype");
  lua_pushvalue(L,(2 + lc_nextra));
  lua_rawset(L,-3);
  lua_pushliteral(L,"visual_scale");
  lua_pushnumber(L,1.2);
  lua_rawset(L,-3);
  lua_pushliteral(L,"tiles");
  lua_createtable(L,1,0);
  lua_pushliteral(L,"redwood_leaves.png");
  lua_rawseti(L,-2,1);
  lua_rawset(L,-3);
  lua_pushliteral(L,"inventory_image");
  lua_pushliteral(L,"redwood_leaves.png");
  lua_rawset(L,-3);
  lua_pushliteral(L,"wield_image");
  lua_pushliteral(L,"redwood_leaves.png");
  lua_rawset(L,-3);
  lua_pushliteral(L,"paramtype");
  lua_pushliteral(L,"light");
  lua_rawset(L,-3);
  lua_pushliteral(L,"walkable");
  lua_getfield(L,LUA_ENVIRONINDEX,"ethereal");
  lua_pushliteral(L,"leafwalk");
  lua_gettable(L,-2);
  lua_remove(L,-2);
  lua_rawset(L,-3);
  lua_pushliteral(L,"waving");
  lua_pushnumber(L,1);
  lua_rawset(L,-3);
  lua_pushliteral(L,"groups");
  lua_createtable(L,0,4);
  lua_pushliteral(L,"snappy");
  lua_pushnumber(L,3);
  lua_rawset(L,-3);
  lua_pushliteral(L,"leafdecay");
  lua_pushnumber(L,3);
  lua_rawset(L,-3);
  lua_pushliteral(L,"leaves");
  lua_pushnumber(L,1);
  lua_rawset(L,-3);
  lua_pushliteral(L,"flammable");
  lua_pushnumber(L,2);
  lua_rawset(L,-3);
  lua_rawset(L,-3);
  lua_pushliteral(L,"drop");
  lua_createtable(L,0,2);
  lua_pushliteral(L,"max_items");
  lua_pushnumber(L,1);
  lua_rawset(L,-3);
  lua_pushliteral(L,"items");
  lua_createtable(L,2,0);
  lua_createtable(L,0,2);
  lua_pushliteral(L,"items");
  lua_createtable(L,1,0);
  lua_pushliteral(L,"ethereal:redwood_sapling");
  lua_rawseti(L,-2,1);
  lua_rawset(L,-3);
  lua_pushliteral(L,"rarity");
  lua_pushnumber(L,50);
  lua_rawset(L,-3);
  lua_rawseti(L,-2,1);
  lua_createtable(L,0,1);
  lua_pushliteral(L,"items");
  lua_createtable(L,1,0);
  lua_pushliteral(L,"ethereal:redwood_leaves");
  lua_rawseti(L,-2,1);
  lua_rawset(L,-3);
  lua_rawseti(L,-2,2);
  lua_rawset(L,-3);
  lua_rawset(L,-3);
  lua_pushliteral(L,"sounds");
  lua_getfield(L,LUA_ENVIRONINDEX,"default");
  lua_pushliteral(L,"node_sound_leaves_defaults");
  lua_gettable(L,-2);
  lua_remove(L,-2);
  lua_call(L,0,1);
  lua_rawset(L,-3);
  lua_pushliteral(L,"after_place_node");
  lua_getfield(L,LUA_ENVIRONINDEX,"default");
  lua_pushliteral(L,"after_place_leaves");
  lua_gettable(L,-2);
  lua_remove(L,-2);
  lua_rawset(L,-3);
  lua_call(L,2,0);
  assert(lua_gettop(L) - lc_nextra == 2);
  
  /* -- orange tree leaves
   * minetest.register_node("ethereal:orange_leaves", {
   * 	description = S("Orange Leaves"),
   * 	drawtype = leaftype,
   * 	visual_scale = 1.2,
   * 	tiles = {"orange_leaves.png"},
   * 	inventory_image = "orange_leaves.png",
   * 	wield_image = "orange_leaves.png",
   * 	paramtype = "light",
   * 	walkable = ethereal.leafwalk,
   * 	waving = 1,
   * 	groups = {snappy = 3, leafdecay = 3, leaves = 1, flammable = 2},
   * 	drop = {
   * 		max_items = 1,
   * 		items = {
   * 			{items = {"ethereal:orange_tree_sapling"}, rarity = 15},
   * 			{items = {"ethereal:orange_leaves"}}
   * 		}
   * 	},
   * 	sounds = default.node_sound_leaves_defaults(),
   * 	after_place_node = default.after_place_leaves,
   * }) */
  lua_getfield(L,LUA_ENVIRONINDEX,"minetest");
  lua_pushliteral(L,"register_node");
  lua_gettable(L,-2);
  lua_remove(L,-2);
  lua_pushliteral(L,"ethereal:orange_leaves");
  lua_createtable(L,0,13);
  lua_pushliteral(L,"description");
  lua_pushvalue(L,(1 + lc_nextra));
  lua_pushliteral(L,"Orange Leaves");
  lua_call(L,1,1);
  lua_rawset(L,-3);
  lua_pushliteral(L,"drawtype");
  lua_pushvalue(L,(2 + lc_nextra));
  lua_rawset(L,-3);
  lua_pushliteral(L,"visual_scale");
  lua_pushnumber(L,1.2);
  lua_rawset(L,-3);
  lua_pushliteral(L,"tiles");
  lua_createtable(L,1,0);
  lua_pushliteral(L,"orange_leaves.png");
  lua_rawseti(L,-2,1);
  lua_rawset(L,-3);
  lua_pushliteral(L,"inventory_image");
  lua_pushliteral(L,"orange_leaves.png");
  lua_rawset(L,-3);
  lua_pushliteral(L,"wield_image");
  lua_pushliteral(L,"orange_leaves.png");
  lua_rawset(L,-3);
  lua_pushliteral(L,"paramtype");
  lua_pushliteral(L,"light");
  lua_rawset(L,-3);
  lua_pushliteral(L,"walkable");
  lua_getfield(L,LUA_ENVIRONINDEX,"ethereal");
  lua_pushliteral(L,"leafwalk");
  lua_gettable(L,-2);
  lua_remove(L,-2);
  lua_rawset(L,-3);
  lua_pushliteral(L,"waving");
  lua_pushnumber(L,1);
  lua_rawset(L,-3);
  lua_pushliteral(L,"groups");
  lua_createtable(L,0,4);
  lua_pushliteral(L,"snappy");
  lua_pushnumber(L,3);
  lua_rawset(L,-3);
  lua_pushliteral(L,"leafdecay");
  lua_pushnumber(L,3);
  lua_rawset(L,-3);
  lua_pushliteral(L,"leaves");
  lua_pushnumber(L,1);
  lua_rawset(L,-3);
  lua_pushliteral(L,"flammable");
  lua_pushnumber(L,2);
  lua_rawset(L,-3);
  lua_rawset(L,-3);
  lua_pushliteral(L,"drop");
  lua_createtable(L,0,2);
  lua_pushliteral(L,"max_items");
  lua_pushnumber(L,1);
  lua_rawset(L,-3);
  lua_pushliteral(L,"items");
  lua_createtable(L,2,0);
  lua_createtable(L,0,2);
  lua_pushliteral(L,"items");
  lua_createtable(L,1,0);
  lua_pushliteral(L,"ethereal:orange_tree_sapling");
  lua_rawseti(L,-2,1);
  lua_rawset(L,-3);
  lua_pushliteral(L,"rarity");
  lua_pushnumber(L,15);
  lua_rawset(L,-3);
  lua_rawseti(L,-2,1);
  lua_createtable(L,0,1);
  lua_pushliteral(L,"items");
  lua_createtable(L,1,0);
  lua_pushliteral(L,"ethereal:orange_leaves");
  lua_rawseti(L,-2,1);
  lua_rawset(L,-3);
  lua_rawseti(L,-2,2);
  lua_rawset(L,-3);
  lua_rawset(L,-3);
  lua_pushliteral(L,"sounds");
  lua_getfield(L,LUA_ENVIRONINDEX,"default");
  lua_pushliteral(L,"node_sound_leaves_defaults");
  lua_gettable(L,-2);
  lua_remove(L,-2);
  lua_call(L,0,1);
  lua_rawset(L,-3);
  lua_pushliteral(L,"after_place_node");
  lua_getfield(L,LUA_ENVIRONINDEX,"default");
  lua_pushliteral(L,"after_place_leaves");
  lua_gettable(L,-2);
  lua_remove(L,-2);
  lua_rawset(L,-3);
  lua_call(L,2,0);
  assert(lua_gettop(L) - lc_nextra == 2);
  
  /* -- banana tree leaves
   * minetest.register_node("ethereal:bananaleaves", {
   * 	description = S("Banana Leaves"),
   * 	drawtype = leaftype,
   * 	visual_scale = 1.2,
   * 	tiles = {"banana_leaf.png"},
   * 	inventory_image = "banana_leaf.png",
   * 	wield_image = "banana_leaf.png",
   * 	paramtype = "light",
   * 	walkable = ethereal.leafwalk,
   * 	waving = 1,
   * 	groups = {snappy = 3, leafdecay = 3, leaves = 1, flammable = 2},
   * 	drop = {
   * 		max_items = 1,
   * 		items = {
   * 			{items = {"ethereal:banana_tree_sapling"}, rarity = 10},
   * 			{items = {"ethereal:bananaleaves"}}
   * 		}
   * 	},
   * 	sounds = default.node_sound_leaves_defaults(),
   * 	after_place_node = default.after_place_leaves,
   * }) */
  lua_getfield(L,LUA_ENVIRONINDEX,"minetest");
  lua_pushliteral(L,"register_node");
  lua_gettable(L,-2);
  lua_remove(L,-2);
  lua_pushliteral(L,"ethereal:bananaleaves");
  lua_createtable(L,0,13);
  lua_pushliteral(L,"description");
  lua_pushvalue(L,(1 + lc_nextra));
  lua_pushliteral(L,"Banana Leaves");
  lua_call(L,1,1);
  lua_rawset(L,-3);
  lua_pushliteral(L,"drawtype");
  lua_pushvalue(L,(2 + lc_nextra));
  lua_rawset(L,-3);
  lua_pushliteral(L,"visual_scale");
  lua_pushnumber(L,1.2);
  lua_rawset(L,-3);
  lua_pushliteral(L,"tiles");
  lua_createtable(L,1,0);
  lua_pushliteral(L,"banana_leaf.png");
  lua_rawseti(L,-2,1);
  lua_rawset(L,-3);
  lua_pushliteral(L,"inventory_image");
  lua_pushliteral(L,"banana_leaf.png");
  lua_rawset(L,-3);
  lua_pushliteral(L,"wield_image");
  lua_pushliteral(L,"banana_leaf.png");
  lua_rawset(L,-3);
  lua_pushliteral(L,"paramtype");
  lua_pushliteral(L,"light");
  lua_rawset(L,-3);
  lua_pushliteral(L,"walkable");
  lua_getfield(L,LUA_ENVIRONINDEX,"ethereal");
  lua_pushliteral(L,"leafwalk");
  lua_gettable(L,-2);
  lua_remove(L,-2);
  lua_rawset(L,-3);
  lua_pushliteral(L,"waving");
  lua_pushnumber(L,1);
  lua_rawset(L,-3);
  lua_pushliteral(L,"groups");
  lua_createtable(L,0,4);
  lua_pushliteral(L,"snappy");
  lua_pushnumber(L,3);
  lua_rawset(L,-3);
  lua_pushliteral(L,"leafdecay");
  lua_pushnumber(L,3);
  lua_rawset(L,-3);
  lua_pushliteral(L,"leaves");
  lua_pushnumber(L,1);
  lua_rawset(L,-3);
  lua_pushliteral(L,"flammable");
  lua_pushnumber(L,2);
  lua_rawset(L,-3);
  lua_rawset(L,-3);
  lua_pushliteral(L,"drop");
  lua_createtable(L,0,2);
  lua_pushliteral(L,"max_items");
  lua_pushnumber(L,1);
  lua_rawset(L,-3);
  lua_pushliteral(L,"items");
  lua_createtable(L,2,0);
  lua_createtable(L,0,2);
  lua_pushliteral(L,"items");
  lua_createtable(L,1,0);
  lua_pushliteral(L,"ethereal:banana_tree_sapling");
  lua_rawseti(L,-2,1);
  lua_rawset(L,-3);
  lua_pushliteral(L,"rarity");
  lua_pushnumber(L,10);
  lua_rawset(L,-3);
  lua_rawseti(L,-2,1);
  lua_createtable(L,0,1);
  lua_pushliteral(L,"items");
  lua_createtable(L,1,0);
  lua_pushliteral(L,"ethereal:bananaleaves");
  lua_rawseti(L,-2,1);
  lua_rawset(L,-3);
  lua_rawseti(L,-2,2);
  lua_rawset(L,-3);
  lua_rawset(L,-3);
  lua_pushliteral(L,"sounds");
  lua_getfield(L,LUA_ENVIRONINDEX,"default");
  lua_pushliteral(L,"node_sound_leaves_defaults");
  lua_gettable(L,-2);
  lua_remove(L,-2);
  lua_call(L,0,1);
  lua_rawset(L,-3);
  lua_pushliteral(L,"after_place_node");
  lua_getfield(L,LUA_ENVIRONINDEX,"default");
  lua_pushliteral(L,"after_place_leaves");
  lua_gettable(L,-2);
  lua_remove(L,-2);
  lua_rawset(L,-3);
  lua_call(L,2,0);
  assert(lua_gettop(L) - lc_nextra == 2);
  
  /* -- healing tree leaves
   * minetest.register_node("ethereal:yellowleaves", {
   * 	description = S("Healing Tree Leaves"),
   * 	drawtype = leaftype,
   * 	visual_scale = 1.2,
   * 	tiles = {"yellow_leaves.png"},
   * 	inventory_image = "yellow_leaves.png",
   * 	wield_image = "yellow_leaves.png",
   * 	paramtype = "light",
   * 	walkable = ethereal.leafwalk,
   * 	waving = 1,
   * 	groups = {snappy = 3, leafdecay = 3, leaves = 1},
   * 	drop = {
   * 		max_items = 1,
   * 		items = {
   * 			{items = {"ethereal:yellow_tree_sapling"}, rarity = 50},
   * 			{items = {"ethereal:yellowleaves"}}
   * 		}
   * 	},
   * 	-- one leaf heals half a heart when eaten
   * 	on_use = minetest.item_eat(1),
   * 	sounds = default.node_sound_leaves_defaults(),
   * 	after_place_node = default.after_place_leaves,
   * 	light_source = 9,
   * }) */
  lua_getfield(L,LUA_ENVIRONINDEX,"minetest");
  lua_pushliteral(L,"register_node");
  lua_gettable(L,-2);
  lua_remove(L,-2);
  lua_pushliteral(L,"ethereal:yellowleaves");
  lua_createtable(L,0,15);
  lua_pushliteral(L,"description");
  lua_pushvalue(L,(1 + lc_nextra));
  lua_pushliteral(L,"Healing Tree Leaves");
  lua_call(L,1,1);
  lua_rawset(L,-3);
  lua_pushliteral(L,"drawtype");
  lua_pushvalue(L,(2 + lc_nextra));
  lua_rawset(L,-3);
  lua_pushliteral(L,"visual_scale");
  lua_pushnumber(L,1.2);
  lua_rawset(L,-3);
  lua_pushliteral(L,"tiles");
  lua_createtable(L,1,0);
  lua_pushliteral(L,"yellow_leaves.png");
  lua_rawseti(L,-2,1);
  lua_rawset(L,-3);
  lua_pushliteral(L,"inventory_image");
  lua_pushliteral(L,"yellow_leaves.png");
  lua_rawset(L,-3);
  lua_pushliteral(L,"wield_image");
  lua_pushliteral(L,"yellow_leaves.png");
  lua_rawset(L,-3);
  lua_pushliteral(L,"paramtype");
  lua_pushliteral(L,"light");
  lua_rawset(L,-3);
  lua_pushliteral(L,"walkable");
  lua_getfield(L,LUA_ENVIRONINDEX,"ethereal");
  lua_pushliteral(L,"leafwalk");
  lua_gettable(L,-2);
  lua_remove(L,-2);
  lua_rawset(L,-3);
  lua_pushliteral(L,"waving");
  lua_pushnumber(L,1);
  lua_rawset(L,-3);
  lua_pushliteral(L,"groups");
  lua_createtable(L,0,3);
  lua_pushliteral(L,"snappy");
  lua_pushnumber(L,3);
  lua_rawset(L,-3);
  lua_pushliteral(L,"leafdecay");
  lua_pushnumber(L,3);
  lua_rawset(L,-3);
  lua_pushliteral(L,"leaves");
  lua_pushnumber(L,1);
  lua_rawset(L,-3);
  lua_rawset(L,-3);
  lua_pushliteral(L,"drop");
  lua_createtable(L,0,2);
  lua_pushliteral(L,"max_items");
  lua_pushnumber(L,1);
  lua_rawset(L,-3);
  lua_pushliteral(L,"items");
  lua_createtable(L,2,0);
  lua_createtable(L,0,2);
  lua_pushliteral(L,"items");
  lua_createtable(L,1,0);
  lua_pushliteral(L,"ethereal:yellow_tree_sapling");
  lua_rawseti(L,-2,1);
  lua_rawset(L,-3);
  lua_pushliteral(L,"rarity");
  lua_pushnumber(L,50);
  lua_rawset(L,-3);
  lua_rawseti(L,-2,1);
  lua_createtable(L,0,1);
  lua_pushliteral(L,"items");
  lua_createtable(L,1,0);
  lua_pushliteral(L,"ethereal:yellowleaves");
  lua_rawseti(L,-2,1);
  lua_rawset(L,-3);
  lua_rawseti(L,-2,2);
  lua_rawset(L,-3);
  lua_rawset(L,-3);
  lua_pushliteral(L,"on_use");
  lua_getfield(L,LUA_ENVIRONINDEX,"minetest");
  lua_pushliteral(L,"item_eat");
  lua_gettable(L,-2);
  lua_remove(L,-2);
  lua_pushnumber(L,1);
  lua_call(L,1,1);
  lua_rawset(L,-3);
  lua_pushliteral(L,"sounds");
  lua_getfield(L,LUA_ENVIRONINDEX,"default");
  lua_pushliteral(L,"node_sound_leaves_defaults");
  lua_gettable(L,-2);
  lua_remove(L,-2);
  lua_call(L,0,1);
  lua_rawset(L,-3);
  lua_pushliteral(L,"after_place_node");
  lua_getfield(L,LUA_ENVIRONINDEX,"default");
  lua_pushliteral(L,"after_place_leaves");
  lua_gettable(L,-2);
  lua_remove(L,-2);
  lua_rawset(L,-3);
  lua_pushliteral(L,"light_source");
  lua_pushnumber(L,9);
  lua_rawset(L,-3);
  lua_call(L,2,0);
  assert(lua_gettop(L) - lc_nextra == 2);
  
  /* -- palm tree leaves
   * minetest.register_node("ethereal:palmleaves", {
   * 	description = S("Palm Leaves"),
   * 	drawtype = leaftype,
   * 	visual_scale = 1.2,
   * 	tiles = {"moretrees_palm_leaves.png"},
   * 	inventory_image = "moretrees_palm_leaves.png",
   * 	wield_image = "moretrees_palm_leaves.png",
   * 	paramtype = "light",
   * 	walkable = ethereal.leafwalk,
   * 	waving = 1,
   * 	groups = {snappy = 3, leafdecay = 3, leaves = 1, flammable = 2},
   * 	drop = {
   * 		max_items = 1,
   * 		items = {
   * 			{items = {"ethereal:palm_sapling"}, rarity = 10},
   * 			{items = {"ethereal:palmleaves"}}
   * 		}
   * 	},
   * 	sounds = default.node_sound_leaves_defaults(),
   * 	after_place_node = default.after_place_leaves,
   * }) */
  lua_getfield(L,LUA_ENVIRONINDEX,"minetest");
  lua_pushliteral(L,"register_node");
  lua_gettable(L,-2);
  lua_remove(L,-2);
  lua_pushliteral(L,"ethereal:palmleaves");
  lua_createtable(L,0,13);
  lua_pushliteral(L,"description");
  lua_pushvalue(L,(1 + lc_nextra));
  lua_pushliteral(L,"Palm Leaves");
  lua_call(L,1,1);
  lua_rawset(L,-3);
  lua_pushliteral(L,"drawtype");
  lua_pushvalue(L,(2 + lc_nextra));
  lua_rawset(L,-3);
  lua_pushliteral(L,"visual_scale");
  lua_pushnumber(L,1.2);
  lua_rawset(L,-3);
  lua_pushliteral(L,"tiles");
  lua_createtable(L,1,0);
  lua_pushliteral(L,"moretrees_palm_leaves.png");
  lua_rawseti(L,-2,1);
  lua_rawset(L,-3);
  lua_pushliteral(L,"inventory_image");
  lua_pushliteral(L,"moretrees_palm_leaves.png");
  lua_rawset(L,-3);
  lua_pushliteral(L,"wield_image");
  lua_pushliteral(L,"moretrees_palm_leaves.png");
  lua_rawset(L,-3);
  lua_pushliteral(L,"paramtype");
  lua_pushliteral(L,"light");
  lua_rawset(L,-3);
  lua_pushliteral(L,"walkable");
  lua_getfield(L,LUA_ENVIRONINDEX,"ethereal");
  lua_pushliteral(L,"leafwalk");
  lua_gettable(L,-2);
  lua_remove(L,-2);
  lua_rawset(L,-3);
  lua_pushliteral(L,"waving");
  lua_pushnumber(L,1);
  lua_rawset(L,-3);
  lua_pushliteral(L,"groups");
  lua_createtable(L,0,4);
  lua_pushliteral(L,"snappy");
  lua_pushnumber(L,3);
  lua_rawset(L,-3);
  lua_pushliteral(L,"leafdecay");
  lua_pushnumber(L,3);
  lua_rawset(L,-3);
  lua_pushliteral(L,"leaves");
  lua_pushnumber(L,1);
  lua_rawset(L,-3);
  lua_pushliteral(L,"flammable");
  lua_pushnumber(L,2);
  lua_rawset(L,-3);
  lua_rawset(L,-3);
  lua_pushliteral(L,"drop");
  lua_createtable(L,0,2);
  lua_pushliteral(L,"max_items");
  lua_pushnumber(L,1);
  lua_rawset(L,-3);
  lua_pushliteral(L,"items");
  lua_createtable(L,2,0);
  lua_createtable(L,0,2);
  lua_pushliteral(L,"items");
  lua_createtable(L,1,0);
  lua_pushliteral(L,"ethereal:palm_sapling");
  lua_rawseti(L,-2,1);
  lua_rawset(L,-3);
  lua_pushliteral(L,"rarity");
  lua_pushnumber(L,10);
  lua_rawset(L,-3);
  lua_rawseti(L,-2,1);
  lua_createtable(L,0,1);
  lua_pushliteral(L,"items");
  lua_createtable(L,1,0);
  lua_pushliteral(L,"ethereal:palmleaves");
  lua_rawseti(L,-2,1);
  lua_rawset(L,-3);
  lua_rawseti(L,-2,2);
  lua_rawset(L,-3);
  lua_rawset(L,-3);
  lua_pushliteral(L,"sounds");
  lua_getfield(L,LUA_ENVIRONINDEX,"default");
  lua_pushliteral(L,"node_sound_leaves_defaults");
  lua_gettable(L,-2);
  lua_remove(L,-2);
  lua_call(L,0,1);
  lua_rawset(L,-3);
  lua_pushliteral(L,"after_place_node");
  lua_getfield(L,LUA_ENVIRONINDEX,"default");
  lua_pushliteral(L,"after_place_leaves");
  lua_gettable(L,-2);
  lua_remove(L,-2);
  lua_rawset(L,-3);
  lua_call(L,2,0);
  assert(lua_gettop(L) - lc_nextra == 2);
  
  /* -- birch tree leaves
   * minetest.register_node("ethereal:birch_leaves", {
   * 	description = S("Birch Leaves"),
   * 	drawtype = leaftype,
   * 	visual_scale = 1.2,
   * 	tiles = {"moretrees_birch_leaves.png"},
   * 	inventory_image = "moretrees_birch_leaves.png",
   * 	wield_image = "moretrees_birch_leaves.png",
   * 	paramtype = "light",
   * 	walkable = ethereal.leafwalk,
   * 	waving = 1,
   * 	groups = {snappy = 3, leafdecay = 3, leaves = 1, flammable = 2},
   * 	drop = {
   * 		max_items = 1,
   * 		items = {
   * 			{items = {"ethereal:birch_sapling"}, rarity = 20},
   * 			{items = {"ethereal:birch_leaves"}}
   * 		}
   * 	},
   * 	sounds = default.node_sound_leaves_defaults(),
   * 	after_place_node = default.after_place_leaves,
   * }) */
  lua_getfield(L,LUA_ENVIRONINDEX,"minetest");
  lua_pushliteral(L,"register_node");
  lua_gettable(L,-2);
  lua_remove(L,-2);
  lua_pushliteral(L,"ethereal:birch_leaves");
  lua_createtable(L,0,13);
  lua_pushliteral(L,"description");
  lua_pushvalue(L,(1 + lc_nextra));
  lua_pushliteral(L,"Birch Leaves");
  lua_call(L,1,1);
  lua_rawset(L,-3);
  lua_pushliteral(L,"drawtype");
  lua_pushvalue(L,(2 + lc_nextra));
  lua_rawset(L,-3);
  lua_pushliteral(L,"visual_scale");
  lua_pushnumber(L,1.2);
  lua_rawset(L,-3);
  lua_pushliteral(L,"tiles");
  lua_createtable(L,1,0);
  lua_pushliteral(L,"moretrees_birch_leaves.png");
  lua_rawseti(L,-2,1);
  lua_rawset(L,-3);
  lua_pushliteral(L,"inventory_image");
  lua_pushliteral(L,"moretrees_birch_leaves.png");
  lua_rawset(L,-3);
  lua_pushliteral(L,"wield_image");
  lua_pushliteral(L,"moretrees_birch_leaves.png");
  lua_rawset(L,-3);
  lua_pushliteral(L,"paramtype");
  lua_pushliteral(L,"light");
  lua_rawset(L,-3);
  lua_pushliteral(L,"walkable");
  lua_getfield(L,LUA_ENVIRONINDEX,"ethereal");
  lua_pushliteral(L,"leafwalk");
  lua_gettable(L,-2);
  lua_remove(L,-2);
  lua_rawset(L,-3);
  lua_pushliteral(L,"waving");
  lua_pushnumber(L,1);
  lua_rawset(L,-3);
  lua_pushliteral(L,"groups");
  lua_createtable(L,0,4);
  lua_pushliteral(L,"snappy");
  lua_pushnumber(L,3);
  lua_rawset(L,-3);
  lua_pushliteral(L,"leafdecay");
  lua_pushnumber(L,3);
  lua_rawset(L,-3);
  lua_pushliteral(L,"leaves");
  lua_pushnumber(L,1);
  lua_rawset(L,-3);
  lua_pushliteral(L,"flammable");
  lua_pushnumber(L,2);
  lua_rawset(L,-3);
  lua_rawset(L,-3);
  lua_pushliteral(L,"drop");
  lua_createtable(L,0,2);
  lua_pushliteral(L,"max_items");
  lua_pushnumber(L,1);
  lua_rawset(L,-3);
  lua_pushliteral(L,"items");
  lua_createtable(L,2,0);
  lua_createtable(L,0,2);
  lua_pushliteral(L,"items");
  lua_createtable(L,1,0);
  lua_pushliteral(L,"ethereal:birch_sapling");
  lua_rawseti(L,-2,1);
  lua_rawset(L,-3);
  lua_pushliteral(L,"rarity");
  lua_pushnumber(L,20);
  lua_rawset(L,-3);
  lua_rawseti(L,-2,1);
  lua_createtable(L,0,1);
  lua_pushliteral(L,"items");
  lua_createtable(L,1,0);
  lua_pushliteral(L,"ethereal:birch_leaves");
  lua_rawseti(L,-2,1);
  lua_rawset(L,-3);
  lua_rawseti(L,-2,2);
  lua_rawset(L,-3);
  lua_rawset(L,-3);
  lua_pushliteral(L,"sounds");
  lua_getfield(L,LUA_ENVIRONINDEX,"default");
  lua_pushliteral(L,"node_sound_leaves_defaults");
  lua_gettable(L,-2);
  lua_remove(L,-2);
  lua_call(L,0,1);
  lua_rawset(L,-3);
  lua_pushliteral(L,"after_place_node");
  lua_getfield(L,LUA_ENVIRONINDEX,"default");
  lua_pushliteral(L,"after_place_leaves");
  lua_gettable(L,-2);
  lua_remove(L,-2);
  lua_rawset(L,-3);
  lua_call(L,2,0);
  assert(lua_gettop(L) - lc_nextra == 2);
  
  /* -- frost tree leaves
   * minetest.register_node("ethereal:frost_leaves", {
   * 	description = S("Frost Leaves"),
   * 	drawtype = leaftype,
   * 	visual_scale = 1.2,
   * 	tiles = {"ethereal_frost_leaves.png"},
   * 	inventory_image = "ethereal_frost_leaves.png",
   * 	wield_image = "ethereal_frost_leaves.png",
   * 	paramtype = "light",
   * 	walkable = ethereal.leafwalk,
   * 	waving = 1,
   * 	groups = {snappy = 3, leafdecay = 3, leaves = 1, puts_out_fire = 1},
   * 	drop = {
   * 		max_items = 1,
   * 		items = {
   * 			{items = {"ethereal:frost_tree_sapling"}, rarity = 15},
   * 			{items = {"ethereal:frost_leaves"}}
   * 		}
   * 	},
   * 	light_source = 9,
   * 	sounds = default.node_sound_leaves_defaults(),
   * 	after_place_node = default.after_place_leaves,
   * }) */
  lua_getfield(L,LUA_ENVIRONINDEX,"minetest");
  lua_pushliteral(L,"register_node");
  lua_gettable(L,-2);
  lua_remove(L,-2);
  lua_pushliteral(L,"ethereal:frost_leaves");
  lua_createtable(L,0,14);
  lua_pushliteral(L,"description");
  lua_pushvalue(L,(1 + lc_nextra));
  lua_pushliteral(L,"Frost Leaves");
  lua_call(L,1,1);
  lua_rawset(L,-3);
  lua_pushliteral(L,"drawtype");
  lua_pushvalue(L,(2 + lc_nextra));
  lua_rawset(L,-3);
  lua_pushliteral(L,"visual_scale");
  lua_pushnumber(L,1.2);
  lua_rawset(L,-3);
  lua_pushliteral(L,"tiles");
  lua_createtable(L,1,0);
  lua_pushliteral(L,"ethereal_frost_leaves.png");
  lua_rawseti(L,-2,1);
  lua_rawset(L,-3);
  lua_pushliteral(L,"inventory_image");
  lua_pushliteral(L,"ethereal_frost_leaves.png");
  lua_rawset(L,-3);
  lua_pushliteral(L,"wield_image");
  lua_pushliteral(L,"ethereal_frost_leaves.png");
  lua_rawset(L,-3);
  lua_pushliteral(L,"paramtype");
  lua_pushliteral(L,"light");
  lua_rawset(L,-3);
  lua_pushliteral(L,"walkable");
  lua_getfield(L,LUA_ENVIRONINDEX,"ethereal");
  lua_pushliteral(L,"leafwalk");
  lua_gettable(L,-2);
  lua_remove(L,-2);
  lua_rawset(L,-3);
  lua_pushliteral(L,"waving");
  lua_pushnumber(L,1);
  lua_rawset(L,-3);
  lua_pushliteral(L,"groups");
  lua_createtable(L,0,4);
  lua_pushliteral(L,"snappy");
  lua_pushnumber(L,3);
  lua_rawset(L,-3);
  lua_pushliteral(L,"leafdecay");
  lua_pushnumber(L,3);
  lua_rawset(L,-3);
  lua_pushliteral(L,"leaves");
  lua_pushnumber(L,1);
  lua_rawset(L,-3);
  lua_pushliteral(L,"puts_out_fire");
  lua_pushnumber(L,1);
  lua_rawset(L,-3);
  lua_rawset(L,-3);
  lua_pushliteral(L,"drop");
  lua_createtable(L,0,2);
  lua_pushliteral(L,"max_items");
  lua_pushnumber(L,1);
  lua_rawset(L,-3);
  lua_pushliteral(L,"items");
  lua_createtable(L,2,0);
  lua_createtable(L,0,2);
  lua_pushliteral(L,"items");
  lua_createtable(L,1,0);
  lua_pushliteral(L,"ethereal:frost_tree_sapling");
  lua_rawseti(L,-2,1);
  lua_rawset(L,-3);
  lua_pushliteral(L,"rarity");
  lua_pushnumber(L,15);
  lua_rawset(L,-3);
  lua_rawseti(L,-2,1);
  lua_createtable(L,0,1);
  lua_pushliteral(L,"items");
  lua_createtable(L,1,0);
  lua_pushliteral(L,"ethereal:frost_leaves");
  lua_rawseti(L,-2,1);
  lua_rawset(L,-3);
  lua_rawseti(L,-2,2);
  lua_rawset(L,-3);
  lua_rawset(L,-3);
  lua_pushliteral(L,"light_source");
  lua_pushnumber(L,9);
  lua_rawset(L,-3);
  lua_pushliteral(L,"sounds");
  lua_getfield(L,LUA_ENVIRONINDEX,"default");
  lua_pushliteral(L,"node_sound_leaves_defaults");
  lua_gettable(L,-2);
  lua_remove(L,-2);
  lua_call(L,0,1);
  lua_rawset(L,-3);
  lua_pushliteral(L,"after_place_node");
  lua_getfield(L,LUA_ENVIRONINDEX,"default");
  lua_pushliteral(L,"after_place_leaves");
  lua_gettable(L,-2);
  lua_remove(L,-2);
  lua_rawset(L,-3);
  lua_call(L,2,0);
  assert(lua_gettop(L) - lc_nextra == 2);
  
  /* -- bamboo stalk leaves
   * minetest.register_node("ethereal:bamboo_leaves", {
   * 	description = S("Bamboo Leaves"),
   * 	drawtype = leaftype,
   * 	visual_scale = 1.2,
   * 	tiles = {"bamboo_leaves.png"},
   * 	inventory_image = "bamboo_leaves.png",
   * 	wield_image = "bamboo_leaves.png",
   * 	paramtype = "light",
   * 	walkable = ethereal.leafwalk,
   * 	waving = 1,
   * 	groups = {snappy = 3, leafdecay = 3, leaves = 1, flammable = 2},
   * 	drop = {
   * 		max_items = 1,
   * 		items = {
   * 			{items = {"ethereal:bamboo_sprout"}, rarity = 10},
   * 			{items = {"ethereal:bamboo_leaves"}}
   * 		}
   * 	},
   * 	sounds = default.node_sound_leaves_defaults(),
   * 	after_place_node = default.after_place_leaves,
   * }) */
  lua_getfield(L,LUA_ENVIRONINDEX,"minetest");
  lua_pushliteral(L,"register_node");
  lua_gettable(L,-2);
  lua_remove(L,-2);
  lua_pushliteral(L,"ethereal:bamboo_leaves");
  lua_createtable(L,0,13);
  lua_pushliteral(L,"description");
  lua_pushvalue(L,(1 + lc_nextra));
  lua_pushliteral(L,"Bamboo Leaves");
  lua_call(L,1,1);
  lua_rawset(L,-3);
  lua_pushliteral(L,"drawtype");
  lua_pushvalue(L,(2 + lc_nextra));
  lua_rawset(L,-3);
  lua_pushliteral(L,"visual_scale");
  lua_pushnumber(L,1.2);
  lua_rawset(L,-3);
  lua_pushliteral(L,"tiles");
  lua_createtable(L,1,0);
  lua_pushliteral(L,"bamboo_leaves.png");
  lua_rawseti(L,-2,1);
  lua_rawset(L,-3);
  lua_pushliteral(L,"inventory_image");
  lua_pushliteral(L,"bamboo_leaves.png");
  lua_rawset(L,-3);
  lua_pushliteral(L,"wield_image");
  lua_pushliteral(L,"bamboo_leaves.png");
  lua_rawset(L,-3);
  lua_pushliteral(L,"paramtype");
  lua_pushliteral(L,"light");
  lua_rawset(L,-3);
  lua_pushliteral(L,"walkable");
  lua_getfield(L,LUA_ENVIRONINDEX,"ethereal");
  lua_pushliteral(L,"leafwalk");
  lua_gettable(L,-2);
  lua_remove(L,-2);
  lua_rawset(L,-3);
  lua_pushliteral(L,"waving");
  lua_pushnumber(L,1);
  lua_rawset(L,-3);
  lua_pushliteral(L,"groups");
  lua_createtable(L,0,4);
  lua_pushliteral(L,"snappy");
  lua_pushnumber(L,3);
  lua_rawset(L,-3);
  lua_pushliteral(L,"leafdecay");
  lua_pushnumber(L,3);
  lua_rawset(L,-3);
  lua_pushliteral(L,"leaves");
  lua_pushnumber(L,1);
  lua_rawset(L,-3);
  lua_pushliteral(L,"flammable");
  lua_pushnumber(L,2);
  lua_rawset(L,-3);
  lua_rawset(L,-3);
  lua_pushliteral(L,"drop");
  lua_createtable(L,0,2);
  lua_pushliteral(L,"max_items");
  lua_pushnumber(L,1);
  lua_rawset(L,-3);
  lua_pushliteral(L,"items");
  lua_createtable(L,2,0);
  lua_createtable(L,0,2);
  lua_pushliteral(L,"items");
  lua_createtable(L,1,0);
  lua_pushliteral(L,"ethereal:bamboo_sprout");
  lua_rawseti(L,-2,1);
  lua_rawset(L,-3);
  lua_pushliteral(L,"rarity");
  lua_pushnumber(L,10);
  lua_rawset(L,-3);
  lua_rawseti(L,-2,1);
  lua_createtable(L,0,1);
  lua_pushliteral(L,"items");
  lua_createtable(L,1,0);
  lua_pushliteral(L,"ethereal:bamboo_leaves");
  lua_rawseti(L,-2,1);
  lua_rawset(L,-3);
  lua_rawseti(L,-2,2);
  lua_rawset(L,-3);
  lua_rawset(L,-3);
  lua_pushliteral(L,"sounds");
  lua_getfield(L,LUA_ENVIRONINDEX,"default");
  lua_pushliteral(L,"node_sound_leaves_defaults");
  lua_gettable(L,-2);
  lua_remove(L,-2);
  lua_call(L,0,1);
  lua_rawset(L,-3);
  lua_pushliteral(L,"after_place_node");
  lua_getfield(L,LUA_ENVIRONINDEX,"default");
  lua_pushliteral(L,"after_place_leaves");
  lua_gettable(L,-2);
  lua_remove(L,-2);
  lua_rawset(L,-3);
  lua_call(L,2,0);
  assert(lua_gettop(L) - lc_nextra == 2);
  
  /* -- mushroom tops
   * minetest.register_node("ethereal:mushroom", {
   * 	description = S("Mushroom Cap"),
   * 	tiles = {"mushroom_block.png"},
   * 	groups = {choppy = 2, oddly_breakable_by_hand = 1, flammable = 2},
   * 	drop = {
   * 		max_items = 1,
   * 		items = {
   * 			{items = {"ethereal:mushroom_sapling"}, rarity = 20},
   * 			{items = {"ethereal:mushroom"}}
   * 		}
   * 	},
   * 	sounds = default.node_sound_wood_defaults(),
   * }) */
  lua_getfield(L,LUA_ENVIRONINDEX,"minetest");
  lua_pushliteral(L,"register_node");
  lua_gettable(L,-2);
  lua_remove(L,-2);
  lua_pushliteral(L,"ethereal:mushroom");
  lua_createtable(L,0,5);
  lua_pushliteral(L,"description");
  lua_pushvalue(L,(1 + lc_nextra));
  lua_pushliteral(L,"Mushroom Cap");
  lua_call(L,1,1);
  lua_rawset(L,-3);
  lua_pushliteral(L,"tiles");
  lua_createtable(L,1,0);
  lua_pushliteral(L,"mushroom_block.png");
  lua_rawseti(L,-2,1);
  lua_rawset(L,-3);
  lua_pushliteral(L,"groups");
  lua_createtable(L,0,3);
  lua_pushliteral(L,"choppy");
  lua_pushnumber(L,2);
  lua_rawset(L,-3);
  lua_pushliteral(L,"oddly_breakable_by_hand");
  lua_pushnumber(L,1);
  lua_rawset(L,-3);
  lua_pushliteral(L,"flammable");
  lua_pushnumber(L,2);
  lua_rawset(L,-3);
  lua_rawset(L,-3);
  lua_pushliteral(L,"drop");
  lua_createtable(L,0,2);
  lua_pushliteral(L,"max_items");
  lua_pushnumber(L,1);
  lua_rawset(L,-3);
  lua_pushliteral(L,"items");
  lua_createtable(L,2,0);
  lua_createtable(L,0,2);
  lua_pushliteral(L,"items");
  lua_createtable(L,1,0);
  lua_pushliteral(L,"ethereal:mushroom_sapling");
  lua_rawseti(L,-2,1);
  lua_rawset(L,-3);
  lua_pushliteral(L,"rarity");
  lua_pushnumber(L,20);
  lua_rawset(L,-3);
  lua_rawseti(L,-2,1);
  lua_createtable(L,0,1);
  lua_pushliteral(L,"items");
  lua_createtable(L,1,0);
  lua_pushliteral(L,"ethereal:mushroom");
  lua_rawseti(L,-2,1);
  lua_rawset(L,-3);
  lua_rawseti(L,-2,2);
  lua_rawset(L,-3);
  lua_rawset(L,-3);
  lua_pushliteral(L,"sounds");
  lua_getfield(L,LUA_ENVIRONINDEX,"default");
  lua_pushliteral(L,"node_sound_wood_defaults");
  lua_gettable(L,-2);
  lua_remove(L,-2);
  lua_call(L,0,1);
  lua_rawset(L,-3);
  lua_call(L,2,0);
  assert(lua_gettop(L) - lc_nextra == 2);
  
  /* minetest.register_craft({
   * 	type = "fuel",
   * 	recipe = "ethereal:mushroom",
   * 	burntime = 10,
   * }) */
  lua_getfield(L,LUA_ENVIRONINDEX,"minetest");
  lua_pushliteral(L,"register_craft");
  lua_gettable(L,-2);
  lua_remove(L,-2);
  lua_createtable(L,0,3);
  lua_pushliteral(L,"type");
  lua_pushliteral(L,"fuel");
  lua_rawset(L,-3);
  lua_pushliteral(L,"recipe");
  lua_pushliteral(L,"ethereal:mushroom");
  lua_rawset(L,-3);
  lua_pushliteral(L,"burntime");
  lua_pushnumber(L,10);
  lua_rawset(L,-3);
  lua_call(L,1,0);
  assert(lua_gettop(L) - lc_nextra == 2);
  
  /* -- mushroom pore (spongelike material found inside giant shrooms)
   * minetest.register_node("ethereal:mushroom_pore", {
   * 	description = S("Mushroom Pore"),
   * 	tiles = {"mushroom_pore.png"},
   * 	groups = {
   * 		snappy = 3, cracky = 3, choppy = 3, oddly_breakable_by_hand = 3,
   * 		flammable = 2, disable_jump = 1, fall_damage_add_percent = -100
   * 	},
   * 	sounds = default.node_sound_dirt_defaults(),
   * }) */
  lua_getfield(L,LUA_ENVIRONINDEX,"minetest");
  lua_pushliteral(L,"register_node");
  lua_gettable(L,-2);
  lua_remove(L,-2);
  lua_pushliteral(L,"ethereal:mushroom_pore");
  lua_createtable(L,0,4);
  lua_pushliteral(L,"description");
  lua_pushvalue(L,(1 + lc_nextra));
  lua_pushliteral(L,"Mushroom Pore");
  lua_call(L,1,1);
  lua_rawset(L,-3);
  lua_pushliteral(L,"tiles");
  lua_createtable(L,1,0);
  lua_pushliteral(L,"mushroom_pore.png");
  lua_rawseti(L,-2,1);
  lua_rawset(L,-3);
  lua_pushliteral(L,"groups");
  lua_createtable(L,0,7);
  lua_pushliteral(L,"snappy");
  lua_pushnumber(L,3);
  lua_rawset(L,-3);
  lua_pushliteral(L,"cracky");
  lua_pushnumber(L,3);
  lua_rawset(L,-3);
  lua_pushliteral(L,"choppy");
  lua_pushnumber(L,3);
  lua_rawset(L,-3);
  lua_pushliteral(L,"oddly_breakable_by_hand");
  lua_pushnumber(L,3);
  lua_rawset(L,-3);
  lua_pushliteral(L,"flammable");
  lua_pushnumber(L,2);
  lua_rawset(L,-3);
  lua_pushliteral(L,"disable_jump");
  lua_pushnumber(L,1);
  lua_rawset(L,-3);
  lua_pushliteral(L,"fall_damage_add_percent");
  lua_pushnumber(L,-100);
  lua_rawset(L,-3);
  lua_rawset(L,-3);
  lua_pushliteral(L,"sounds");
  lua_getfield(L,LUA_ENVIRONINDEX,"default");
  lua_pushliteral(L,"node_sound_dirt_defaults");
  lua_gettable(L,-2);
  lua_remove(L,-2);
  lua_call(L,0,1);
  lua_rawset(L,-3);
  lua_call(L,2,0);
  assert(lua_gettop(L) - lc_nextra == 2);
  
  /* -- hedge block
   * minetest.register_node("ethereal:bush", {
   * 	description = S("Bush"),
   * 	tiles = {"ethereal_bush.png"},
   * 	walkable = true,
   * 	groups = {snappy = 3, flammable = 2},
   * 	sounds = default.node_sound_leaves_defaults(),
   * }) */
  lua_getfield(L,LUA_ENVIRONINDEX,"minetest");
  lua_pushliteral(L,"register_node");
  lua_gettable(L,-2);
  lua_remove(L,-2);
  lua_pushliteral(L,"ethereal:bush");
  lua_createtable(L,0,5);
  lua_pushliteral(L,"description");
  lua_pushvalue(L,(1 + lc_nextra));
  lua_pushliteral(L,"Bush");
  lua_call(L,1,1);
  lua_rawset(L,-3);
  lua_pushliteral(L,"tiles");
  lua_createtable(L,1,0);
  lua_pushliteral(L,"ethereal_bush.png");
  lua_rawseti(L,-2,1);
  lua_rawset(L,-3);
  lua_pushliteral(L,"walkable");
  lua_pushboolean(L,1);
  lua_rawset(L,-3);
  lua_pushliteral(L,"groups");
  lua_createtable(L,0,2);
  lua_pushliteral(L,"snappy");
  lua_pushnumber(L,3);
  lua_rawset(L,-3);
  lua_pushliteral(L,"flammable");
  lua_pushnumber(L,2);
  lua_rawset(L,-3);
  lua_rawset(L,-3);
  lua_pushliteral(L,"sounds");
  lua_getfield(L,LUA_ENVIRONINDEX,"default");
  lua_pushliteral(L,"node_sound_leaves_defaults");
  lua_gettable(L,-2);
  lua_remove(L,-2);
  lua_call(L,0,1);
  lua_rawset(L,-3);
  lua_call(L,2,0);
  assert(lua_gettop(L) - lc_nextra == 2);
  
  /* minetest.register_craft({
   * 	output = "ethereal:bush",
   * 	recipe = {
   * 		{"group:leaves", "group:leaves", "group:leaves"},
   * 		{"group:leaves", "ethereal:bamboo_leaves", "group:leaves"},
   * 		{"group:leaves", "group:leaves", "group:leaves"},
   * 	}
   * }) */
  lua_getfield(L,LUA_ENVIRONINDEX,"minetest");
  lua_pushliteral(L,"register_craft");
  lua_gettable(L,-2);
  lua_remove(L,-2);
  lua_createtable(L,0,2);
  lua_pushliteral(L,"output");
  lua_pushliteral(L,"ethereal:bush");
  lua_rawset(L,-3);
  lua_pushliteral(L,"recipe");
  lua_createtable(L,3,0);
  lua_createtable(L,3,0);
  lua_pushliteral(L,"group:leaves");
  lua_rawseti(L,-2,1);
  lua_pushliteral(L,"group:leaves");
  lua_rawseti(L,-2,2);
  lua_pushliteral(L,"group:leaves");
  lua_rawseti(L,-2,3);
  lua_rawseti(L,-2,1);
  lua_createtable(L,3,0);
  lua_pushliteral(L,"group:leaves");
  lua_rawseti(L,-2,1);
  lua_pushliteral(L,"ethereal:bamboo_leaves");
  lua_rawseti(L,-2,2);
  lua_pushliteral(L,"group:leaves");
  lua_rawseti(L,-2,3);
  lua_rawseti(L,-2,2);
  lua_createtable(L,3,0);
  lua_pushliteral(L,"group:leaves");
  lua_rawseti(L,-2,1);
  lua_pushliteral(L,"group:leaves");
  lua_rawseti(L,-2,2);
  lua_pushliteral(L,"group:leaves");
  lua_rawseti(L,-2,3);
  lua_rawseti(L,-2,3);
  lua_rawset(L,-3);
  lua_call(L,1,0);
  assert(lua_gettop(L) - lc_nextra == 2);
  
  /* -- bush block #2
   * minetest.register_node("ethereal:bush2", {
   * 	drawtype = "allfaces_optional",
   * 	description = S("Bush #2"),
   * 	tiles = {"default_aspen_leaves.png"},
   * 	paramtype = "light",
   * 	walkable = true,
   * 	groups = {snappy = 3, flammable = 2},
   * 	sounds = default.node_sound_leaves_defaults(),
   * }) */
  lua_getfield(L,LUA_ENVIRONINDEX,"minetest");
  lua_pushliteral(L,"register_node");
  lua_gettable(L,-2);
  lua_remove(L,-2);
  lua_pushliteral(L,"ethereal:bush2");
  lua_createtable(L,0,7);
  lua_pushliteral(L,"drawtype");
  lua_pushliteral(L,"allfaces_optional");
  lua_rawset(L,-3);
  lua_pushliteral(L,"description");
  lua_pushvalue(L,(1 + lc_nextra));
  lua_pushliteral(L,"Bush #2");
  lua_call(L,1,1);
  lua_rawset(L,-3);
  lua_pushliteral(L,"tiles");
  lua_createtable(L,1,0);
  lua_pushliteral(L,"default_aspen_leaves.png");
  lua_rawseti(L,-2,1);
  lua_rawset(L,-3);
  lua_pushliteral(L,"paramtype");
  lua_pushliteral(L,"light");
  lua_rawset(L,-3);
  lua_pushliteral(L,"walkable");
  lua_pushboolean(L,1);
  lua_rawset(L,-3);
  lua_pushliteral(L,"groups");
  lua_createtable(L,0,2);
  lua_pushliteral(L,"snappy");
  lua_pushnumber(L,3);
  lua_rawset(L,-3);
  lua_pushliteral(L,"flammable");
  lua_pushnumber(L,2);
  lua_rawset(L,-3);
  lua_rawset(L,-3);
  lua_pushliteral(L,"sounds");
  lua_getfield(L,LUA_ENVIRONINDEX,"default");
  lua_pushliteral(L,"node_sound_leaves_defaults");
  lua_gettable(L,-2);
  lua_remove(L,-2);
  lua_call(L,0,1);
  lua_rawset(L,-3);
  lua_call(L,2,0);
  assert(lua_gettop(L) - lc_nextra == 2);
  
  /* minetest.register_craft({
   * 	output = "ethereal:bush2",
   * 	recipe = {
   * 		{"group:leaves", "group:leaves", "group:leaves"},
   * 		{"group:leaves", "default:aspen_leaves", "group:leaves"},
   * 		{"group:leaves", "group:leaves", "group:leaves"},
   * 	}
   * }) */
  lua_getfield(L,LUA_ENVIRONINDEX,"minetest");
  lua_pushliteral(L,"register_craft");
  lua_gettable(L,-2);
  lua_remove(L,-2);
  lua_createtable(L,0,2);
  lua_pushliteral(L,"output");
  lua_pushliteral(L,"ethereal:bush2");
  lua_rawset(L,-3);
  lua_pushliteral(L,"recipe");
  lua_createtable(L,3,0);
  lua_createtable(L,3,0);
  lua_pushliteral(L,"group:leaves");
  lua_rawseti(L,-2,1);
  lua_pushliteral(L,"group:leaves");
  lua_rawseti(L,-2,2);
  lua_pushliteral(L,"group:leaves");
  lua_rawseti(L,-2,3);
  lua_rawseti(L,-2,1);
  lua_createtable(L,3,0);
  lua_pushliteral(L,"group:leaves");
  lua_rawseti(L,-2,1);
  lua_pushliteral(L,"default:aspen_leaves");
  lua_rawseti(L,-2,2);
  lua_pushliteral(L,"group:leaves");
  lua_rawseti(L,-2,3);
  lua_rawseti(L,-2,2);
  lua_createtable(L,3,0);
  lua_pushliteral(L,"group:leaves");
  lua_rawseti(L,-2,1);
  lua_pushliteral(L,"group:leaves");
  lua_rawseti(L,-2,2);
  lua_pushliteral(L,"group:leaves");
  lua_rawseti(L,-2,3);
  lua_rawseti(L,-2,3);
  lua_rawset(L,-3);
  lua_call(L,1,0);
  assert(lua_gettop(L) - lc_nextra == 2);
  
  /* -- bush block #3
   * minetest.register_node("ethereal:bush3", {
   * 	drawtype = "allfaces_optional",
   * 	description = S("Bush #3"),
   * 	tiles = {"default_pine_needles.png"},
   * 	paramtype = "light",
   * 	walkable = true,
   * 	groups = {snappy = 3, flammable = 2},
   * 	sounds = default.node_sound_leaves_defaults(),
   * }) */
  lua_getfield(L,LUA_ENVIRONINDEX,"minetest");
  lua_pushliteral(L,"register_node");
  lua_gettable(L,-2);
  lua_remove(L,-2);
  lua_pushliteral(L,"ethereal:bush3");
  lua_createtable(L,0,7);
  lua_pushliteral(L,"drawtype");
  lua_pushliteral(L,"allfaces_optional");
  lua_rawset(L,-3);
  lua_pushliteral(L,"description");
  lua_pushvalue(L,(1 + lc_nextra));
  lua_pushliteral(L,"Bush #3");
  lua_call(L,1,1);
  lua_rawset(L,-3);
  lua_pushliteral(L,"tiles");
  lua_createtable(L,1,0);
  lua_pushliteral(L,"default_pine_needles.png");
  lua_rawseti(L,-2,1);
  lua_rawset(L,-3);
  lua_pushliteral(L,"paramtype");
  lua_pushliteral(L,"light");
  lua_rawset(L,-3);
  lua_pushliteral(L,"walkable");
  lua_pushboolean(L,1);
  lua_rawset(L,-3);
  lua_pushliteral(L,"groups");
  lua_createtable(L,0,2);
  lua_pushliteral(L,"snappy");
  lua_pushnumber(L,3);
  lua_rawset(L,-3);
  lua_pushliteral(L,"flammable");
  lua_pushnumber(L,2);
  lua_rawset(L,-3);
  lua_rawset(L,-3);
  lua_pushliteral(L,"sounds");
  lua_getfield(L,LUA_ENVIRONINDEX,"default");
  lua_pushliteral(L,"node_sound_leaves_defaults");
  lua_gettable(L,-2);
  lua_remove(L,-2);
  lua_call(L,0,1);
  lua_rawset(L,-3);
  lua_call(L,2,0);
  assert(lua_gettop(L) - lc_nextra == 2);
  
  /* minetest.register_craft({
   * 	output = "ethereal:bush3",
   * 	recipe = {
   * 		{"group:leaves", "group:leaves", "group:leaves"},
   * 		{"group:leaves", "default:pine_needles", "group:leaves"},
   * 		{"group:leaves", "group:leaves", "group:leaves"},
   * 	}
   * }) */
  lua_getfield(L,LUA_ENVIRONINDEX,"minetest");
  lua_pushliteral(L,"register_craft");
  lua_gettable(L,-2);
  lua_remove(L,-2);
  lua_createtable(L,0,2);
  lua_pushliteral(L,"output");
  lua_pushliteral(L,"ethereal:bush3");
  lua_rawset(L,-3);
  lua_pushliteral(L,"recipe");
  lua_createtable(L,3,0);
  lua_createtable(L,3,0);
  lua_pushliteral(L,"group:leaves");
  lua_rawseti(L,-2,1);
  lua_pushliteral(L,"group:leaves");
  lua_rawseti(L,-2,2);
  lua_pushliteral(L,"group:leaves");
  lua_rawseti(L,-2,3);
  lua_rawseti(L,-2,1);
  lua_createtable(L,3,0);
  lua_pushliteral(L,"group:leaves");
  lua_rawseti(L,-2,1);
  lua_pushliteral(L,"default:pine_needles");
  lua_rawseti(L,-2,2);
  lua_pushliteral(L,"group:leaves");
  lua_rawseti(L,-2,3);
  lua_rawseti(L,-2,2);
  lua_createtable(L,3,0);
  lua_pushliteral(L,"group:leaves");
  lua_rawseti(L,-2,1);
  lua_pushliteral(L,"group:leaves");
  lua_rawseti(L,-2,2);
  lua_pushliteral(L,"group:leaves");
  lua_rawseti(L,-2,3);
  lua_rawseti(L,-2,3);
  lua_rawset(L,-3);
  lua_call(L,1,0);
  assert(lua_gettop(L) - lc_nextra == 2);
  return 0;
}


/* from lua.c */
static int traceback (lua_State *L) {
  if (!lua_isstring(L, 1))  /* 'message' not a string? */
    return 1;  /* keep it intact */
  lua_getfield(L, LUA_GLOBALSINDEX, "debug");
  if (!lua_istable(L, -1)) {
    lua_pop(L, 1);
    return 1;
  }
  lua_getfield(L, -1, "traceback");
  if (!lua_isfunction(L, -1)) {
    lua_pop(L, 2);
    return 1;
  }
  lua_pushvalue(L, 1);  /* pass error message */
  lua_pushinteger(L, 2);  /* skip this function and traceback */
  lua_call(L, 2, 1);  /* call debug.traceback */
  return 1;
}


static void lc_l_message (const char *pname, const char *msg) {
  if (pname) fprintf(stderr, "%s: ", pname);
  fprintf(stderr, "%s\n", msg);
  fflush(stderr);
}

static int lc_report (lua_State *L, int status) {
  if (status && !lua_isnil(L, -1)) {
    const char *msg = lua_tostring(L, -1);
    if (msg == NULL) msg = "(error object is not a string)";
    /*FIX-IMROVE:progname*/
    lc_l_message("lua", msg);
    lua_pop(L, 1);
  }
  return status;
}

static int lc_docall (lua_State *L, int narg, int clear) {
  int status;
  int base = lua_gettop(L) - narg;  /* function index */
  lua_pushcfunction(L, traceback);  /* push traceback function */
  lua_insert(L, base);  /* put it under chunk and args */
  /*FIX? signal(SIGINT, laction); */
  status = lua_pcall(L, narg, (clear ? 0 : LUA_MULTRET), base);
  /*FIX? signal(SIGINT, SIG_DFL); */
  lua_remove(L, base);  /* remove traceback function */
  /* force a complete garbage collection in case of errors */
  if (status != 0) lua_gc(L, LUA_GCCOLLECT, 0);
  return status;
}

static int lc_dofile (lua_State *L, const char *name) {
  int status = luaL_loadfile(L, name) || lc_docall(L, 0, 1);
  return lc_report(L, status);
}

static int lc_dostring (lua_State *L, const char *s, const char *name) {
  int status = luaL_loadbuffer(L, s, strlen(s), name) || lc_docall(L, 0, 1);
  return lc_report(L, status);
}

static int lc_handle_luainit (lua_State *L) {
  const char *init = getenv(LUA_INIT);
  if (init == NULL) return 0;  /* status OK */
  else if (init[0] == '@')
    return lc_dofile(L, init+1);
  else
    return lc_dostring(L, init, "=" LUA_INIT);
}


typedef struct {
  int c;
  const char ** v;
} lc_args_t;


/* create global arg table */
static void lc_createarg(lua_State * L, const lc_args_t * const args) {
  int i;
  lua_newtable(L);
  for (i=0; i < args->c; i++) {
    lua_pushstring(L, args->v[i]);
    lua_rawseti(L, -2, i);
  }
  lua_setglobal(L, "arg");
}


int lc_pmain_mod_ethereal_leaves(lua_State * L) {
  luaL_openlibs(L);

  lua_pushcfunction(L, traceback);

  const int status1 = lc_handle_luainit(L);
  if (status1 != 0) return 0;

  /* note: IMPROVE: closure not always needed here */
  lua_newtable(L); /* closure table */
  lua_pushcclosure(L, lcf_main, 1);

  int status2 = lua_pcall(L, 0, 0, -2);
  if (status2 != 0) {
    const char * msg = lua_tostring(L,-1);
    if (msg == NULL) msg = "(error object is not a string)";
    fputs(msg, stderr);
  }
  return 0;
}


