/* WARNING: This file was automatically generated by lua2c. */

#ifdef __cplusplus
extern "C" {
#endif
#include <lua.h>
#include <lauxlib.h>
#include <lualib.h>
#ifdef __cplusplus
}
#endif
#include <stdio.h>
#include <stdlib.h>


#include <string.h>


/* pushes new closure table onto the stack, using closure table at
 * given index as its parent */
static void lc_newclosuretable(lua_State * L, int idx) {

  lua_newtable(L);
  lua_pushvalue(L,idx);
  lua_rawseti(L,-2,0);


}

#include <assert.h>

/* gets upvalue with ID varid by consulting upvalue table at index
 * tidx for the upvalue table at given nesting level. */
static void lc_getupvalue(lua_State * L, int tidx, int level, int varid) {
  if (level == 0) {
    lua_rawgeti(L,tidx,varid);
  }
  else {
    lua_pushvalue(L,tidx);
    while (--level >= 0) {
      lua_rawgeti(L,tidx,0); /* 0 links to parent table */
      lua_remove(L,-2);
      tidx = -1;
    }
    lua_rawgeti(L,-1,varid);
    lua_remove(L,-2);
  }
}


/* function(pos, node, puncher) */
static int lcf2 (lua_State * L) {
  enum { lc_nformalargs = 3 };
  lua_settop(L,3);
  
  /* puncher:punch(puncher, 1.0, {
   * 			full_punch_interval = 1.0,
   * 			damage_groups = {fleshy = 2}
   * 		}, nil) */
  lua_pushvalue(L,3);
  lua_pushliteral(L,"punch");
  lua_gettable(L,-2);
  lua_insert(L,-2);
  lua_pushvalue(L,3);
  lua_pushnumber(L,1);
  lua_createtable(L,0,2);
  lua_pushliteral(L,"full_punch_interval");
  lua_pushnumber(L,1);
  lua_rawset(L,-3);
  lua_pushliteral(L,"damage_groups");
  lua_createtable(L,0,1);
  lua_pushliteral(L,"fleshy");
  lua_pushnumber(L,2);
  lua_rawset(L,-3);
  lua_rawset(L,-3);
  lua_pushnil(L);
  lua_call(L,5,0);
  assert(lua_gettop(L) == 3);
  return 0;
}


/* name: ethereal.add_moss
 * function(typ, descr, texture, receipe_item) */
static int lcf1_ethereal_add_moss (lua_State * L) {
  enum { lc_nformalargs = 4 };
  lua_settop(L,4);
  
  /* minetest.register_node("ethereal:" .. typ .. "_moss", {
   * 		description = S(descr .. " Moss"),
   * 		tiles = {texture},
   * 		groups = {crumbly = 3},
   * 		sounds = default.node_sound_dirt_defaults()
   * 	}) */
  lua_getfield(L,LUA_ENVIRONINDEX,"minetest");
  lua_pushliteral(L,"register_node");
  lua_gettable(L,-2);
  lua_remove(L,-2);
  lua_pushliteral(L,"ethereal:");
  lua_pushvalue(L,1);
  lua_pushliteral(L,"_moss");
  lua_concat(L,2);
  lua_concat(L,2);
  lua_createtable(L,0,4);
  lua_pushliteral(L,"description");
  lc_getupvalue(L,lua_upvalueindex(1),0,1);
  lua_pushvalue(L,2);
  lua_pushliteral(L," Moss");
  lua_concat(L,2);
  lua_call(L,1,1);
  lua_rawset(L,-3);
  lua_pushliteral(L,"tiles");
  lua_createtable(L,1,0);
  lua_pushvalue(L,3);
  lua_rawseti(L,-2,1);
  lua_rawset(L,-3);
  lua_pushliteral(L,"groups");
  lua_createtable(L,0,1);
  lua_pushliteral(L,"crumbly");
  lua_pushnumber(L,3);
  lua_rawset(L,-3);
  lua_rawset(L,-3);
  lua_pushliteral(L,"sounds");
  lua_getfield(L,LUA_ENVIRONINDEX,"default");
  lua_pushliteral(L,"node_sound_dirt_defaults");
  lua_gettable(L,-2);
  lua_remove(L,-2);
  lua_call(L,0,1);
  lua_rawset(L,-3);
  lua_call(L,2,0);
  assert(lua_gettop(L) == 4);
  
  /* minetest.register_craft({
   * 		output = "ethereal:"..typ.."_moss",
   * 		recipe = {{"default:dirt", receipe_item }}
   * 	}) */
  lua_getfield(L,LUA_ENVIRONINDEX,"minetest");
  lua_pushliteral(L,"register_craft");
  lua_gettable(L,-2);
  lua_remove(L,-2);
  lua_createtable(L,0,2);
  lua_pushliteral(L,"output");
  lua_pushliteral(L,"ethereal:");
  lua_pushvalue(L,1);
  lua_pushliteral(L,"_moss");
  lua_concat(L,2);
  lua_concat(L,2);
  lua_rawset(L,-3);
  lua_pushliteral(L,"recipe");
  lua_createtable(L,1,0);
  lua_createtable(L,2,0);
  lua_pushliteral(L,"default:dirt");
  lua_rawseti(L,-2,1);
  lua_pushvalue(L,4);
  lua_rawseti(L,-2,2);
  lua_rawseti(L,-2,1);
  lua_rawset(L,-3);
  lua_call(L,1,0);
  assert(lua_gettop(L) == 4);
  return 0;
}


/* name: (main)
 * function(...) */
static int lcf_main (lua_State * L) {
  enum { lc_nformalargs = 0 };
  const int lc_nactualargs = lua_gettop(L);
  const int lc_nextra = (lc_nactualargs - lc_nformalargs);
  
  /* local S = ethereal.intllib */
  lc_newclosuretable(L,lua_upvalueindex(1));
  enum { lc1 = 1 };
  assert((lua_gettop(L) == (lc1 + lc_nextra)));
  lua_getfield(L,LUA_ENVIRONINDEX,"ethereal");
  lua_pushliteral(L,"intllib");
  lua_gettable(L,-2);
  lua_remove(L,-2);
  lua_rawseti(L,(lc1 + lc_nextra),1);
  assert(lua_gettop(L) - lc_nextra == 1);
  
  /* -- Fire Flower
   * minetest.register_node("ethereal:fire_flower", {
   * 	description = S("Fire Flower"),
   * 	drawtype = "plantlike",
   * 	tiles = { "ethereal_fire_flower.png" },
   * 	inventory_image = "ethereal_fire_flower.png",
   * 	wield_image = "ethereal_fire_flower.png",
   * 	paramtype = "light",
   * 	light_source = 5,
   * 	sunlight_propagates = true,
   * 	walkable = false,
   * 	buildable_to = true,
   * 	damage_per_second = 2,
   * 	groups = {snappy = 1, oddly_breakable_by_hand = 3, igniter = 2},
   * 	sounds = default.node_sound_leaves_defaults(),
   * 	selection_box = {
   * 		type = "fixed",
   * 		fixed = {-0.5, -0.5, -0.5, 0.5, -5/16, 0.5},
   * 	},
   * 
   * 	on_punch = function(pos, node, puncher)
   * 
   * 		puncher:punch(puncher, 1.0, {
   * 			full_punch_interval = 1.0,
   * 			damage_groups = {fleshy = 2}
   * 		}, nil)
   * 	end,
   * }) */
  lua_getfield(L,LUA_ENVIRONINDEX,"minetest");
  lua_pushliteral(L,"register_node");
  lua_gettable(L,-2);
  lua_remove(L,-2);
  lua_pushliteral(L,"ethereal:fire_flower");
  lua_createtable(L,0,15);
  lua_pushliteral(L,"description");
  lc_getupvalue(L,(lc1 + lc_nextra),0,1);
  lua_pushliteral(L,"Fire Flower");
  lua_call(L,1,1);
  lua_rawset(L,-3);
  lua_pushliteral(L,"drawtype");
  lua_pushliteral(L,"plantlike");
  lua_rawset(L,-3);
  lua_pushliteral(L,"tiles");
  lua_createtable(L,1,0);
  lua_pushliteral(L,"ethereal_fire_flower.png");
  lua_rawseti(L,-2,1);
  lua_rawset(L,-3);
  lua_pushliteral(L,"inventory_image");
  lua_pushliteral(L,"ethereal_fire_flower.png");
  lua_rawset(L,-3);
  lua_pushliteral(L,"wield_image");
  lua_pushliteral(L,"ethereal_fire_flower.png");
  lua_rawset(L,-3);
  lua_pushliteral(L,"paramtype");
  lua_pushliteral(L,"light");
  lua_rawset(L,-3);
  lua_pushliteral(L,"light_source");
  lua_pushnumber(L,5);
  lua_rawset(L,-3);
  lua_pushliteral(L,"sunlight_propagates");
  lua_pushboolean(L,1);
  lua_rawset(L,-3);
  lua_pushliteral(L,"walkable");
  lua_pushboolean(L,0);
  lua_rawset(L,-3);
  lua_pushliteral(L,"buildable_to");
  lua_pushboolean(L,1);
  lua_rawset(L,-3);
  lua_pushliteral(L,"damage_per_second");
  lua_pushnumber(L,2);
  lua_rawset(L,-3);
  lua_pushliteral(L,"groups");
  lua_createtable(L,0,3);
  lua_pushliteral(L,"snappy");
  lua_pushnumber(L,1);
  lua_rawset(L,-3);
  lua_pushliteral(L,"oddly_breakable_by_hand");
  lua_pushnumber(L,3);
  lua_rawset(L,-3);
  lua_pushliteral(L,"igniter");
  lua_pushnumber(L,2);
  lua_rawset(L,-3);
  lua_rawset(L,-3);
  lua_pushliteral(L,"sounds");
  lua_getfield(L,LUA_ENVIRONINDEX,"default");
  lua_pushliteral(L,"node_sound_leaves_defaults");
  lua_gettable(L,-2);
  lua_remove(L,-2);
  lua_call(L,0,1);
  lua_rawset(L,-3);
  lua_pushliteral(L,"selection_box");
  lua_createtable(L,0,2);
  lua_pushliteral(L,"type");
  lua_pushliteral(L,"fixed");
  lua_rawset(L,-3);
  lua_pushliteral(L,"fixed");
  lua_createtable(L,6,0);
  lua_pushnumber(L,-0.5);
  lua_rawseti(L,-2,1);
  lua_pushnumber(L,-0.5);
  lua_rawseti(L,-2,2);
  lua_pushnumber(L,-0.5);
  lua_rawseti(L,-2,3);
  lua_pushnumber(L,0.5);
  lua_rawseti(L,-2,4);
  lua_pushnumber(L,-0.3125);
  lua_rawseti(L,-2,5);
  lua_pushnumber(L,0.5);
  lua_rawseti(L,-2,6);
  lua_rawset(L,-3);
  lua_rawset(L,-3);
  lua_pushliteral(L,"on_punch");
  lua_pushcfunction(L,lcf2);
  lua_rawset(L,-3);
  lua_call(L,2,0);
  assert(lua_gettop(L) - lc_nextra == 1);
  
  /* minetest.register_craft({
   * 	type = "fuel",
   * 	recipe = "ethereal:fire_flower",
   * 	burntime = 20,
   * }) */
  lua_getfield(L,LUA_ENVIRONINDEX,"minetest");
  lua_pushliteral(L,"register_craft");
  lua_gettable(L,-2);
  lua_remove(L,-2);
  lua_createtable(L,0,3);
  lua_pushliteral(L,"type");
  lua_pushliteral(L,"fuel");
  lua_rawset(L,-3);
  lua_pushliteral(L,"recipe");
  lua_pushliteral(L,"ethereal:fire_flower");
  lua_rawset(L,-3);
  lua_pushliteral(L,"burntime");
  lua_pushnumber(L,20);
  lua_rawset(L,-3);
  lua_call(L,1,0);
  assert(lua_gettop(L) - lc_nextra == 1);
  
  /* -- Fire Dust
   * minetest.register_craftitem("ethereal:fire_dust", {
   * 	description = S("Fire Dust"),
   * 	inventory_image = "fire_dust.png",
   * }) */
  lua_getfield(L,LUA_ENVIRONINDEX,"minetest");
  lua_pushliteral(L,"register_craftitem");
  lua_gettable(L,-2);
  lua_remove(L,-2);
  lua_pushliteral(L,"ethereal:fire_dust");
  lua_createtable(L,0,2);
  lua_pushliteral(L,"description");
  lc_getupvalue(L,(lc1 + lc_nextra),0,1);
  lua_pushliteral(L,"Fire Dust");
  lua_call(L,1,1);
  lua_rawset(L,-3);
  lua_pushliteral(L,"inventory_image");
  lua_pushliteral(L,"fire_dust.png");
  lua_rawset(L,-3);
  lua_call(L,2,0);
  assert(lua_gettop(L) - lc_nextra == 1);
  
  /* minetest.register_craft({
   * 	output = "ethereal:fire_dust 2",
   * 	recipe = {
   * 		{'ethereal:fire_flower'},
   * 	}
   * }) */
  lua_getfield(L,LUA_ENVIRONINDEX,"minetest");
  lua_pushliteral(L,"register_craft");
  lua_gettable(L,-2);
  lua_remove(L,-2);
  lua_createtable(L,0,2);
  lua_pushliteral(L,"output");
  lua_pushliteral(L,"ethereal:fire_dust 2");
  lua_rawset(L,-3);
  lua_pushliteral(L,"recipe");
  lua_createtable(L,1,0);
  lua_createtable(L,1,0);
  lua_pushliteral(L,"ethereal:fire_flower");
  lua_rawseti(L,-2,1);
  lua_rawseti(L,-2,1);
  lua_rawset(L,-3);
  lua_call(L,1,0);
  assert(lua_gettop(L) - lc_nextra == 1);
  
  /* minetest.register_craft({
   * 	type = "fuel",
   * 	recipe = "ethereal:fire_dust",
   * 	burntime = 10,
   * }) */
  lua_getfield(L,LUA_ENVIRONINDEX,"minetest");
  lua_pushliteral(L,"register_craft");
  lua_gettable(L,-2);
  lua_remove(L,-2);
  lua_createtable(L,0,3);
  lua_pushliteral(L,"type");
  lua_pushliteral(L,"fuel");
  lua_rawset(L,-3);
  lua_pushliteral(L,"recipe");
  lua_pushliteral(L,"ethereal:fire_dust");
  lua_rawset(L,-3);
  lua_pushliteral(L,"burntime");
  lua_pushnumber(L,10);
  lua_rawset(L,-3);
  lua_call(L,1,0);
  assert(lua_gettop(L) - lc_nextra == 1);
  
  /* -- vines
   * minetest.register_node("ethereal:vine", {
   * 	description = S("Vine"),
   * 	drawtype = "signlike",
   * 	tiles = {"vine.png"},
   * 	inventory_image = "vine.png",
   * 	wield_image = "vine.png",
   * 	paramtype = "light",
   * 	paramtype2 = "wallmounted",
   * 	walkable = false,
   * 	climbable = true,
   * 	is_ground_content = false,
   * 	selection_box = {
   * 		type = "wallmounted",
   * 	},
   * 	groups = {choppy = 3, oddly_breakable_by_hand = 1},
   * 	legacy_wallmounted = true,
   * 	sounds = default.node_sound_leaves_defaults(),
   * }) */
  lua_getfield(L,LUA_ENVIRONINDEX,"minetest");
  lua_pushliteral(L,"register_node");
  lua_gettable(L,-2);
  lua_remove(L,-2);
  lua_pushliteral(L,"ethereal:vine");
  lua_createtable(L,0,14);
  lua_pushliteral(L,"description");
  lc_getupvalue(L,(lc1 + lc_nextra),0,1);
  lua_pushliteral(L,"Vine");
  lua_call(L,1,1);
  lua_rawset(L,-3);
  lua_pushliteral(L,"drawtype");
  lua_pushliteral(L,"signlike");
  lua_rawset(L,-3);
  lua_pushliteral(L,"tiles");
  lua_createtable(L,1,0);
  lua_pushliteral(L,"vine.png");
  lua_rawseti(L,-2,1);
  lua_rawset(L,-3);
  lua_pushliteral(L,"inventory_image");
  lua_pushliteral(L,"vine.png");
  lua_rawset(L,-3);
  lua_pushliteral(L,"wield_image");
  lua_pushliteral(L,"vine.png");
  lua_rawset(L,-3);
  lua_pushliteral(L,"paramtype");
  lua_pushliteral(L,"light");
  lua_rawset(L,-3);
  lua_pushliteral(L,"paramtype2");
  lua_pushliteral(L,"wallmounted");
  lua_rawset(L,-3);
  lua_pushliteral(L,"walkable");
  lua_pushboolean(L,0);
  lua_rawset(L,-3);
  lua_pushliteral(L,"climbable");
  lua_pushboolean(L,1);
  lua_rawset(L,-3);
  lua_pushliteral(L,"is_ground_content");
  lua_pushboolean(L,0);
  lua_rawset(L,-3);
  lua_pushliteral(L,"selection_box");
  lua_createtable(L,0,1);
  lua_pushliteral(L,"type");
  lua_pushliteral(L,"wallmounted");
  lua_rawset(L,-3);
  lua_rawset(L,-3);
  lua_pushliteral(L,"groups");
  lua_createtable(L,0,2);
  lua_pushliteral(L,"choppy");
  lua_pushnumber(L,3);
  lua_rawset(L,-3);
  lua_pushliteral(L,"oddly_breakable_by_hand");
  lua_pushnumber(L,1);
  lua_rawset(L,-3);
  lua_rawset(L,-3);
  lua_pushliteral(L,"legacy_wallmounted");
  lua_pushboolean(L,1);
  lua_rawset(L,-3);
  lua_pushliteral(L,"sounds");
  lua_getfield(L,LUA_ENVIRONINDEX,"default");
  lua_pushliteral(L,"node_sound_leaves_defaults");
  lua_gettable(L,-2);
  lua_remove(L,-2);
  lua_call(L,0,1);
  lua_rawset(L,-3);
  lua_call(L,2,0);
  assert(lua_gettop(L) - lc_nextra == 1);
  
  /* minetest.register_craft({
   * 	output = "ethereal:vine 2",
   * 	recipe = {
   * 		{"group:leaves", "group:leaves"},
   * 		{"group:leaves", "group:leaves"},
   * 		{"group:leaves", "group:leaves"},
   * 	}
   * }) */
  lua_getfield(L,LUA_ENVIRONINDEX,"minetest");
  lua_pushliteral(L,"register_craft");
  lua_gettable(L,-2);
  lua_remove(L,-2);
  lua_createtable(L,0,2);
  lua_pushliteral(L,"output");
  lua_pushliteral(L,"ethereal:vine 2");
  lua_rawset(L,-3);
  lua_pushliteral(L,"recipe");
  lua_createtable(L,3,0);
  lua_createtable(L,2,0);
  lua_pushliteral(L,"group:leaves");
  lua_rawseti(L,-2,1);
  lua_pushliteral(L,"group:leaves");
  lua_rawseti(L,-2,2);
  lua_rawseti(L,-2,1);
  lua_createtable(L,2,0);
  lua_pushliteral(L,"group:leaves");
  lua_rawseti(L,-2,1);
  lua_pushliteral(L,"group:leaves");
  lua_rawseti(L,-2,2);
  lua_rawseti(L,-2,2);
  lua_createtable(L,2,0);
  lua_pushliteral(L,"group:leaves");
  lua_rawseti(L,-2,1);
  lua_pushliteral(L,"group:leaves");
  lua_rawseti(L,-2,2);
  lua_rawseti(L,-2,3);
  lua_rawset(L,-3);
  lua_call(L,1,0);
  assert(lua_gettop(L) - lc_nextra == 1);
  
  /* -- light strings (glowing vine)
   * minetest.register_node("ethereal:lightstring", {
   * 	description = S("Light String Vine"),
   * 	drawtype = "signlike",
   * 	tiles = {"lightstring.png"},
   * 	inventory_image = "lightstring.png",
   * 	wield_image = "lightstring.png",
   * 	paramtype = "light",
   * 	paramtype2 = "wallmounted",
   * 	light_source = 10,
   * 	walkable = false,
   * 	climbable = true,
   * 	is_ground_content = false,
   * 	selection_box = {
   * 		type = "wallmounted",
   * 	},
   * 	groups = {choppy = 3, oddly_breakable_by_hand = 1},
   * 	legacy_wallmounted = true,
   * 	sounds = default.node_sound_leaves_defaults(),
   * }) */
  lua_getfield(L,LUA_ENVIRONINDEX,"minetest");
  lua_pushliteral(L,"register_node");
  lua_gettable(L,-2);
  lua_remove(L,-2);
  lua_pushliteral(L,"ethereal:lightstring");
  lua_createtable(L,0,15);
  lua_pushliteral(L,"description");
  lc_getupvalue(L,(lc1 + lc_nextra),0,1);
  lua_pushliteral(L,"Light String Vine");
  lua_call(L,1,1);
  lua_rawset(L,-3);
  lua_pushliteral(L,"drawtype");
  lua_pushliteral(L,"signlike");
  lua_rawset(L,-3);
  lua_pushliteral(L,"tiles");
  lua_createtable(L,1,0);
  lua_pushliteral(L,"lightstring.png");
  lua_rawseti(L,-2,1);
  lua_rawset(L,-3);
  lua_pushliteral(L,"inventory_image");
  lua_pushliteral(L,"lightstring.png");
  lua_rawset(L,-3);
  lua_pushliteral(L,"wield_image");
  lua_pushliteral(L,"lightstring.png");
  lua_rawset(L,-3);
  lua_pushliteral(L,"paramtype");
  lua_pushliteral(L,"light");
  lua_rawset(L,-3);
  lua_pushliteral(L,"paramtype2");
  lua_pushliteral(L,"wallmounted");
  lua_rawset(L,-3);
  lua_pushliteral(L,"light_source");
  lua_pushnumber(L,10);
  lua_rawset(L,-3);
  lua_pushliteral(L,"walkable");
  lua_pushboolean(L,0);
  lua_rawset(L,-3);
  lua_pushliteral(L,"climbable");
  lua_pushboolean(L,1);
  lua_rawset(L,-3);
  lua_pushliteral(L,"is_ground_content");
  lua_pushboolean(L,0);
  lua_rawset(L,-3);
  lua_pushliteral(L,"selection_box");
  lua_createtable(L,0,1);
  lua_pushliteral(L,"type");
  lua_pushliteral(L,"wallmounted");
  lua_rawset(L,-3);
  lua_rawset(L,-3);
  lua_pushliteral(L,"groups");
  lua_createtable(L,0,2);
  lua_pushliteral(L,"choppy");
  lua_pushnumber(L,3);
  lua_rawset(L,-3);
  lua_pushliteral(L,"oddly_breakable_by_hand");
  lua_pushnumber(L,1);
  lua_rawset(L,-3);
  lua_rawset(L,-3);
  lua_pushliteral(L,"legacy_wallmounted");
  lua_pushboolean(L,1);
  lua_rawset(L,-3);
  lua_pushliteral(L,"sounds");
  lua_getfield(L,LUA_ENVIRONINDEX,"default");
  lua_pushliteral(L,"node_sound_leaves_defaults");
  lua_gettable(L,-2);
  lua_remove(L,-2);
  lua_call(L,0,1);
  lua_rawset(L,-3);
  lua_call(L,2,0);
  assert(lua_gettop(L) - lc_nextra == 1);
  
  /* minetest.register_craft({
   * 	output = "ethereal:lightstring 8",
   * 	recipe = {
   * 		{"ethereal:vine", "ethereal:vine", "ethereal:vine"},
   * 		{"ethereal:vine", "ethereal:fire_dust", "ethereal:vine"},
   * 		{"ethereal:vine", "ethereal:vine", "ethereal:vine"},
   * 	},
   * }) */
  lua_getfield(L,LUA_ENVIRONINDEX,"minetest");
  lua_pushliteral(L,"register_craft");
  lua_gettable(L,-2);
  lua_remove(L,-2);
  lua_createtable(L,0,2);
  lua_pushliteral(L,"output");
  lua_pushliteral(L,"ethereal:lightstring 8");
  lua_rawset(L,-3);
  lua_pushliteral(L,"recipe");
  lua_createtable(L,3,0);
  lua_createtable(L,3,0);
  lua_pushliteral(L,"ethereal:vine");
  lua_rawseti(L,-2,1);
  lua_pushliteral(L,"ethereal:vine");
  lua_rawseti(L,-2,2);
  lua_pushliteral(L,"ethereal:vine");
  lua_rawseti(L,-2,3);
  lua_rawseti(L,-2,1);
  lua_createtable(L,3,0);
  lua_pushliteral(L,"ethereal:vine");
  lua_rawseti(L,-2,1);
  lua_pushliteral(L,"ethereal:fire_dust");
  lua_rawseti(L,-2,2);
  lua_pushliteral(L,"ethereal:vine");
  lua_rawseti(L,-2,3);
  lua_rawseti(L,-2,2);
  lua_createtable(L,3,0);
  lua_pushliteral(L,"ethereal:vine");
  lua_rawseti(L,-2,1);
  lua_pushliteral(L,"ethereal:vine");
  lua_rawseti(L,-2,2);
  lua_pushliteral(L,"ethereal:vine");
  lua_rawseti(L,-2,3);
  lua_rawseti(L,-2,3);
  lua_rawset(L,-3);
  lua_call(L,1,0);
  assert(lua_gettop(L) - lc_nextra == 1);
  
  /* -- Fern (boston)
   * minetest.register_node("ethereal:fern", {
   * 	description = S("Fern"),
   * 	drawtype = "plantlike",
   * 	visual_scale = 1.2,
   * 	tiles = {"fern.png"},
   * 	inventory_image = "fern.png",
   * 	wield_image = "fern.png",
   * 	paramtype = "light",
   * 	sunlight_propagates = true,
   * 	waving = 1,
   * 	walkable = false,
   * 	buildable_to = true,
   * 	drop = {
   * 		max_items = 1,
   * 		items = {
   * 			{items = {"ethereal:fern_tubers"}, rarity = 6},
   * 			{items = {"ethereal:fern"}}
   * 		}
   * 	},
   * 	groups = {snappy = 3, flora = 1, attached_node = 1, flammable = 2},
   * 	sounds = default.node_sound_leaves_defaults(),
   * 	selection_box = {
   * 		type = "fixed",
   * 		fixed = {-0.5, -0.5, -0.5, 0.5, -5/16, 0.5}
   * 	},
   * }) */
  lua_getfield(L,LUA_ENVIRONINDEX,"minetest");
  lua_pushliteral(L,"register_node");
  lua_gettable(L,-2);
  lua_remove(L,-2);
  lua_pushliteral(L,"ethereal:fern");
  lua_createtable(L,0,15);
  lua_pushliteral(L,"description");
  lc_getupvalue(L,(lc1 + lc_nextra),0,1);
  lua_pushliteral(L,"Fern");
  lua_call(L,1,1);
  lua_rawset(L,-3);
  lua_pushliteral(L,"drawtype");
  lua_pushliteral(L,"plantlike");
  lua_rawset(L,-3);
  lua_pushliteral(L,"visual_scale");
  lua_pushnumber(L,1.2);
  lua_rawset(L,-3);
  lua_pushliteral(L,"tiles");
  lua_createtable(L,1,0);
  lua_pushliteral(L,"fern.png");
  lua_rawseti(L,-2,1);
  lua_rawset(L,-3);
  lua_pushliteral(L,"inventory_image");
  lua_pushliteral(L,"fern.png");
  lua_rawset(L,-3);
  lua_pushliteral(L,"wield_image");
  lua_pushliteral(L,"fern.png");
  lua_rawset(L,-3);
  lua_pushliteral(L,"paramtype");
  lua_pushliteral(L,"light");
  lua_rawset(L,-3);
  lua_pushliteral(L,"sunlight_propagates");
  lua_pushboolean(L,1);
  lua_rawset(L,-3);
  lua_pushliteral(L,"waving");
  lua_pushnumber(L,1);
  lua_rawset(L,-3);
  lua_pushliteral(L,"walkable");
  lua_pushboolean(L,0);
  lua_rawset(L,-3);
  lua_pushliteral(L,"buildable_to");
  lua_pushboolean(L,1);
  lua_rawset(L,-3);
  lua_pushliteral(L,"drop");
  lua_createtable(L,0,2);
  lua_pushliteral(L,"max_items");
  lua_pushnumber(L,1);
  lua_rawset(L,-3);
  lua_pushliteral(L,"items");
  lua_createtable(L,2,0);
  lua_createtable(L,0,2);
  lua_pushliteral(L,"items");
  lua_createtable(L,1,0);
  lua_pushliteral(L,"ethereal:fern_tubers");
  lua_rawseti(L,-2,1);
  lua_rawset(L,-3);
  lua_pushliteral(L,"rarity");
  lua_pushnumber(L,6);
  lua_rawset(L,-3);
  lua_rawseti(L,-2,1);
  lua_createtable(L,0,1);
  lua_pushliteral(L,"items");
  lua_createtable(L,1,0);
  lua_pushliteral(L,"ethereal:fern");
  lua_rawseti(L,-2,1);
  lua_rawset(L,-3);
  lua_rawseti(L,-2,2);
  lua_rawset(L,-3);
  lua_rawset(L,-3);
  lua_pushliteral(L,"groups");
  lua_createtable(L,0,4);
  lua_pushliteral(L,"snappy");
  lua_pushnumber(L,3);
  lua_rawset(L,-3);
  lua_pushliteral(L,"flora");
  lua_pushnumber(L,1);
  lua_rawset(L,-3);
  lua_pushliteral(L,"attached_node");
  lua_pushnumber(L,1);
  lua_rawset(L,-3);
  lua_pushliteral(L,"flammable");
  lua_pushnumber(L,2);
  lua_rawset(L,-3);
  lua_rawset(L,-3);
  lua_pushliteral(L,"sounds");
  lua_getfield(L,LUA_ENVIRONINDEX,"default");
  lua_pushliteral(L,"node_sound_leaves_defaults");
  lua_gettable(L,-2);
  lua_remove(L,-2);
  lua_call(L,0,1);
  lua_rawset(L,-3);
  lua_pushliteral(L,"selection_box");
  lua_createtable(L,0,2);
  lua_pushliteral(L,"type");
  lua_pushliteral(L,"fixed");
  lua_rawset(L,-3);
  lua_pushliteral(L,"fixed");
  lua_createtable(L,6,0);
  lua_pushnumber(L,-0.5);
  lua_rawseti(L,-2,1);
  lua_pushnumber(L,-0.5);
  lua_rawseti(L,-2,2);
  lua_pushnumber(L,-0.5);
  lua_rawseti(L,-2,3);
  lua_pushnumber(L,0.5);
  lua_rawseti(L,-2,4);
  lua_pushnumber(L,-0.3125);
  lua_rawseti(L,-2,5);
  lua_pushnumber(L,0.5);
  lua_rawseti(L,-2,6);
  lua_rawset(L,-3);
  lua_rawset(L,-3);
  lua_call(L,2,0);
  assert(lua_gettop(L) - lc_nextra == 1);
  
  /* -- Boston Ferns sometimes drop edible Tubers (heals 1/2 heart when eaten)
   * minetest.register_craftitem("ethereal:fern_tubers", {
   * 	description = S("Fern Tubers"),
   * 	inventory_image = "fern_tubers.png",
   * 	on_use = minetest.item_eat(1),
   * }) */
  lua_getfield(L,LUA_ENVIRONINDEX,"minetest");
  lua_pushliteral(L,"register_craftitem");
  lua_gettable(L,-2);
  lua_remove(L,-2);
  lua_pushliteral(L,"ethereal:fern_tubers");
  lua_createtable(L,0,3);
  lua_pushliteral(L,"description");
  lc_getupvalue(L,(lc1 + lc_nextra),0,1);
  lua_pushliteral(L,"Fern Tubers");
  lua_call(L,1,1);
  lua_rawset(L,-3);
  lua_pushliteral(L,"inventory_image");
  lua_pushliteral(L,"fern_tubers.png");
  lua_rawset(L,-3);
  lua_pushliteral(L,"on_use");
  lua_getfield(L,LUA_ENVIRONINDEX,"minetest");
  lua_pushliteral(L,"item_eat");
  lua_gettable(L,-2);
  lua_remove(L,-2);
  lua_pushnumber(L,1);
  lua_call(L,1,1);
  lua_rawset(L,-3);
  lua_call(L,2,0);
  assert(lua_gettop(L) - lc_nextra == 1);
  
  /* -- Red Shrub (not flammable)
   * minetest.register_node("ethereal:dry_shrub", {
   * 	description = S("Fiery Dry Shrub"),
   * 	drawtype = "plantlike",
   * 	visual_scale = 1.0,
   * 	tiles = {"ethereal_dry_shrub.png"},
   * 	inventory_image = "ethereal_dry_shrub.png",
   * 	wield_image = "ethereal_dry_shrub.png",
   * 	paramtype = "light",
   * 	sunlight_propagates = true,
   * 	waving = 1,
   * 	walkable = false,
   * 	buildable_to = true,
   * 	groups = {snappy = 3, flora = 1, attached_node = 1},
   * 	sounds = default.node_sound_leaves_defaults(),
   * 	selection_box = {
   * 		type = "fixed",
   * 		fixed = {-0.5, -0.5, -0.5, 0.5, -5/16, 0.5}
   * 	},
   * }) */
  lua_getfield(L,LUA_ENVIRONINDEX,"minetest");
  lua_pushliteral(L,"register_node");
  lua_gettable(L,-2);
  lua_remove(L,-2);
  lua_pushliteral(L,"ethereal:dry_shrub");
  lua_createtable(L,0,14);
  lua_pushliteral(L,"description");
  lc_getupvalue(L,(lc1 + lc_nextra),0,1);
  lua_pushliteral(L,"Fiery Dry Shrub");
  lua_call(L,1,1);
  lua_rawset(L,-3);
  lua_pushliteral(L,"drawtype");
  lua_pushliteral(L,"plantlike");
  lua_rawset(L,-3);
  lua_pushliteral(L,"visual_scale");
  lua_pushnumber(L,1);
  lua_rawset(L,-3);
  lua_pushliteral(L,"tiles");
  lua_createtable(L,1,0);
  lua_pushliteral(L,"ethereal_dry_shrub.png");
  lua_rawseti(L,-2,1);
  lua_rawset(L,-3);
  lua_pushliteral(L,"inventory_image");
  lua_pushliteral(L,"ethereal_dry_shrub.png");
  lua_rawset(L,-3);
  lua_pushliteral(L,"wield_image");
  lua_pushliteral(L,"ethereal_dry_shrub.png");
  lua_rawset(L,-3);
  lua_pushliteral(L,"paramtype");
  lua_pushliteral(L,"light");
  lua_rawset(L,-3);
  lua_pushliteral(L,"sunlight_propagates");
  lua_pushboolean(L,1);
  lua_rawset(L,-3);
  lua_pushliteral(L,"waving");
  lua_pushnumber(L,1);
  lua_rawset(L,-3);
  lua_pushliteral(L,"walkable");
  lua_pushboolean(L,0);
  lua_rawset(L,-3);
  lua_pushliteral(L,"buildable_to");
  lua_pushboolean(L,1);
  lua_rawset(L,-3);
  lua_pushliteral(L,"groups");
  lua_createtable(L,0,3);
  lua_pushliteral(L,"snappy");
  lua_pushnumber(L,3);
  lua_rawset(L,-3);
  lua_pushliteral(L,"flora");
  lua_pushnumber(L,1);
  lua_rawset(L,-3);
  lua_pushliteral(L,"attached_node");
  lua_pushnumber(L,1);
  lua_rawset(L,-3);
  lua_rawset(L,-3);
  lua_pushliteral(L,"sounds");
  lua_getfield(L,LUA_ENVIRONINDEX,"default");
  lua_pushliteral(L,"node_sound_leaves_defaults");
  lua_gettable(L,-2);
  lua_remove(L,-2);
  lua_call(L,0,1);
  lua_rawset(L,-3);
  lua_pushliteral(L,"selection_box");
  lua_createtable(L,0,2);
  lua_pushliteral(L,"type");
  lua_pushliteral(L,"fixed");
  lua_rawset(L,-3);
  lua_pushliteral(L,"fixed");
  lua_createtable(L,6,0);
  lua_pushnumber(L,-0.5);
  lua_rawseti(L,-2,1);
  lua_pushnumber(L,-0.5);
  lua_rawseti(L,-2,2);
  lua_pushnumber(L,-0.5);
  lua_rawseti(L,-2,3);
  lua_pushnumber(L,0.5);
  lua_rawseti(L,-2,4);
  lua_pushnumber(L,-0.3125);
  lua_rawseti(L,-2,5);
  lua_pushnumber(L,0.5);
  lua_rawseti(L,-2,6);
  lua_rawset(L,-3);
  lua_rawset(L,-3);
  lua_call(L,2,0);
  assert(lua_gettop(L) - lc_nextra == 1);
  
  /* -- Grey Shrub (not Flammable - too cold to burn)
   * minetest.register_node("ethereal:snowygrass", {
   * 	description = S("Snowy Grass"),
   * 	drawtype = "plantlike",
   * 	visual_scale = 0.9,
   * 	tiles = {"ethereal_snowygrass.png"},
   * 	inventory_image = "ethereal_snowygrass.png",
   * 	wield_image = "ethereal_snowygrass.png",
   * 	paramtype = "light",
   * 	sunlight_propagates = true,
   * 	waving = 1,
   * 	walkable = false,
   * 	buildable_to = true,
   * 	groups = {snappy = 3, flora = 1, attached_node = 1},
   * 	sounds = default.node_sound_leaves_defaults(),
   * 	selection_box = {
   * 		type = "fixed",
   * 		fixed = {-0.5, -0.5, -0.5, 0.5, -5/16, 0.5}
   * 	},
   * }) */
  lua_getfield(L,LUA_ENVIRONINDEX,"minetest");
  lua_pushliteral(L,"register_node");
  lua_gettable(L,-2);
  lua_remove(L,-2);
  lua_pushliteral(L,"ethereal:snowygrass");
  lua_createtable(L,0,14);
  lua_pushliteral(L,"description");
  lc_getupvalue(L,(lc1 + lc_nextra),0,1);
  lua_pushliteral(L,"Snowy Grass");
  lua_call(L,1,1);
  lua_rawset(L,-3);
  lua_pushliteral(L,"drawtype");
  lua_pushliteral(L,"plantlike");
  lua_rawset(L,-3);
  lua_pushliteral(L,"visual_scale");
  lua_pushnumber(L,0.9);
  lua_rawset(L,-3);
  lua_pushliteral(L,"tiles");
  lua_createtable(L,1,0);
  lua_pushliteral(L,"ethereal_snowygrass.png");
  lua_rawseti(L,-2,1);
  lua_rawset(L,-3);
  lua_pushliteral(L,"inventory_image");
  lua_pushliteral(L,"ethereal_snowygrass.png");
  lua_rawset(L,-3);
  lua_pushliteral(L,"wield_image");
  lua_pushliteral(L,"ethereal_snowygrass.png");
  lua_rawset(L,-3);
  lua_pushliteral(L,"paramtype");
  lua_pushliteral(L,"light");
  lua_rawset(L,-3);
  lua_pushliteral(L,"sunlight_propagates");
  lua_pushboolean(L,1);
  lua_rawset(L,-3);
  lua_pushliteral(L,"waving");
  lua_pushnumber(L,1);
  lua_rawset(L,-3);
  lua_pushliteral(L,"walkable");
  lua_pushboolean(L,0);
  lua_rawset(L,-3);
  lua_pushliteral(L,"buildable_to");
  lua_pushboolean(L,1);
  lua_rawset(L,-3);
  lua_pushliteral(L,"groups");
  lua_createtable(L,0,3);
  lua_pushliteral(L,"snappy");
  lua_pushnumber(L,3);
  lua_rawset(L,-3);
  lua_pushliteral(L,"flora");
  lua_pushnumber(L,1);
  lua_rawset(L,-3);
  lua_pushliteral(L,"attached_node");
  lua_pushnumber(L,1);
  lua_rawset(L,-3);
  lua_rawset(L,-3);
  lua_pushliteral(L,"sounds");
  lua_getfield(L,LUA_ENVIRONINDEX,"default");
  lua_pushliteral(L,"node_sound_leaves_defaults");
  lua_gettable(L,-2);
  lua_remove(L,-2);
  lua_call(L,0,1);
  lua_rawset(L,-3);
  lua_pushliteral(L,"selection_box");
  lua_createtable(L,0,2);
  lua_pushliteral(L,"type");
  lua_pushliteral(L,"fixed");
  lua_rawset(L,-3);
  lua_pushliteral(L,"fixed");
  lua_createtable(L,6,0);
  lua_pushnumber(L,-0.5);
  lua_rawseti(L,-2,1);
  lua_pushnumber(L,-0.5);
  lua_rawseti(L,-2,2);
  lua_pushnumber(L,-0.5);
  lua_rawseti(L,-2,3);
  lua_pushnumber(L,0.5);
  lua_rawseti(L,-2,4);
  lua_pushnumber(L,-0.3125);
  lua_rawseti(L,-2,5);
  lua_pushnumber(L,0.5);
  lua_rawseti(L,-2,6);
  lua_rawset(L,-3);
  lua_rawset(L,-3);
  lua_call(L,2,0);
  assert(lua_gettop(L) - lc_nextra == 1);
  
  /* -- Crystal Shrub (not Flammable - too cold to burn)
   * minetest.register_node("ethereal:crystalgrass", {
   * 	description = S("Crystal Grass"),
   * 	drawtype = "plantlike",
   * 	visual_scale = 0.9,
   * 	tiles = {"ethereal_crystalgrass.png"},
   * 	inventory_image = "ethereal_crystalgrass.png",
   * 	wield_image = "ethereal_crystalgrass.png",
   * 	paramtype = "light",
   * 	sunlight_propagates = true,
   * 	waving = 1,
   * 	walkable = false,
   * 	buildable_to = true,
   * 	groups = {snappy = 3, flora = 1, attached_node = 1},
   * 	sounds = default.node_sound_leaves_defaults(),
   * 	selection_box = {
   * 		type = "fixed",
   * 		fixed = {-0.5, -0.5, -0.5, 0.5, -5/16, 0.5}
   * 	},
   * }) */
  lua_getfield(L,LUA_ENVIRONINDEX,"minetest");
  lua_pushliteral(L,"register_node");
  lua_gettable(L,-2);
  lua_remove(L,-2);
  lua_pushliteral(L,"ethereal:crystalgrass");
  lua_createtable(L,0,14);
  lua_pushliteral(L,"description");
  lc_getupvalue(L,(lc1 + lc_nextra),0,1);
  lua_pushliteral(L,"Crystal Grass");
  lua_call(L,1,1);
  lua_rawset(L,-3);
  lua_pushliteral(L,"drawtype");
  lua_pushliteral(L,"plantlike");
  lua_rawset(L,-3);
  lua_pushliteral(L,"visual_scale");
  lua_pushnumber(L,0.9);
  lua_rawset(L,-3);
  lua_pushliteral(L,"tiles");
  lua_createtable(L,1,0);
  lua_pushliteral(L,"ethereal_crystalgrass.png");
  lua_rawseti(L,-2,1);
  lua_rawset(L,-3);
  lua_pushliteral(L,"inventory_image");
  lua_pushliteral(L,"ethereal_crystalgrass.png");
  lua_rawset(L,-3);
  lua_pushliteral(L,"wield_image");
  lua_pushliteral(L,"ethereal_crystalgrass.png");
  lua_rawset(L,-3);
  lua_pushliteral(L,"paramtype");
  lua_pushliteral(L,"light");
  lua_rawset(L,-3);
  lua_pushliteral(L,"sunlight_propagates");
  lua_pushboolean(L,1);
  lua_rawset(L,-3);
  lua_pushliteral(L,"waving");
  lua_pushnumber(L,1);
  lua_rawset(L,-3);
  lua_pushliteral(L,"walkable");
  lua_pushboolean(L,0);
  lua_rawset(L,-3);
  lua_pushliteral(L,"buildable_to");
  lua_pushboolean(L,1);
  lua_rawset(L,-3);
  lua_pushliteral(L,"groups");
  lua_createtable(L,0,3);
  lua_pushliteral(L,"snappy");
  lua_pushnumber(L,3);
  lua_rawset(L,-3);
  lua_pushliteral(L,"flora");
  lua_pushnumber(L,1);
  lua_rawset(L,-3);
  lua_pushliteral(L,"attached_node");
  lua_pushnumber(L,1);
  lua_rawset(L,-3);
  lua_rawset(L,-3);
  lua_pushliteral(L,"sounds");
  lua_getfield(L,LUA_ENVIRONINDEX,"default");
  lua_pushliteral(L,"node_sound_leaves_defaults");
  lua_gettable(L,-2);
  lua_remove(L,-2);
  lua_call(L,0,1);
  lua_rawset(L,-3);
  lua_pushliteral(L,"selection_box");
  lua_createtable(L,0,2);
  lua_pushliteral(L,"type");
  lua_pushliteral(L,"fixed");
  lua_rawset(L,-3);
  lua_pushliteral(L,"fixed");
  lua_createtable(L,6,0);
  lua_pushnumber(L,-0.5);
  lua_rawseti(L,-2,1);
  lua_pushnumber(L,-0.5);
  lua_rawseti(L,-2,2);
  lua_pushnumber(L,-0.5);
  lua_rawseti(L,-2,3);
  lua_pushnumber(L,0.5);
  lua_rawseti(L,-2,4);
  lua_pushnumber(L,-0.3125);
  lua_rawseti(L,-2,5);
  lua_pushnumber(L,0.5);
  lua_rawseti(L,-2,6);
  lua_rawset(L,-3);
  lua_rawset(L,-3);
  lua_call(L,2,0);
  assert(lua_gettop(L) - lc_nextra == 1);
  
  /* -- Define Moss Types (Has grass textures on all sides)
   * function ethereal.add_moss(typ, descr, texture, receipe_item)
   * 
   * 	minetest.register_node("ethereal:" .. typ .. "_moss", {
   * 		description = S(descr .. " Moss"),
   * 		tiles = {texture},
   * 		groups = {crumbly = 3},
   * 		sounds = default.node_sound_dirt_defaults()
   * 	})
   * 
   * 	minetest.register_craft({
   * 		output = "ethereal:"..typ.."_moss",
   * 		recipe = {{"default:dirt", receipe_item }}
   * 	})
   * end */
  lua_pushvalue(L,(lc1 + lc_nextra));
  lua_pushcclosure(L,lcf1_ethereal_add_moss,1);
  lua_getfield(L,LUA_ENVIRONINDEX,"ethereal");
  lua_insert(L,-2);
  lua_pushliteral(L,"add_moss");
  lua_insert(L,-2);
  lua_settable(L,-3);
  lua_pop(L,1);
  assert(lua_gettop(L) - lc_nextra == 1);
  
  /* ethereal.add_moss( "crystal", "Crystal", "ethereal_grass_crystal_top.png", "ethereal:frost_leaves") */
  lua_getfield(L,LUA_ENVIRONINDEX,"ethereal");
  lua_pushliteral(L,"add_moss");
  lua_gettable(L,-2);
  lua_remove(L,-2);
  lua_pushliteral(L,"crystal");
  lua_pushliteral(L,"Crystal");
  lua_pushliteral(L,"ethereal_grass_crystal_top.png");
  lua_pushliteral(L,"ethereal:frost_leaves");
  lua_call(L,4,0);
  assert(lua_gettop(L) - lc_nextra == 1);
  
  /* ethereal.add_moss( "mushroom", "Mushroom", "ethereal_grass_mushroom_top.png", "ethereal:mushroom") */
  lua_getfield(L,LUA_ENVIRONINDEX,"ethereal");
  lua_pushliteral(L,"add_moss");
  lua_gettable(L,-2);
  lua_remove(L,-2);
  lua_pushliteral(L,"mushroom");
  lua_pushliteral(L,"Mushroom");
  lua_pushliteral(L,"ethereal_grass_mushroom_top.png");
  lua_pushliteral(L,"ethereal:mushroom");
  lua_call(L,4,0);
  assert(lua_gettop(L) - lc_nextra == 1);
  
  /* ethereal.add_moss( "fiery", "Fiery", "ethereal_grass_fiery_top.png", "ethereal:dry_shrub") */
  lua_getfield(L,LUA_ENVIRONINDEX,"ethereal");
  lua_pushliteral(L,"add_moss");
  lua_gettable(L,-2);
  lua_remove(L,-2);
  lua_pushliteral(L,"fiery");
  lua_pushliteral(L,"Fiery");
  lua_pushliteral(L,"ethereal_grass_fiery_top.png");
  lua_pushliteral(L,"ethereal:dry_shrub");
  lua_call(L,4,0);
  assert(lua_gettop(L) - lc_nextra == 1);
  
  /* ethereal.add_moss( "gray", "Gray", "ethereal_grass_gray_top.png", "ethereal:snowygrass") */
  lua_getfield(L,LUA_ENVIRONINDEX,"ethereal");
  lua_pushliteral(L,"add_moss");
  lua_gettable(L,-2);
  lua_remove(L,-2);
  lua_pushliteral(L,"gray");
  lua_pushliteral(L,"Gray");
  lua_pushliteral(L,"ethereal_grass_gray_top.png");
  lua_pushliteral(L,"ethereal:snowygrass");
  lua_call(L,4,0);
  assert(lua_gettop(L) - lc_nextra == 1);
  
  /* ethereal.add_moss( "green", "Green", "default_grass.png", "default:jungleleaves") */
  lua_getfield(L,LUA_ENVIRONINDEX,"ethereal");
  lua_pushliteral(L,"add_moss");
  lua_gettable(L,-2);
  lua_remove(L,-2);
  lua_pushliteral(L,"green");
  lua_pushliteral(L,"Green");
  lua_pushliteral(L,"default_grass.png");
  lua_pushliteral(L,"default:jungleleaves");
  lua_call(L,4,0);
  assert(lua_gettop(L) - lc_nextra == 1);
  
  /* -- Illuminated Cave Shrooms (Red, Green and Blue)
   * minetest.register_node("ethereal:illumishroom", {
   * 	description = S("Red Illumishroom"),
   * 	drawtype = "plantlike",
   * 	tiles = { "illumishroom.png" },
   * 	inventory_image = "illumishroom.png",
   * 	wield_image = "illumishroom.png",
   * 	paramtype = "light",
   * 	light_source = 5,
   * 	sunlight_propagates = true,
   * 	walkable = false,
   * 	groups = {dig_immediate = 3, attached_node = 1,flammable = 3},
   * 	sounds = default.node_sound_leaves_defaults(),
   * 	selection_box = {
   * 		type = "fixed",
   * 		fixed = {-0.5, -0.5, -0.5, 0.5, -5/16, 0.5},
   * 	},
   * }) */
  lua_getfield(L,LUA_ENVIRONINDEX,"minetest");
  lua_pushliteral(L,"register_node");
  lua_gettable(L,-2);
  lua_remove(L,-2);
  lua_pushliteral(L,"ethereal:illumishroom");
  lua_createtable(L,0,12);
  lua_pushliteral(L,"description");
  lc_getupvalue(L,(lc1 + lc_nextra),0,1);
  lua_pushliteral(L,"Red Illumishroom");
  lua_call(L,1,1);
  lua_rawset(L,-3);
  lua_pushliteral(L,"drawtype");
  lua_pushliteral(L,"plantlike");
  lua_rawset(L,-3);
  lua_pushliteral(L,"tiles");
  lua_createtable(L,1,0);
  lua_pushliteral(L,"illumishroom.png");
  lua_rawseti(L,-2,1);
  lua_rawset(L,-3);
  lua_pushliteral(L,"inventory_image");
  lua_pushliteral(L,"illumishroom.png");
  lua_rawset(L,-3);
  lua_pushliteral(L,"wield_image");
  lua_pushliteral(L,"illumishroom.png");
  lua_rawset(L,-3);
  lua_pushliteral(L,"paramtype");
  lua_pushliteral(L,"light");
  lua_rawset(L,-3);
  lua_pushliteral(L,"light_source");
  lua_pushnumber(L,5);
  lua_rawset(L,-3);
  lua_pushliteral(L,"sunlight_propagates");
  lua_pushboolean(L,1);
  lua_rawset(L,-3);
  lua_pushliteral(L,"walkable");
  lua_pushboolean(L,0);
  lua_rawset(L,-3);
  lua_pushliteral(L,"groups");
  lua_createtable(L,0,3);
  lua_pushliteral(L,"dig_immediate");
  lua_pushnumber(L,3);
  lua_rawset(L,-3);
  lua_pushliteral(L,"attached_node");
  lua_pushnumber(L,1);
  lua_rawset(L,-3);
  lua_pushliteral(L,"flammable");
  lua_pushnumber(L,3);
  lua_rawset(L,-3);
  lua_rawset(L,-3);
  lua_pushliteral(L,"sounds");
  lua_getfield(L,LUA_ENVIRONINDEX,"default");
  lua_pushliteral(L,"node_sound_leaves_defaults");
  lua_gettable(L,-2);
  lua_remove(L,-2);
  lua_call(L,0,1);
  lua_rawset(L,-3);
  lua_pushliteral(L,"selection_box");
  lua_createtable(L,0,2);
  lua_pushliteral(L,"type");
  lua_pushliteral(L,"fixed");
  lua_rawset(L,-3);
  lua_pushliteral(L,"fixed");
  lua_createtable(L,6,0);
  lua_pushnumber(L,-0.5);
  lua_rawseti(L,-2,1);
  lua_pushnumber(L,-0.5);
  lua_rawseti(L,-2,2);
  lua_pushnumber(L,-0.5);
  lua_rawseti(L,-2,3);
  lua_pushnumber(L,0.5);
  lua_rawseti(L,-2,4);
  lua_pushnumber(L,-0.3125);
  lua_rawseti(L,-2,5);
  lua_pushnumber(L,0.5);
  lua_rawseti(L,-2,6);
  lua_rawset(L,-3);
  lua_rawset(L,-3);
  lua_call(L,2,0);
  assert(lua_gettop(L) - lc_nextra == 1);
  
  /* minetest.register_node("ethereal:illumishroom2", {
   * 	description = S("Green Illumishroom"),
   * 	drawtype = "plantlike",
   * 	tiles = { "illumishroom2.png" },
   * 	inventory_image = "illumishroom2.png",
   * 	wield_image = "illumishroom2.png",
   * 	paramtype = "light",
   * 	light_source = 5,
   * 	sunlight_propagates = true,
   * 	walkable = false,
   * 	groups = {dig_immediate = 3, attached_node = 1,flammable = 3},
   * 	sounds = default.node_sound_leaves_defaults(),
   * 	selection_box = {
   * 		type = "fixed",
   * 		fixed = {-0.5, -0.5, -0.5, 0.5, -5/16, 0.5},
   * 	},
   * }) */
  lua_getfield(L,LUA_ENVIRONINDEX,"minetest");
  lua_pushliteral(L,"register_node");
  lua_gettable(L,-2);
  lua_remove(L,-2);
  lua_pushliteral(L,"ethereal:illumishroom2");
  lua_createtable(L,0,12);
  lua_pushliteral(L,"description");
  lc_getupvalue(L,(lc1 + lc_nextra),0,1);
  lua_pushliteral(L,"Green Illumishroom");
  lua_call(L,1,1);
  lua_rawset(L,-3);
  lua_pushliteral(L,"drawtype");
  lua_pushliteral(L,"plantlike");
  lua_rawset(L,-3);
  lua_pushliteral(L,"tiles");
  lua_createtable(L,1,0);
  lua_pushliteral(L,"illumishroom2.png");
  lua_rawseti(L,-2,1);
  lua_rawset(L,-3);
  lua_pushliteral(L,"inventory_image");
  lua_pushliteral(L,"illumishroom2.png");
  lua_rawset(L,-3);
  lua_pushliteral(L,"wield_image");
  lua_pushliteral(L,"illumishroom2.png");
  lua_rawset(L,-3);
  lua_pushliteral(L,"paramtype");
  lua_pushliteral(L,"light");
  lua_rawset(L,-3);
  lua_pushliteral(L,"light_source");
  lua_pushnumber(L,5);
  lua_rawset(L,-3);
  lua_pushliteral(L,"sunlight_propagates");
  lua_pushboolean(L,1);
  lua_rawset(L,-3);
  lua_pushliteral(L,"walkable");
  lua_pushboolean(L,0);
  lua_rawset(L,-3);
  lua_pushliteral(L,"groups");
  lua_createtable(L,0,3);
  lua_pushliteral(L,"dig_immediate");
  lua_pushnumber(L,3);
  lua_rawset(L,-3);
  lua_pushliteral(L,"attached_node");
  lua_pushnumber(L,1);
  lua_rawset(L,-3);
  lua_pushliteral(L,"flammable");
  lua_pushnumber(L,3);
  lua_rawset(L,-3);
  lua_rawset(L,-3);
  lua_pushliteral(L,"sounds");
  lua_getfield(L,LUA_ENVIRONINDEX,"default");
  lua_pushliteral(L,"node_sound_leaves_defaults");
  lua_gettable(L,-2);
  lua_remove(L,-2);
  lua_call(L,0,1);
  lua_rawset(L,-3);
  lua_pushliteral(L,"selection_box");
  lua_createtable(L,0,2);
  lua_pushliteral(L,"type");
  lua_pushliteral(L,"fixed");
  lua_rawset(L,-3);
  lua_pushliteral(L,"fixed");
  lua_createtable(L,6,0);
  lua_pushnumber(L,-0.5);
  lua_rawseti(L,-2,1);
  lua_pushnumber(L,-0.5);
  lua_rawseti(L,-2,2);
  lua_pushnumber(L,-0.5);
  lua_rawseti(L,-2,3);
  lua_pushnumber(L,0.5);
  lua_rawseti(L,-2,4);
  lua_pushnumber(L,-0.3125);
  lua_rawseti(L,-2,5);
  lua_pushnumber(L,0.5);
  lua_rawseti(L,-2,6);
  lua_rawset(L,-3);
  lua_rawset(L,-3);
  lua_call(L,2,0);
  assert(lua_gettop(L) - lc_nextra == 1);
  
  /* minetest.register_node("ethereal:illumishroom3", {
   * 	description = S("Cyan Illumishroom"),
   * 	drawtype = "plantlike",
   * 	tiles = { "illumishroom3.png" },
   * 	inventory_image = "illumishroom3.png",
   * 	wield_image = "illumishroom3.png",
   * 	paramtype = "light",
   * 	light_source = 5,
   * 	sunlight_propagates = true,
   * 	walkable = false,
   * 	groups = {dig_immediate = 3, attached_node = 1,flammable = 3},
   * 	sounds = default.node_sound_leaves_defaults(),
   * 	selection_box = {
   * 		type = "fixed",
   * 		fixed = {-0.5, -0.5, -0.5, 0.5, -5/16, 0.5},
   * 	},
   * }) */
  lua_getfield(L,LUA_ENVIRONINDEX,"minetest");
  lua_pushliteral(L,"register_node");
  lua_gettable(L,-2);
  lua_remove(L,-2);
  lua_pushliteral(L,"ethereal:illumishroom3");
  lua_createtable(L,0,12);
  lua_pushliteral(L,"description");
  lc_getupvalue(L,(lc1 + lc_nextra),0,1);
  lua_pushliteral(L,"Cyan Illumishroom");
  lua_call(L,1,1);
  lua_rawset(L,-3);
  lua_pushliteral(L,"drawtype");
  lua_pushliteral(L,"plantlike");
  lua_rawset(L,-3);
  lua_pushliteral(L,"tiles");
  lua_createtable(L,1,0);
  lua_pushliteral(L,"illumishroom3.png");
  lua_rawseti(L,-2,1);
  lua_rawset(L,-3);
  lua_pushliteral(L,"inventory_image");
  lua_pushliteral(L,"illumishroom3.png");
  lua_rawset(L,-3);
  lua_pushliteral(L,"wield_image");
  lua_pushliteral(L,"illumishroom3.png");
  lua_rawset(L,-3);
  lua_pushliteral(L,"paramtype");
  lua_pushliteral(L,"light");
  lua_rawset(L,-3);
  lua_pushliteral(L,"light_source");
  lua_pushnumber(L,5);
  lua_rawset(L,-3);
  lua_pushliteral(L,"sunlight_propagates");
  lua_pushboolean(L,1);
  lua_rawset(L,-3);
  lua_pushliteral(L,"walkable");
  lua_pushboolean(L,0);
  lua_rawset(L,-3);
  lua_pushliteral(L,"groups");
  lua_createtable(L,0,3);
  lua_pushliteral(L,"dig_immediate");
  lua_pushnumber(L,3);
  lua_rawset(L,-3);
  lua_pushliteral(L,"attached_node");
  lua_pushnumber(L,1);
  lua_rawset(L,-3);
  lua_pushliteral(L,"flammable");
  lua_pushnumber(L,3);
  lua_rawset(L,-3);
  lua_rawset(L,-3);
  lua_pushliteral(L,"sounds");
  lua_getfield(L,LUA_ENVIRONINDEX,"default");
  lua_pushliteral(L,"node_sound_leaves_defaults");
  lua_gettable(L,-2);
  lua_remove(L,-2);
  lua_call(L,0,1);
  lua_rawset(L,-3);
  lua_pushliteral(L,"selection_box");
  lua_createtable(L,0,2);
  lua_pushliteral(L,"type");
  lua_pushliteral(L,"fixed");
  lua_rawset(L,-3);
  lua_pushliteral(L,"fixed");
  lua_createtable(L,6,0);
  lua_pushnumber(L,-0.5);
  lua_rawseti(L,-2,1);
  lua_pushnumber(L,-0.5);
  lua_rawseti(L,-2,2);
  lua_pushnumber(L,-0.5);
  lua_rawseti(L,-2,3);
  lua_pushnumber(L,0.5);
  lua_rawseti(L,-2,4);
  lua_pushnumber(L,-0.3125);
  lua_rawseti(L,-2,5);
  lua_pushnumber(L,0.5);
  lua_rawseti(L,-2,6);
  lua_rawset(L,-3);
  lua_rawset(L,-3);
  lua_call(L,2,0);
  assert(lua_gettop(L) - lc_nextra == 1);
  return 0;
}


/* from lua.c */
static int traceback (lua_State *L) {
  if (!lua_isstring(L, 1))  /* 'message' not a string? */
    return 1;  /* keep it intact */
  lua_getfield(L, LUA_GLOBALSINDEX, "debug");
  if (!lua_istable(L, -1)) {
    lua_pop(L, 1);
    return 1;
  }
  lua_getfield(L, -1, "traceback");
  if (!lua_isfunction(L, -1)) {
    lua_pop(L, 2);
    return 1;
  }
  lua_pushvalue(L, 1);  /* pass error message */
  lua_pushinteger(L, 2);  /* skip this function and traceback */
  lua_call(L, 2, 1);  /* call debug.traceback */
  return 1;
}


static void lc_l_message (const char *pname, const char *msg) {
  if (pname) fprintf(stderr, "%s: ", pname);
  fprintf(stderr, "%s\n", msg);
  fflush(stderr);
}

static int lc_report (lua_State *L, int status) {
  if (status && !lua_isnil(L, -1)) {
    const char *msg = lua_tostring(L, -1);
    if (msg == NULL) msg = "(error object is not a string)";
    /*FIX-IMROVE:progname*/
    lc_l_message("lua", msg);
    lua_pop(L, 1);
  }
  return status;
}

static int lc_docall (lua_State *L, int narg, int clear) {
  int status;
  int base = lua_gettop(L) - narg;  /* function index */
  lua_pushcfunction(L, traceback);  /* push traceback function */
  lua_insert(L, base);  /* put it under chunk and args */
  /*FIX? signal(SIGINT, laction); */
  status = lua_pcall(L, narg, (clear ? 0 : LUA_MULTRET), base);
  /*FIX? signal(SIGINT, SIG_DFL); */
  lua_remove(L, base);  /* remove traceback function */
  /* force a complete garbage collection in case of errors */
  if (status != 0) lua_gc(L, LUA_GCCOLLECT, 0);
  return status;
}

static int lc_dofile (lua_State *L, const char *name) {
  int status = luaL_loadfile(L, name) || lc_docall(L, 0, 1);
  return lc_report(L, status);
}

static int lc_dostring (lua_State *L, const char *s, const char *name) {
  int status = luaL_loadbuffer(L, s, strlen(s), name) || lc_docall(L, 0, 1);
  return lc_report(L, status);
}

static int lc_handle_luainit (lua_State *L) {
  const char *init = getenv(LUA_INIT);
  if (init == NULL) return 0;  /* status OK */
  else if (init[0] == '@')
    return lc_dofile(L, init+1);
  else
    return lc_dostring(L, init, "=" LUA_INIT);
}


typedef struct {
  int c;
  const char ** v;
} lc_args_t;


/* create global arg table */
static void lc_createarg(lua_State * L, const lc_args_t * const args) {
  int i;
  lua_newtable(L);
  for (i=0; i < args->c; i++) {
    lua_pushstring(L, args->v[i]);
    lua_rawseti(L, -2, i);
  }
  lua_setglobal(L, "arg");
}


int lc_pmain_mod_ethereal_plantlife(lua_State * L) {
  luaL_openlibs(L);

  lua_pushcfunction(L, traceback);

  const int status1 = lc_handle_luainit(L);
  if (status1 != 0) return 0;

  /* note: IMPROVE: closure not always needed here */
  lua_newtable(L); /* closure table */
  lua_pushcclosure(L, lcf_main, 1);

  int status2 = lua_pcall(L, 0, 0, -2);
  if (status2 != 0) {
    const char * msg = lua_tostring(L,-1);
    if (msg == NULL) msg = "(error object is not a string)";
    fputs(msg, stderr);
  }
  return 0;
}


