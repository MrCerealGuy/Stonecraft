/* WARNING: This file was automatically generated by lua2c. */

#ifdef __cplusplus
extern "C" {
#endif
#include <lua.h>
#include <lauxlib.h>
#include <lualib.h>
#ifdef __cplusplus
}
#endif
#include <stdio.h>
#include <stdlib.h>


#include <string.h>


/* pushes new closure table onto the stack, using closure table at
 * given index as its parent */
static void lc_newclosuretable(lua_State * L, int idx) {

  lua_newtable(L);
  lua_pushvalue(L,idx);
  lua_rawseti(L,-2,0);


}

#include <assert.h>

/* __mul metamethod handler.
 * warning: assumes indices in range LUA_REGISTRYINDEX < x < 0 are relative. */
static void lc_mul(lua_State * L, int idxa, int idxb) {
  if (lua_isnumber(L,idxa) && lua_isnumber(L,idxb)) {
    lua_pushnumber(L,lua_tonumber(L,idxa) * lua_tonumber(L,idxb));
  }
  else {
    if (luaL_getmetafield(L,idxa,"__mul")||luaL_getmetafield(L,idxb,"__mul")) {
      lua_pushvalue(L,idxa < 0 && idxa > LUA_REGISTRYINDEX ? idxa-1 : idxa);
      lua_pushvalue(L,idxb < 0 && idxb > LUA_REGISTRYINDEX ? idxb-2 : idxb);
      lua_call(L,2,1);
    }
    else {
      luaL_error(L, "attempt to perform arithmetic");
    }
  }
}


/* __sub metamethod handler.
 * warning: assumes indices in range LUA_REGISTRYINDEX < x < 0 are relative. */
static void lc_sub(lua_State * L, int idxa, int idxb) {
  if (lua_isnumber(L,idxa) && lua_isnumber(L,idxb)) {
    lua_pushnumber(L,lua_tonumber(L,idxa) - lua_tonumber(L,idxb));
  }
  else {
    if (luaL_getmetafield(L,idxa,"__sub")||luaL_getmetafield(L,idxb,"__sub")) {
      lua_pushvalue(L,idxa < 0 && idxa > LUA_REGISTRYINDEX ? idxa-1 : idxa);
      lua_pushvalue(L,idxb < 0 && idxb > LUA_REGISTRYINDEX ? idxb-2 : idxb);
      lua_call(L,2,1);
    }
    else {
      luaL_error(L, "attempt to perform arithmetic");
    }
  }
}


/* __add metamethod handler.
 * warning: assumes indices in range LUA_REGISTRYINDEX < x < 0 are relative. */
static void lc_add(lua_State * L, int idxa, int idxb) {
  if (lua_isnumber(L,idxa) && lua_isnumber(L,idxb)) {
    lua_pushnumber(L,lua_tonumber(L,idxa) + lua_tonumber(L,idxb));
  }
  else {
    if (luaL_getmetafield(L,idxa,"__add")||luaL_getmetafield(L,idxb,"__add")) {
      lua_pushvalue(L,idxa < 0 && idxa > LUA_REGISTRYINDEX ? idxa-1 : idxa);
      lua_pushvalue(L,idxb < 0 && idxb > LUA_REGISTRYINDEX ? idxb-2 : idxb);
      lua_call(L,2,1);
    }
    else {
      luaL_error(L, "attempt to perform arithmetic");
    }
  }
}


/* __unm metamethod handler.
 * warning: assumes indices in range LUA_REGISTRYINDEX < x < 0 are relative. */
static void lc_unm(lua_State * L, int idxa) {
  if (lua_isnumber(L,idxa)) {
    lua_pushnumber(L,- lua_tonumber(L, idxa));
  }
  else {
    if (luaL_getmetafield(L,idxa,"__unm")) {
      lua_pushvalue(L,idxa < 0 && idxa > LUA_REGISTRYINDEX ? idxa-1 : idxa);
      lua_call(L,1,1);
    }
    else {
      luaL_error(L, "attempt to perform arithmetic");
    }
  }
}


/* name: get_elevation
 * function(pos) */
static int lcf1_get_elevation (lua_State * L) {
  lua_checkstack(L,24);
  enum { lc_nformalargs = 1 };
  lua_settop(L,1);
  
  /* local pos2d = {x = pos.x, y = pos.z} */
  lua_createtable(L,0,2);
  lua_pushliteral(L,"x");
  lua_pushliteral(L,"x");
  lua_gettable(L,1);
  lua_rawset(L,-3);
  lua_pushliteral(L,"y");
  lua_pushliteral(L,"z");
  lua_gettable(L,1);
  lua_rawset(L,-3);
  assert(lua_gettop(L) == 2);
  
  /* local n1 = minetest.get_perlin(6831, 3, 0.2, 50):get2d(pos2d) */
  lua_getfield(L,LUA_ENVIRONINDEX,"minetest");
  lua_pushliteral(L,"get_perlin");
  lua_gettable(L,-2);
  lua_remove(L,-2);
  lua_pushnumber(L,6831);
  lua_pushnumber(L,3);
  lua_pushnumber(L,0.2);
  lua_pushnumber(L,50);
  lua_call(L,4,1);
  lua_pushliteral(L,"get2d");
  lua_gettable(L,-2);
  lua_insert(L,-2);
  lua_pushvalue(L,2);
  lua_call(L,2,1);
  assert(lua_gettop(L) == 3);
  
  /* local n2 = minetest.get_perlin(1590, 3, 0.2, 50):get2d(pos2d) */
  lua_getfield(L,LUA_ENVIRONINDEX,"minetest");
  lua_pushliteral(L,"get_perlin");
  lua_gettable(L,-2);
  lua_remove(L,-2);
  lua_pushnumber(L,1590);
  lua_pushnumber(L,3);
  lua_pushnumber(L,0.2);
  lua_pushnumber(L,50);
  lua_call(L,4,1);
  lua_pushliteral(L,"get2d");
  lua_gettable(L,-2);
  lua_insert(L,-2);
  lua_pushvalue(L,2);
  lua_call(L,2,1);
  assert(lua_gettop(L) == 4);
  
  /* local n3 = minetest.get_perlin(4385, 3, 0.2, 25):get2d(pos2d) */
  lua_getfield(L,LUA_ENVIRONINDEX,"minetest");
  lua_pushliteral(L,"get_perlin");
  lua_gettable(L,-2);
  lua_remove(L,-2);
  lua_pushnumber(L,4385);
  lua_pushnumber(L,3);
  lua_pushnumber(L,0.2);
  lua_pushnumber(L,25);
  lua_call(L,4,1);
  lua_pushliteral(L,"get2d");
  lua_gettable(L,-2);
  lua_insert(L,-2);
  lua_pushvalue(L,2);
  lua_call(L,2,1);
  assert(lua_gettop(L) == 5);
  
  /* local n4 = minetest.get_perlin(9726, 3, 0.2, 25):get2d(pos2d) */
  lua_getfield(L,LUA_ENVIRONINDEX,"minetest");
  lua_pushliteral(L,"get_perlin");
  lua_gettable(L,-2);
  lua_remove(L,-2);
  lua_pushnumber(L,9726);
  lua_pushnumber(L,3);
  lua_pushnumber(L,0.2);
  lua_pushnumber(L,25);
  lua_call(L,4,1);
  lua_pushliteral(L,"get2d");
  lua_gettable(L,-2);
  lua_insert(L,-2);
  lua_pushvalue(L,2);
  lua_call(L,2,1);
  assert(lua_gettop(L) == 6);
  
  /* local n5 = minetest.get_perlin(1792, 3, 0.2, 10):get2d(pos2d) */
  lua_getfield(L,LUA_ENVIRONINDEX,"minetest");
  lua_pushliteral(L,"get_perlin");
  lua_gettable(L,-2);
  lua_remove(L,-2);
  lua_pushnumber(L,1792);
  lua_pushnumber(L,3);
  lua_pushnumber(L,0.2);
  lua_pushnumber(L,10);
  lua_call(L,4,1);
  lua_pushliteral(L,"get2d");
  lua_gettable(L,-2);
  lua_insert(L,-2);
  lua_pushvalue(L,2);
  lua_call(L,2,1);
  assert(lua_gettop(L) == 7);
  
  /* local n6 = minetest.get_perlin(1016, 3, 0.2, 10):get2d(pos2d) */
  lua_getfield(L,LUA_ENVIRONINDEX,"minetest");
  lua_pushliteral(L,"get_perlin");
  lua_gettable(L,-2);
  lua_remove(L,-2);
  lua_pushnumber(L,1016);
  lua_pushnumber(L,3);
  lua_pushnumber(L,0.2);
  lua_pushnumber(L,10);
  lua_call(L,4,1);
  lua_pushliteral(L,"get2d");
  lua_gettable(L,-2);
  lua_insert(L,-2);
  lua_pushvalue(L,2);
  lua_call(L,2,1);
  assert(lua_gettop(L) == 8);
  
  /* local n7 = minetest.get_perlin(8110, 3, 0.2, 300):get2d(pos2d) */
  lua_getfield(L,LUA_ENVIRONINDEX,"minetest");
  lua_pushliteral(L,"get_perlin");
  lua_gettable(L,-2);
  lua_remove(L,-2);
  lua_pushnumber(L,8110);
  lua_pushnumber(L,3);
  lua_pushnumber(L,0.2);
  lua_pushnumber(L,300);
  lua_call(L,4,1);
  lua_pushliteral(L,"get2d");
  lua_gettable(L,-2);
  lua_insert(L,-2);
  lua_pushvalue(L,2);
  lua_call(L,2,1);
  assert(lua_gettop(L) == 9);
  
  /* local n8 = minetest.get_perlin(2698, 3, 0.2, 400):get2d(pos2d) */
  lua_getfield(L,LUA_ENVIRONINDEX,"minetest");
  lua_pushliteral(L,"get_perlin");
  lua_gettable(L,-2);
  lua_remove(L,-2);
  lua_pushnumber(L,2698);
  lua_pushnumber(L,3);
  lua_pushnumber(L,0.2);
  lua_pushnumber(L,400);
  lua_call(L,4,1);
  lua_pushliteral(L,"get2d");
  lua_gettable(L,-2);
  lua_insert(L,-2);
  lua_pushvalue(L,2);
  lua_call(L,2,1);
  assert(lua_gettop(L) == 10);
  
  /* local value1 = math.abs(n1 - n2) * math.abs(n7) */
  lua_getfield(L,LUA_ENVIRONINDEX,"math");
  lua_pushliteral(L,"abs");
  lua_gettable(L,-2);
  lua_remove(L,-2);
  lc_sub(L,3,4);
  lua_call(L,1,1);
  lua_getfield(L,LUA_ENVIRONINDEX,"math");
  lua_pushliteral(L,"abs");
  lua_gettable(L,-2);
  lua_remove(L,-2);
  lua_pushvalue(L,9);
  lua_call(L,1,1);
  lc_mul(L,-2,-1);
  lua_remove(L,-2);
  lua_remove(L,-2);
  assert(lua_gettop(L) == 11);
  
  /* local value2 = math.sqrt(value1 * math.abs(n3 - n4)) * math.abs(n7) */
  lua_getfield(L,LUA_ENVIRONINDEX,"math");
  lua_pushliteral(L,"sqrt");
  lua_gettable(L,-2);
  lua_remove(L,-2);
  lua_getfield(L,LUA_ENVIRONINDEX,"math");
  lua_pushliteral(L,"abs");
  lua_gettable(L,-2);
  lua_remove(L,-2);
  lc_sub(L,5,6);
  lua_call(L,1,1);
  lc_mul(L,11,-1);
  lua_remove(L,-2);
  lua_call(L,1,1);
  lua_getfield(L,LUA_ENVIRONINDEX,"math");
  lua_pushliteral(L,"abs");
  lua_gettable(L,-2);
  lua_remove(L,-2);
  lua_pushvalue(L,9);
  lua_call(L,1,1);
  lc_mul(L,-2,-1);
  lua_remove(L,-2);
  lua_remove(L,-2);
  assert(lua_gettop(L) == 12);
  
  /* local value3 = math.sqrt(value2 * math.abs(n5 - n6)) * math.abs(n7) */
  lua_getfield(L,LUA_ENVIRONINDEX,"math");
  lua_pushliteral(L,"sqrt");
  lua_gettable(L,-2);
  lua_remove(L,-2);
  lua_getfield(L,LUA_ENVIRONINDEX,"math");
  lua_pushliteral(L,"abs");
  lua_gettable(L,-2);
  lua_remove(L,-2);
  lc_sub(L,7,8);
  lua_call(L,1,1);
  lc_mul(L,12,-1);
  lua_remove(L,-2);
  lua_call(L,1,1);
  lua_getfield(L,LUA_ENVIRONINDEX,"math");
  lua_pushliteral(L,"abs");
  lua_gettable(L,-2);
  lua_remove(L,-2);
  lua_pushvalue(L,9);
  lua_call(L,1,1);
  lc_mul(L,-2,-1);
  lua_remove(L,-2);
  lua_remove(L,-2);
  assert(lua_gettop(L) == 13);
  
  /* value1 = value1 + value1 * n8 */
  lc_mul(L,11,10);
  lc_add(L,11,-1);
  lua_remove(L,-2);
  lua_replace(L,11);
  assert(lua_gettop(L) == 13);
  
  /* value2 = value2 + value2 * n8 */
  lc_mul(L,12,10);
  lc_add(L,12,-1);
  lua_remove(L,-2);
  lua_replace(L,12);
  assert(lua_gettop(L) == 13);
  
  /* value3 = value3 + value3 * n8 */
  lc_mul(L,13,10);
  lc_add(L,13,-1);
  lua_remove(L,-2);
  lua_replace(L,13);
  assert(lua_gettop(L) == 13);
  
  /* local value = value1 * 20 + value2 * 15 + value3 * 10 + n8 * 50 */
  lua_pushnumber(L,20);
  lc_mul(L,11,-1);
  lua_remove(L,-2);
  lua_pushnumber(L,15);
  lc_mul(L,12,-1);
  lua_remove(L,-2);
  lc_add(L,-2,-1);
  lua_remove(L,-2);
  lua_remove(L,-2);
  lua_pushnumber(L,10);
  lc_mul(L,13,-1);
  lua_remove(L,-2);
  lc_add(L,-2,-1);
  lua_remove(L,-2);
  lua_remove(L,-2);
  lua_pushnumber(L,50);
  lc_mul(L,10,-1);
  lua_remove(L,-2);
  lc_add(L,-2,-1);
  lua_remove(L,-2);
  lua_remove(L,-2);
  assert(lua_gettop(L) == 14);
  
  /* if value < 0 then */
  enum { lc18 = 14 };
  lua_pushnumber(L,0);
  const int lc19 = lua_lessthan(L,14,-1);
  lua_pop(L,1);
  lua_pushboolean(L,lc19);
  const int lc20 = lua_toboolean(L,-1);
  lua_pop(L,1);
  if (lc20) {
    
    /* value = -2 * math.sqrt(-value) */
    lua_pushnumber(L,-2);
    lua_getfield(L,LUA_ENVIRONINDEX,"math");
    lua_pushliteral(L,"sqrt");
    lua_gettable(L,-2);
    lua_remove(L,-2);
    lc_unm(L,14);
    lua_call(L,1,1);
    lc_mul(L,-2,-1);
    lua_remove(L,-2);
    lua_remove(L,-2);
    lua_replace(L,14);
    assert(lua_gettop(L) == 14);
  }
  lua_settop(L,lc18);
  assert(lua_gettop(L) == 14);
  
  /* return math.floor(value + 0.5) */
  const int lc21 = lua_gettop(L);
  lua_getfield(L,LUA_ENVIRONINDEX,"math");
  lua_pushliteral(L,"floor");
  lua_gettable(L,-2);
  lua_remove(L,-2);
  lua_pushnumber(L,0.5);
  lc_add(L,14,-1);
  lua_remove(L,-2);
  lua_call(L,1,LUA_MULTRET);
  return (lua_gettop(L) - lc21);
  assert(lua_gettop(L) == 14);
}


/* function(mgparams) */
static int lcf22 (lua_State * L) {
  enum { lc_nformalargs = 1 };
  lua_settop(L,1);
  
  /* minetest.set_mapgen_params({mgname="singlenode", flags = "nolight", flagmask = "nolight"}) */
  lua_getfield(L,LUA_ENVIRONINDEX,"minetest");
  lua_pushliteral(L,"set_mapgen_params");
  lua_gettable(L,-2);
  lua_remove(L,-2);
  lua_createtable(L,0,3);
  lua_pushliteral(L,"mgname");
  lua_pushliteral(L,"singlenode");
  lua_rawset(L,-3);
  lua_pushliteral(L,"flags");
  lua_pushliteral(L,"nolight");
  lua_rawset(L,-3);
  lua_pushliteral(L,"flagmask");
  lua_pushliteral(L,"nolight");
  lua_rawset(L,-3);
  lua_call(L,1,0);
  assert(lua_gettop(L) == 1);
  return 0;
}


/* gets upvalue with ID varid by consulting upvalue table at index
 * tidx for the upvalue table at given nesting level. */
static void lc_getupvalue(lua_State * L, int tidx, int level, int varid) {
  if (level == 0) {
    lua_rawgeti(L,tidx,varid);
  }
  else {
    lua_pushvalue(L,tidx);
    while (--level >= 0) {
      lua_rawgeti(L,tidx,0); /* 0 links to parent table */
      lua_remove(L,-2);
      tidx = -1;
    }
    lua_rawgeti(L,-1,varid);
    lua_remove(L,-2);
  }
}


/* warning: assumes indices in range LUA_REGISTRYINDEX < x < 0 are relative. */
static int lc_le(lua_State * L, int idxa, int idxb) {
  if (lua_type(L,idxa) == LUA_TNUMBER && lua_type(L,idxb) == LUA_TNUMBER) {
    return lua_tonumber(L,idxa) <= lua_tonumber(L,idxb);
  }
  else if (lua_type(L,idxa) == LUA_TSTRING && lua_type(L,idxb) == LUA_TSTRING) {
    /* result similar to lvm.c l_strcmp */
    return lua_lessthan(L,idxa,idxb) || lua_rawequal(L,idxa,idxb);
  }
  else if (luaL_getmetafield(L,idxa,"__le")||luaL_getmetafield(L,idxb,"__le")) {
    lua_pushvalue(L,idxa < 0 && idxa > LUA_REGISTRYINDEX ? idxa-1 : idxa);
    lua_pushvalue(L,idxb < 0 && idxb > LUA_REGISTRYINDEX ? idxb-2 : idxb);
    lua_call(L,2,1);
    const int result = lua_toboolean(L,-1);
    lua_pop(L,1);
    return result;
  }
  else if (luaL_getmetafield(L,idxa,"__lt")||luaL_getmetafield(L,idxb,"__lt")) {
    lua_pushvalue(L,idxb < 0 && idxb > LUA_REGISTRYINDEX ? idxb-1 : idxb);
    lua_pushvalue(L,idxa < 0 && idxa > LUA_REGISTRYINDEX ? idxa-2 : idxa);
    lua_call(L,2,1);
    const int result = ! lua_toboolean(L,-1);
    lua_pop(L,1);
    return result;
  }
  else {
    return luaL_error(L, "attempt to compare");
  }
}


#include <math.h>

/* __pow metamethod handler.
 * warning: assumes indices in range LUA_REGISTRYINDEX < x < 0 are relative. */
static void lc_pow(lua_State * L, int idxa, int idxb) {
  if (lua_isnumber(L,idxa) && lua_isnumber(L,idxb)) {
    lua_pushnumber(L,pow(lua_tonumber(L,idxa),lua_tonumber(L,idxb)));
  }
  else {
    if (luaL_getmetafield(L,idxa,"__pow")||luaL_getmetafield(L,idxb,"__pow")) {
      lua_pushvalue(L,idxa < 0 && idxa > LUA_REGISTRYINDEX ? idxa-1 : idxa);
      lua_pushvalue(L,idxb < 0 && idxb > LUA_REGISTRYINDEX ? idxb-2 : idxb);
      lua_call(L,2,1);
    }
    else {
      luaL_error(L, "attempt to perform arithmetic");
    }
  }
}


/* __div metamethod handler.
 * warning: assumes indices in range LUA_REGISTRYINDEX < x < 0 are relative. */
static void lc_div(lua_State * L, int idxa, int idxb) {
  if (lua_isnumber(L,idxa) && lua_isnumber(L,idxb)) {
    lua_pushnumber(L,lua_tonumber(L,idxa) / lua_tonumber(L,idxb));
  }
  else {
    if (luaL_getmetafield(L,idxa,"__div")||luaL_getmetafield(L,idxb,"__div")) {
      lua_pushvalue(L,idxa < 0 && idxa > LUA_REGISTRYINDEX ? idxa-1 : idxa);
      lua_pushvalue(L,idxb < 0 && idxb > LUA_REGISTRYINDEX ? idxb-2 : idxb);
      lua_call(L,2,1);
    }
    else {
      luaL_error(L, "attempt to perform arithmetic");
    }
  }
}


/* function(minp, maxp) */
static int lcf191 (lua_State * L) {
  lua_checkstack(L,96);
  enum { lc_nformalargs = 2 };
  lua_settop(L,2);
  
  /* local t0 = os.clock() */
  lua_getfield(L,LUA_ENVIRONINDEX,"os");
  lua_pushliteral(L,"clock");
  lua_gettable(L,-2);
  lua_remove(L,-2);
  lua_call(L,0,1);
  assert(lua_gettop(L) == 3);
  
  /* local x1 = maxp.x */
  lua_pushliteral(L,"x");
  lua_gettable(L,2);
  assert(lua_gettop(L) == 4);
  
  /* local y1 = maxp.y */
  lua_pushliteral(L,"y");
  lua_gettable(L,2);
  assert(lua_gettop(L) == 5);
  
  /* local z1 = maxp.z */
  lua_pushliteral(L,"z");
  lua_gettable(L,2);
  assert(lua_gettop(L) == 6);
  
  /* local x0 = minp.x */
  lua_pushliteral(L,"x");
  lua_gettable(L,1);
  assert(lua_gettop(L) == 7);
  
  /* local y0 = minp.y */
  lua_pushliteral(L,"y");
  lua_gettable(L,1);
  assert(lua_gettop(L) == 8);
  
  /* local z0 = minp.z */
  lua_pushliteral(L,"z");
  lua_gettable(L,1);
  assert(lua_gettop(L) == 9);
  
  /* print ("[forest] Generating map from "..minetest.pos_to_string(minp).." to "..minetest.pos_to_string(maxp)) */
  lua_getfield(L,LUA_ENVIRONINDEX,"print");
  lua_pushliteral(L,"[forest] Generating map from ");
  lua_getfield(L,LUA_ENVIRONINDEX,"minetest");
  lua_pushliteral(L,"pos_to_string");
  lua_gettable(L,-2);
  lua_remove(L,-2);
  lua_pushvalue(L,1);
  lua_call(L,1,1);
  lua_pushliteral(L," to ");
  lua_getfield(L,LUA_ENVIRONINDEX,"minetest");
  lua_pushliteral(L,"pos_to_string");
  lua_gettable(L,-2);
  lua_remove(L,-2);
  lua_pushvalue(L,2);
  lua_call(L,1,1);
  lua_concat(L,2);
  lua_concat(L,2);
  lua_concat(L,2);
  lua_call(L,1,0);
  assert(lua_gettop(L) == 9);
  
  /* local c_dstone = minetest.get_content_id("default:desert_stone") */
  lua_getfield(L,LUA_ENVIRONINDEX,"minetest");
  lua_pushliteral(L,"get_content_id");
  lua_gettable(L,-2);
  lua_remove(L,-2);
  lua_pushliteral(L,"default:desert_stone");
  lua_call(L,1,1);
  assert(lua_gettop(L) == 10);
  
  /* local c_dsand = minetest.get_content_id("default:desert_sand") */
  lua_getfield(L,LUA_ENVIRONINDEX,"minetest");
  lua_pushliteral(L,"get_content_id");
  lua_gettable(L,-2);
  lua_remove(L,-2);
  lua_pushliteral(L,"default:desert_sand");
  lua_call(L,1,1);
  assert(lua_gettop(L) == 11);
  
  /* local c_water = minetest.get_content_id("default:water_source") */
  lua_getfield(L,LUA_ENVIRONINDEX,"minetest");
  lua_pushliteral(L,"get_content_id");
  lua_gettable(L,-2);
  lua_remove(L,-2);
  lua_pushliteral(L,"default:water_source");
  lua_call(L,1,1);
  assert(lua_gettop(L) == 12);
  
  /* local c_stone = minetest.get_content_id("default:stone") */
  lua_getfield(L,LUA_ENVIRONINDEX,"minetest");
  lua_pushliteral(L,"get_content_id");
  lua_gettable(L,-2);
  lua_remove(L,-2);
  lua_pushliteral(L,"default:stone");
  lua_call(L,1,1);
  assert(lua_gettop(L) == 13);
  
  /* local c_sand = minetest.get_content_id("default:sand") */
  lua_getfield(L,LUA_ENVIRONINDEX,"minetest");
  lua_pushliteral(L,"get_content_id");
  lua_gettable(L,-2);
  lua_remove(L,-2);
  lua_pushliteral(L,"default:sand");
  lua_call(L,1,1);
  assert(lua_gettop(L) == 14);
  
  /* local c_grass = minetest.get_content_id("default:dirt_with_grass") */
  lua_getfield(L,LUA_ENVIRONINDEX,"minetest");
  lua_pushliteral(L,"get_content_id");
  lua_gettable(L,-2);
  lua_remove(L,-2);
  lua_pushliteral(L,"default:dirt_with_grass");
  lua_call(L,1,1);
  assert(lua_gettop(L) == 15);
  
  /* local c_snow = minetest.get_content_id("default:dirt_with_snow") */
  lua_getfield(L,LUA_ENVIRONINDEX,"minetest");
  lua_pushliteral(L,"get_content_id");
  lua_gettable(L,-2);
  lua_remove(L,-2);
  lua_pushliteral(L,"default:dirt_with_snow");
  lua_call(L,1,1);
  assert(lua_gettop(L) == 16);
  
  /* local c_dirt = minetest.get_content_id("default:dirt") */
  lua_getfield(L,LUA_ENVIRONINDEX,"minetest");
  lua_pushliteral(L,"get_content_id");
  lua_gettable(L,-2);
  lua_remove(L,-2);
  lua_pushliteral(L,"default:dirt");
  lua_call(L,1,1);
  assert(lua_gettop(L) == 17);
  
  /* local c_gravel = minetest.get_content_id("default:gravel") */
  lua_getfield(L,LUA_ENVIRONINDEX,"minetest");
  lua_pushliteral(L,"get_content_id");
  lua_gettable(L,-2);
  lua_remove(L,-2);
  lua_pushliteral(L,"default:gravel");
  lua_call(L,1,1);
  assert(lua_gettop(L) == 18);
  
  /* local c_grasses = {
   * 		minetest.get_content_id("default:grass_1"),
   * 		minetest.get_content_id("default:grass_2"),
   * 		minetest.get_content_id("default:grass_3"),
   * 		minetest.get_content_id("default:grass_4"),
   * 		minetest.get_content_id("default:grass_5")
   * 	} */
  lua_createtable(L,5,0);
  lua_getfield(L,LUA_ENVIRONINDEX,"minetest");
  lua_pushliteral(L,"get_content_id");
  lua_gettable(L,-2);
  lua_remove(L,-2);
  lua_pushliteral(L,"default:grass_1");
  lua_call(L,1,1);
  lua_rawseti(L,-2,1);
  lua_getfield(L,LUA_ENVIRONINDEX,"minetest");
  lua_pushliteral(L,"get_content_id");
  lua_gettable(L,-2);
  lua_remove(L,-2);
  lua_pushliteral(L,"default:grass_2");
  lua_call(L,1,1);
  lua_rawseti(L,-2,2);
  lua_getfield(L,LUA_ENVIRONINDEX,"minetest");
  lua_pushliteral(L,"get_content_id");
  lua_gettable(L,-2);
  lua_remove(L,-2);
  lua_pushliteral(L,"default:grass_3");
  lua_call(L,1,1);
  lua_rawseti(L,-2,3);
  lua_getfield(L,LUA_ENVIRONINDEX,"minetest");
  lua_pushliteral(L,"get_content_id");
  lua_gettable(L,-2);
  lua_remove(L,-2);
  lua_pushliteral(L,"default:grass_4");
  lua_call(L,1,1);
  lua_rawseti(L,-2,4);
  const int lc23 = lua_gettop(L);
  lua_getfield(L,LUA_ENVIRONINDEX,"minetest");
  lua_pushliteral(L,"get_content_id");
  lua_gettable(L,-2);
  lua_remove(L,-2);
  lua_pushliteral(L,"default:grass_5");
  lua_call(L,1,LUA_MULTRET);
  while ((lua_gettop(L) > lc23)) {
    lua_rawseti(L,lc23,(4 + (lua_gettop(L) - lc23)));
  }
  assert(lua_gettop(L) == 19);
  
  /* local c_jungle = minetest.get_content_id("default:junglegrass") */
  lua_getfield(L,LUA_ENVIRONINDEX,"minetest");
  lua_pushliteral(L,"get_content_id");
  lua_gettable(L,-2);
  lua_remove(L,-2);
  lua_pushliteral(L,"default:junglegrass");
  lua_call(L,1,1);
  assert(lua_gettop(L) == 20);
  
  /* local c_flowers = {minetest.get_content_id("flowers:dandelion_yellow"), minetest.get_content_id("flowers:dandelion_yellow"), minetest.get_content_id("flowers:dandelion_yellow"), minetest.get_content_id("flowers:geranium"), minetest.get_content_id("flowers:tulip"), minetest.get_content_id("flowers:rose")} */
  lua_createtable(L,6,0);
  lua_getfield(L,LUA_ENVIRONINDEX,"minetest");
  lua_pushliteral(L,"get_content_id");
  lua_gettable(L,-2);
  lua_remove(L,-2);
  lua_pushliteral(L,"flowers:dandelion_yellow");
  lua_call(L,1,1);
  lua_rawseti(L,-2,1);
  lua_getfield(L,LUA_ENVIRONINDEX,"minetest");
  lua_pushliteral(L,"get_content_id");
  lua_gettable(L,-2);
  lua_remove(L,-2);
  lua_pushliteral(L,"flowers:dandelion_yellow");
  lua_call(L,1,1);
  lua_rawseti(L,-2,2);
  lua_getfield(L,LUA_ENVIRONINDEX,"minetest");
  lua_pushliteral(L,"get_content_id");
  lua_gettable(L,-2);
  lua_remove(L,-2);
  lua_pushliteral(L,"flowers:dandelion_yellow");
  lua_call(L,1,1);
  lua_rawseti(L,-2,3);
  lua_getfield(L,LUA_ENVIRONINDEX,"minetest");
  lua_pushliteral(L,"get_content_id");
  lua_gettable(L,-2);
  lua_remove(L,-2);
  lua_pushliteral(L,"flowers:geranium");
  lua_call(L,1,1);
  lua_rawseti(L,-2,4);
  lua_getfield(L,LUA_ENVIRONINDEX,"minetest");
  lua_pushliteral(L,"get_content_id");
  lua_gettable(L,-2);
  lua_remove(L,-2);
  lua_pushliteral(L,"flowers:tulip");
  lua_call(L,1,1);
  lua_rawseti(L,-2,5);
  const int lc24 = lua_gettop(L);
  lua_getfield(L,LUA_ENVIRONINDEX,"minetest");
  lua_pushliteral(L,"get_content_id");
  lua_gettable(L,-2);
  lua_remove(L,-2);
  lua_pushliteral(L,"flowers:rose");
  lua_call(L,1,LUA_MULTRET);
  while ((lua_gettop(L) > lc24)) {
    lua_rawseti(L,lc24,(5 + (lua_gettop(L) - lc24)));
  }
  assert(lua_gettop(L) == 21);
  
  /* local c_papyrus = minetest.get_content_id("default:papyrus") */
  lua_getfield(L,LUA_ENVIRONINDEX,"minetest");
  lua_pushliteral(L,"get_content_id");
  lua_gettable(L,-2);
  lua_remove(L,-2);
  lua_pushliteral(L,"default:papyrus");
  lua_call(L,1,1);
  assert(lua_gettop(L) == 22);
  
  /* local c_shrub = minetest.get_content_id("default:dry_shrub") */
  lua_getfield(L,LUA_ENVIRONINDEX,"minetest");
  lua_pushliteral(L,"get_content_id");
  lua_gettable(L,-2);
  lua_remove(L,-2);
  lua_pushliteral(L,"default:dry_shrub");
  lua_call(L,1,1);
  assert(lua_gettop(L) == 23);
  
  /* local c_lava = minetest.get_content_id("default:lava_source") */
  lua_getfield(L,LUA_ENVIRONINDEX,"minetest");
  lua_pushliteral(L,"get_content_id");
  lua_gettable(L,-2);
  lua_remove(L,-2);
  lua_pushliteral(L,"default:lava_source");
  lua_call(L,1,1);
  assert(lua_gettop(L) == 24);
  
  /* local c_cactus = minetest.get_content_id("default:cactus") */
  lua_getfield(L,LUA_ENVIRONINDEX,"minetest");
  lua_pushliteral(L,"get_content_id");
  lua_gettable(L,-2);
  lua_remove(L,-2);
  lua_pushliteral(L,"default:cactus");
  lua_call(L,1,1);
  assert(lua_gettop(L) == 25);
  
  /* local c_ignore = minetest.get_content_id("ignore") */
  lua_getfield(L,LUA_ENVIRONINDEX,"minetest");
  lua_pushliteral(L,"get_content_id");
  lua_gettable(L,-2);
  lua_remove(L,-2);
  lua_pushliteral(L,"ignore");
  lua_call(L,1,1);
  assert(lua_gettop(L) == 26);
  
  /* local c_air = minetest.get_content_id("air") */
  lua_getfield(L,LUA_ENVIRONINDEX,"minetest");
  lua_pushliteral(L,"get_content_id");
  lua_gettable(L,-2);
  lua_remove(L,-2);
  lua_pushliteral(L,"air");
  lua_call(L,1,1);
  assert(lua_gettop(L) == 27);
  
  /* -- LVM stuff
   * local manip, emin, emax = minetest.get_mapgen_object("voxelmanip") */
  lua_getfield(L,LUA_ENVIRONINDEX,"minetest");
  lua_pushliteral(L,"get_mapgen_object");
  lua_gettable(L,-2);
  lua_remove(L,-2);
  lua_pushliteral(L,"voxelmanip");
  lua_call(L,1,3);
  assert(lua_gettop(L) == 30);
  
  /* local area = VoxelArea:new({MinEdge = emin, MaxEdge = emax}) */
  lua_getfield(L,LUA_ENVIRONINDEX,"VoxelArea");
  lua_pushliteral(L,"new");
  lua_gettable(L,-2);
  lua_insert(L,-2);
  lua_createtable(L,0,2);
  lua_pushliteral(L,"MinEdge");
  lua_pushvalue(L,29);
  lua_rawset(L,-3);
  lua_pushliteral(L,"MaxEdge");
  lua_pushvalue(L,30);
  lua_rawset(L,-3);
  lua_call(L,2,1);
  assert(lua_gettop(L) == 31);
  
  /* local data = manip:get_data() */
  lua_pushvalue(L,28);
  lua_pushliteral(L,"get_data");
  lua_gettable(L,-2);
  lua_insert(L,-2);
  lua_call(L,1,1);
  assert(lua_gettop(L) == 32);
  
  /* local elevation */
  lua_settop(L,(lua_gettop(L) + 1));
  assert(lua_gettop(L) == 33);
  
  /* local node */
  lua_settop(L,(lua_gettop(L) + 1));
  assert(lua_gettop(L) == 34);
  
  /* local pos */
  lua_settop(L,(lua_gettop(L) + 1));
  assert(lua_gettop(L) == 35);
  
  /* local ground1, ground2, ground3, ground4, plant */
  lua_settop(L,(lua_gettop(L) + 5));
  assert(lua_gettop(L) == 40);
  
  /* -- perlinmap stuff
   * local sidelen = x1 - x0 + 1 */
  lc_sub(L,4,7);
  lua_pushnumber(L,1);
  lc_add(L,-2,-1);
  lua_remove(L,-2);
  lua_remove(L,-2);
  assert(lua_gettop(L) == 41);
  
  /* local chulens = {x=sidelen, y=sidelen, z=sidelen} */
  lua_createtable(L,0,3);
  lua_pushliteral(L,"x");
  lua_pushvalue(L,41);
  lua_rawset(L,-3);
  lua_pushliteral(L,"y");
  lua_pushvalue(L,41);
  lua_rawset(L,-3);
  lua_pushliteral(L,"z");
  lua_pushvalue(L,41);
  lua_rawset(L,-3);
  assert(lua_gettop(L) == 42);
  
  /* local minposxyz = {x=x0, y=y0, z=z0} */
  lua_createtable(L,0,3);
  lua_pushliteral(L,"x");
  lua_pushvalue(L,7);
  lua_rawset(L,-3);
  lua_pushliteral(L,"y");
  lua_pushvalue(L,8);
  lua_rawset(L,-3);
  lua_pushliteral(L,"z");
  lua_pushvalue(L,9);
  lua_rawset(L,-3);
  assert(lua_gettop(L) == 43);
  
  /* local minposxz = {x=x0, y=z0} */
  lua_createtable(L,0,2);
  lua_pushliteral(L,"x");
  lua_pushvalue(L,7);
  lua_rawset(L,-3);
  lua_pushliteral(L,"y");
  lua_pushvalue(L,9);
  lua_rawset(L,-3);
  assert(lua_gettop(L) == 44);
  
  /* -- 3D noises
   * local nvals_n1 = minetest.get_perlin_map(np_n1, chulens):get3dMap_flat(minposxyz) */
  lua_getfield(L,LUA_ENVIRONINDEX,"minetest");
  lua_pushliteral(L,"get_perlin_map");
  lua_gettable(L,-2);
  lua_remove(L,-2);
  lc_getupvalue(L,lua_upvalueindex(1),16,1);
  lua_pushvalue(L,42);
  lua_call(L,2,1);
  lua_pushliteral(L,"get3dMap_flat");
  lua_gettable(L,-2);
  lua_insert(L,-2);
  lua_pushvalue(L,43);
  lua_call(L,2,1);
  assert(lua_gettop(L) == 45);
  
  /* local nvals_n2 = minetest.get_perlin_map(np_n2, chulens):get3dMap_flat(minposxyz) */
  lua_getfield(L,LUA_ENVIRONINDEX,"minetest");
  lua_pushliteral(L,"get_perlin_map");
  lua_gettable(L,-2);
  lua_remove(L,-2);
  lc_getupvalue(L,lua_upvalueindex(1),15,2);
  lua_pushvalue(L,42);
  lua_call(L,2,1);
  lua_pushliteral(L,"get3dMap_flat");
  lua_gettable(L,-2);
  lua_insert(L,-2);
  lua_pushvalue(L,43);
  lua_call(L,2,1);
  assert(lua_gettop(L) == 46);
  
  /* local nvals_n3 = minetest.get_perlin_map(np_n3, chulens):get3dMap_flat(minposxyz) */
  lua_getfield(L,LUA_ENVIRONINDEX,"minetest");
  lua_pushliteral(L,"get_perlin_map");
  lua_gettable(L,-2);
  lua_remove(L,-2);
  lc_getupvalue(L,lua_upvalueindex(1),14,3);
  lua_pushvalue(L,42);
  lua_call(L,2,1);
  lua_pushliteral(L,"get3dMap_flat");
  lua_gettable(L,-2);
  lua_insert(L,-2);
  lua_pushvalue(L,43);
  lua_call(L,2,1);
  assert(lua_gettop(L) == 47);
  
  /* local nvals_n4 = minetest.get_perlin_map(np_n4, chulens):get3dMap_flat(minposxyz) */
  lua_getfield(L,LUA_ENVIRONINDEX,"minetest");
  lua_pushliteral(L,"get_perlin_map");
  lua_gettable(L,-2);
  lua_remove(L,-2);
  lc_getupvalue(L,lua_upvalueindex(1),13,4);
  lua_pushvalue(L,42);
  lua_call(L,2,1);
  lua_pushliteral(L,"get3dMap_flat");
  lua_gettable(L,-2);
  lua_insert(L,-2);
  lua_pushvalue(L,43);
  lua_call(L,2,1);
  assert(lua_gettop(L) == 48);
  
  /* -- 2D noises
   * local nvals_n5 = minetest.get_perlin_map(np_n5, chulens):get2dMap_flat(minposxz) */
  lua_getfield(L,LUA_ENVIRONINDEX,"minetest");
  lua_pushliteral(L,"get_perlin_map");
  lua_gettable(L,-2);
  lua_remove(L,-2);
  lc_getupvalue(L,lua_upvalueindex(1),12,5);
  lua_pushvalue(L,42);
  lua_call(L,2,1);
  lua_pushliteral(L,"get2dMap_flat");
  lua_gettable(L,-2);
  lua_insert(L,-2);
  lua_pushvalue(L,44);
  lua_call(L,2,1);
  assert(lua_gettop(L) == 49);
  
  /* local nvals_n6 = minetest.get_perlin_map(np_n6, chulens):get2dMap_flat(minposxz) */
  lua_getfield(L,LUA_ENVIRONINDEX,"minetest");
  lua_pushliteral(L,"get_perlin_map");
  lua_gettable(L,-2);
  lua_remove(L,-2);
  lc_getupvalue(L,lua_upvalueindex(1),11,6);
  lua_pushvalue(L,42);
  lua_call(L,2,1);
  lua_pushliteral(L,"get2dMap_flat");
  lua_gettable(L,-2);
  lua_insert(L,-2);
  lua_pushvalue(L,44);
  lua_call(L,2,1);
  assert(lua_gettop(L) == 50);
  
  /* local nvals_n7 = minetest.get_perlin_map(np_n7, chulens):get2dMap_flat(minposxz) */
  lua_getfield(L,LUA_ENVIRONINDEX,"minetest");
  lua_pushliteral(L,"get_perlin_map");
  lua_gettable(L,-2);
  lua_remove(L,-2);
  lc_getupvalue(L,lua_upvalueindex(1),10,7);
  lua_pushvalue(L,42);
  lua_call(L,2,1);
  lua_pushliteral(L,"get2dMap_flat");
  lua_gettable(L,-2);
  lua_insert(L,-2);
  lua_pushvalue(L,44);
  lua_call(L,2,1);
  assert(lua_gettop(L) == 51);
  
  /* local nvals_n8 = minetest.get_perlin_map(np_n8, chulens):get2dMap_flat(minposxz) */
  lua_getfield(L,LUA_ENVIRONINDEX,"minetest");
  lua_pushliteral(L,"get_perlin_map");
  lua_gettable(L,-2);
  lua_remove(L,-2);
  lc_getupvalue(L,lua_upvalueindex(1),9,8);
  lua_pushvalue(L,42);
  lua_call(L,2,1);
  lua_pushliteral(L,"get2dMap_flat");
  lua_gettable(L,-2);
  lua_insert(L,-2);
  lua_pushvalue(L,44);
  lua_call(L,2,1);
  assert(lua_gettop(L) == 52);
  
  /* local nvals_n9 = minetest.get_perlin_map(np_n9, chulens):get2dMap_flat(minposxz) */
  lua_getfield(L,LUA_ENVIRONINDEX,"minetest");
  lua_pushliteral(L,"get_perlin_map");
  lua_gettable(L,-2);
  lua_remove(L,-2);
  lc_getupvalue(L,lua_upvalueindex(1),8,9);
  lua_pushvalue(L,42);
  lua_call(L,2,1);
  lua_pushliteral(L,"get2dMap_flat");
  lua_gettable(L,-2);
  lua_insert(L,-2);
  lua_pushvalue(L,44);
  lua_call(L,2,1);
  assert(lua_gettop(L) == 53);
  
  /* -- elevation 2D noises
   * local nvals_n1e = minetest.get_perlin_map(np_n1e, chulens):get2dMap_flat(minposxz) */
  lua_getfield(L,LUA_ENVIRONINDEX,"minetest");
  lua_pushliteral(L,"get_perlin_map");
  lua_gettable(L,-2);
  lua_remove(L,-2);
  lc_getupvalue(L,lua_upvalueindex(1),7,10);
  lua_pushvalue(L,42);
  lua_call(L,2,1);
  lua_pushliteral(L,"get2dMap_flat");
  lua_gettable(L,-2);
  lua_insert(L,-2);
  lua_pushvalue(L,44);
  lua_call(L,2,1);
  assert(lua_gettop(L) == 54);
  
  /* local nvals_n2e = minetest.get_perlin_map(np_n2e, chulens):get2dMap_flat(minposxz) */
  lua_getfield(L,LUA_ENVIRONINDEX,"minetest");
  lua_pushliteral(L,"get_perlin_map");
  lua_gettable(L,-2);
  lua_remove(L,-2);
  lc_getupvalue(L,lua_upvalueindex(1),6,11);
  lua_pushvalue(L,42);
  lua_call(L,2,1);
  lua_pushliteral(L,"get2dMap_flat");
  lua_gettable(L,-2);
  lua_insert(L,-2);
  lua_pushvalue(L,44);
  lua_call(L,2,1);
  assert(lua_gettop(L) == 55);
  
  /* local nvals_n3e = minetest.get_perlin_map(np_n3e, chulens):get2dMap_flat(minposxz) */
  lua_getfield(L,LUA_ENVIRONINDEX,"minetest");
  lua_pushliteral(L,"get_perlin_map");
  lua_gettable(L,-2);
  lua_remove(L,-2);
  lc_getupvalue(L,lua_upvalueindex(1),5,12);
  lua_pushvalue(L,42);
  lua_call(L,2,1);
  lua_pushliteral(L,"get2dMap_flat");
  lua_gettable(L,-2);
  lua_insert(L,-2);
  lua_pushvalue(L,44);
  lua_call(L,2,1);
  assert(lua_gettop(L) == 56);
  
  /* local nvals_n4e = minetest.get_perlin_map(np_n4e, chulens):get2dMap_flat(minposxz) */
  lua_getfield(L,LUA_ENVIRONINDEX,"minetest");
  lua_pushliteral(L,"get_perlin_map");
  lua_gettable(L,-2);
  lua_remove(L,-2);
  lc_getupvalue(L,lua_upvalueindex(1),4,13);
  lua_pushvalue(L,42);
  lua_call(L,2,1);
  lua_pushliteral(L,"get2dMap_flat");
  lua_gettable(L,-2);
  lua_insert(L,-2);
  lua_pushvalue(L,44);
  lua_call(L,2,1);
  assert(lua_gettop(L) == 57);
  
  /* local nvals_n5e = minetest.get_perlin_map(np_n5e, chulens):get2dMap_flat(minposxz) */
  lua_getfield(L,LUA_ENVIRONINDEX,"minetest");
  lua_pushliteral(L,"get_perlin_map");
  lua_gettable(L,-2);
  lua_remove(L,-2);
  lc_getupvalue(L,lua_upvalueindex(1),3,14);
  lua_pushvalue(L,42);
  lua_call(L,2,1);
  lua_pushliteral(L,"get2dMap_flat");
  lua_gettable(L,-2);
  lua_insert(L,-2);
  lua_pushvalue(L,44);
  lua_call(L,2,1);
  assert(lua_gettop(L) == 58);
  
  /* local nvals_n6e = minetest.get_perlin_map(np_n6e, chulens):get2dMap_flat(minposxz) */
  lua_getfield(L,LUA_ENVIRONINDEX,"minetest");
  lua_pushliteral(L,"get_perlin_map");
  lua_gettable(L,-2);
  lua_remove(L,-2);
  lc_getupvalue(L,lua_upvalueindex(1),2,15);
  lua_pushvalue(L,42);
  lua_call(L,2,1);
  lua_pushliteral(L,"get2dMap_flat");
  lua_gettable(L,-2);
  lua_insert(L,-2);
  lua_pushvalue(L,44);
  lua_call(L,2,1);
  assert(lua_gettop(L) == 59);
  
  /* local nvals_n7e = minetest.get_perlin_map(np_n7e, chulens):get2dMap_flat(minposxz) */
  lua_getfield(L,LUA_ENVIRONINDEX,"minetest");
  lua_pushliteral(L,"get_perlin_map");
  lua_gettable(L,-2);
  lua_remove(L,-2);
  lc_getupvalue(L,lua_upvalueindex(1),1,16);
  lua_pushvalue(L,42);
  lua_call(L,2,1);
  lua_pushliteral(L,"get2dMap_flat");
  lua_gettable(L,-2);
  lua_insert(L,-2);
  lua_pushvalue(L,44);
  lua_call(L,2,1);
  assert(lua_gettop(L) == 60);
  
  /* local nvals_n8e = minetest.get_perlin_map(np_n8e, chulens):get2dMap_flat(minposxz) */
  lua_getfield(L,LUA_ENVIRONINDEX,"minetest");
  lua_pushliteral(L,"get_perlin_map");
  lua_gettable(L,-2);
  lua_remove(L,-2);
  lc_getupvalue(L,lua_upvalueindex(1),0,17);
  lua_pushvalue(L,42);
  lua_call(L,2,1);
  lua_pushliteral(L,"get2dMap_flat");
  lua_gettable(L,-2);
  lua_insert(L,-2);
  lua_pushvalue(L,44);
  lua_call(L,2,1);
  assert(lua_gettop(L) == 61);
  
  /* local nixz = 1 */
  lua_pushnumber(L,1);
  assert(lua_gettop(L) == 62);
  
  /* -- 2D noise index
   * for z = minp.z, maxp.z do */
  lua_pushliteral(L,"z");
  lua_gettable(L,1);
  lua_pushliteral(L,"z");
  lua_gettable(L,2);
  if (!((lua_isnumber(L,-2) && lua_isnumber(L,-1)))) {
    luaL_error(L,"'for' limit must be a number");
  }
  double lc25_var = lua_tonumber(L,-2);
  const double lc26_limit = lua_tonumber(L,-1);
  const double lc27_step = 1;
  lua_pop(L,2);
  enum { lc28 = 62 };
  while ((((lc27_step > 0) && (lc25_var <= lc26_limit)) || ((lc27_step <= 0) && (lc25_var >= lc26_limit)))) {
    
    /* internal: local z at index 63 */
    lua_pushnumber(L,lc25_var);
    
    /* for x = minp.x, maxp.x do */
    lua_pushliteral(L,"x");
    lua_gettable(L,1);
    lua_pushliteral(L,"x");
    lua_gettable(L,2);
    if (!((lua_isnumber(L,-2) && lua_isnumber(L,-1)))) {
      luaL_error(L,"'for' limit must be a number");
    }
    double lc29_var = lua_tonumber(L,-2);
    const double lc30_limit = lua_tonumber(L,-1);
    const double lc31_step = 1;
    lua_pop(L,2);
    enum { lc32 = 63 };
    while ((((lc31_step > 0) && (lc29_var <= lc30_limit)) || ((lc31_step <= 0) && (lc29_var >= lc30_limit)))) {
      
      /* internal: local x at index 64 */
      lua_pushnumber(L,lc29_var);
      
      /* local n1 = nvals_n1e[nixz] */
      lua_pushvalue(L,62);
      lua_gettable(L,54);
      assert(lua_gettop(L) == 65);
      
      /* local n2 = nvals_n2e[nixz] */
      lua_pushvalue(L,62);
      lua_gettable(L,55);
      assert(lua_gettop(L) == 66);
      
      /* local n3 = nvals_n3e[nixz] */
      lua_pushvalue(L,62);
      lua_gettable(L,56);
      assert(lua_gettop(L) == 67);
      
      /* local n4 = nvals_n4e[nixz] */
      lua_pushvalue(L,62);
      lua_gettable(L,57);
      assert(lua_gettop(L) == 68);
      
      /* local n5 = nvals_n5e[nixz] */
      lua_pushvalue(L,62);
      lua_gettable(L,58);
      assert(lua_gettop(L) == 69);
      
      /* local n6 = nvals_n6e[nixz] */
      lua_pushvalue(L,62);
      lua_gettable(L,59);
      assert(lua_gettop(L) == 70);
      
      /* local n7 = nvals_n7e[nixz] */
      lua_pushvalue(L,62);
      lua_gettable(L,60);
      assert(lua_gettop(L) == 71);
      
      /* local n8 = nvals_n8e[nixz] */
      lua_pushvalue(L,62);
      lua_gettable(L,61);
      assert(lua_gettop(L) == 72);
      
      /* local value1 = math.abs(n1 - n2) * math.abs(n7) */
      lua_getfield(L,LUA_ENVIRONINDEX,"math");
      lua_pushliteral(L,"abs");
      lua_gettable(L,-2);
      lua_remove(L,-2);
      lc_sub(L,65,66);
      lua_call(L,1,1);
      lua_getfield(L,LUA_ENVIRONINDEX,"math");
      lua_pushliteral(L,"abs");
      lua_gettable(L,-2);
      lua_remove(L,-2);
      lua_pushvalue(L,71);
      lua_call(L,1,1);
      lc_mul(L,-2,-1);
      lua_remove(L,-2);
      lua_remove(L,-2);
      assert(lua_gettop(L) == 73);
      
      /* local value2 = math.sqrt(value1 * math.abs(n3 - n4)) * math.abs(n7) */
      lua_getfield(L,LUA_ENVIRONINDEX,"math");
      lua_pushliteral(L,"sqrt");
      lua_gettable(L,-2);
      lua_remove(L,-2);
      lua_getfield(L,LUA_ENVIRONINDEX,"math");
      lua_pushliteral(L,"abs");
      lua_gettable(L,-2);
      lua_remove(L,-2);
      lc_sub(L,67,68);
      lua_call(L,1,1);
      lc_mul(L,73,-1);
      lua_remove(L,-2);
      lua_call(L,1,1);
      lua_getfield(L,LUA_ENVIRONINDEX,"math");
      lua_pushliteral(L,"abs");
      lua_gettable(L,-2);
      lua_remove(L,-2);
      lua_pushvalue(L,71);
      lua_call(L,1,1);
      lc_mul(L,-2,-1);
      lua_remove(L,-2);
      lua_remove(L,-2);
      assert(lua_gettop(L) == 74);
      
      /* local value3 = math.sqrt(value2 * math.abs(n5 - n6)) * math.abs(n7) */
      lua_getfield(L,LUA_ENVIRONINDEX,"math");
      lua_pushliteral(L,"sqrt");
      lua_gettable(L,-2);
      lua_remove(L,-2);
      lua_getfield(L,LUA_ENVIRONINDEX,"math");
      lua_pushliteral(L,"abs");
      lua_gettable(L,-2);
      lua_remove(L,-2);
      lc_sub(L,69,70);
      lua_call(L,1,1);
      lc_mul(L,74,-1);
      lua_remove(L,-2);
      lua_call(L,1,1);
      lua_getfield(L,LUA_ENVIRONINDEX,"math");
      lua_pushliteral(L,"abs");
      lua_gettable(L,-2);
      lua_remove(L,-2);
      lua_pushvalue(L,71);
      lua_call(L,1,1);
      lc_mul(L,-2,-1);
      lua_remove(L,-2);
      lua_remove(L,-2);
      assert(lua_gettop(L) == 75);
      
      /* value1 = value1 + value1 * n8 */
      lc_mul(L,73,72);
      lc_add(L,73,-1);
      lua_remove(L,-2);
      lua_replace(L,73);
      assert(lua_gettop(L) == 75);
      
      /* value2 = value2 + value2 * n8 */
      lc_mul(L,74,72);
      lc_add(L,74,-1);
      lua_remove(L,-2);
      lua_replace(L,74);
      assert(lua_gettop(L) == 75);
      
      /* value3 = value3 + value3 * n8 */
      lc_mul(L,75,72);
      lc_add(L,75,-1);
      lua_remove(L,-2);
      lua_replace(L,75);
      assert(lua_gettop(L) == 75);
      
      /* local value = value1 * 20 + value2 * 15 + value3 * 10 + n8 * 50 */
      lua_pushnumber(L,20);
      lc_mul(L,73,-1);
      lua_remove(L,-2);
      lua_pushnumber(L,15);
      lc_mul(L,74,-1);
      lua_remove(L,-2);
      lc_add(L,-2,-1);
      lua_remove(L,-2);
      lua_remove(L,-2);
      lua_pushnumber(L,10);
      lc_mul(L,75,-1);
      lua_remove(L,-2);
      lc_add(L,-2,-1);
      lua_remove(L,-2);
      lua_remove(L,-2);
      lua_pushnumber(L,50);
      lc_mul(L,72,-1);
      lua_remove(L,-2);
      lc_add(L,-2,-1);
      lua_remove(L,-2);
      lua_remove(L,-2);
      assert(lua_gettop(L) == 76);
      
      /* if value < 0 then */
      enum { lc33 = 76 };
      lua_pushnumber(L,0);
      const int lc34 = lua_lessthan(L,76,-1);
      lua_pop(L,1);
      lua_pushboolean(L,lc34);
      const int lc35 = lua_toboolean(L,-1);
      lua_pop(L,1);
      if (lc35) {
        
        /* value = -2 * math.sqrt(-value) */
        lua_pushnumber(L,-2);
        lua_getfield(L,LUA_ENVIRONINDEX,"math");
        lua_pushliteral(L,"sqrt");
        lua_gettable(L,-2);
        lua_remove(L,-2);
        lc_unm(L,76);
        lua_call(L,1,1);
        lc_mul(L,-2,-1);
        lua_remove(L,-2);
        lua_remove(L,-2);
        lua_replace(L,76);
        assert(lua_gettop(L) == 76);
      }
      lua_settop(L,lc33);
      assert(lua_gettop(L) == 76);
      
      /* elevation = math.floor(value + 0.5) */
      lua_getfield(L,LUA_ENVIRONINDEX,"math");
      lua_pushliteral(L,"floor");
      lua_gettable(L,-2);
      lua_remove(L,-2);
      lua_pushnumber(L,0.5);
      lc_add(L,76,-1);
      lua_remove(L,-2);
      lua_call(L,1,1);
      lua_replace(L,33);
      assert(lua_gettop(L) == 76);
      
      /* if math.max(elevation, 1) >= minp.y then */
      enum { lc36 = 76 };
      lua_pushliteral(L,"y");
      lua_gettable(L,1);
      lua_getfield(L,LUA_ENVIRONINDEX,"math");
      lua_pushliteral(L,"max");
      lua_gettable(L,-2);
      lua_remove(L,-2);
      lua_pushvalue(L,33);
      lua_pushnumber(L,1);
      lua_call(L,2,1);
      const int lc37 = lc_le(L,-2,-1);
      lua_pop(L,2);
      lua_pushboolean(L,lc37);
      const int lc38 = lua_toboolean(L,-1);
      lua_pop(L,1);
      if (lc38) {
        
        /* n5v = nvals_n5[nixz] */
        lua_pushvalue(L,62);
        lua_gettable(L,49);
        lua_setfield(L,LUA_ENVIRONINDEX,"n5v");
        assert(lua_gettop(L) == 76);
        
        /* n6v = nvals_n6[nixz] */
        lua_pushvalue(L,62);
        lua_gettable(L,50);
        lua_setfield(L,LUA_ENVIRONINDEX,"n6v");
        assert(lua_gettop(L) == 76);
        
        /* n7v = nvals_n7[nixz] */
        lua_pushvalue(L,62);
        lua_gettable(L,51);
        lua_setfield(L,LUA_ENVIRONINDEX,"n7v");
        assert(lua_gettop(L) == 76);
        
        /* n8v = nvals_n8[nixz] */
        lua_pushvalue(L,62);
        lua_gettable(L,52);
        lua_setfield(L,LUA_ENVIRONINDEX,"n8v");
        assert(lua_gettop(L) == 76);
        
        /* n9v = nvals_n9[nixz] */
        lua_pushvalue(L,62);
        lua_gettable(L,53);
        lua_setfield(L,LUA_ENVIRONINDEX,"n9v");
        assert(lua_gettop(L) == 76);
        
        /* if elevation < n8v * 5 then */
        enum { lc39 = 76 };
        lua_getfield(L,LUA_ENVIRONINDEX,"n8v");
        lua_pushnumber(L,5);
        lc_mul(L,-2,-1);
        lua_remove(L,-2);
        lua_remove(L,-2);
        const int lc40 = lua_lessthan(L,33,-1);
        lua_pop(L,1);
        lua_pushboolean(L,lc40);
        const int lc41 = lua_toboolean(L,-1);
        lua_pop(L,1);
        if (lc41) {
          
          /* if n7v < 0.88 then */
          enum { lc42 = 76 };
          lua_getfield(L,LUA_ENVIRONINDEX,"n7v");
          lua_pushnumber(L,0.88);
          const int lc43 = lua_lessthan(L,-2,-1);
          lua_pop(L,2);
          lua_pushboolean(L,lc43);
          const int lc44 = lua_toboolean(L,-1);
          lua_pop(L,1);
          if (lc44) {
            
            /* if n5v - n6v > 0.8 then */
            enum { lc45 = 76 };
            lua_pushnumber(L,0.8);
            lua_getfield(L,LUA_ENVIRONINDEX,"n5v");
            lua_getfield(L,LUA_ENVIRONINDEX,"n6v");
            lc_sub(L,-2,-1);
            lua_remove(L,-2);
            lua_remove(L,-2);
            const int lc46 = lua_lessthan(L,-2,-1);
            lua_pop(L,2);
            lua_pushboolean(L,lc46);
            const int lc47 = lua_toboolean(L,-1);
            lua_pop(L,1);
            if (lc47) {
              
              /* ground1 = c_gravel */
              lua_pushvalue(L,18);
              lua_replace(L,36);
              assert(lua_gettop(L) == 76);
              
              /* ground2 = c_gravel */
              lua_pushvalue(L,18);
              lua_replace(L,37);
              assert(lua_gettop(L) == 76);
              
              /* ground3 = c_stone */
              lua_pushvalue(L,13);
              lua_replace(L,38);
              assert(lua_gettop(L) == 76);
              
              /* ground4 = c_stone */
              lua_pushvalue(L,13);
              lua_replace(L,39);
              assert(lua_gettop(L) == 76);
              
              /* plant = nil */
              lua_pushnil(L);
              lua_replace(L,40);
              assert(lua_gettop(L) == 76);
            }
            else {
              
              /* elseif n6v < 0 then */
              enum { lc48 = 76 };
              lua_getfield(L,LUA_ENVIRONINDEX,"n6v");
              lua_pushnumber(L,0);
              const int lc49 = lua_lessthan(L,-2,-1);
              lua_pop(L,2);
              lua_pushboolean(L,lc49);
              const int lc50 = lua_toboolean(L,-1);
              lua_pop(L,1);
              if (lc50) {
                
                /* if n5v < -0.4 then */
                enum { lc51 = 76 };
                lua_getfield(L,LUA_ENVIRONINDEX,"n5v");
                lua_pushnumber(L,-0.4);
                const int lc52 = lua_lessthan(L,-2,-1);
                lua_pop(L,2);
                lua_pushboolean(L,lc52);
                const int lc53 = lua_toboolean(L,-1);
                lua_pop(L,1);
                if (lc53) {
                  
                  /* ground1 = c_dsand */
                  lua_pushvalue(L,11);
                  lua_replace(L,36);
                  assert(lua_gettop(L) == 76);
                  
                  /* ground2 = c_dsand */
                  lua_pushvalue(L,11);
                  lua_replace(L,37);
                  assert(lua_gettop(L) == 76);
                  
                  /* ground3 = c_dstone */
                  lua_pushvalue(L,10);
                  lua_replace(L,38);
                  assert(lua_gettop(L) == 76);
                  
                  /* ground4 = c_stone */
                  lua_pushvalue(L,13);
                  lua_replace(L,39);
                  assert(lua_gettop(L) == 76);
                  
                  /* plant = nil */
                  lua_pushnil(L);
                  lua_replace(L,40);
                  assert(lua_gettop(L) == 76);
                }
                else {
                  
                  /* else
                   * ground1 = c_sand */
                  lua_pushvalue(L,14);
                  lua_replace(L,36);
                  assert(lua_gettop(L) == 76);
                  
                  /* ground2 = c_sand */
                  lua_pushvalue(L,14);
                  lua_replace(L,37);
                  assert(lua_gettop(L) == 76);
                  
                  /* ground3 = c_stone */
                  lua_pushvalue(L,13);
                  lua_replace(L,38);
                  assert(lua_gettop(L) == 76);
                  
                  /* ground4 = c_stone */
                  lua_pushvalue(L,13);
                  lua_replace(L,39);
                  assert(lua_gettop(L) == 76);
                  
                  /* plant = nil */
                  lua_pushnil(L);
                  lua_replace(L,40);
                  assert(lua_gettop(L) == 76);
                }
                lua_settop(L,lc51);
                assert(lua_gettop(L) == 76);
              }
              else {
                
                /* elseif n5v + n6v * 5 > 2 then */
                enum { lc54 = 76 };
                lua_pushnumber(L,2);
                lua_getfield(L,LUA_ENVIRONINDEX,"n5v");
                lua_getfield(L,LUA_ENVIRONINDEX,"n6v");
                lua_pushnumber(L,5);
                lc_mul(L,-2,-1);
                lua_remove(L,-2);
                lua_remove(L,-2);
                lc_add(L,-2,-1);
                lua_remove(L,-2);
                lua_remove(L,-2);
                const int lc55 = lua_lessthan(L,-2,-1);
                lua_pop(L,2);
                lua_pushboolean(L,lc55);
                const int lc56 = lua_toboolean(L,-1);
                lua_pop(L,1);
                if (lc56) {
                  
                  /* if n6v > 0.8 then */
                  enum { lc57 = 76 };
                  lua_pushnumber(L,0.8);
                  lua_getfield(L,LUA_ENVIRONINDEX,"n6v");
                  const int lc58 = lua_lessthan(L,-2,-1);
                  lua_pop(L,2);
                  lua_pushboolean(L,lc58);
                  const int lc59 = lua_toboolean(L,-1);
                  lua_pop(L,1);
                  if (lc59) {
                    
                    /* ground1 = c_gravel */
                    lua_pushvalue(L,18);
                    lua_replace(L,36);
                    assert(lua_gettop(L) == 76);
                    
                    /* ground2 = c_gravel */
                    lua_pushvalue(L,18);
                    lua_replace(L,37);
                    assert(lua_gettop(L) == 76);
                    
                    /* ground3 = c_stone */
                    lua_pushvalue(L,13);
                    lua_replace(L,38);
                    assert(lua_gettop(L) == 76);
                    
                    /* ground4 = c_stone */
                    lua_pushvalue(L,13);
                    lua_replace(L,39);
                    assert(lua_gettop(L) == 76);
                    
                    /* plant = nil */
                    lua_pushnil(L);
                    lua_replace(L,40);
                    assert(lua_gettop(L) == 76);
                  }
                  else {
                    
                    /* else
                     * ground1 = c_grass */
                    lua_pushvalue(L,15);
                    lua_replace(L,36);
                    assert(lua_gettop(L) == 76);
                    
                    /* ground2 = c_dirt */
                    lua_pushvalue(L,17);
                    lua_replace(L,37);
                    assert(lua_gettop(L) == 76);
                    
                    /* ground3 = c_stone */
                    lua_pushvalue(L,13);
                    lua_replace(L,38);
                    assert(lua_gettop(L) == 76);
                    
                    /* ground4 = c_stone */
                    lua_pushvalue(L,13);
                    lua_replace(L,39);
                    assert(lua_gettop(L) == 76);
                    
                    /* plant = {def = c_papyrus, percent = 4, height = math.random(2, 5)} */
                    lua_createtable(L,0,3);
                    lua_pushliteral(L,"def");
                    lua_pushvalue(L,22);
                    lua_rawset(L,-3);
                    lua_pushliteral(L,"percent");
                    lua_pushnumber(L,4);
                    lua_rawset(L,-3);
                    lua_pushliteral(L,"height");
                    lua_getfield(L,LUA_ENVIRONINDEX,"math");
                    lua_pushliteral(L,"random");
                    lua_gettable(L,-2);
                    lua_remove(L,-2);
                    lua_pushnumber(L,2);
                    lua_pushnumber(L,5);
                    lua_call(L,2,1);
                    lua_rawset(L,-3);
                    lua_replace(L,40);
                    assert(lua_gettop(L) == 76);
                  }
                  lua_settop(L,lc57);
                  assert(lua_gettop(L) == 76);
                }
                else {
                  
                  /* else
                   * ground1 = c_sand */
                  lua_pushvalue(L,14);
                  lua_replace(L,36);
                  assert(lua_gettop(L) == 76);
                  
                  /* ground2 = c_sand */
                  lua_pushvalue(L,14);
                  lua_replace(L,37);
                  assert(lua_gettop(L) == 76);
                  
                  /* ground3 = c_stone */
                  lua_pushvalue(L,13);
                  lua_replace(L,38);
                  assert(lua_gettop(L) == 76);
                  
                  /* ground4 = c_stone */
                  lua_pushvalue(L,13);
                  lua_replace(L,39);
                  assert(lua_gettop(L) == 76);
                  
                  /* plant = {def = c_grasses[math.random(5)], percent = 15} */
                  lua_createtable(L,0,2);
                  lua_pushliteral(L,"def");
                  lua_getfield(L,LUA_ENVIRONINDEX,"math");
                  lua_pushliteral(L,"random");
                  lua_gettable(L,-2);
                  lua_remove(L,-2);
                  lua_pushnumber(L,5);
                  lua_call(L,1,1);
                  lua_gettable(L,19);
                  lua_rawset(L,-3);
                  lua_pushliteral(L,"percent");
                  lua_pushnumber(L,15);
                  lua_rawset(L,-3);
                  lua_replace(L,40);
                  assert(lua_gettop(L) == 76);
                }
                lua_settop(L,lc54);
              }
              lua_settop(L,lc48);
            }
            lua_settop(L,lc45);
            assert(lua_gettop(L) == 76);
          }
          else {
            
            /* elseif n5v * 2 - n6v < 0 then */
            enum { lc60 = 76 };
            lua_getfield(L,LUA_ENVIRONINDEX,"n5v");
            lua_pushnumber(L,2);
            lc_mul(L,-2,-1);
            lua_remove(L,-2);
            lua_remove(L,-2);
            lua_getfield(L,LUA_ENVIRONINDEX,"n6v");
            lc_sub(L,-2,-1);
            lua_remove(L,-2);
            lua_remove(L,-2);
            lua_pushnumber(L,0);
            const int lc61 = lua_lessthan(L,-2,-1);
            lua_pop(L,2);
            lua_pushboolean(L,lc61);
            const int lc62 = lua_toboolean(L,-1);
            lua_pop(L,1);
            if (lc62) {
              
              /* ground1 = c_gravel */
              lua_pushvalue(L,18);
              lua_replace(L,36);
              assert(lua_gettop(L) == 76);
              
              /* ground2 = c_gravel */
              lua_pushvalue(L,18);
              lua_replace(L,37);
              assert(lua_gettop(L) == 76);
              
              /* ground3 = c_stone */
              lua_pushvalue(L,13);
              lua_replace(L,38);
              assert(lua_gettop(L) == 76);
              
              /* ground4 = c_stone */
              lua_pushvalue(L,13);
              lua_replace(L,39);
              assert(lua_gettop(L) == 76);
              
              /* plant = nil */
              lua_pushnil(L);
              lua_replace(L,40);
              assert(lua_gettop(L) == 76);
            }
            else {
              
              /* else
               * ground1 = c_stone */
              lua_pushvalue(L,13);
              lua_replace(L,36);
              assert(lua_gettop(L) == 76);
              
              /* ground2 = c_stone */
              lua_pushvalue(L,13);
              lua_replace(L,37);
              assert(lua_gettop(L) == 76);
              
              /* ground3 = c_stone */
              lua_pushvalue(L,13);
              lua_replace(L,38);
              assert(lua_gettop(L) == 76);
              
              /* ground4 = c_stone */
              lua_pushvalue(L,13);
              lua_replace(L,39);
              assert(lua_gettop(L) == 76);
              
              /* plant = nil */
              lua_pushnil(L);
              lua_replace(L,40);
              assert(lua_gettop(L) == 76);
            }
            lua_settop(L,lc60);
          }
          lua_settop(L,lc42);
          assert(lua_gettop(L) == 76);
        }
        else {
          
          /* elseif n7v < 0.88 then */
          enum { lc63 = 76 };
          lua_getfield(L,LUA_ENVIRONINDEX,"n7v");
          lua_pushnumber(L,0.88);
          const int lc64 = lua_lessthan(L,-2,-1);
          lua_pop(L,2);
          lua_pushboolean(L,lc64);
          const int lc65 = lua_toboolean(L,-1);
          lua_pop(L,1);
          if (lc65) {
            
            /* if n5v + 2 * n6v > -0.4 then */
            enum { lc66 = 76 };
            lua_pushnumber(L,-0.4);
            lua_getfield(L,LUA_ENVIRONINDEX,"n5v");
            lua_pushnumber(L,2);
            lua_getfield(L,LUA_ENVIRONINDEX,"n6v");
            lc_mul(L,-2,-1);
            lua_remove(L,-2);
            lua_remove(L,-2);
            lc_add(L,-2,-1);
            lua_remove(L,-2);
            lua_remove(L,-2);
            const int lc67 = lua_lessthan(L,-2,-1);
            lua_pop(L,2);
            lua_pushboolean(L,lc67);
            const int lc68 = lua_toboolean(L,-1);
            lua_pop(L,1);
            if (lc68) {
              
              /* if n5v > 0 then */
              enum { lc69 = 76 };
              lua_pushnumber(L,0);
              lua_getfield(L,LUA_ENVIRONINDEX,"n5v");
              const int lc70 = lua_lessthan(L,-2,-1);
              lua_pop(L,2);
              lua_pushboolean(L,lc70);
              const int lc71 = lua_toboolean(L,-1);
              lua_pop(L,1);
              if (lc71) {
                
                /* ground1 = c_grass */
                lua_pushvalue(L,15);
                lua_replace(L,36);
                assert(lua_gettop(L) == 76);
                
                /* ground2 = c_dirt */
                lua_pushvalue(L,17);
                lua_replace(L,37);
                assert(lua_gettop(L) == 76);
                
                /* ground3 = c_stone */
                lua_pushvalue(L,13);
                lua_replace(L,38);
                assert(lua_gettop(L) == 76);
                
                /* ground4 = c_stone */
                lua_pushvalue(L,13);
                lua_replace(L,39);
                assert(lua_gettop(L) == 76);
                
                /* plant = nil */
                lua_pushnil(L);
                lua_replace(L,40);
                assert(lua_gettop(L) == 76);
              }
              else {
                
                /* else
                 * ground1 = c_grass */
                lua_pushvalue(L,15);
                lua_replace(L,36);
                assert(lua_gettop(L) == 76);
                
                /* ground2 = c_dirt */
                lua_pushvalue(L,17);
                lua_replace(L,37);
                assert(lua_gettop(L) == 76);
                
                /* ground3 = c_stone */
                lua_pushvalue(L,13);
                lua_replace(L,38);
                assert(lua_gettop(L) == 76);
                
                /* ground4 = c_stone */
                lua_pushvalue(L,13);
                lua_replace(L,39);
                assert(lua_gettop(L) == 76);
                
                /* if math.random(2) == 2 then */
                enum { lc72 = 76 };
                lua_getfield(L,LUA_ENVIRONINDEX,"math");
                lua_pushliteral(L,"random");
                lua_gettable(L,-2);
                lua_remove(L,-2);
                lua_pushnumber(L,2);
                lua_call(L,1,1);
                lua_pushnumber(L,2);
                const int lc73 = lua_equal(L,-2,-1);
                lua_pop(L,2);
                lua_pushboolean(L,lc73);
                const int lc74 = lua_toboolean(L,-1);
                lua_pop(L,1);
                if (lc74) {
                  
                  /* plant = {def = c_grasses[math.random(5)], percent = 20} */
                  lua_createtable(L,0,2);
                  lua_pushliteral(L,"def");
                  lua_getfield(L,LUA_ENVIRONINDEX,"math");
                  lua_pushliteral(L,"random");
                  lua_gettable(L,-2);
                  lua_remove(L,-2);
                  lua_pushnumber(L,5);
                  lua_call(L,1,1);
                  lua_gettable(L,19);
                  lua_rawset(L,-3);
                  lua_pushliteral(L,"percent");
                  lua_pushnumber(L,20);
                  lua_rawset(L,-3);
                  lua_replace(L,40);
                  assert(lua_gettop(L) == 76);
                }
                else {
                  
                  /* else
                   * plant = {def = c_flowers[math.random(6)], percent = -n5v} */
                  lua_createtable(L,0,2);
                  lua_pushliteral(L,"def");
                  lua_getfield(L,LUA_ENVIRONINDEX,"math");
                  lua_pushliteral(L,"random");
                  lua_gettable(L,-2);
                  lua_remove(L,-2);
                  lua_pushnumber(L,6);
                  lua_call(L,1,1);
                  lua_gettable(L,21);
                  lua_rawset(L,-3);
                  lua_pushliteral(L,"percent");
                  lua_getfield(L,LUA_ENVIRONINDEX,"n5v");
                  lc_unm(L,-1);
                  lua_remove(L,-2);
                  lua_rawset(L,-3);
                  lua_replace(L,40);
                  assert(lua_gettop(L) == 76);
                }
                lua_settop(L,lc72);
                assert(lua_gettop(L) == 76);
              }
              lua_settop(L,lc69);
              assert(lua_gettop(L) == 76);
            }
            else {
              
              /* elseif n6v < -0.4 then */
              enum { lc75 = 76 };
              lua_getfield(L,LUA_ENVIRONINDEX,"n6v");
              lua_pushnumber(L,-0.4);
              const int lc76 = lua_lessthan(L,-2,-1);
              lua_pop(L,2);
              lua_pushboolean(L,lc76);
              const int lc77 = lua_toboolean(L,-1);
              lua_pop(L,1);
              if (lc77) {
                
                /* ground1 = c_dsand */
                lua_pushvalue(L,11);
                lua_replace(L,36);
                assert(lua_gettop(L) == 76);
                
                /* ground2 = c_dsand */
                lua_pushvalue(L,11);
                lua_replace(L,37);
                assert(lua_gettop(L) == 76);
                
                /* ground3 = c_dstone */
                lua_pushvalue(L,10);
                lua_replace(L,38);
                assert(lua_gettop(L) == 76);
                
                /* ground4 = c_stone */
                lua_pushvalue(L,13);
                lua_replace(L,39);
                assert(lua_gettop(L) == 76);
                
                /* if math.random(2) == 2 then */
                enum { lc78 = 76 };
                lua_getfield(L,LUA_ENVIRONINDEX,"math");
                lua_pushliteral(L,"random");
                lua_gettable(L,-2);
                lua_remove(L,-2);
                lua_pushnumber(L,2);
                lua_call(L,1,1);
                lua_pushnumber(L,2);
                const int lc79 = lua_equal(L,-2,-1);
                lua_pop(L,2);
                lua_pushboolean(L,lc79);
                const int lc80 = lua_toboolean(L,-1);
                lua_pop(L,1);
                if (lc80) {
                  
                  /* plant = {def = c_cactus, percent = 2, height = math.random(2, 6)} */
                  lua_createtable(L,0,3);
                  lua_pushliteral(L,"def");
                  lua_pushvalue(L,25);
                  lua_rawset(L,-3);
                  lua_pushliteral(L,"percent");
                  lua_pushnumber(L,2);
                  lua_rawset(L,-3);
                  lua_pushliteral(L,"height");
                  lua_getfield(L,LUA_ENVIRONINDEX,"math");
                  lua_pushliteral(L,"random");
                  lua_gettable(L,-2);
                  lua_remove(L,-2);
                  lua_pushnumber(L,2);
                  lua_pushnumber(L,6);
                  lua_call(L,2,1);
                  lua_rawset(L,-3);
                  lua_replace(L,40);
                  assert(lua_gettop(L) == 76);
                }
                else {
                  
                  /* else
                   * plant = {def = c_shrub, percent = 5} */
                  lua_createtable(L,0,2);
                  lua_pushliteral(L,"def");
                  lua_pushvalue(L,23);
                  lua_rawset(L,-3);
                  lua_pushliteral(L,"percent");
                  lua_pushnumber(L,5);
                  lua_rawset(L,-3);
                  lua_replace(L,40);
                  assert(lua_gettop(L) == 76);
                }
                lua_settop(L,lc78);
                assert(lua_gettop(L) == 76);
              }
              else {
                
                /* else
                 * ground1 = c_sand */
                lua_pushvalue(L,14);
                lua_replace(L,36);
                assert(lua_gettop(L) == 76);
                
                /* ground2 = c_sand */
                lua_pushvalue(L,14);
                lua_replace(L,37);
                assert(lua_gettop(L) == 76);
                
                /* ground3 = c_dstone */
                lua_pushvalue(L,10);
                lua_replace(L,38);
                assert(lua_gettop(L) == 76);
                
                /* ground4 = c_stone */
                lua_pushvalue(L,13);
                lua_replace(L,39);
                assert(lua_gettop(L) == 76);
                
                /* if math.random(2) == 2 then */
                enum { lc81 = 76 };
                lua_getfield(L,LUA_ENVIRONINDEX,"math");
                lua_pushliteral(L,"random");
                lua_gettable(L,-2);
                lua_remove(L,-2);
                lua_pushnumber(L,2);
                lua_call(L,1,1);
                lua_pushnumber(L,2);
                const int lc82 = lua_equal(L,-2,-1);
                lua_pop(L,2);
                lua_pushboolean(L,lc82);
                const int lc83 = lua_toboolean(L,-1);
                lua_pop(L,1);
                if (lc83) {
                  
                  /* plant = {def = c_cactus, percent = 0.25, height = math.random(2, 4)} */
                  lua_createtable(L,0,3);
                  lua_pushliteral(L,"def");
                  lua_pushvalue(L,25);
                  lua_rawset(L,-3);
                  lua_pushliteral(L,"percent");
                  lua_pushnumber(L,0.25);
                  lua_rawset(L,-3);
                  lua_pushliteral(L,"height");
                  lua_getfield(L,LUA_ENVIRONINDEX,"math");
                  lua_pushliteral(L,"random");
                  lua_gettable(L,-2);
                  lua_remove(L,-2);
                  lua_pushnumber(L,2);
                  lua_pushnumber(L,4);
                  lua_call(L,2,1);
                  lua_rawset(L,-3);
                  lua_replace(L,40);
                  assert(lua_gettop(L) == 76);
                }
                else {
                  
                  /* else
                   * plant = {def = c_jungle, percent = 25} */
                  lua_createtable(L,0,2);
                  lua_pushliteral(L,"def");
                  lua_pushvalue(L,20);
                  lua_rawset(L,-3);
                  lua_pushliteral(L,"percent");
                  lua_pushnumber(L,25);
                  lua_rawset(L,-3);
                  lua_replace(L,40);
                  assert(lua_gettop(L) == 76);
                }
                lua_settop(L,lc81);
                assert(lua_gettop(L) == 76);
              }
              lua_settop(L,lc75);
            }
            lua_settop(L,lc66);
            assert(lua_gettop(L) == 76);
          }
          else {
            
            /* elseif n5v ^ 2 + n6v ^ 2 < 0.16 and n7v > 0.9 then */
            enum { lc84 = 76 };
            lua_getfield(L,LUA_ENVIRONINDEX,"n5v");
            lua_pushnumber(L,2);
            lc_pow(L,-2,-1);
            lua_remove(L,-2);
            lua_remove(L,-2);
            lua_getfield(L,LUA_ENVIRONINDEX,"n6v");
            lua_pushnumber(L,2);
            lc_pow(L,-2,-1);
            lua_remove(L,-2);
            lua_remove(L,-2);
            lc_add(L,-2,-1);
            lua_remove(L,-2);
            lua_remove(L,-2);
            lua_pushnumber(L,0.16);
            const int lc85 = lua_lessthan(L,-2,-1);
            lua_pop(L,2);
            lua_pushboolean(L,lc85);
            if (lua_toboolean(L,-1)) {
              lua_pop(L,1);
              lua_pushnumber(L,0.9);
              lua_getfield(L,LUA_ENVIRONINDEX,"n7v");
              const int lc86 = lua_lessthan(L,-2,-1);
              lua_pop(L,2);
              lua_pushboolean(L,lc86);
            }
            const int lc87 = lua_toboolean(L,-1);
            lua_pop(L,1);
            if (lc87) {
              
              /* ground1 = c_air */
              lua_pushvalue(L,27);
              lua_replace(L,36);
              assert(lua_gettop(L) == 76);
              
              /* ground2 = c_lava */
              lua_pushvalue(L,24);
              lua_replace(L,37);
              assert(lua_gettop(L) == 76);
              
              /* ground3 = c_stone */
              lua_pushvalue(L,13);
              lua_replace(L,38);
              assert(lua_gettop(L) == 76);
              
              /* ground4 = c_stone */
              lua_pushvalue(L,13);
              lua_replace(L,39);
              assert(lua_gettop(L) == 76);
              
              /* plant = nil */
              lua_pushnil(L);
              lua_replace(L,40);
              assert(lua_gettop(L) == 76);
              
              /* elevation = math.min(
               * 					elevation, get_elevation({x = x, z = z + 1}),
               * 					get_elevation({x = x, z = z - 1}),
               * 					get_elevation({x = x + 1, z = z}),
               * 					get_elevation({x = x - 1, z = z})
               * 				) */
              lua_getfield(L,LUA_ENVIRONINDEX,"math");
              lua_pushliteral(L,"min");
              lua_gettable(L,-2);
              lua_remove(L,-2);
              const int lc88 = lua_gettop(L);
              lua_pushvalue(L,33);
              lua_getfield(L,LUA_ENVIRONINDEX,"get_elevation");
              lua_createtable(L,0,2);
              lua_pushliteral(L,"x");
              lua_pushvalue(L,64);
              lua_rawset(L,-3);
              lua_pushliteral(L,"z");
              lua_pushnumber(L,1);
              lc_add(L,63,-1);
              lua_remove(L,-2);
              lua_rawset(L,-3);
              lua_call(L,1,1);
              lua_getfield(L,LUA_ENVIRONINDEX,"get_elevation");
              lua_createtable(L,0,2);
              lua_pushliteral(L,"x");
              lua_pushvalue(L,64);
              lua_rawset(L,-3);
              lua_pushliteral(L,"z");
              lua_pushnumber(L,1);
              lc_sub(L,63,-1);
              lua_remove(L,-2);
              lua_rawset(L,-3);
              lua_call(L,1,1);
              lua_getfield(L,LUA_ENVIRONINDEX,"get_elevation");
              lua_createtable(L,0,2);
              lua_pushliteral(L,"x");
              lua_pushnumber(L,1);
              lc_add(L,64,-1);
              lua_remove(L,-2);
              lua_rawset(L,-3);
              lua_pushliteral(L,"z");
              lua_pushvalue(L,63);
              lua_rawset(L,-3);
              lua_call(L,1,1);
              lua_getfield(L,LUA_ENVIRONINDEX,"get_elevation");
              lua_createtable(L,0,2);
              lua_pushliteral(L,"x");
              lua_pushnumber(L,1);
              lc_sub(L,64,-1);
              lua_remove(L,-2);
              lua_rawset(L,-3);
              lua_pushliteral(L,"z");
              lua_pushvalue(L,63);
              lua_rawset(L,-3);
              lua_call(L,1,LUA_MULTRET);
              lua_call(L,(lua_gettop(L) - lc88),1);
              lua_replace(L,33);
              assert(lua_gettop(L) == 76);
            }
            else {
              
              /* elseif n5v > -0.6 then */
              enum { lc89 = 76 };
              lua_pushnumber(L,-0.6);
              lua_getfield(L,LUA_ENVIRONINDEX,"n5v");
              const int lc90 = lua_lessthan(L,-2,-1);
              lua_pop(L,2);
              lua_pushboolean(L,lc90);
              const int lc91 = lua_toboolean(L,-1);
              lua_pop(L,1);
              if (lc91) {
                
                /* ground1 = c_stone */
                lua_pushvalue(L,13);
                lua_replace(L,36);
                assert(lua_gettop(L) == 76);
                
                /* ground2 = c_stone */
                lua_pushvalue(L,13);
                lua_replace(L,37);
                assert(lua_gettop(L) == 76);
                
                /* ground3 = c_stone */
                lua_pushvalue(L,13);
                lua_replace(L,38);
                assert(lua_gettop(L) == 76);
                
                /* ground4 = c_stone */
                lua_pushvalue(L,13);
                lua_replace(L,39);
                assert(lua_gettop(L) == 76);
                
                /* plant = nil */
                lua_pushnil(L);
                lua_replace(L,40);
                assert(lua_gettop(L) == 76);
              }
              else {
                
                /* else
                 * ground1 = c_gravel */
                lua_pushvalue(L,18);
                lua_replace(L,36);
                assert(lua_gettop(L) == 76);
                
                /* ground2 = c_gravel */
                lua_pushvalue(L,18);
                lua_replace(L,37);
                assert(lua_gettop(L) == 76);
                
                /* ground3 = c_stone */
                lua_pushvalue(L,13);
                lua_replace(L,38);
                assert(lua_gettop(L) == 76);
                
                /* ground4 = c_stone */
                lua_pushvalue(L,13);
                lua_replace(L,39);
                assert(lua_gettop(L) == 76);
                
                /* plant = nil */
                lua_pushnil(L);
                lua_replace(L,40);
                assert(lua_gettop(L) == 76);
              }
              lua_settop(L,lc89);
            }
            lua_settop(L,lc84);
          }
          lua_settop(L,lc63);
        }
        lua_settop(L,lc39);
        assert(lua_gettop(L) == 76);
        
        /* for y = minp.y, math.min(math.max(elevation, 1), maxp.y) do */
        lua_pushliteral(L,"y");
        lua_gettable(L,1);
        lua_getfield(L,LUA_ENVIRONINDEX,"math");
        lua_pushliteral(L,"min");
        lua_gettable(L,-2);
        lua_remove(L,-2);
        lua_getfield(L,LUA_ENVIRONINDEX,"math");
        lua_pushliteral(L,"max");
        lua_gettable(L,-2);
        lua_remove(L,-2);
        lua_pushvalue(L,33);
        lua_pushnumber(L,1);
        lua_call(L,2,1);
        lua_pushliteral(L,"y");
        lua_gettable(L,2);
        lua_call(L,2,1);
        if (!((lua_isnumber(L,-2) && lua_isnumber(L,-1)))) {
          luaL_error(L,"'for' limit must be a number");
        }
        double lc92_var = lua_tonumber(L,-2);
        const double lc93_limit = lua_tonumber(L,-1);
        const double lc94_step = 1;
        lua_pop(L,2);
        enum { lc95 = 76 };
        while ((((lc94_step > 0) && (lc92_var <= lc93_limit)) || ((lc94_step <= 0) && (lc92_var >= lc93_limit)))) {
          
          /* internal: local y at index 77 */
          lua_pushnumber(L,lc92_var);
          
          /* pos = area:index(x, y, z) */
          lua_pushvalue(L,31);
          lua_pushliteral(L,"index");
          lua_gettable(L,-2);
          lua_insert(L,-2);
          lua_pushvalue(L,64);
          lua_pushvalue(L,77);
          lua_pushvalue(L,63);
          lua_call(L,4,1);
          lua_replace(L,35);
          assert(lua_gettop(L) == 77);
          
          /* -- LVM index for node
           * local nixyz = (z - z0) * 6400 + (y - y0) * 80 + (x - x0) + 1 */
          lc_sub(L,63,9);
          lua_pushnumber(L,6400);
          lc_mul(L,-2,-1);
          lua_remove(L,-2);
          lua_remove(L,-2);
          lc_sub(L,77,8);
          lua_pushnumber(L,80);
          lc_mul(L,-2,-1);
          lua_remove(L,-2);
          lua_remove(L,-2);
          lc_add(L,-2,-1);
          lua_remove(L,-2);
          lua_remove(L,-2);
          lc_sub(L,64,7);
          lc_add(L,-2,-1);
          lua_remove(L,-2);
          lua_remove(L,-2);
          lua_pushnumber(L,1);
          lc_add(L,-2,-1);
          lua_remove(L,-2);
          lua_remove(L,-2);
          assert(lua_gettop(L) == 78);
          
          /* -- noise index for node
           * n1v = nvals_n1[nixyz] */
          lua_pushvalue(L,78);
          lua_gettable(L,45);
          lua_setfield(L,LUA_ENVIRONINDEX,"n1v");
          assert(lua_gettop(L) == 78);
          
          /* n2v = nvals_n2[nixyz] */
          lua_pushvalue(L,78);
          lua_gettable(L,46);
          lua_setfield(L,LUA_ENVIRONINDEX,"n2v");
          assert(lua_gettop(L) == 78);
          
          /* n3v = nvals_n3[nixyz] */
          lua_pushvalue(L,78);
          lua_gettable(L,47);
          lua_setfield(L,LUA_ENVIRONINDEX,"n3v");
          assert(lua_gettop(L) == 78);
          
          /* n4v = nvals_n4[nixyz] */
          lua_pushvalue(L,78);
          lua_gettable(L,48);
          lua_setfield(L,LUA_ENVIRONINDEX,"n4v");
          assert(lua_gettop(L) == 78);
          
          /* if y == elevation then */
          enum { lc96 = 78 };
          const int lc97 = lua_equal(L,77,33);
          lua_pushboolean(L,lc97);
          const int lc98 = lua_toboolean(L,-1);
          lua_pop(L,1);
          if (lc98) {
            
            /* if elevation >= 1 then */
            enum { lc99 = 78 };
            lua_pushnumber(L,1);
            const int lc100 = lc_le(L,-1,33);
            lua_pop(L,1);
            lua_pushboolean(L,lc100);
            const int lc101 = lua_toboolean(L,-1);
            lua_pop(L,1);
            if (lc101) {
              
              /* node = ground1 */
              lua_pushvalue(L,36);
              lua_replace(L,34);
              assert(lua_gettop(L) == 78);
            }
            else {
              
              /* else
               * node = ground2 */
              lua_pushvalue(L,37);
              lua_replace(L,34);
              assert(lua_gettop(L) == 78);
            }
            lua_settop(L,lc99);
            assert(lua_gettop(L) == 78);
          }
          else {
            
            /* elseif y > elevation then */
            enum { lc102 = 78 };
            const int lc103 = lua_lessthan(L,33,77);
            lua_pushboolean(L,lc103);
            const int lc104 = lua_toboolean(L,-1);
            lua_pop(L,1);
            if (lc104) {
              
              /* node = c_water */
              lua_pushvalue(L,12);
              lua_replace(L,34);
              assert(lua_gettop(L) == 78);
            }
            else {
              
              /* elseif y + math.random(2, 6) >= elevation then */
              enum { lc105 = 78 };
              lua_getfield(L,LUA_ENVIRONINDEX,"math");
              lua_pushliteral(L,"random");
              lua_gettable(L,-2);
              lua_remove(L,-2);
              lua_pushnumber(L,2);
              lua_pushnumber(L,6);
              lua_call(L,2,1);
              lc_add(L,77,-1);
              lua_remove(L,-2);
              const int lc106 = lc_le(L,33,-1);
              lua_pop(L,1);
              lua_pushboolean(L,lc106);
              const int lc107 = lua_toboolean(L,-1);
              lua_pop(L,1);
              if (lc107) {
                
                /* node = ground2 */
                lua_pushvalue(L,37);
                lua_replace(L,34);
                assert(lua_gettop(L) == 78);
              }
              else {
                
                /* elseif y + 20 + n9v * 10 >= elevation then */
                enum { lc108 = 78 };
                lua_pushnumber(L,20);
                lc_add(L,77,-1);
                lua_remove(L,-2);
                lua_getfield(L,LUA_ENVIRONINDEX,"n9v");
                lua_pushnumber(L,10);
                lc_mul(L,-2,-1);
                lua_remove(L,-2);
                lua_remove(L,-2);
                lc_add(L,-2,-1);
                lua_remove(L,-2);
                lua_remove(L,-2);
                const int lc109 = lc_le(L,33,-1);
                lua_pop(L,1);
                lua_pushboolean(L,lc109);
                const int lc110 = lua_toboolean(L,-1);
                lua_pop(L,1);
                if (lc110) {
                  
                  /* node = ground3 */
                  lua_pushvalue(L,38);
                  lua_replace(L,34);
                  assert(lua_gettop(L) == 78);
                }
                else {
                  
                  /* else
                   * node = ground4 */
                  lua_pushvalue(L,39);
                  lua_replace(L,34);
                  assert(lua_gettop(L) == 78);
                }
                lua_settop(L,lc108);
              }
              lua_settop(L,lc105);
            }
            lua_settop(L,lc102);
          }
          lua_settop(L,lc96);
          assert(lua_gettop(L) == 78);
          
          /* if math.max(n1v, n2v, n3v) - math.min(n1v, n2v, n3v) > n4v / 5 or node == c_water then */
          enum { lc111 = 78 };
          lua_getfield(L,LUA_ENVIRONINDEX,"n4v");
          lua_pushnumber(L,5);
          lc_div(L,-2,-1);
          lua_remove(L,-2);
          lua_remove(L,-2);
          lua_getfield(L,LUA_ENVIRONINDEX,"math");
          lua_pushliteral(L,"max");
          lua_gettable(L,-2);
          lua_remove(L,-2);
          lua_getfield(L,LUA_ENVIRONINDEX,"n1v");
          lua_getfield(L,LUA_ENVIRONINDEX,"n2v");
          lua_getfield(L,LUA_ENVIRONINDEX,"n3v");
          lua_call(L,3,1);
          lua_getfield(L,LUA_ENVIRONINDEX,"math");
          lua_pushliteral(L,"min");
          lua_gettable(L,-2);
          lua_remove(L,-2);
          lua_getfield(L,LUA_ENVIRONINDEX,"n1v");
          lua_getfield(L,LUA_ENVIRONINDEX,"n2v");
          lua_getfield(L,LUA_ENVIRONINDEX,"n3v");
          lua_call(L,3,1);
          lc_sub(L,-2,-1);
          lua_remove(L,-2);
          lua_remove(L,-2);
          const int lc112 = lua_lessthan(L,-2,-1);
          lua_pop(L,2);
          lua_pushboolean(L,lc112);
          if (!(lua_toboolean(L,-1))) {
            lua_pop(L,1);
            lua_pushvalue(L,34);
            lua_pushvalue(L,12);
            const int lc113 = lua_equal(L,-2,-1);
            lua_pop(L,2);
            lua_pushboolean(L,lc113);
          }
          const int lc114 = lua_toboolean(L,-1);
          lua_pop(L,1);
          if (lc114) {
            
            /* data[pos] = node */
            lua_pushvalue(L,34);
            lua_pushvalue(L,35);
            lua_insert(L,-2);
            lua_settable(L,32);
            assert(lua_gettop(L) == 78);
          }
          lua_settop(L,lc111);
          assert(lua_gettop(L) == 78);
          
          /* internal: stack cleanup on scope exit */
          lua_pop(L,2);
          lc92_var += lc94_step;
        }
        lua_settop(L,lc95);
        assert(lua_gettop(L) == 76);
        
        /* if elevation > 0 and plant then */
        enum { lc115 = 76 };
        lua_pushnumber(L,0);
        const int lc116 = lua_lessthan(L,-1,33);
        lua_pop(L,1);
        lua_pushboolean(L,lc116);
        if (lua_toboolean(L,-1)) {
          lua_pop(L,1);
          lua_pushvalue(L,40);
        }
        const int lc117 = lua_toboolean(L,-1);
        lua_pop(L,1);
        if (lc117) {
          
          /* if math.random() * 100 < plant.percent then */
          enum { lc118 = 76 };
          lua_getfield(L,LUA_ENVIRONINDEX,"math");
          lua_pushliteral(L,"random");
          lua_gettable(L,-2);
          lua_remove(L,-2);
          lua_call(L,0,1);
          lua_pushnumber(L,100);
          lc_mul(L,-2,-1);
          lua_remove(L,-2);
          lua_remove(L,-2);
          lua_pushliteral(L,"percent");
          lua_gettable(L,40);
          const int lc119 = lua_lessthan(L,-2,-1);
          lua_pop(L,2);
          lua_pushboolean(L,lc119);
          const int lc120 = lua_toboolean(L,-1);
          lua_pop(L,1);
          if (lc120) {
            
            /* if plant.height then */
            enum { lc121 = 76 };
            lua_pushliteral(L,"height");
            lua_gettable(L,40);
            const int lc122 = lua_toboolean(L,-1);
            lua_pop(L,1);
            if (lc122) {
              
              /* for i = 1, plant.height do */
              lua_pushnumber(L,1);
              lua_pushliteral(L,"height");
              lua_gettable(L,40);
              if (!((lua_isnumber(L,-2) && lua_isnumber(L,-1)))) {
                luaL_error(L,"'for' limit must be a number");
              }
              double lc123_var = lua_tonumber(L,-2);
              const double lc124_limit = lua_tonumber(L,-1);
              const double lc125_step = 1;
              lua_pop(L,2);
              enum { lc126 = 76 };
              while ((((lc125_step > 0) && (lc123_var <= lc124_limit)) || ((lc125_step <= 0) && (lc123_var >= lc124_limit)))) {
                
                /* internal: local i at index 77 */
                lua_pushnumber(L,lc123_var);
                
                /* if area:contains(x, elevation + i, z) then */
                enum { lc127 = 77 };
                lua_pushvalue(L,31);
                lua_pushliteral(L,"contains");
                lua_gettable(L,-2);
                lua_insert(L,-2);
                lua_pushvalue(L,64);
                lc_add(L,33,77);
                lua_pushvalue(L,63);
                lua_call(L,4,1);
                const int lc128 = lua_toboolean(L,-1);
                lua_pop(L,1);
                if (lc128) {
                  
                  /* data[area:index(x, elevation + i, z)] = plant.def */
                  lua_pushliteral(L,"def");
                  lua_gettable(L,40);
                  lua_pushvalue(L,31);
                  lua_pushliteral(L,"index");
                  lua_gettable(L,-2);
                  lua_insert(L,-2);
                  lua_pushvalue(L,64);
                  lc_add(L,33,77);
                  lua_pushvalue(L,63);
                  lua_call(L,4,1);
                  lua_insert(L,-2);
                  lua_settable(L,32);
                  assert(lua_gettop(L) == 77);
                }
                lua_settop(L,lc127);
                assert(lua_gettop(L) == 77);
                
                /* internal: stack cleanup on scope exit */
                lua_pop(L,1);
                lc123_var += lc125_step;
              }
              lua_settop(L,lc126);
              assert(lua_gettop(L) == 76);
            }
            else {
              
              /* elseif area:contains(x, elevation + 1, z) then */
              enum { lc129 = 76 };
              lua_pushvalue(L,31);
              lua_pushliteral(L,"contains");
              lua_gettable(L,-2);
              lua_insert(L,-2);
              lua_pushvalue(L,64);
              lua_pushnumber(L,1);
              lc_add(L,33,-1);
              lua_remove(L,-2);
              lua_pushvalue(L,63);
              lua_call(L,4,1);
              const int lc130 = lua_toboolean(L,-1);
              lua_pop(L,1);
              if (lc130) {
                
                /* data[area:index(x, elevation + 1, z)] = plant.def */
                lua_pushliteral(L,"def");
                lua_gettable(L,40);
                lua_pushvalue(L,31);
                lua_pushliteral(L,"index");
                lua_gettable(L,-2);
                lua_insert(L,-2);
                lua_pushvalue(L,64);
                lua_pushnumber(L,1);
                lc_add(L,33,-1);
                lua_remove(L,-2);
                lua_pushvalue(L,63);
                lua_call(L,4,1);
                lua_insert(L,-2);
                lua_settable(L,32);
                assert(lua_gettop(L) == 76);
              }
              lua_settop(L,lc129);
            }
            lua_settop(L,lc121);
            assert(lua_gettop(L) == 76);
          }
          lua_settop(L,lc118);
          assert(lua_gettop(L) == 76);
        }
        lua_settop(L,lc115);
        assert(lua_gettop(L) == 76);
      }
      lua_settop(L,lc36);
      assert(lua_gettop(L) == 76);
      
      /* nixz = nixz + 1 */
      lua_pushnumber(L,1);
      lc_add(L,62,-1);
      lua_remove(L,-2);
      lua_replace(L,62);
      assert(lua_gettop(L) == 76);
      
      /* internal: stack cleanup on scope exit */
      lua_pop(L,13);
      lc29_var += lc31_step;
    }
    lua_settop(L,lc32);
    assert(lua_gettop(L) == 63);
    
    /* internal: stack cleanup on scope exit */
    lua_pop(L,1);
    lc25_var += lc27_step;
  }
  lua_settop(L,lc28);
  assert(lua_gettop(L) == 62);
  
  /* manip:set_data(data) */
  lua_pushvalue(L,28);
  lua_pushliteral(L,"set_data");
  lua_gettable(L,-2);
  lua_insert(L,-2);
  lua_pushvalue(L,32);
  lua_call(L,2,0);
  assert(lua_gettop(L) == 62);
  
  /* manip:update_liquids() */
  lua_pushvalue(L,28);
  lua_pushliteral(L,"update_liquids");
  lua_gettable(L,-2);
  lua_insert(L,-2);
  lua_call(L,1,0);
  assert(lua_gettop(L) == 62);
  
  /* manip:calc_lighting() */
  lua_pushvalue(L,28);
  lua_pushliteral(L,"calc_lighting");
  lua_gettable(L,-2);
  lua_insert(L,-2);
  lua_call(L,1,0);
  assert(lua_gettop(L) == 62);
  
  /* manip:write_to_map(data) */
  lua_pushvalue(L,28);
  lua_pushliteral(L,"write_to_map");
  lua_gettable(L,-2);
  lua_insert(L,-2);
  lua_pushvalue(L,32);
  lua_call(L,2,0);
  assert(lua_gettop(L) == 62);
  
  /* ------------------------ Ore generation ------------------------
   * local t1 = os.clock() */
  lua_getfield(L,LUA_ENVIRONINDEX,"os");
  lua_pushliteral(L,"clock");
  lua_gettable(L,-2);
  lua_remove(L,-2);
  lua_call(L,0,1);
  assert(lua_gettop(L) == 63);
  
  /* local pr = PseudoRandom(math.random(1000)) */
  lua_getfield(L,LUA_ENVIRONINDEX,"PseudoRandom");
  const int lc131 = lua_gettop(L);
  lua_getfield(L,LUA_ENVIRONINDEX,"math");
  lua_pushliteral(L,"random");
  lua_gettable(L,-2);
  lua_remove(L,-2);
  lua_pushnumber(L,1000);
  lua_call(L,1,LUA_MULTRET);
  lua_call(L,(lua_gettop(L) - lc131),1);
  assert(lua_gettop(L) == 64);
  
  /* for num, def in pairs(ores) do
   * internal: local f, s, var = explist */
  enum { lc132 = 64 };
  lua_getfield(L,LUA_ENVIRONINDEX,"pairs");
  lua_getfield(L,LUA_ENVIRONINDEX,"ores");
  lua_call(L,1,3);
  while (1) {
    
    /* internal: local var_1, ..., var_n = f(s, var)
     *           if var_1 == nil then break end
     *           var = var_1 */
    lua_pushvalue(L,-3);
    lua_pushvalue(L,-3);
    lua_pushvalue(L,-3);
    lua_call(L,2,2);
    if (lua_isnil(L,-2)) {
      break;
    }
    lua_pushvalue(L,-2);
    lua_replace(L,-4);
    
    /* internal: local num with idx 68
     * internal: local def with idx 69 */
    
    
    /* local noise = minetest.get_perlin(def.seed, 1, 0, def.scale) */
    lua_getfield(L,LUA_ENVIRONINDEX,"minetest");
    lua_pushliteral(L,"get_perlin");
    lua_gettable(L,-2);
    lua_remove(L,-2);
    lua_pushliteral(L,"seed");
    lua_gettable(L,69);
    lua_pushnumber(L,1);
    lua_pushnumber(L,0);
    lua_pushliteral(L,"scale");
    lua_gettable(L,69);
    lua_call(L,4,1);
    assert(lua_gettop(L) == 70);
    
    /* if def.gradiant then */
    enum { lc133 = 70 };
    lua_pushliteral(L,"gradiant");
    lua_gettable(L,69);
    const int lc134 = lua_toboolean(L,-1);
    lua_pop(L,1);
    if (lc134) {
      
      /* for i = 1, def.frequency do */
      lua_pushnumber(L,1);
      lua_pushliteral(L,"frequency");
      lua_gettable(L,69);
      if (!((lua_isnumber(L,-2) && lua_isnumber(L,-1)))) {
        luaL_error(L,"'for' limit must be a number");
      }
      double lc135_var = lua_tonumber(L,-2);
      const double lc136_limit = lua_tonumber(L,-1);
      const double lc137_step = 1;
      lua_pop(L,2);
      enum { lc138 = 70 };
      while ((((lc137_step > 0) && (lc135_var <= lc136_limit)) || ((lc137_step <= 0) && (lc135_var >= lc136_limit)))) {
        
        /* internal: local i at index 71 */
        lua_pushnumber(L,lc135_var);
        
        /* local middle = {x = pr:next(minp.x, maxp.x), y = pr:next(minp.y, maxp.y), z = pr:next(minp.z, maxp.z)} */
        lua_createtable(L,0,3);
        lua_pushliteral(L,"x");
        lua_pushvalue(L,64);
        lua_pushliteral(L,"next");
        lua_gettable(L,-2);
        lua_insert(L,-2);
        lua_pushliteral(L,"x");
        lua_gettable(L,1);
        lua_pushliteral(L,"x");
        lua_gettable(L,2);
        lua_call(L,3,1);
        lua_rawset(L,-3);
        lua_pushliteral(L,"y");
        lua_pushvalue(L,64);
        lua_pushliteral(L,"next");
        lua_gettable(L,-2);
        lua_insert(L,-2);
        lua_pushliteral(L,"y");
        lua_gettable(L,1);
        lua_pushliteral(L,"y");
        lua_gettable(L,2);
        lua_call(L,3,1);
        lua_rawset(L,-3);
        lua_pushliteral(L,"z");
        lua_pushvalue(L,64);
        lua_pushliteral(L,"next");
        lua_gettable(L,-2);
        lua_insert(L,-2);
        lua_pushliteral(L,"z");
        lua_gettable(L,1);
        lua_pushliteral(L,"z");
        lua_gettable(L,2);
        lua_call(L,3,1);
        lua_rawset(L,-3);
        assert(lua_gettop(L) == 72);
        
        /* if noise:get3d(middle) + math.random() * 2 >= 1 and middle.y < def.max_y and middle.y > def.min_y then */
        enum { lc139 = 72 };
        lua_pushnumber(L,1);
        lua_pushvalue(L,70);
        lua_pushliteral(L,"get3d");
        lua_gettable(L,-2);
        lua_insert(L,-2);
        lua_pushvalue(L,72);
        lua_call(L,2,1);
        lua_getfield(L,LUA_ENVIRONINDEX,"math");
        lua_pushliteral(L,"random");
        lua_gettable(L,-2);
        lua_remove(L,-2);
        lua_call(L,0,1);
        lua_pushnumber(L,2);
        lc_mul(L,-2,-1);
        lua_remove(L,-2);
        lua_remove(L,-2);
        lc_add(L,-2,-1);
        lua_remove(L,-2);
        lua_remove(L,-2);
        const int lc140 = lc_le(L,-2,-1);
        lua_pop(L,2);
        lua_pushboolean(L,lc140);
        if (lua_toboolean(L,-1)) {
          lua_pop(L,1);
          lua_pushliteral(L,"y");
          lua_gettable(L,72);
          lua_pushliteral(L,"max_y");
          lua_gettable(L,69);
          const int lc141 = lua_lessthan(L,-2,-1);
          lua_pop(L,2);
          lua_pushboolean(L,lc141);
        }
        if (lua_toboolean(L,-1)) {
          lua_pop(L,1);
          lua_pushliteral(L,"min_y");
          lua_gettable(L,69);
          lua_pushliteral(L,"y");
          lua_gettable(L,72);
          const int lc142 = lua_lessthan(L,-2,-1);
          lua_pop(L,2);
          lua_pushboolean(L,lc142);
        }
        const int lc143 = lua_toboolean(L,-1);
        lua_pop(L,1);
        if (lc143) {
          
          /* local zone = minetest.find_nodes_in_area(
           * 						{x = middle.x - def.radius, y = middle.y - def.radius, z = middle.z - def.radius},
           * 						{x = middle.x + def.radius, y = middle.y + def.radius, z = middle.z + def.radius},
           * 						{def.wherein}
           * 					) */
          lua_getfield(L,LUA_ENVIRONINDEX,"minetest");
          lua_pushliteral(L,"find_nodes_in_area");
          lua_gettable(L,-2);
          lua_remove(L,-2);
          lua_createtable(L,0,3);
          lua_pushliteral(L,"x");
          lua_pushliteral(L,"x");
          lua_gettable(L,72);
          lua_pushliteral(L,"radius");
          lua_gettable(L,69);
          lc_sub(L,-2,-1);
          lua_remove(L,-2);
          lua_remove(L,-2);
          lua_rawset(L,-3);
          lua_pushliteral(L,"y");
          lua_pushliteral(L,"y");
          lua_gettable(L,72);
          lua_pushliteral(L,"radius");
          lua_gettable(L,69);
          lc_sub(L,-2,-1);
          lua_remove(L,-2);
          lua_remove(L,-2);
          lua_rawset(L,-3);
          lua_pushliteral(L,"z");
          lua_pushliteral(L,"z");
          lua_gettable(L,72);
          lua_pushliteral(L,"radius");
          lua_gettable(L,69);
          lc_sub(L,-2,-1);
          lua_remove(L,-2);
          lua_remove(L,-2);
          lua_rawset(L,-3);
          lua_createtable(L,0,3);
          lua_pushliteral(L,"x");
          lua_pushliteral(L,"x");
          lua_gettable(L,72);
          lua_pushliteral(L,"radius");
          lua_gettable(L,69);
          lc_add(L,-2,-1);
          lua_remove(L,-2);
          lua_remove(L,-2);
          lua_rawset(L,-3);
          lua_pushliteral(L,"y");
          lua_pushliteral(L,"y");
          lua_gettable(L,72);
          lua_pushliteral(L,"radius");
          lua_gettable(L,69);
          lc_add(L,-2,-1);
          lua_remove(L,-2);
          lua_remove(L,-2);
          lua_rawset(L,-3);
          lua_pushliteral(L,"z");
          lua_pushliteral(L,"z");
          lua_gettable(L,72);
          lua_pushliteral(L,"radius");
          lua_gettable(L,69);
          lc_add(L,-2,-1);
          lua_remove(L,-2);
          lua_remove(L,-2);
          lua_rawset(L,-3);
          lua_createtable(L,1,0);
          lua_pushliteral(L,"wherein");
          lua_gettable(L,69);
          lua_rawseti(L,-2,1);
          lua_call(L,3,1);
          assert(lua_gettop(L) == 73);
          
          /* for node, pos in pairs(zone) do
           * internal: local f, s, var = explist */
          enum { lc144 = 73 };
          lua_getfield(L,LUA_ENVIRONINDEX,"pairs");
          lua_pushvalue(L,73);
          lua_call(L,1,3);
          while (1) {
            
            /* internal: local var_1, ..., var_n = f(s, var)
             *           if var_1 == nil then break end
             *           var = var_1 */
            lua_pushvalue(L,-3);
            lua_pushvalue(L,-3);
            lua_pushvalue(L,-3);
            lua_call(L,2,2);
            if (lua_isnil(L,-2)) {
              break;
            }
            lua_pushvalue(L,-2);
            lua_replace(L,-4);
            
            /* internal: local node with idx 77
             * internal: local pos with idx 78 */
            
            
            /* if distance(middle, pos) / (def.radius + 1) - math.random() <= 0 and math.random(100) <= def.density then */
            enum { lc145 = 78 };
            lua_getfield(L,LUA_ENVIRONINDEX,"distance");
            lua_pushvalue(L,72);
            lua_pushvalue(L,78);
            lua_call(L,2,1);
            lua_pushliteral(L,"radius");
            lua_gettable(L,69);
            lua_pushnumber(L,1);
            lc_add(L,-2,-1);
            lua_remove(L,-2);
            lua_remove(L,-2);
            lc_div(L,-2,-1);
            lua_remove(L,-2);
            lua_remove(L,-2);
            lua_getfield(L,LUA_ENVIRONINDEX,"math");
            lua_pushliteral(L,"random");
            lua_gettable(L,-2);
            lua_remove(L,-2);
            lua_call(L,0,1);
            lc_sub(L,-2,-1);
            lua_remove(L,-2);
            lua_remove(L,-2);
            lua_pushnumber(L,0);
            const int lc146 = lc_le(L,-2,-1);
            lua_pop(L,2);
            lua_pushboolean(L,lc146);
            if (lua_toboolean(L,-1)) {
              lua_pop(L,1);
              lua_getfield(L,LUA_ENVIRONINDEX,"math");
              lua_pushliteral(L,"random");
              lua_gettable(L,-2);
              lua_remove(L,-2);
              lua_pushnumber(L,100);
              lua_call(L,1,1);
              lua_pushliteral(L,"density");
              lua_gettable(L,69);
              const int lc147 = lc_le(L,-2,-1);
              lua_pop(L,2);
              lua_pushboolean(L,lc147);
            }
            const int lc148 = lua_toboolean(L,-1);
            lua_pop(L,1);
            if (lc148) {
              
              /* minetest.set_node(pos, {name = def.ore}) */
              lua_getfield(L,LUA_ENVIRONINDEX,"minetest");
              lua_pushliteral(L,"set_node");
              lua_gettable(L,-2);
              lua_remove(L,-2);
              lua_pushvalue(L,78);
              lua_createtable(L,0,1);
              lua_pushliteral(L,"name");
              lua_pushliteral(L,"ore");
              lua_gettable(L,69);
              lua_rawset(L,-3);
              lua_call(L,2,0);
              assert(lua_gettop(L) == 78);
            }
            lua_settop(L,lc145);
            assert(lua_gettop(L) == 78);
            
            /* internal: stack cleanup on scope exit */
            lua_pop(L,2);
          }
          lua_settop(L,lc144);
          assert(lua_gettop(L) == 73);
        }
        lua_settop(L,lc139);
        assert(lua_gettop(L) == 72);
        
        /* if def.center then */
        enum { lc149 = 72 };
        lua_pushliteral(L,"center");
        lua_gettable(L,69);
        const int lc150 = lua_toboolean(L,-1);
        lua_pop(L,1);
        if (lc150) {
          
          /* minetest.set_node(middle, {name = def.center}) */
          lua_getfield(L,LUA_ENVIRONINDEX,"minetest");
          lua_pushliteral(L,"set_node");
          lua_gettable(L,-2);
          lua_remove(L,-2);
          lua_pushvalue(L,72);
          lua_createtable(L,0,1);
          lua_pushliteral(L,"name");
          lua_pushliteral(L,"center");
          lua_gettable(L,69);
          lua_rawset(L,-3);
          lua_call(L,2,0);
          assert(lua_gettop(L) == 72);
        }
        lua_settop(L,lc149);
        assert(lua_gettop(L) == 72);
        
        /* internal: stack cleanup on scope exit */
        lua_pop(L,2);
        lc135_var += lc137_step;
      }
      lua_settop(L,lc138);
      assert(lua_gettop(L) == 70);
    }
    else {
      
      /* else
       * for i = 1, def.frequency do */
      lua_pushnumber(L,1);
      lua_pushliteral(L,"frequency");
      lua_gettable(L,69);
      if (!((lua_isnumber(L,-2) && lua_isnumber(L,-1)))) {
        luaL_error(L,"'for' limit must be a number");
      }
      double lc151_var = lua_tonumber(L,-2);
      const double lc152_limit = lua_tonumber(L,-1);
      const double lc153_step = 1;
      lua_pop(L,2);
      enum { lc154 = 70 };
      while ((((lc153_step > 0) && (lc151_var <= lc152_limit)) || ((lc153_step <= 0) && (lc151_var >= lc152_limit)))) {
        
        /* internal: local i at index 71 */
        lua_pushnumber(L,lc151_var);
        
        /* local middle = {x = pr:next(minp.x, maxp.x), y = pr:next(minp.y, maxp.y), z = pr:next(minp.z, maxp.z)} */
        lua_createtable(L,0,3);
        lua_pushliteral(L,"x");
        lua_pushvalue(L,64);
        lua_pushliteral(L,"next");
        lua_gettable(L,-2);
        lua_insert(L,-2);
        lua_pushliteral(L,"x");
        lua_gettable(L,1);
        lua_pushliteral(L,"x");
        lua_gettable(L,2);
        lua_call(L,3,1);
        lua_rawset(L,-3);
        lua_pushliteral(L,"y");
        lua_pushvalue(L,64);
        lua_pushliteral(L,"next");
        lua_gettable(L,-2);
        lua_insert(L,-2);
        lua_pushliteral(L,"y");
        lua_gettable(L,1);
        lua_pushliteral(L,"y");
        lua_gettable(L,2);
        lua_call(L,3,1);
        lua_rawset(L,-3);
        lua_pushliteral(L,"z");
        lua_pushvalue(L,64);
        lua_pushliteral(L,"next");
        lua_gettable(L,-2);
        lua_insert(L,-2);
        lua_pushliteral(L,"z");
        lua_gettable(L,1);
        lua_pushliteral(L,"z");
        lua_gettable(L,2);
        lua_call(L,3,1);
        lua_rawset(L,-3);
        assert(lua_gettop(L) == 72);
        
        /* if noise:get3d(middle) + math.random() * 2 >= 1 and middle.y < def.max_y and middle.y > def.min_y then */
        enum { lc155 = 72 };
        lua_pushnumber(L,1);
        lua_pushvalue(L,70);
        lua_pushliteral(L,"get3d");
        lua_gettable(L,-2);
        lua_insert(L,-2);
        lua_pushvalue(L,72);
        lua_call(L,2,1);
        lua_getfield(L,LUA_ENVIRONINDEX,"math");
        lua_pushliteral(L,"random");
        lua_gettable(L,-2);
        lua_remove(L,-2);
        lua_call(L,0,1);
        lua_pushnumber(L,2);
        lc_mul(L,-2,-1);
        lua_remove(L,-2);
        lua_remove(L,-2);
        lc_add(L,-2,-1);
        lua_remove(L,-2);
        lua_remove(L,-2);
        const int lc156 = lc_le(L,-2,-1);
        lua_pop(L,2);
        lua_pushboolean(L,lc156);
        if (lua_toboolean(L,-1)) {
          lua_pop(L,1);
          lua_pushliteral(L,"y");
          lua_gettable(L,72);
          lua_pushliteral(L,"max_y");
          lua_gettable(L,69);
          const int lc157 = lua_lessthan(L,-2,-1);
          lua_pop(L,2);
          lua_pushboolean(L,lc157);
        }
        if (lua_toboolean(L,-1)) {
          lua_pop(L,1);
          lua_pushliteral(L,"min_y");
          lua_gettable(L,69);
          lua_pushliteral(L,"y");
          lua_gettable(L,72);
          const int lc158 = lua_lessthan(L,-2,-1);
          lua_pop(L,2);
          lua_pushboolean(L,lc158);
        }
        const int lc159 = lua_toboolean(L,-1);
        lua_pop(L,1);
        if (lc159) {
          
          /* local zone = minetest.find_nodes_in_area(
           * 						{x = middle.x - def.radius, y = middle.y - def.radius, z = middle.z - def.radius},
           * 						{x = middle.x + def.radius, y = middle.y + def.radius, z = middle.z + def.radius},
           * 						{def.wherein}
           * 					) */
          lua_getfield(L,LUA_ENVIRONINDEX,"minetest");
          lua_pushliteral(L,"find_nodes_in_area");
          lua_gettable(L,-2);
          lua_remove(L,-2);
          lua_createtable(L,0,3);
          lua_pushliteral(L,"x");
          lua_pushliteral(L,"x");
          lua_gettable(L,72);
          lua_pushliteral(L,"radius");
          lua_gettable(L,69);
          lc_sub(L,-2,-1);
          lua_remove(L,-2);
          lua_remove(L,-2);
          lua_rawset(L,-3);
          lua_pushliteral(L,"y");
          lua_pushliteral(L,"y");
          lua_gettable(L,72);
          lua_pushliteral(L,"radius");
          lua_gettable(L,69);
          lc_sub(L,-2,-1);
          lua_remove(L,-2);
          lua_remove(L,-2);
          lua_rawset(L,-3);
          lua_pushliteral(L,"z");
          lua_pushliteral(L,"z");
          lua_gettable(L,72);
          lua_pushliteral(L,"radius");
          lua_gettable(L,69);
          lc_sub(L,-2,-1);
          lua_remove(L,-2);
          lua_remove(L,-2);
          lua_rawset(L,-3);
          lua_createtable(L,0,3);
          lua_pushliteral(L,"x");
          lua_pushliteral(L,"x");
          lua_gettable(L,72);
          lua_pushliteral(L,"radius");
          lua_gettable(L,69);
          lc_add(L,-2,-1);
          lua_remove(L,-2);
          lua_remove(L,-2);
          lua_rawset(L,-3);
          lua_pushliteral(L,"y");
          lua_pushliteral(L,"y");
          lua_gettable(L,72);
          lua_pushliteral(L,"radius");
          lua_gettable(L,69);
          lc_add(L,-2,-1);
          lua_remove(L,-2);
          lua_remove(L,-2);
          lua_rawset(L,-3);
          lua_pushliteral(L,"z");
          lua_pushliteral(L,"z");
          lua_gettable(L,72);
          lua_pushliteral(L,"radius");
          lua_gettable(L,69);
          lc_add(L,-2,-1);
          lua_remove(L,-2);
          lua_remove(L,-2);
          lua_rawset(L,-3);
          lua_createtable(L,1,0);
          lua_pushliteral(L,"wherein");
          lua_gettable(L,69);
          lua_rawseti(L,-2,1);
          lua_call(L,3,1);
          assert(lua_gettop(L) == 73);
          
          /* for node, pos in pairs(zone) do
           * internal: local f, s, var = explist */
          enum { lc160 = 73 };
          lua_getfield(L,LUA_ENVIRONINDEX,"pairs");
          lua_pushvalue(L,73);
          lua_call(L,1,3);
          while (1) {
            
            /* internal: local var_1, ..., var_n = f(s, var)
             *           if var_1 == nil then break end
             *           var = var_1 */
            lua_pushvalue(L,-3);
            lua_pushvalue(L,-3);
            lua_pushvalue(L,-3);
            lua_call(L,2,2);
            if (lua_isnil(L,-2)) {
              break;
            }
            lua_pushvalue(L,-2);
            lua_replace(L,-4);
            
            /* internal: local node with idx 77
             * internal: local pos with idx 78 */
            
            
            /* if distance(middle, pos) <= def.radius and math.random(100) >= def.density then */
            enum { lc161 = 78 };
            lua_getfield(L,LUA_ENVIRONINDEX,"distance");
            lua_pushvalue(L,72);
            lua_pushvalue(L,78);
            lua_call(L,2,1);
            lua_pushliteral(L,"radius");
            lua_gettable(L,69);
            const int lc162 = lc_le(L,-2,-1);
            lua_pop(L,2);
            lua_pushboolean(L,lc162);
            if (lua_toboolean(L,-1)) {
              lua_pop(L,1);
              lua_pushliteral(L,"density");
              lua_gettable(L,69);
              lua_getfield(L,LUA_ENVIRONINDEX,"math");
              lua_pushliteral(L,"random");
              lua_gettable(L,-2);
              lua_remove(L,-2);
              lua_pushnumber(L,100);
              lua_call(L,1,1);
              const int lc163 = lc_le(L,-2,-1);
              lua_pop(L,2);
              lua_pushboolean(L,lc163);
            }
            const int lc164 = lua_toboolean(L,-1);
            lua_pop(L,1);
            if (lc164) {
              
              /* minetest.set_node(pos, {name = def.ore}) */
              lua_getfield(L,LUA_ENVIRONINDEX,"minetest");
              lua_pushliteral(L,"set_node");
              lua_gettable(L,-2);
              lua_remove(L,-2);
              lua_pushvalue(L,78);
              lua_createtable(L,0,1);
              lua_pushliteral(L,"name");
              lua_pushliteral(L,"ore");
              lua_gettable(L,69);
              lua_rawset(L,-3);
              lua_call(L,2,0);
              assert(lua_gettop(L) == 78);
            }
            lua_settop(L,lc161);
            assert(lua_gettop(L) == 78);
            
            /* internal: stack cleanup on scope exit */
            lua_pop(L,2);
          }
          lua_settop(L,lc160);
          assert(lua_gettop(L) == 73);
        }
        lua_settop(L,lc155);
        assert(lua_gettop(L) == 72);
        
        /* internal: stack cleanup on scope exit */
        lua_pop(L,2);
        lc151_var += lc153_step;
      }
      lua_settop(L,lc154);
      assert(lua_gettop(L) == 70);
    }
    lua_settop(L,lc133);
    assert(lua_gettop(L) == 70);
    
    /* internal: stack cleanup on scope exit */
    lua_pop(L,3);
  }
  lua_settop(L,lc132);
  assert(lua_gettop(L) == 64);
  
  /* ------------------------ Tree generation ------------------------
   * local t2 = os.clock() */
  lua_getfield(L,LUA_ENVIRONINDEX,"os");
  lua_pushliteral(L,"clock");
  lua_gettable(L,-2);
  lua_remove(L,-2);
  lua_call(L,0,1);
  assert(lua_gettop(L) == 65);
  
  /* local biomes = minetest.get_perlin(289, 3, 0.6, 200) */
  lua_getfield(L,LUA_ENVIRONINDEX,"minetest");
  lua_pushliteral(L,"get_perlin");
  lua_gettable(L,-2);
  lua_remove(L,-2);
  lua_pushnumber(L,289);
  lua_pushnumber(L,3);
  lua_pushnumber(L,0.6);
  lua_pushnumber(L,200);
  lua_call(L,4,1);
  assert(lua_gettop(L) == 66);
  
  /* local grass_area = minetest.find_nodes_in_area(minp, maxp, "default:dirt_with_grass") */
  lua_getfield(L,LUA_ENVIRONINDEX,"minetest");
  lua_pushliteral(L,"find_nodes_in_area");
  lua_gettable(L,-2);
  lua_remove(L,-2);
  lua_pushvalue(L,1);
  lua_pushvalue(L,2);
  lua_pushliteral(L,"default:dirt_with_grass");
  lua_call(L,3,1);
  assert(lua_gettop(L) == 67);
  
  /* for grass, pos in pairs(grass_area) do
   * internal: local f, s, var = explist */
  enum { lc165 = 67 };
  lua_getfield(L,LUA_ENVIRONINDEX,"pairs");
  lua_pushvalue(L,67);
  lua_call(L,1,3);
  while (1) {
    
    /* internal: local var_1, ..., var_n = f(s, var)
     *           if var_1 == nil then break end
     *           var = var_1 */
    lua_pushvalue(L,-3);
    lua_pushvalue(L,-3);
    lua_pushvalue(L,-3);
    lua_call(L,2,2);
    if (lua_isnil(L,-2)) {
      break;
    }
    lua_pushvalue(L,-2);
    lua_replace(L,-4);
    
    /* internal: local grass with idx 71
     * internal: local pos with idx 72 */
    
    
    /* if math.random(12) == math.random(12) then */
    enum { lc166 = 72 };
    lua_getfield(L,LUA_ENVIRONINDEX,"math");
    lua_pushliteral(L,"random");
    lua_gettable(L,-2);
    lua_remove(L,-2);
    lua_pushnumber(L,12);
    lua_call(L,1,1);
    lua_getfield(L,LUA_ENVIRONINDEX,"math");
    lua_pushliteral(L,"random");
    lua_gettable(L,-2);
    lua_remove(L,-2);
    lua_pushnumber(L,12);
    lua_call(L,1,1);
    const int lc167 = lua_equal(L,-2,-1);
    lua_pop(L,2);
    lua_pushboolean(L,lc167);
    const int lc168 = lua_toboolean(L,-1);
    lua_pop(L,1);
    if (lc168) {
      
      /* local total = 0 */
      lua_pushnumber(L,0);
      assert(lua_gettop(L) == 73);
      
      /* local temperature = get_average_temperature(pos) */
      lua_getfield(L,LUA_ENVIRONINDEX,"get_average_temperature");
      lua_pushvalue(L,72);
      lua_call(L,1,1);
      assert(lua_gettop(L) == 74);
      
      /* local biome = biomes:get3d(pos) * 50 + 50 */
      lua_pushvalue(L,66);
      lua_pushliteral(L,"get3d");
      lua_gettable(L,-2);
      lua_insert(L,-2);
      lua_pushvalue(L,72);
      lua_call(L,2,1);
      lua_pushnumber(L,50);
      lc_mul(L,-2,-1);
      lua_remove(L,-2);
      lua_remove(L,-2);
      lua_pushnumber(L,50);
      lc_add(L,-2,-1);
      lua_remove(L,-2);
      lua_remove(L,-2);
      assert(lua_gettop(L) == 75);
      
      /* local candidates = {} */
      lua_newtable(L);
      assert(lua_gettop(L) == 76);
      
      /* local water = true */
      lua_pushboolean(L,1);
      assert(lua_gettop(L) == 77);
      
      /* local list = "" */
      lua_pushliteral(L,"");
      assert(lua_gettop(L) == 78);
      
      /* for specie, def in pairs(apportionment) do
       * internal: local f, s, var = explist */
      enum { lc169 = 78 };
      lua_getfield(L,LUA_ENVIRONINDEX,"pairs");
      lua_getfield(L,LUA_ENVIRONINDEX,"apportionment");
      lua_call(L,1,3);
      while (1) {
        
        /* internal: local var_1, ..., var_n = f(s, var)
         *           if var_1 == nil then break end
         *           var = var_1 */
        lua_pushvalue(L,-3);
        lua_pushvalue(L,-3);
        lua_pushvalue(L,-3);
        lua_call(L,2,2);
        if (lua_isnil(L,-2)) {
          break;
        }
        lua_pushvalue(L,-2);
        lua_replace(L,-4);
        
        /* internal: local specie with idx 82
         * internal: local def with idx 83 */
        
        
        /* local difference = (def.biome - biome) ^ 2 */
        lua_pushliteral(L,"biome");
        lua_gettable(L,83);
        lc_sub(L,-1,75);
        lua_remove(L,-2);
        lua_pushnumber(L,2);
        lc_pow(L,-2,-1);
        lua_remove(L,-2);
        lua_remove(L,-2);
        assert(lua_gettop(L) == 84);
        
        /* if def.water_proximity then */
        enum { lc170 = 84 };
        lua_pushliteral(L,"water_proximity");
        lua_gettable(L,83);
        const int lc171 = lua_toboolean(L,-1);
        lua_pop(L,1);
        if (lc171) {
          
          /* if minetest.find_node_near(pos, math.abs(def.water_proximity), {"group:water"}) == nil then */
          enum { lc172 = 84 };
          lua_getfield(L,LUA_ENVIRONINDEX,"minetest");
          lua_pushliteral(L,"find_node_near");
          lua_gettable(L,-2);
          lua_remove(L,-2);
          lua_pushvalue(L,72);
          lua_getfield(L,LUA_ENVIRONINDEX,"math");
          lua_pushliteral(L,"abs");
          lua_gettable(L,-2);
          lua_remove(L,-2);
          lua_pushliteral(L,"water_proximity");
          lua_gettable(L,83);
          lua_call(L,1,1);
          lua_createtable(L,1,0);
          lua_pushliteral(L,"group:water");
          lua_rawseti(L,-2,1);
          lua_call(L,3,1);
          lua_pushnil(L);
          const int lc173 = lua_equal(L,-2,-1);
          lua_pop(L,2);
          lua_pushboolean(L,lc173);
          const int lc174 = lua_toboolean(L,-1);
          lua_pop(L,1);
          if (lc174) {
            
            /* water = def.water_proximity <= 0 */
            lua_pushliteral(L,"water_proximity");
            lua_gettable(L,83);
            lua_pushnumber(L,0);
            const int lc175 = lc_le(L,-2,-1);
            lua_pop(L,2);
            lua_pushboolean(L,lc175);
            lua_replace(L,77);
            assert(lua_gettop(L) == 84);
          }
          else {
            
            /* else
             * water = def.water_proximity >= 0 */
            lua_pushnumber(L,0);
            lua_pushliteral(L,"water_proximity");
            lua_gettable(L,83);
            const int lc176 = lc_le(L,-2,-1);
            lua_pop(L,2);
            lua_pushboolean(L,lc176);
            lua_replace(L,77);
            assert(lua_gettop(L) == 84);
          }
          lua_settop(L,lc172);
          assert(lua_gettop(L) == 84);
        }
        else {
          
          /* else
           * water = true */
          lua_pushboolean(L,1);
          lua_replace(L,77);
          assert(lua_gettop(L) == 84);
        }
        lua_settop(L,lc170);
        assert(lua_gettop(L) == 84);
        
        /* if temperature <= def.temperature.max and temperature >= def.temperature.min and water then */
        enum { lc177 = 84 };
        lua_pushliteral(L,"temperature");
        lua_gettable(L,83);
        lua_pushliteral(L,"max");
        lua_gettable(L,-2);
        lua_remove(L,-2);
        const int lc178 = lc_le(L,74,-1);
        lua_pop(L,1);
        lua_pushboolean(L,lc178);
        if (lua_toboolean(L,-1)) {
          lua_pop(L,1);
          lua_pushliteral(L,"temperature");
          lua_gettable(L,83);
          lua_pushliteral(L,"min");
          lua_gettable(L,-2);
          lua_remove(L,-2);
          const int lc179 = lc_le(L,-1,74);
          lua_pop(L,1);
          lua_pushboolean(L,lc179);
        }
        if (lua_toboolean(L,-1)) {
          lua_pop(L,1);
          lua_pushvalue(L,77);
        }
        const int lc180 = lua_toboolean(L,-1);
        lua_pop(L,1);
        if (lc180) {
          
          /* if difference < def.tolerance ^ 2 then */
          enum { lc181 = 84 };
          lua_pushliteral(L,"tolerance");
          lua_gettable(L,83);
          lua_pushnumber(L,2);
          lc_pow(L,-2,-1);
          lua_remove(L,-2);
          lua_remove(L,-2);
          const int lc182 = lua_lessthan(L,84,-1);
          lua_pop(L,1);
          lua_pushboolean(L,lc182);
          const int lc183 = lua_toboolean(L,-1);
          lua_pop(L,1);
          if (lc183) {
            
            /* local chance = def.frequency * (1 - difference / def.tolerance ^ 2) */
            lua_pushliteral(L,"frequency");
            lua_gettable(L,83);
            lua_pushnumber(L,1);
            lua_pushliteral(L,"tolerance");
            lua_gettable(L,83);
            lua_pushnumber(L,2);
            lc_pow(L,-2,-1);
            lua_remove(L,-2);
            lua_remove(L,-2);
            lc_div(L,84,-1);
            lua_remove(L,-2);
            lc_sub(L,-2,-1);
            lua_remove(L,-2);
            lua_remove(L,-2);
            lc_mul(L,-2,-1);
            lua_remove(L,-2);
            lua_remove(L,-2);
            assert(lua_gettop(L) == 85);
            
            /* total = total + chance */
            lc_add(L,73,85);
            lua_replace(L,73);
            assert(lua_gettop(L) == 85);
            
            /* candidates[specie] = total */
            lua_pushvalue(L,73);
            lua_pushvalue(L,82);
            lua_insert(L,-2);
            lua_settable(L,76);
            assert(lua_gettop(L) == 85);
          }
          lua_settop(L,lc181);
          assert(lua_gettop(L) == 84);
        }
        lua_settop(L,lc177);
        assert(lua_gettop(L) == 84);
        
        /* internal: stack cleanup on scope exit */
        lua_pop(L,3);
      }
      lua_settop(L,lc169);
      assert(lua_gettop(L) == 78);
      
      /* local num = math.random() * total */
      lua_getfield(L,LUA_ENVIRONINDEX,"math");
      lua_pushliteral(L,"random");
      lua_gettable(L,-2);
      lua_remove(L,-2);
      lua_call(L,0,1);
      lc_mul(L,-1,73);
      lua_remove(L,-2);
      assert(lua_gettop(L) == 79);
      
      /* local min = total */
      lua_pushvalue(L,73);
      assert(lua_gettop(L) == 80);
      
      /* local tree = nil */
      lua_pushnil(L);
      assert(lua_gettop(L) == 81);
      
      /* for specie, num_chance in pairs(candidates) do
       * internal: local f, s, var = explist */
      enum { lc184 = 81 };
      lua_getfield(L,LUA_ENVIRONINDEX,"pairs");
      lua_pushvalue(L,76);
      lua_call(L,1,3);
      while (1) {
        
        /* internal: local var_1, ..., var_n = f(s, var)
         *           if var_1 == nil then break end
         *           var = var_1 */
        lua_pushvalue(L,-3);
        lua_pushvalue(L,-3);
        lua_pushvalue(L,-3);
        lua_call(L,2,2);
        if (lua_isnil(L,-2)) {
          break;
        }
        lua_pushvalue(L,-2);
        lua_replace(L,-4);
        
        /* internal: local specie with idx 85
         * internal: local num_chance with idx 86 */
        
        
        /* if num <= num_chance and num_chance <= min then */
        enum { lc185 = 86 };
        lua_pushboolean(L,lc_le(L,79,86));
        if (lua_toboolean(L,-1)) {
          lua_pop(L,1);
          lua_pushboolean(L,lc_le(L,86,80));
        }
        const int lc186 = lua_toboolean(L,-1);
        lua_pop(L,1);
        if (lc186) {
          
          /* tree = specie */
          lua_pushvalue(L,85);
          lua_replace(L,81);
          assert(lua_gettop(L) == 86);
          
          /* min = num_chance */
          lua_pushvalue(L,86);
          lua_replace(L,80);
          assert(lua_gettop(L) == 86);
        }
        lua_settop(L,lc185);
        assert(lua_gettop(L) == 86);
        
        /* internal: stack cleanup on scope exit */
        lua_pop(L,2);
      }
      lua_settop(L,lc184);
      assert(lua_gettop(L) == 81);
      
      /* local def = apportionment[tree] */
      lua_getfield(L,LUA_ENVIRONINDEX,"apportionment");
      lua_pushvalue(L,81);
      lua_gettable(L,-2);
      lua_remove(L,-2);
      assert(lua_gettop(L) == 82);
      
      /* pos = {x = pos.x, y = pos.y + 1, z = pos.z} */
      lua_createtable(L,0,3);
      lua_pushliteral(L,"x");
      lua_pushliteral(L,"x");
      lua_gettable(L,72);
      lua_rawset(L,-3);
      lua_pushliteral(L,"y");
      lua_pushliteral(L,"y");
      lua_gettable(L,72);
      lua_pushnumber(L,1);
      lc_add(L,-2,-1);
      lua_remove(L,-2);
      lua_remove(L,-2);
      lua_rawset(L,-3);
      lua_pushliteral(L,"z");
      lua_pushliteral(L,"z");
      lua_gettable(L,72);
      lua_rawset(L,-3);
      lua_replace(L,72);
      assert(lua_gettop(L) == 82);
      
      /* if def then */
      enum { lc187 = 82 };
      if (lua_toboolean(L,82)) {
        
        /* if math.random(20) <= def.density then */
        enum { lc188 = 82 };
        lua_getfield(L,LUA_ENVIRONINDEX,"math");
        lua_pushliteral(L,"random");
        lua_gettable(L,-2);
        lua_remove(L,-2);
        lua_pushnumber(L,20);
        lua_call(L,1,1);
        lua_pushliteral(L,"density");
        lua_gettable(L,82);
        const int lc189 = lc_le(L,-2,-1);
        lua_pop(L,2);
        lua_pushboolean(L,lc189);
        const int lc190 = lua_toboolean(L,-1);
        lua_pop(L,1);
        if (lc190) {
          
          /* trees[tree].method(pos, tree) */
          lua_getfield(L,LUA_ENVIRONINDEX,"trees");
          lua_pushvalue(L,81);
          lua_gettable(L,-2);
          lua_remove(L,-2);
          lua_pushliteral(L,"method");
          lua_gettable(L,-2);
          lua_remove(L,-2);
          lua_pushvalue(L,72);
          lua_pushvalue(L,81);
          lua_call(L,2,0);
          assert(lua_gettop(L) == 82);
        }
        lua_settop(L,lc188);
        assert(lua_gettop(L) == 82);
      }
      lua_settop(L,lc187);
      assert(lua_gettop(L) == 82);
    }
    lua_settop(L,lc166);
    assert(lua_gettop(L) == 72);
    
    /* internal: stack cleanup on scope exit */
    lua_pop(L,2);
  }
  lua_settop(L,lc165);
  assert(lua_gettop(L) == 67);
  
  /* local t3 = os.clock() */
  lua_getfield(L,LUA_ENVIRONINDEX,"os");
  lua_pushliteral(L,"clock");
  lua_gettable(L,-2);
  lua_remove(L,-2);
  lua_call(L,0,1);
  assert(lua_gettop(L) == 68);
  
  /* local chugent1 = math.ceil((t1 - t0) * 1000) / 1000 */
  lua_getfield(L,LUA_ENVIRONINDEX,"math");
  lua_pushliteral(L,"ceil");
  lua_gettable(L,-2);
  lua_remove(L,-2);
  lc_sub(L,63,3);
  lua_pushnumber(L,1000);
  lc_mul(L,-2,-1);
  lua_remove(L,-2);
  lua_remove(L,-2);
  lua_call(L,1,1);
  lua_pushnumber(L,1000);
  lc_div(L,-2,-1);
  lua_remove(L,-2);
  lua_remove(L,-2);
  assert(lua_gettop(L) == 69);
  
  /* local chugent2 = math.ceil((t2 - t1) * 1000) / 1000 */
  lua_getfield(L,LUA_ENVIRONINDEX,"math");
  lua_pushliteral(L,"ceil");
  lua_gettable(L,-2);
  lua_remove(L,-2);
  lc_sub(L,65,63);
  lua_pushnumber(L,1000);
  lc_mul(L,-2,-1);
  lua_remove(L,-2);
  lua_remove(L,-2);
  lua_call(L,1,1);
  lua_pushnumber(L,1000);
  lc_div(L,-2,-1);
  lua_remove(L,-2);
  lua_remove(L,-2);
  assert(lua_gettop(L) == 70);
  
  /* local chugent3 = math.ceil((t3 - t2) * 1000) / 1000 */
  lua_getfield(L,LUA_ENVIRONINDEX,"math");
  lua_pushliteral(L,"ceil");
  lua_gettable(L,-2);
  lua_remove(L,-2);
  lc_sub(L,68,65);
  lua_pushnumber(L,1000);
  lc_mul(L,-2,-1);
  lua_remove(L,-2);
  lua_remove(L,-2);
  lua_call(L,1,1);
  lua_pushnumber(L,1000);
  lc_div(L,-2,-1);
  lua_remove(L,-2);
  lua_remove(L,-2);
  assert(lua_gettop(L) == 71);
  
  /* print ("[forest] Base map "..chugent1.." sec, Ores "..chugent2.." sec, Trees "..chugent3.." sec. Total "..chugent1 + chugent2 + chugent3.." sec.") */
  lua_getfield(L,LUA_ENVIRONINDEX,"print");
  lua_pushliteral(L,"[forest] Base map ");
  lua_pushvalue(L,69);
  lua_pushliteral(L," sec, Ores ");
  lua_pushvalue(L,70);
  lua_pushliteral(L," sec, Trees ");
  lua_pushvalue(L,71);
  lua_pushliteral(L," sec. Total ");
  lc_add(L,69,70);
  lc_add(L,-1,71);
  lua_remove(L,-2);
  lua_pushliteral(L," sec.");
  lua_concat(L,2);
  lua_concat(L,2);
  lua_concat(L,2);
  lua_concat(L,2);
  lua_concat(L,2);
  lua_concat(L,2);
  lua_concat(L,2);
  lua_concat(L,2);
  lua_call(L,1,0);
  assert(lua_gettop(L) == 71);
  return 0;
}


/* name: spawn_player
 * function(player) */
static int lcf1_spawn_player (lua_State * L) {
  enum { lc_nformalargs = 1 };
  lua_settop(L,1);
  
  /* local pr = PseudoRandom(math.random(1000000)) */
  lua_getfield(L,LUA_ENVIRONINDEX,"PseudoRandom");
  const int lc192 = lua_gettop(L);
  lua_getfield(L,LUA_ENVIRONINDEX,"math");
  lua_pushliteral(L,"random");
  lua_gettable(L,-2);
  lua_remove(L,-2);
  lua_pushnumber(L,1000000);
  lua_call(L,1,LUA_MULTRET);
  lua_call(L,(lua_gettop(L) - lc192),1);
  assert(lua_gettop(L) == 2);
  
  /* local pos = {x = pr:next(-250, 250), z = pr:next(-250, 250)} */
  lua_createtable(L,0,2);
  lua_pushliteral(L,"x");
  lua_pushvalue(L,2);
  lua_pushliteral(L,"next");
  lua_gettable(L,-2);
  lua_insert(L,-2);
  lua_pushnumber(L,-250);
  lua_pushnumber(L,250);
  lua_call(L,3,1);
  lua_rawset(L,-3);
  lua_pushliteral(L,"z");
  lua_pushvalue(L,2);
  lua_pushliteral(L,"next");
  lua_gettable(L,-2);
  lua_insert(L,-2);
  lua_pushnumber(L,-250);
  lua_pushnumber(L,250);
  lua_call(L,3,1);
  lua_rawset(L,-3);
  assert(lua_gettop(L) == 3);
  
  /* local elevation = get_elevation(pos) */
  lua_getfield(L,LUA_ENVIRONINDEX,"get_elevation");
  lua_pushvalue(L,3);
  lua_call(L,1,1);
  assert(lua_gettop(L) == 4);
  
  /* local dir */
  lua_settop(L,(lua_gettop(L) + 1));
  assert(lua_gettop(L) == 5);
  
  /* local noise = minetest.get_perlin(5096, 3, 0.6, 600) */
  lua_getfield(L,LUA_ENVIRONINDEX,"minetest");
  lua_pushliteral(L,"get_perlin");
  lua_gettable(L,-2);
  lua_remove(L,-2);
  lua_pushnumber(L,5096);
  lua_pushnumber(L,3);
  lua_pushnumber(L,0.6);
  lua_pushnumber(L,600);
  lua_call(L,4,1);
  assert(lua_gettop(L) == 6);
  
  /* while elevation < 2 and noise:get2d({x = pos.x, y = pos.z}) <= 0.85 do */
  enum { lc193 = 6 };
  while (1) {
    lua_pushnumber(L,2);
    const int lc194 = lua_lessthan(L,4,-1);
    lua_pop(L,1);
    lua_pushboolean(L,lc194);
    if (lua_toboolean(L,-1)) {
      lua_pop(L,1);
      lua_pushvalue(L,6);
      lua_pushliteral(L,"get2d");
      lua_gettable(L,-2);
      lua_insert(L,-2);
      lua_createtable(L,0,2);
      lua_pushliteral(L,"x");
      lua_pushliteral(L,"x");
      lua_gettable(L,3);
      lua_rawset(L,-3);
      lua_pushliteral(L,"y");
      lua_pushliteral(L,"z");
      lua_gettable(L,3);
      lua_rawset(L,-3);
      lua_call(L,2,1);
      lua_pushnumber(L,0.85);
      const int lc195 = lc_le(L,-2,-1);
      lua_pop(L,2);
      lua_pushboolean(L,lc195);
    }
    if (!(lua_toboolean(L,-1))) {
      break;
    }
    lua_pop(L,1);
    
    /* dir = pr:next(1, 4) */
    lua_pushvalue(L,2);
    lua_pushliteral(L,"next");
    lua_gettable(L,-2);
    lua_insert(L,-2);
    lua_pushnumber(L,1);
    lua_pushnumber(L,4);
    lua_call(L,3,1);
    lua_replace(L,5);
    assert(lua_gettop(L) == 6);
    
    /* if dir == 1 then */
    enum { lc196 = 6 };
    lua_pushnumber(L,1);
    const int lc197 = lua_equal(L,5,-1);
    lua_pop(L,1);
    lua_pushboolean(L,lc197);
    const int lc198 = lua_toboolean(L,-1);
    lua_pop(L,1);
    if (lc198) {
      
      /* pos = {x = pos.x + 1, z = pos.z} */
      lua_createtable(L,0,2);
      lua_pushliteral(L,"x");
      lua_pushliteral(L,"x");
      lua_gettable(L,3);
      lua_pushnumber(L,1);
      lc_add(L,-2,-1);
      lua_remove(L,-2);
      lua_remove(L,-2);
      lua_rawset(L,-3);
      lua_pushliteral(L,"z");
      lua_pushliteral(L,"z");
      lua_gettable(L,3);
      lua_rawset(L,-3);
      lua_replace(L,3);
      assert(lua_gettop(L) == 6);
    }
    else {
      
      /* elseif dir == 2 then */
      enum { lc199 = 6 };
      lua_pushnumber(L,2);
      const int lc200 = lua_equal(L,5,-1);
      lua_pop(L,1);
      lua_pushboolean(L,lc200);
      const int lc201 = lua_toboolean(L,-1);
      lua_pop(L,1);
      if (lc201) {
        
        /* pos = {x = pos.x - 1, z = pos.z} */
        lua_createtable(L,0,2);
        lua_pushliteral(L,"x");
        lua_pushliteral(L,"x");
        lua_gettable(L,3);
        lua_pushnumber(L,1);
        lc_sub(L,-2,-1);
        lua_remove(L,-2);
        lua_remove(L,-2);
        lua_rawset(L,-3);
        lua_pushliteral(L,"z");
        lua_pushliteral(L,"z");
        lua_gettable(L,3);
        lua_rawset(L,-3);
        lua_replace(L,3);
        assert(lua_gettop(L) == 6);
      }
      else {
        
        /* elseif dir == 3 then */
        enum { lc202 = 6 };
        lua_pushnumber(L,3);
        const int lc203 = lua_equal(L,5,-1);
        lua_pop(L,1);
        lua_pushboolean(L,lc203);
        const int lc204 = lua_toboolean(L,-1);
        lua_pop(L,1);
        if (lc204) {
          
          /* pos = {x = pos.x, z = pos.z + 1} */
          lua_createtable(L,0,2);
          lua_pushliteral(L,"x");
          lua_pushliteral(L,"x");
          lua_gettable(L,3);
          lua_rawset(L,-3);
          lua_pushliteral(L,"z");
          lua_pushliteral(L,"z");
          lua_gettable(L,3);
          lua_pushnumber(L,1);
          lc_add(L,-2,-1);
          lua_remove(L,-2);
          lua_remove(L,-2);
          lua_rawset(L,-3);
          lua_replace(L,3);
          assert(lua_gettop(L) == 6);
        }
        else {
          
          /* elseif dir == 4 then */
          enum { lc205 = 6 };
          lua_pushnumber(L,4);
          const int lc206 = lua_equal(L,5,-1);
          lua_pop(L,1);
          lua_pushboolean(L,lc206);
          const int lc207 = lua_toboolean(L,-1);
          lua_pop(L,1);
          if (lc207) {
            
            /* pos = {x = pos.x, z = pos.z - 1} */
            lua_createtable(L,0,2);
            lua_pushliteral(L,"x");
            lua_pushliteral(L,"x");
            lua_gettable(L,3);
            lua_rawset(L,-3);
            lua_pushliteral(L,"z");
            lua_pushliteral(L,"z");
            lua_gettable(L,3);
            lua_pushnumber(L,1);
            lc_sub(L,-2,-1);
            lua_remove(L,-2);
            lua_remove(L,-2);
            lua_rawset(L,-3);
            lua_replace(L,3);
            assert(lua_gettop(L) == 6);
          }
          lua_settop(L,lc205);
        }
        lua_settop(L,lc202);
      }
      lua_settop(L,lc199);
    }
    lua_settop(L,lc196);
    assert(lua_gettop(L) == 6);
    
    /* elevation = get_elevation(pos) */
    lua_getfield(L,LUA_ENVIRONINDEX,"get_elevation");
    lua_pushvalue(L,3);
    lua_call(L,1,1);
    lua_replace(L,4);
    assert(lua_gettop(L) == 6);
  }
  lua_settop(L,lc193);
  assert(lua_gettop(L) == 6);
  
  /* pos = {x = pos.x, y = elevation + 2, z = pos.z} */
  lua_createtable(L,0,3);
  lua_pushliteral(L,"x");
  lua_pushliteral(L,"x");
  lua_gettable(L,3);
  lua_rawset(L,-3);
  lua_pushliteral(L,"y");
  lua_pushnumber(L,2);
  lc_add(L,4,-1);
  lua_remove(L,-2);
  lua_rawset(L,-3);
  lua_pushliteral(L,"z");
  lua_pushliteral(L,"z");
  lua_gettable(L,3);
  lua_rawset(L,-3);
  lua_replace(L,3);
  assert(lua_gettop(L) == 6);
  
  /* player:setpos(pos) */
  lua_pushvalue(L,1);
  lua_pushliteral(L,"setpos");
  lua_gettable(L,-2);
  lua_insert(L,-2);
  lua_pushvalue(L,3);
  lua_call(L,2,0);
  assert(lua_gettop(L) == 6);
  return 0;
}


/* function(player) */
static int lcf208 (lua_State * L) {
  enum { lc_nformalargs = 1 };
  lua_settop(L,1);
  
  /* spawn_player(player) */
  lua_getfield(L,LUA_ENVIRONINDEX,"spawn_player");
  lua_pushvalue(L,1);
  lua_call(L,1,0);
  assert(lua_gettop(L) == 1);
  return 0;
}


/* function(player) */
static int lcf209 (lua_State * L) {
  enum { lc_nformalargs = 1 };
  lua_settop(L,1);
  
  /* spawn_player(player) */
  lua_getfield(L,LUA_ENVIRONINDEX,"spawn_player");
  lua_pushvalue(L,1);
  lua_call(L,1,0);
  assert(lua_gettop(L) == 1);
  
  /* return true */
  lua_pushboolean(L,1);
  return 1;
  assert(lua_gettop(L) == 1);
}


/* name: (main)
 * function(...) */
static int lcf_main (lua_State * L) {
  lua_checkstack(L,27);
  enum { lc_nformalargs = 0 };
  const int lc_nactualargs = lua_gettop(L);
  const int lc_nextra = (lc_nactualargs - lc_nformalargs);
  
  /* -- 3D noises
   * local np_n1 = {
   * 	offset = 0,
   * 	scale = 1,
   * 	spread = {x=30, y=30, z=30},
   * 	seed = 5203,
   * 	octaves = 3,
   * 	persist = 0.6
   * } */
  lc_newclosuretable(L,lua_upvalueindex(1));
  enum { lc1 = 1 };
  assert((lua_gettop(L) == (lc1 + lc_nextra)));
  lua_createtable(L,0,6);
  lua_pushliteral(L,"offset");
  lua_pushnumber(L,0);
  lua_rawset(L,-3);
  lua_pushliteral(L,"scale");
  lua_pushnumber(L,1);
  lua_rawset(L,-3);
  lua_pushliteral(L,"spread");
  lua_createtable(L,0,3);
  lua_pushliteral(L,"x");
  lua_pushnumber(L,30);
  lua_rawset(L,-3);
  lua_pushliteral(L,"y");
  lua_pushnumber(L,30);
  lua_rawset(L,-3);
  lua_pushliteral(L,"z");
  lua_pushnumber(L,30);
  lua_rawset(L,-3);
  lua_rawset(L,-3);
  lua_pushliteral(L,"seed");
  lua_pushnumber(L,5203);
  lua_rawset(L,-3);
  lua_pushliteral(L,"octaves");
  lua_pushnumber(L,3);
  lua_rawset(L,-3);
  lua_pushliteral(L,"persist");
  lua_pushnumber(L,0.6);
  lua_rawset(L,-3);
  lua_rawseti(L,(lc1 + lc_nextra),1);
  assert(lua_gettop(L) - lc_nextra == 1);
  
  /* local np_n2 = {
   * 	offset = 0,
   * 	scale = 1,
   * 	spread = {x=30, y=30, z=30},
   * 	seed = 7660,
   * 	octaves = 3,
   * 	persist = 0.6
   * } */
  lc_newclosuretable(L,(lc1 + lc_nextra));
  enum { lc2 = 2 };
  assert((lua_gettop(L) == (lc2 + lc_nextra)));
  lua_createtable(L,0,6);
  lua_pushliteral(L,"offset");
  lua_pushnumber(L,0);
  lua_rawset(L,-3);
  lua_pushliteral(L,"scale");
  lua_pushnumber(L,1);
  lua_rawset(L,-3);
  lua_pushliteral(L,"spread");
  lua_createtable(L,0,3);
  lua_pushliteral(L,"x");
  lua_pushnumber(L,30);
  lua_rawset(L,-3);
  lua_pushliteral(L,"y");
  lua_pushnumber(L,30);
  lua_rawset(L,-3);
  lua_pushliteral(L,"z");
  lua_pushnumber(L,30);
  lua_rawset(L,-3);
  lua_rawset(L,-3);
  lua_pushliteral(L,"seed");
  lua_pushnumber(L,7660);
  lua_rawset(L,-3);
  lua_pushliteral(L,"octaves");
  lua_pushnumber(L,3);
  lua_rawset(L,-3);
  lua_pushliteral(L,"persist");
  lua_pushnumber(L,0.6);
  lua_rawset(L,-3);
  lua_rawseti(L,(lc2 + lc_nextra),2);
  assert(lua_gettop(L) - lc_nextra == 2);
  
  /* local np_n3 = {
   * 	offset = 0,
   * 	scale = 1,
   * 	spread = {x=30, y=30, z=30},
   * 	seed = 3289,
   * 	octaves = 3,
   * 	persist = 0.6
   * } */
  lc_newclosuretable(L,(lc2 + lc_nextra));
  enum { lc3 = 3 };
  assert((lua_gettop(L) == (lc3 + lc_nextra)));
  lua_createtable(L,0,6);
  lua_pushliteral(L,"offset");
  lua_pushnumber(L,0);
  lua_rawset(L,-3);
  lua_pushliteral(L,"scale");
  lua_pushnumber(L,1);
  lua_rawset(L,-3);
  lua_pushliteral(L,"spread");
  lua_createtable(L,0,3);
  lua_pushliteral(L,"x");
  lua_pushnumber(L,30);
  lua_rawset(L,-3);
  lua_pushliteral(L,"y");
  lua_pushnumber(L,30);
  lua_rawset(L,-3);
  lua_pushliteral(L,"z");
  lua_pushnumber(L,30);
  lua_rawset(L,-3);
  lua_rawset(L,-3);
  lua_pushliteral(L,"seed");
  lua_pushnumber(L,3289);
  lua_rawset(L,-3);
  lua_pushliteral(L,"octaves");
  lua_pushnumber(L,3);
  lua_rawset(L,-3);
  lua_pushliteral(L,"persist");
  lua_pushnumber(L,0.6);
  lua_rawset(L,-3);
  lua_rawseti(L,(lc3 + lc_nextra),3);
  assert(lua_gettop(L) - lc_nextra == 3);
  
  /* local np_n4 = {
   * 	offset = 0,
   * 	scale = 1,
   * 	spread = {x=150, y=150, z=150},
   * 	seed = 5435,
   * 	octaves = 3,
   * 	persist = 0.6
   * } */
  lc_newclosuretable(L,(lc3 + lc_nextra));
  enum { lc4 = 4 };
  assert((lua_gettop(L) == (lc4 + lc_nextra)));
  lua_createtable(L,0,6);
  lua_pushliteral(L,"offset");
  lua_pushnumber(L,0);
  lua_rawset(L,-3);
  lua_pushliteral(L,"scale");
  lua_pushnumber(L,1);
  lua_rawset(L,-3);
  lua_pushliteral(L,"spread");
  lua_createtable(L,0,3);
  lua_pushliteral(L,"x");
  lua_pushnumber(L,150);
  lua_rawset(L,-3);
  lua_pushliteral(L,"y");
  lua_pushnumber(L,150);
  lua_rawset(L,-3);
  lua_pushliteral(L,"z");
  lua_pushnumber(L,150);
  lua_rawset(L,-3);
  lua_rawset(L,-3);
  lua_pushliteral(L,"seed");
  lua_pushnumber(L,5435);
  lua_rawset(L,-3);
  lua_pushliteral(L,"octaves");
  lua_pushnumber(L,3);
  lua_rawset(L,-3);
  lua_pushliteral(L,"persist");
  lua_pushnumber(L,0.6);
  lua_rawset(L,-3);
  lua_rawseti(L,(lc4 + lc_nextra),4);
  assert(lua_gettop(L) - lc_nextra == 4);
  
  /* -- 2D noises
   * local np_n5 = {
   * 	offset = 0,
   * 	scale = 1,
   * 	spread = {x=80, y=80, z=80},
   * 	seed = 9849,
   * 	octaves = 3,
   * 	persist = 0.6
   * } */
  lc_newclosuretable(L,(lc4 + lc_nextra));
  enum { lc5 = 5 };
  assert((lua_gettop(L) == (lc5 + lc_nextra)));
  lua_createtable(L,0,6);
  lua_pushliteral(L,"offset");
  lua_pushnumber(L,0);
  lua_rawset(L,-3);
  lua_pushliteral(L,"scale");
  lua_pushnumber(L,1);
  lua_rawset(L,-3);
  lua_pushliteral(L,"spread");
  lua_createtable(L,0,3);
  lua_pushliteral(L,"x");
  lua_pushnumber(L,80);
  lua_rawset(L,-3);
  lua_pushliteral(L,"y");
  lua_pushnumber(L,80);
  lua_rawset(L,-3);
  lua_pushliteral(L,"z");
  lua_pushnumber(L,80);
  lua_rawset(L,-3);
  lua_rawset(L,-3);
  lua_pushliteral(L,"seed");
  lua_pushnumber(L,9849);
  lua_rawset(L,-3);
  lua_pushliteral(L,"octaves");
  lua_pushnumber(L,3);
  lua_rawset(L,-3);
  lua_pushliteral(L,"persist");
  lua_pushnumber(L,0.6);
  lua_rawset(L,-3);
  lua_rawseti(L,(lc5 + lc_nextra),5);
  assert(lua_gettop(L) - lc_nextra == 5);
  
  /* local np_n6 = {
   * 	offset = 0,
   * 	scale = 1,
   * 	spread = {x=200, y=200, z=200},
   * 	seed = 7237,
   * 	octaves = 3,
   * 	persist = 0.6
   * } */
  lc_newclosuretable(L,(lc5 + lc_nextra));
  enum { lc6 = 6 };
  assert((lua_gettop(L) == (lc6 + lc_nextra)));
  lua_createtable(L,0,6);
  lua_pushliteral(L,"offset");
  lua_pushnumber(L,0);
  lua_rawset(L,-3);
  lua_pushliteral(L,"scale");
  lua_pushnumber(L,1);
  lua_rawset(L,-3);
  lua_pushliteral(L,"spread");
  lua_createtable(L,0,3);
  lua_pushliteral(L,"x");
  lua_pushnumber(L,200);
  lua_rawset(L,-3);
  lua_pushliteral(L,"y");
  lua_pushnumber(L,200);
  lua_rawset(L,-3);
  lua_pushliteral(L,"z");
  lua_pushnumber(L,200);
  lua_rawset(L,-3);
  lua_rawset(L,-3);
  lua_pushliteral(L,"seed");
  lua_pushnumber(L,7237);
  lua_rawset(L,-3);
  lua_pushliteral(L,"octaves");
  lua_pushnumber(L,3);
  lua_rawset(L,-3);
  lua_pushliteral(L,"persist");
  lua_pushnumber(L,0.6);
  lua_rawset(L,-3);
  lua_rawseti(L,(lc6 + lc_nextra),6);
  assert(lua_gettop(L) - lc_nextra == 6);
  
  /* local np_n7 = {
   * 	offset = 0,
   * 	scale = 1,
   * 	spread = {x=600, y=600, z=600},
   * 	seed = 5096,
   * 	octaves = 3,
   * 	persist = 0.6
   * } */
  lc_newclosuretable(L,(lc6 + lc_nextra));
  enum { lc7 = 7 };
  assert((lua_gettop(L) == (lc7 + lc_nextra)));
  lua_createtable(L,0,6);
  lua_pushliteral(L,"offset");
  lua_pushnumber(L,0);
  lua_rawset(L,-3);
  lua_pushliteral(L,"scale");
  lua_pushnumber(L,1);
  lua_rawset(L,-3);
  lua_pushliteral(L,"spread");
  lua_createtable(L,0,3);
  lua_pushliteral(L,"x");
  lua_pushnumber(L,600);
  lua_rawset(L,-3);
  lua_pushliteral(L,"y");
  lua_pushnumber(L,600);
  lua_rawset(L,-3);
  lua_pushliteral(L,"z");
  lua_pushnumber(L,600);
  lua_rawset(L,-3);
  lua_rawset(L,-3);
  lua_pushliteral(L,"seed");
  lua_pushnumber(L,5096);
  lua_rawset(L,-3);
  lua_pushliteral(L,"octaves");
  lua_pushnumber(L,3);
  lua_rawset(L,-3);
  lua_pushliteral(L,"persist");
  lua_pushnumber(L,0.6);
  lua_rawset(L,-3);
  lua_rawseti(L,(lc7 + lc_nextra),7);
  assert(lua_gettop(L) - lc_nextra == 7);
  
  /* local np_n8 = {
   * 	offset = 0,
   * 	scale = 1,
   * 	spread = {x=20, y=20, z=20},
   * 	seed = 7230,
   * 	octaves = 3,
   * 	persist = 0.6
   * } */
  lc_newclosuretable(L,(lc7 + lc_nextra));
  enum { lc8 = 8 };
  assert((lua_gettop(L) == (lc8 + lc_nextra)));
  lua_createtable(L,0,6);
  lua_pushliteral(L,"offset");
  lua_pushnumber(L,0);
  lua_rawset(L,-3);
  lua_pushliteral(L,"scale");
  lua_pushnumber(L,1);
  lua_rawset(L,-3);
  lua_pushliteral(L,"spread");
  lua_createtable(L,0,3);
  lua_pushliteral(L,"x");
  lua_pushnumber(L,20);
  lua_rawset(L,-3);
  lua_pushliteral(L,"y");
  lua_pushnumber(L,20);
  lua_rawset(L,-3);
  lua_pushliteral(L,"z");
  lua_pushnumber(L,20);
  lua_rawset(L,-3);
  lua_rawset(L,-3);
  lua_pushliteral(L,"seed");
  lua_pushnumber(L,7230);
  lua_rawset(L,-3);
  lua_pushliteral(L,"octaves");
  lua_pushnumber(L,3);
  lua_rawset(L,-3);
  lua_pushliteral(L,"persist");
  lua_pushnumber(L,0.6);
  lua_rawset(L,-3);
  lua_rawseti(L,(lc8 + lc_nextra),8);
  assert(lua_gettop(L) - lc_nextra == 8);
  
  /* local np_n9 = {
   * 	offset = 0,
   * 	scale = 1,
   * 	spread = {x=20, y=20, z=20},
   * 	seed = 9933,
   * 	octaves = 3,
   * 	persist = 0.6
   * } */
  lc_newclosuretable(L,(lc8 + lc_nextra));
  enum { lc9 = 9 };
  assert((lua_gettop(L) == (lc9 + lc_nextra)));
  lua_createtable(L,0,6);
  lua_pushliteral(L,"offset");
  lua_pushnumber(L,0);
  lua_rawset(L,-3);
  lua_pushliteral(L,"scale");
  lua_pushnumber(L,1);
  lua_rawset(L,-3);
  lua_pushliteral(L,"spread");
  lua_createtable(L,0,3);
  lua_pushliteral(L,"x");
  lua_pushnumber(L,20);
  lua_rawset(L,-3);
  lua_pushliteral(L,"y");
  lua_pushnumber(L,20);
  lua_rawset(L,-3);
  lua_pushliteral(L,"z");
  lua_pushnumber(L,20);
  lua_rawset(L,-3);
  lua_rawset(L,-3);
  lua_pushliteral(L,"seed");
  lua_pushnumber(L,9933);
  lua_rawset(L,-3);
  lua_pushliteral(L,"octaves");
  lua_pushnumber(L,3);
  lua_rawset(L,-3);
  lua_pushliteral(L,"persist");
  lua_pushnumber(L,0.6);
  lua_rawset(L,-3);
  lua_rawseti(L,(lc9 + lc_nextra),9);
  assert(lua_gettop(L) - lc_nextra == 9);
  
  /* -- elevation noises
   * local np_n1e = {
   * 	offset = 0,
   * 	scale = 1,
   * 	spread = {x=50, y=50, z=50},
   * 	seed = 6831,
   * 	octaves = 3,
   * 	persist = 0.2
   * } */
  lc_newclosuretable(L,(lc9 + lc_nextra));
  enum { lc10 = 10 };
  assert((lua_gettop(L) == (lc10 + lc_nextra)));
  lua_createtable(L,0,6);
  lua_pushliteral(L,"offset");
  lua_pushnumber(L,0);
  lua_rawset(L,-3);
  lua_pushliteral(L,"scale");
  lua_pushnumber(L,1);
  lua_rawset(L,-3);
  lua_pushliteral(L,"spread");
  lua_createtable(L,0,3);
  lua_pushliteral(L,"x");
  lua_pushnumber(L,50);
  lua_rawset(L,-3);
  lua_pushliteral(L,"y");
  lua_pushnumber(L,50);
  lua_rawset(L,-3);
  lua_pushliteral(L,"z");
  lua_pushnumber(L,50);
  lua_rawset(L,-3);
  lua_rawset(L,-3);
  lua_pushliteral(L,"seed");
  lua_pushnumber(L,6831);
  lua_rawset(L,-3);
  lua_pushliteral(L,"octaves");
  lua_pushnumber(L,3);
  lua_rawset(L,-3);
  lua_pushliteral(L,"persist");
  lua_pushnumber(L,0.2);
  lua_rawset(L,-3);
  lua_rawseti(L,(lc10 + lc_nextra),10);
  assert(lua_gettop(L) - lc_nextra == 10);
  
  /* local np_n2e = {
   * 	offset = 0,
   * 	scale = 1,
   * 	spread = {x=50, y=50, z=50},
   * 	seed = 1590,
   * 	octaves = 3,
   * 	persist = 0.2
   * } */
  lc_newclosuretable(L,(lc10 + lc_nextra));
  enum { lc11 = 11 };
  assert((lua_gettop(L) == (lc11 + lc_nextra)));
  lua_createtable(L,0,6);
  lua_pushliteral(L,"offset");
  lua_pushnumber(L,0);
  lua_rawset(L,-3);
  lua_pushliteral(L,"scale");
  lua_pushnumber(L,1);
  lua_rawset(L,-3);
  lua_pushliteral(L,"spread");
  lua_createtable(L,0,3);
  lua_pushliteral(L,"x");
  lua_pushnumber(L,50);
  lua_rawset(L,-3);
  lua_pushliteral(L,"y");
  lua_pushnumber(L,50);
  lua_rawset(L,-3);
  lua_pushliteral(L,"z");
  lua_pushnumber(L,50);
  lua_rawset(L,-3);
  lua_rawset(L,-3);
  lua_pushliteral(L,"seed");
  lua_pushnumber(L,1590);
  lua_rawset(L,-3);
  lua_pushliteral(L,"octaves");
  lua_pushnumber(L,3);
  lua_rawset(L,-3);
  lua_pushliteral(L,"persist");
  lua_pushnumber(L,0.2);
  lua_rawset(L,-3);
  lua_rawseti(L,(lc11 + lc_nextra),11);
  assert(lua_gettop(L) - lc_nextra == 11);
  
  /* local np_n3e = {
   * 	offset = 0,
   * 	scale = 1,
   * 	spread = {x=25, y=25, z=25},
   * 	seed = 4385,
   * 	octaves = 3,
   * 	persist = 0.2
   * } */
  lc_newclosuretable(L,(lc11 + lc_nextra));
  enum { lc12 = 12 };
  assert((lua_gettop(L) == (lc12 + lc_nextra)));
  lua_createtable(L,0,6);
  lua_pushliteral(L,"offset");
  lua_pushnumber(L,0);
  lua_rawset(L,-3);
  lua_pushliteral(L,"scale");
  lua_pushnumber(L,1);
  lua_rawset(L,-3);
  lua_pushliteral(L,"spread");
  lua_createtable(L,0,3);
  lua_pushliteral(L,"x");
  lua_pushnumber(L,25);
  lua_rawset(L,-3);
  lua_pushliteral(L,"y");
  lua_pushnumber(L,25);
  lua_rawset(L,-3);
  lua_pushliteral(L,"z");
  lua_pushnumber(L,25);
  lua_rawset(L,-3);
  lua_rawset(L,-3);
  lua_pushliteral(L,"seed");
  lua_pushnumber(L,4385);
  lua_rawset(L,-3);
  lua_pushliteral(L,"octaves");
  lua_pushnumber(L,3);
  lua_rawset(L,-3);
  lua_pushliteral(L,"persist");
  lua_pushnumber(L,0.2);
  lua_rawset(L,-3);
  lua_rawseti(L,(lc12 + lc_nextra),12);
  assert(lua_gettop(L) - lc_nextra == 12);
  
  /* local np_n4e = {
   * 	offset = 0,
   * 	scale = 1,
   * 	spread = {x=25, y=25, z=25},
   * 	seed = 9726,
   * 	octaves = 3,
   * 	persist = 0.2
   * } */
  lc_newclosuretable(L,(lc12 + lc_nextra));
  enum { lc13 = 13 };
  assert((lua_gettop(L) == (lc13 + lc_nextra)));
  lua_createtable(L,0,6);
  lua_pushliteral(L,"offset");
  lua_pushnumber(L,0);
  lua_rawset(L,-3);
  lua_pushliteral(L,"scale");
  lua_pushnumber(L,1);
  lua_rawset(L,-3);
  lua_pushliteral(L,"spread");
  lua_createtable(L,0,3);
  lua_pushliteral(L,"x");
  lua_pushnumber(L,25);
  lua_rawset(L,-3);
  lua_pushliteral(L,"y");
  lua_pushnumber(L,25);
  lua_rawset(L,-3);
  lua_pushliteral(L,"z");
  lua_pushnumber(L,25);
  lua_rawset(L,-3);
  lua_rawset(L,-3);
  lua_pushliteral(L,"seed");
  lua_pushnumber(L,9726);
  lua_rawset(L,-3);
  lua_pushliteral(L,"octaves");
  lua_pushnumber(L,3);
  lua_rawset(L,-3);
  lua_pushliteral(L,"persist");
  lua_pushnumber(L,0.2);
  lua_rawset(L,-3);
  lua_rawseti(L,(lc13 + lc_nextra),13);
  assert(lua_gettop(L) - lc_nextra == 13);
  
  /* local np_n5e = {
   * 	offset = 0,
   * 	scale = 1,
   * 	spread = {x=10, y=10, z=10},
   * 	seed = 1792,
   * 	octaves = 3,
   * 	persist = 0.2
   * } */
  lc_newclosuretable(L,(lc13 + lc_nextra));
  enum { lc14 = 14 };
  assert((lua_gettop(L) == (lc14 + lc_nextra)));
  lua_createtable(L,0,6);
  lua_pushliteral(L,"offset");
  lua_pushnumber(L,0);
  lua_rawset(L,-3);
  lua_pushliteral(L,"scale");
  lua_pushnumber(L,1);
  lua_rawset(L,-3);
  lua_pushliteral(L,"spread");
  lua_createtable(L,0,3);
  lua_pushliteral(L,"x");
  lua_pushnumber(L,10);
  lua_rawset(L,-3);
  lua_pushliteral(L,"y");
  lua_pushnumber(L,10);
  lua_rawset(L,-3);
  lua_pushliteral(L,"z");
  lua_pushnumber(L,10);
  lua_rawset(L,-3);
  lua_rawset(L,-3);
  lua_pushliteral(L,"seed");
  lua_pushnumber(L,1792);
  lua_rawset(L,-3);
  lua_pushliteral(L,"octaves");
  lua_pushnumber(L,3);
  lua_rawset(L,-3);
  lua_pushliteral(L,"persist");
  lua_pushnumber(L,0.2);
  lua_rawset(L,-3);
  lua_rawseti(L,(lc14 + lc_nextra),14);
  assert(lua_gettop(L) - lc_nextra == 14);
  
  /* local np_n6e = {
   * 	offset = 0,
   * 	scale = 1,
   * 	spread = {x=10, y=10, z=10},
   * 	seed = 1016,
   * 	octaves = 3,
   * 	persist = 0.2
   * } */
  lc_newclosuretable(L,(lc14 + lc_nextra));
  enum { lc15 = 15 };
  assert((lua_gettop(L) == (lc15 + lc_nextra)));
  lua_createtable(L,0,6);
  lua_pushliteral(L,"offset");
  lua_pushnumber(L,0);
  lua_rawset(L,-3);
  lua_pushliteral(L,"scale");
  lua_pushnumber(L,1);
  lua_rawset(L,-3);
  lua_pushliteral(L,"spread");
  lua_createtable(L,0,3);
  lua_pushliteral(L,"x");
  lua_pushnumber(L,10);
  lua_rawset(L,-3);
  lua_pushliteral(L,"y");
  lua_pushnumber(L,10);
  lua_rawset(L,-3);
  lua_pushliteral(L,"z");
  lua_pushnumber(L,10);
  lua_rawset(L,-3);
  lua_rawset(L,-3);
  lua_pushliteral(L,"seed");
  lua_pushnumber(L,1016);
  lua_rawset(L,-3);
  lua_pushliteral(L,"octaves");
  lua_pushnumber(L,3);
  lua_rawset(L,-3);
  lua_pushliteral(L,"persist");
  lua_pushnumber(L,0.2);
  lua_rawset(L,-3);
  lua_rawseti(L,(lc15 + lc_nextra),15);
  assert(lua_gettop(L) - lc_nextra == 15);
  
  /* local np_n7e = {
   * 	offset = 0,
   * 	scale = 1,
   * 	spread = {x=300, y=300, z=300},
   * 	seed = 8110,
   * 	octaves = 3,
   * 	persist = 0.2
   * } */
  lc_newclosuretable(L,(lc15 + lc_nextra));
  enum { lc16 = 16 };
  assert((lua_gettop(L) == (lc16 + lc_nextra)));
  lua_createtable(L,0,6);
  lua_pushliteral(L,"offset");
  lua_pushnumber(L,0);
  lua_rawset(L,-3);
  lua_pushliteral(L,"scale");
  lua_pushnumber(L,1);
  lua_rawset(L,-3);
  lua_pushliteral(L,"spread");
  lua_createtable(L,0,3);
  lua_pushliteral(L,"x");
  lua_pushnumber(L,300);
  lua_rawset(L,-3);
  lua_pushliteral(L,"y");
  lua_pushnumber(L,300);
  lua_rawset(L,-3);
  lua_pushliteral(L,"z");
  lua_pushnumber(L,300);
  lua_rawset(L,-3);
  lua_rawset(L,-3);
  lua_pushliteral(L,"seed");
  lua_pushnumber(L,8110);
  lua_rawset(L,-3);
  lua_pushliteral(L,"octaves");
  lua_pushnumber(L,3);
  lua_rawset(L,-3);
  lua_pushliteral(L,"persist");
  lua_pushnumber(L,0.2);
  lua_rawset(L,-3);
  lua_rawseti(L,(lc16 + lc_nextra),16);
  assert(lua_gettop(L) - lc_nextra == 16);
  
  /* local np_n8e = {
   * 	offset = 0,
   * 	scale = 1,
   * 	spread = {x=400, y=400, z=400},
   * 	seed = 2698,
   * 	octaves = 3,
   * 	persist = 0.2
   * } */
  lc_newclosuretable(L,(lc16 + lc_nextra));
  enum { lc17 = 17 };
  assert((lua_gettop(L) == (lc17 + lc_nextra)));
  lua_createtable(L,0,6);
  lua_pushliteral(L,"offset");
  lua_pushnumber(L,0);
  lua_rawset(L,-3);
  lua_pushliteral(L,"scale");
  lua_pushnumber(L,1);
  lua_rawset(L,-3);
  lua_pushliteral(L,"spread");
  lua_createtable(L,0,3);
  lua_pushliteral(L,"x");
  lua_pushnumber(L,400);
  lua_rawset(L,-3);
  lua_pushliteral(L,"y");
  lua_pushnumber(L,400);
  lua_rawset(L,-3);
  lua_pushliteral(L,"z");
  lua_pushnumber(L,400);
  lua_rawset(L,-3);
  lua_rawset(L,-3);
  lua_pushliteral(L,"seed");
  lua_pushnumber(L,2698);
  lua_rawset(L,-3);
  lua_pushliteral(L,"octaves");
  lua_pushnumber(L,3);
  lua_rawset(L,-3);
  lua_pushliteral(L,"persist");
  lua_pushnumber(L,0.2);
  lua_rawset(L,-3);
  lua_rawseti(L,(lc17 + lc_nextra),17);
  assert(lua_gettop(L) - lc_nextra == 17);
  
  /* -- elevation function for spawnplayer
   * function get_elevation(pos)
   * 	local pos2d = {x = pos.x, y = pos.z}
   * 	local n1 = minetest.get_perlin(6831, 3, 0.2, 50):get2d(pos2d)
   * 	local n2 = minetest.get_perlin(1590, 3, 0.2, 50):get2d(pos2d)
   * 	local n3 = minetest.get_perlin(4385, 3, 0.2, 25):get2d(pos2d)
   * 	local n4 = minetest.get_perlin(9726, 3, 0.2, 25):get2d(pos2d)
   * 	local n5 = minetest.get_perlin(1792, 3, 0.2, 10):get2d(pos2d)
   * 	local n6 = minetest.get_perlin(1016, 3, 0.2, 10):get2d(pos2d)
   * 	local n7 = minetest.get_perlin(8110, 3, 0.2, 300):get2d(pos2d)
   * 	local n8 = minetest.get_perlin(2698, 3, 0.2, 400):get2d(pos2d)
   * 	local value1 = math.abs(n1 - n2) * math.abs(n7)
   * 	local value2 = math.sqrt(value1 * math.abs(n3 - n4)) * math.abs(n7)
   * 	local value3 = math.sqrt(value2 * math.abs(n5 - n6)) * math.abs(n7)
   * 	value1 = value1 + value1 * n8
   * 	value2 = value2 + value2 * n8
   * 	value3 = value3 + value3 * n8
   * 	local value = value1 * 20 + value2 * 15 + value3 * 10 + n8 * 50
   * 	if value < 0 then
   * 		value = -2 * math.sqrt(-value)
   * 	end
   * 	return math.floor(value + 0.5)
   * end */
  lua_pushcfunction(L,lcf1_get_elevation);
  lua_setfield(L,LUA_ENVIRONINDEX,"get_elevation");
  assert(lua_gettop(L) - lc_nextra == 17);
  
  /* -- Set mapgen parameters
   * minetest.register_on_mapgen_init(function(mgparams)
   * 	minetest.set_mapgen_params({mgname="singlenode", flags = "nolight", flagmask = "nolight"})
   * end) */
  lua_getfield(L,LUA_ENVIRONINDEX,"minetest");
  lua_pushliteral(L,"register_on_mapgen_init");
  lua_gettable(L,-2);
  lua_remove(L,-2);
  lua_pushcfunction(L,lcf22);
  lua_call(L,1,0);
  assert(lua_gettop(L) - lc_nextra == 17);
  
  /* ------------------------ Base map generation ------------------------
   * minetest.register_on_generated(function(minp, maxp)
   * 	
   * 	local t0 = os.clock()
   * 	local x1 = maxp.x
   * 	local y1 = maxp.y
   * 	local z1 = maxp.z
   * 	local x0 = minp.x
   * 	local y0 = minp.y
   * 	local z0 = minp.z
   * 	
   * 	print ("[forest] Generating map from "..minetest.pos_to_string(minp).." to "..minetest.pos_to_string(maxp))
   * 	
   * 	local c_dstone = minetest.get_content_id("default:desert_stone")
   * 	local c_dsand = minetest.get_content_id("default:desert_sand")
   * 	local c_water = minetest.get_content_id("default:water_source")
   * 	local c_stone = minetest.get_content_id("default:stone")
   * 	local c_sand = minetest.get_content_id("default:sand")
   * 	local c_grass = minetest.get_content_id("default:dirt_with_grass")
   * 	local c_snow = minetest.get_content_id("default:dirt_with_snow")
   * 	local c_dirt = minetest.get_content_id("default:dirt")
   * 	local c_gravel = minetest.get_content_id("default:gravel")
   * 	local c_grasses = {
   * 		minetest.get_content_id("default:grass_1"),
   * 		minetest.get_content_id("default:grass_2"),
   * 		minetest.get_content_id("default:grass_3"),
   * 		minetest.get_content_id("default:grass_4"),
   * 		minetest.get_content_id("default:grass_5")
   * 	}
   * 	local c_jungle = minetest.get_content_id("default:junglegrass")
   * 	local c_flowers = {minetest.get_content_id("flowers:dandelion_yellow"), minetest.get_content_id("flowers:dandelion_yellow"), minetest.get_content_id("flowers:dandelion_yellow"), minetest.get_content_id("flowers:geranium"), minetest.get_content_id("flowers:tulip"), minetest.get_content_id("flowers:rose")}
   * 	local c_papyrus = minetest.get_content_id("default:papyrus")
   * 	local c_shrub = minetest.get_content_id("default:dry_shrub")
   * 	local c_lava = minetest.get_content_id("default:lava_source")
   * 	local c_cactus = minetest.get_content_id("default:cactus")
   * 	local c_ignore = minetest.get_content_id("ignore")
   * 	local c_air = minetest.get_content_id("air")
   * 	-- LVM stuff
   * 	local manip, emin, emax = minetest.get_mapgen_object("voxelmanip")
   * 	local area = VoxelArea:new({MinEdge = emin, MaxEdge = emax})
   * 	local data = manip:get_data()
   * 	
   * 	local elevation
   * 	local node
   * 	local pos
   * 	local ground1, ground2, ground3, ground4, plant
   * 	
   * 	-- perlinmap stuff
   * 	local sidelen = x1 - x0 + 1
   * 	local chulens = {x=sidelen, y=sidelen, z=sidelen}
   * 	local minposxyz = {x=x0, y=y0, z=z0}
   * 	local minposxz = {x=x0, y=z0}
   * 	-- 3D noises
   * 	local nvals_n1 = minetest.get_perlin_map(np_n1, chulens):get3dMap_flat(minposxyz)
   * 	local nvals_n2 = minetest.get_perlin_map(np_n2, chulens):get3dMap_flat(minposxyz)
   * 	local nvals_n3 = minetest.get_perlin_map(np_n3, chulens):get3dMap_flat(minposxyz)
   * 	local nvals_n4 = minetest.get_perlin_map(np_n4, chulens):get3dMap_flat(minposxyz)
   * 	-- 2D noises
   * 	local nvals_n5 = minetest.get_perlin_map(np_n5, chulens):get2dMap_flat(minposxz)
   * 	local nvals_n6 = minetest.get_perlin_map(np_n6, chulens):get2dMap_flat(minposxz)
   * 	local nvals_n7 = minetest.get_perlin_map(np_n7, chulens):get2dMap_flat(minposxz)
   * 	local nvals_n8 = minetest.get_perlin_map(np_n8, chulens):get2dMap_flat(minposxz)
   * 	local nvals_n9 = minetest.get_perlin_map(np_n9, chulens):get2dMap_flat(minposxz)
   * 	-- elevation 2D noises
   * 	local nvals_n1e = minetest.get_perlin_map(np_n1e, chulens):get2dMap_flat(minposxz)
   * 	local nvals_n2e = minetest.get_perlin_map(np_n2e, chulens):get2dMap_flat(minposxz)
   * 	local nvals_n3e = minetest.get_perlin_map(np_n3e, chulens):get2dMap_flat(minposxz)
   * 	local nvals_n4e = minetest.get_perlin_map(np_n4e, chulens):get2dMap_flat(minposxz)
   * 	local nvals_n5e = minetest.get_perlin_map(np_n5e, chulens):get2dMap_flat(minposxz)
   * 	local nvals_n6e = minetest.get_perlin_map(np_n6e, chulens):get2dMap_flat(minposxz)
   * 	local nvals_n7e = minetest.get_perlin_map(np_n7e, chulens):get2dMap_flat(minposxz)
   * 	local nvals_n8e = minetest.get_perlin_map(np_n8e, chulens):get2dMap_flat(minposxz)
   * 	
   * 	local nixz = 1 -- 2D noise index
   * 	for z = minp.z, maxp.z do
   * 	for x = minp.x, maxp.x do
   * 		local n1 = nvals_n1e[nixz]
   * 		local n2 = nvals_n2e[nixz]
   * 		local n3 = nvals_n3e[nixz]
   * 		local n4 = nvals_n4e[nixz]
   * 		local n5 = nvals_n5e[nixz]
   * 		local n6 = nvals_n6e[nixz]
   * 		local n7 = nvals_n7e[nixz]
   * 		local n8 = nvals_n8e[nixz]
   * 		local value1 = math.abs(n1 - n2) * math.abs(n7)
   * 		local value2 = math.sqrt(value1 * math.abs(n3 - n4)) * math.abs(n7)
   * 		local value3 = math.sqrt(value2 * math.abs(n5 - n6)) * math.abs(n7)
   * 		value1 = value1 + value1 * n8
   * 		value2 = value2 + value2 * n8
   * 		value3 = value3 + value3 * n8
   * 		local value = value1 * 20 + value2 * 15 + value3 * 10 + n8 * 50
   * 		if value < 0 then
   * 			value = -2 * math.sqrt(-value)
   * 		end
   * 		elevation = math.floor(value + 0.5)
   * 		
   * 		if math.max(elevation, 1) >= minp.y then
   * 			n5v = nvals_n5[nixz]
   * 			n6v = nvals_n6[nixz]
   * 			n7v = nvals_n7[nixz]
   * 			n8v = nvals_n8[nixz]
   * 			n9v = nvals_n9[nixz]
   * 			if elevation < n8v * 5 then
   * 				if n7v < 0.88 then
   * 					if n5v - n6v > 0.8 then
   * 						ground1 = c_gravel
   * 						ground2 = c_gravel
   * 						ground3 = c_stone
   * 						ground4 = c_stone
   * 						plant = nil
   * 					elseif n6v < 0 then
   * 						if n5v < -0.4 then
   * 							ground1 = c_dsand
   * 							ground2 = c_dsand
   * 							ground3 = c_dstone
   * 							ground4 = c_stone
   * 							plant = nil
   * 						else
   * 							ground1 = c_sand
   * 							ground2 = c_sand
   * 							ground3 = c_stone
   * 							ground4 = c_stone
   * 							plant = nil
   * 						end
   * 					elseif n5v + n6v * 5 > 2 then
   * 						if n6v > 0.8 then
   * 							ground1 = c_gravel
   * 							ground2 = c_gravel
   * 							ground3 = c_stone
   * 							ground4 = c_stone
   * 							plant = nil
   * 						else
   * 							ground1 = c_grass
   * 							ground2 = c_dirt
   * 							ground3 = c_stone
   * 							ground4 = c_stone
   * 							plant = {def = c_papyrus, percent = 4, height = math.random(2, 5)}
   * 						end
   * 					else
   * 						ground1 = c_sand
   * 						ground2 = c_sand
   * 						ground3 = c_stone
   * 						ground4 = c_stone
   * 						plant = {def = c_grasses[math.random(5)], percent = 15}
   * 					end
   * 				elseif n5v * 2 - n6v < 0 then
   * 					ground1 = c_gravel
   * 					ground2 = c_gravel
   * 					ground3 = c_stone
   * 					ground4 = c_stone
   * 					plant = nil
   * 				else
   * 					ground1 = c_stone
   * 					ground2 = c_stone
   * 					ground3 = c_stone
   * 					ground4 = c_stone
   * 					plant = nil
   * 				end
   * 			elseif n7v < 0.88 then
   * 				if n5v + 2 * n6v > -0.4 then
   * 					if n5v > 0 then
   * 						ground1 = c_grass
   * 						ground2 = c_dirt
   * 						ground3 = c_stone
   * 						ground4 = c_stone
   * 						plant = nil
   * 					else
   * 						ground1 = c_grass
   * 						ground2 = c_dirt
   * 						ground3 = c_stone
   * 						ground4 = c_stone
   * 						if math.random(2) == 2 then
   * 							plant = {def = c_grasses[math.random(5)], percent = 20}
   * 						else
   * 							plant = {def = c_flowers[math.random(6)], percent = -n5v}
   * 						end
   * 					end
   * 				elseif n6v < -0.4 then
   * 					ground1 = c_dsand
   * 					ground2 = c_dsand
   * 					ground3 = c_dstone
   * 					ground4 = c_stone
   * 					if math.random(2) == 2 then
   * 						plant = {def = c_cactus, percent = 2, height = math.random(2, 6)}
   * 					else
   * 						plant = {def = c_shrub, percent = 5}
   * 					end
   * 				else
   * 					ground1 = c_sand
   * 					ground2 = c_sand
   * 					ground3 = c_dstone
   * 					ground4 = c_stone
   * 					if math.random(2) == 2 then
   * 						plant = {def = c_cactus, percent = 0.25, height = math.random(2, 4)}
   * 					else
   * 						plant = {def = c_jungle, percent = 25}
   * 					end
   * 				end
   * 			elseif n5v ^ 2 + n6v ^ 2 < 0.16 and n7v > 0.9 then
   * 				ground1 = c_air
   * 				ground2 = c_lava
   * 				ground3 = c_stone
   * 				ground4 = c_stone
   * 				plant = nil
   * 				elevation = math.min(
   * 					elevation, get_elevation({x = x, z = z + 1}),
   * 					get_elevation({x = x, z = z - 1}),
   * 					get_elevation({x = x + 1, z = z}),
   * 					get_elevation({x = x - 1, z = z})
   * 				)
   * 			elseif n5v > -0.6 then
   * 				ground1 = c_stone
   * 				ground2 = c_stone
   * 				ground3 = c_stone
   * 				ground4 = c_stone
   * 				plant = nil
   * 			else
   * 				ground1 = c_gravel
   * 				ground2 = c_gravel
   * 				ground3 = c_stone
   * 				ground4 = c_stone
   * 				plant = nil
   * 			end
   * 			
   * 			for y = minp.y, math.min(math.max(elevation, 1), maxp.y) do
   * 				pos = area:index(x, y, z) -- LVM index for node
   * 				local nixyz = (z - z0) * 6400 + (y - y0) * 80 + (x - x0) + 1 -- noise index for node
   * 				n1v = nvals_n1[nixyz]
   * 				n2v = nvals_n2[nixyz]
   * 				n3v = nvals_n3[nixyz]
   * 				n4v = nvals_n4[nixyz]
   * 				if y == elevation then
   * 					if elevation >= 1 then
   * 						node = ground1
   * 					else
   * 						node = ground2
   * 					end
   * 				elseif y > elevation then
   * 					node = c_water
   * 				elseif y + math.random(2, 6) >= elevation then
   * 					node = ground2
   * 				elseif y + 20 + n9v * 10 >= elevation then
   * 					node = ground3
   * 				else
   * 					node = ground4
   * 				end
   * 				if math.max(n1v, n2v, n3v) - math.min(n1v, n2v, n3v) > n4v / 5 or node == c_water then
   * 					data[pos] = node
   * 				end
   * 			end
   * 			
   * 			if elevation > 0 and plant then
   * 				if math.random() * 100 < plant.percent then
   * 					if plant.height then
   * 						for i = 1, plant.height do
   * 							if area:contains(x, elevation + i, z) then
   * 								data[area:index(x, elevation + i, z)] = plant.def
   * 							end
   * 						end
   * 					elseif area:contains(x, elevation + 1, z) then
   * 						data[area:index(x, elevation + 1, z)] = plant.def
   * 					end
   * 				end
   * 			end
   * 		end
   * 		nixz = nixz + 1 -- increment 2D noise index
   * 	end
   * 	end
   * 	manip:set_data(data)
   * 	manip:update_liquids()
   * 	manip:calc_lighting()
   * 	manip:write_to_map(data)
   * 
   * ------------------------ Ore generation ------------------------
   * 
   * 	local t1 = os.clock()
   * 	local pr = PseudoRandom(math.random(1000))
   * 	for num, def in pairs(ores) do
   * 		local noise = minetest.get_perlin(def.seed, 1, 0, def.scale)
   * 		if def.gradiant then
   * 			for i = 1, def.frequency do
   * 				local middle = {x = pr:next(minp.x, maxp.x), y = pr:next(minp.y, maxp.y), z = pr:next(minp.z, maxp.z)}
   * 				if noise:get3d(middle) + math.random() * 2 >= 1 and middle.y < def.max_y and middle.y > def.min_y then
   * 					local zone = minetest.find_nodes_in_area(
   * 						{x = middle.x - def.radius, y = middle.y - def.radius, z = middle.z - def.radius},
   * 						{x = middle.x + def.radius, y = middle.y + def.radius, z = middle.z + def.radius},
   * 						{def.wherein}
   * 					)
   * 					for node, pos in pairs(zone) do
   * 						if distance(middle, pos) / (def.radius + 1) - math.random() <= 0 and math.random(100) <= def.density then
   * 							minetest.set_node(pos, {name = def.ore})
   * 						end
   * 					end
   * 				end
   * 				if def.center then
   * 					minetest.set_node(middle, {name = def.center})
   * 				end
   * 			end
   * 		else
   * 			for i = 1, def.frequency do
   * 				local middle = {x = pr:next(minp.x, maxp.x), y = pr:next(minp.y, maxp.y), z = pr:next(minp.z, maxp.z)}
   * 				if noise:get3d(middle) + math.random() * 2 >= 1 and middle.y < def.max_y and middle.y > def.min_y then
   * 					local zone = minetest.find_nodes_in_area(
   * 						{x = middle.x - def.radius, y = middle.y - def.radius, z = middle.z - def.radius},
   * 						{x = middle.x + def.radius, y = middle.y + def.radius, z = middle.z + def.radius},
   * 						{def.wherein}
   * 					)
   * 					for node, pos in pairs(zone) do
   * 						if distance(middle, pos) <= def.radius and math.random(100) >= def.density then
   * 							minetest.set_node(pos, {name = def.ore})
   * 						end
   * 					end
   * 				end
   * 			end
   * 		end
   * 		
   * 	end
   * 
   * ------------------------ Tree generation ------------------------
   * 
   * 	local t2 = os.clock()
   * 	local biomes = minetest.get_perlin(289, 3, 0.6, 200)
   * 	local grass_area = minetest.find_nodes_in_area(minp, maxp, "default:dirt_with_grass")
   * 	for grass, pos in pairs(grass_area) do
   * 		if math.random(12) == math.random(12) then
   * 			local total = 0
   * 			local temperature = get_average_temperature(pos)
   * 			local biome = biomes:get3d(pos) * 50 + 50
   * 			local candidates = {}
   * 			local water = true
   * 			local list = ""
   * 			for specie, def in pairs(apportionment) do
   * 				local difference = (def.biome - biome) ^ 2
   * 				if def.water_proximity then
   * 					if minetest.find_node_near(pos, math.abs(def.water_proximity), {"group:water"}) == nil then
   * 						water = def.water_proximity <= 0
   * 					else
   * 						water = def.water_proximity >= 0
   * 					end
   * 				else
   * 					water = true
   * 				end
   * 				if temperature <= def.temperature.max and temperature >= def.temperature.min and water then
   * 					if difference < def.tolerance ^ 2 then
   * 						local chance = def.frequency * (1 - difference / def.tolerance ^ 2)
   * 						total = total + chance
   * 						candidates[specie] = total
   * 					end
   * 				end
   * 			end
   * 			local num = math.random() * total
   * 			local min = total
   * 			local tree = nil
   * 			for specie, num_chance in pairs(candidates) do
   * 				if num <= num_chance and num_chance <= min then
   * 					tree = specie
   * 					min = num_chance
   * 				end
   * 			end
   * 			local def = apportionment[tree]
   * 			pos = {x = pos.x, y = pos.y + 1, z = pos.z}
   * 			if def then
   * 				if math.random(20) <= def.density then
   * 					trees[tree].method(pos, tree)
   * 				end
   * 			end
   * 		end
   * 	end
   * 	local t3 = os.clock()
   * 	local chugent1 = math.ceil((t1 - t0) * 1000) / 1000
   * 	local chugent2 = math.ceil((t2 - t1) * 1000) / 1000
   * 	local chugent3 = math.ceil((t3 - t2) * 1000) / 1000
   * 	print ("[forest] Base map "..chugent1.." sec, Ores "..chugent2.." sec, Trees "..chugent3.." sec. Total "..chugent1 + chugent2 + chugent3.." sec.")
   * end) */
  lua_getfield(L,LUA_ENVIRONINDEX,"minetest");
  lua_pushliteral(L,"register_on_generated");
  lua_gettable(L,-2);
  lua_remove(L,-2);
  lua_pushvalue(L,(lc17 + lc_nextra));
  lua_pushcclosure(L,lcf191,1);
  lua_call(L,1,0);
  assert(lua_gettop(L) - lc_nextra == 17);
  
  /* function spawn_player(player)
   * 	local pr = PseudoRandom(math.random(1000000))
   * 	local pos = {x = pr:next(-250, 250), z = pr:next(-250, 250)}
   * 	local elevation = get_elevation(pos)
   * 	local dir
   * 	local noise = minetest.get_perlin(5096, 3, 0.6, 600)
   * 	while elevation < 2 and noise:get2d({x = pos.x, y = pos.z}) <= 0.85 do
   * 		dir = pr:next(1, 4)
   * 		if dir == 1 then
   * 			pos = {x = pos.x + 1, z = pos.z}
   * 		elseif dir == 2 then
   * 			pos = {x = pos.x - 1, z = pos.z}
   * 		elseif dir == 3 then
   * 			pos = {x = pos.x, z = pos.z + 1}
   * 		elseif dir == 4 then
   * 			pos = {x = pos.x, z = pos.z - 1}
   * 		end
   * 		elevation = get_elevation(pos)
   * 	end
   * 	pos = {x = pos.x, y = elevation + 2, z = pos.z}
   * 	player:setpos(pos)
   * end */
  lua_pushcfunction(L,lcf1_spawn_player);
  lua_setfield(L,LUA_ENVIRONINDEX,"spawn_player");
  assert(lua_gettop(L) - lc_nextra == 17);
  
  /* minetest.register_on_newplayer(function(player)
   * 	spawn_player(player)
   * end) */
  lua_getfield(L,LUA_ENVIRONINDEX,"minetest");
  lua_pushliteral(L,"register_on_newplayer");
  lua_gettable(L,-2);
  lua_remove(L,-2);
  lua_pushcfunction(L,lcf208);
  lua_call(L,1,0);
  assert(lua_gettop(L) - lc_nextra == 17);
  
  /* minetest.register_on_respawnplayer(function(player)
   * 	spawn_player(player)
   * 	return true
   * end) */
  lua_getfield(L,LUA_ENVIRONINDEX,"minetest");
  lua_pushliteral(L,"register_on_respawnplayer");
  lua_gettable(L,-2);
  lua_remove(L,-2);
  lua_pushcfunction(L,lcf209);
  lua_call(L,1,0);
  assert(lua_gettop(L) - lc_nextra == 17);
  return 0;
}


/* from lua.c */
static int traceback (lua_State *L) {
  if (!lua_isstring(L, 1))  /* 'message' not a string? */
    return 1;  /* keep it intact */
  lua_getfield(L, LUA_GLOBALSINDEX, "debug");
  if (!lua_istable(L, -1)) {
    lua_pop(L, 1);
    return 1;
  }
  lua_getfield(L, -1, "traceback");
  if (!lua_isfunction(L, -1)) {
    lua_pop(L, 2);
    return 1;
  }
  lua_pushvalue(L, 1);  /* pass error message */
  lua_pushinteger(L, 2);  /* skip this function and traceback */
  lua_call(L, 2, 1);  /* call debug.traceback */
  return 1;
}


static void lc_l_message (const char *pname, const char *msg) {
  if (pname) fprintf(stderr, "%s: ", pname);
  fprintf(stderr, "%s\n", msg);
  fflush(stderr);
}

static int lc_report (lua_State *L, int status) {
  if (status && !lua_isnil(L, -1)) {
    const char *msg = lua_tostring(L, -1);
    if (msg == NULL) msg = "(error object is not a string)";
    /*FIX-IMROVE:progname*/
    lc_l_message("lua", msg);
    lua_pop(L, 1);
  }
  return status;
}

static int lc_docall (lua_State *L, int narg, int clear) {
  int status;
  int base = lua_gettop(L) - narg;  /* function index */
  lua_pushcfunction(L, traceback);  /* push traceback function */
  lua_insert(L, base);  /* put it under chunk and args */
  /*FIX? signal(SIGINT, laction); */
  status = lua_pcall(L, narg, (clear ? 0 : LUA_MULTRET), base);
  /*FIX? signal(SIGINT, SIG_DFL); */
  lua_remove(L, base);  /* remove traceback function */
  /* force a complete garbage collection in case of errors */
  if (status != 0) lua_gc(L, LUA_GCCOLLECT, 0);
  return status;
}

static int lc_dofile (lua_State *L, const char *name) {
  int status = luaL_loadfile(L, name) || lc_docall(L, 0, 1);
  return lc_report(L, status);
}

static int lc_dostring (lua_State *L, const char *s, const char *name) {
  int status = luaL_loadbuffer(L, s, strlen(s), name) || lc_docall(L, 0, 1);
  return lc_report(L, status);
}

static int lc_handle_luainit (lua_State *L) {
  const char *init = getenv(LUA_INIT);
  if (init == NULL) return 0;  /* status OK */
  else if (init[0] == '@')
    return lc_dofile(L, init+1);
  else
    return lc_dostring(L, init, "=" LUA_INIT);
}


typedef struct {
  int c;
  const char ** v;
} lc_args_t;


/* create global arg table */
static void lc_createarg(lua_State * L, const lc_args_t * const args) {
  int i;
  lua_newtable(L);
  for (i=0; i < args->c; i++) {
    lua_pushstring(L, args->v[i]);
    lua_rawseti(L, -2, i);
  }
  lua_setglobal(L, "arg");
}


int lc_pmain_mod_forest_mapgen(lua_State * L) {
	  luaL_openlibs(L);

	  lua_pushcfunction(L, traceback);

	  const int status1 = lc_handle_luainit(L);
	  if (status1 != 0) return 0;

	  /* note: IMPROVE: closure not always needed here */
	  lua_newtable(L); /* closure table */
	  lua_pushcclosure(L, lcf_main, 1);

	  int status2 = lua_pcall(L, 0, 0, -2);
	  if (status2 != 0) {
	    const char * msg = lua_tostring(L,-1);
	    if (msg == NULL) msg = "(error object is not a string)";
	    fputs(msg, stderr);
	  }
	  return 0;
	}

